<!doctype html>
<html lang="uz">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>KiberMath.uz — Matematika zamonaviy usulda</title>
  <link rel="stylesheet" href="/assets/css/style.css"/>
</head>
<body data-page="index">
  <!-- Header (partials/header.html fetch orqali ulanadi) -->
  <div id="km-header"></div>

  <main class="container">
    <!-- Hero -->
    <section class="hero">
      <h1>KiberMath — <span class="gradient">zamonaviy</span> matematika platformasi</h1>
      <p>Onlayn testlar, musobaqalar, simulyatorlar va o‘yinlar — barchasi bir joyda. Foydalanuvchi ID, balans va ball tizimi bilan.</p>
      <div class="hero-cta">
        <a href="/namuna.html" class="btn btn-primary">Boshlash</a>
        <a href="/profile.html" class="btn btn-ghost">Profil</a>
      </div>
    </section>

    <!-- Gorizontal HTML carousel (400px) — SLIDElar fetch bilan yuklanadi -->
    <section class="card">
      <div class="h-banner-carousel" id="adsCarousel" aria-label="Reklama karuseli">
        <!-- JS bu yerga .h-slide bloklarini qo‘shadi; har bir .h-slide ichida adsX.html bo‘ladi -->
      </div>
    </section>

    <!-- Pastda 4 ta vertikal HTML banner (600px) — fetch bilan yuklanadi -->
    <section class="card" style="margin-top:16px;">
      <h2 style="margin:8px 0 16px;">Tanlov bannerlari</h2>
      <div class="banner-grid-vertical" id="verticalGrid">
        <!-- JS bu yerga banner1..4.html ni ketma-ket joylaydi -->
      </div>
    </section>

    <!-- Motivatsiya -->
    <section class="card" style="margin-top:16px;">
      <h2 style="margin-top:0">Motivatsion shior</h2>
      <p class="muted">“Har kuni 1 qadam — 365 kunda yangi cho‘qqi.”</p>
    </section>
  </main>

  <!-- Footer (partials/footer.html fetch orqali ulanadi) -->
  <div id="km-footer"></div>

  <!-- Assistive floating menu -->
  <div id="assistiveTouch" title="Kiber menyu"></div>
  <div id="assistiveMenu">
    <a class="btn" href="/index.html">Asosiy</a>
    <a class="btn" href="/profile.html">Profil</a>
    <a class="btn" href="/namuna.html">Namuna</a>
  </div>

  <!-- Firebase & asosiy bootstrap -->
  <script type="module" src="/assets/js/firebase.js"></script>
  <script type="module" src="/assets/js/main.js"></script>

  <!-- Bannerlarni bog'lash: ads1..3 -> carousel, banner1..4 -> grid -->
<script type="module">
  import { initCarousel } from './assets/js/ui.js';       // ./ bilan
  import { attachHeaderFooter } from './assets/js/include.js';
  import { initTheme } from './assets/js/theme.js';
  import { requireAuthForPage } from './assets/js/auth.js';

  await attachHeaderFooter();
  initTheme();
  requireAuthForPage({ redirectIfLoggedOut: 'register.html' });

  function resolve(relPath){
    const base = location.pathname.endsWith('/') ? location.pathname
      : location.pathname.substring(0, location.pathname.lastIndexOf('/') + 1);
    return new URL(relPath, location.origin + base).toString();
  }

  // --- Carousel: ads1..3.html (relative paths!)
  const adsContainer = document.getElementById('adsCarousel');
  const adsFiles = ['ads/ads1.html','ads/ads2.html','ads/ads3.html'];
  for (let i=0; i<adsFiles.length; i++){
    try{
      const res = await fetch(resolve(adsFiles[i]), { cache: 'no-store' });
      if (!res.ok) throw new Error(adsFiles[i] + ' topilmadi');
      const html = await res.text();
      const slide = document.createElement('div');
      slide.className = 'h-slide' + (i===0 ? ' active' : '');
      slide.innerHTML = html;
      adsContainer.appendChild(slide);
    }catch(e){ console.error(e); }
  }
  initCarousel();

  // --- Vertikal grid: banner1..4.html
  const grid = document.getElementById('verticalGrid');
  const vFiles = ['banner/banner1.html','banner/banner2.html','banner/banner3.html','banner/banner4.html'];
  for (const f of vFiles){
    try{
      const res = await fetch(resolve(f), { cache: 'no-store' });
      if (!res.ok) throw new Error(f + ' topilmadi');
      const html = await res.text();
      const holder = document.createElement('div');
      holder.innerHTML = html;
      const first = holder.firstElementChild;
      if (first) grid.appendChild(first);
    }catch(e){ console.error(e); }
  }
</script>

</body>
</html>
