<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover"/>
<meta name="theme-color" content="#0ea5e9"/>
<link rel="icon" sizes="192x192" href="logo.png"/>
<link rel="apple-touch-icon" href="logo.png"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
<link rel="stylesheet" href="assets/css/style.css"/>
<link rel="stylesheet" href="assets/css/bridge.css"/>
<link rel="manifest" href="manifest.webmanifest"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<meta name="mobile-web-app-capable" content="yes"/>
<link rel="apple-touch-icon" sizes="180x180" href="icons/icon-180x180.png"/>
<link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192x192.png"/>
<link rel="stylesheet" href="assets/css/pwa.css"/>

<title>LeaderMath.UZ — Kirish</title>

<style>
  /* =============================
     LOGIN PREMIUM (scoped)
     - HTML/CSS mosligi 100%
     - Logo: kvadrat badge (no-stretch)
  ============================== */
  body[data-page="login"] .app{max-width:1180px}
  body[data-page="login"] header{margin-bottom:8px}

  body[data-page="login"] .loginShell{
    display:grid;
    grid-template-columns: 1.15fr .85fr;
    gap:18px;
    align-items:stretch;
  }

  body[data-page="login"] .heroCard{
    position:relative;
    overflow:hidden;
    border-radius:26px;
    padding:22px;
    border: 1px solid rgba(20,40,60,.12);
    background:
      radial-gradient(900px 500px at 15% 20%, rgba(14,165,233,.25), transparent 60%),
      radial-gradient(900px 500px at 85% 30%, rgba(46,139,87,.22), transparent 60%),
      linear-gradient(180deg, rgba(255,255,255,.72), rgba(255,255,255,.58));
    box-shadow: 0 24px 60px rgba(2,6,23,.10);
    backdrop-filter: blur(10px);
  }
  body[data-page="login"] .heroCard:before{
    content:"";
    position:absolute; inset:-2px;
    background: linear-gradient(135deg, rgba(14,165,233,.55), rgba(46,139,87,.55), rgba(245,158,11,.35));
    opacity:.18;
    filter: blur(20px);
    pointer-events:none;
  }

  body[data-page="login"] .brandRow{display:flex;align-items:center;gap:14px;position:relative;z-index:1}
  body[data-page="login"] .logoBadge{
    width:66px;height:66px;
    border-radius:20px;
    padding:10px;
    background: rgba(255,255,255,.78);
    border: 1px solid rgba(20,40,60,.14);
    box-shadow: 0 16px 40px rgba(2,6,23,.10);
    display:flex;align-items:center;justify-content:center;
  }
  body[data-page="login"] .logoBadge img{
    width:100%;height:100%;object-fit:contain;
    filter: drop-shadow(0 10px 18px rgba(2,6,23,.18));
  }
  body[data-page="login"] .brandText .ttl{font-weight:900;font-size:20px;letter-spacing:.2px}
  body[data-page="login"] .brandText .sub{opacity:.82;font-size:12px;line-height:1.25;margin-top:4px}

  body[data-page="login"] .heroKpis{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px;position:relative;z-index:1}
  body[data-page="login"] .kpi{
    display:flex;align-items:center;gap:10px;
    padding:10px 12px;
    border-radius:18px;
    background: rgba(255,255,255,.66);
    border: 1px solid rgba(20,40,60,.12);
  }
  body[data-page="login"] .kpi .ic{
    width:34px;height:34px;border-radius:14px;
    display:flex;align-items:center;justify-content:center;
    background: rgba(15,23,42,.06);
    border:1px solid rgba(20,40,60,.10);
  }
  body[data-page="login"] .kpi b{font-size:11px}
  body[data-page="login"] .kpi small{display:block;font-size:10px;opacity:.72;margin-top:2px}

  body[data-page="login"] .heroNote{
    margin-top:14px;
    border-radius:18px;
    padding:12px 12px;
    background: rgba(15,23,42,.04);
    border: 1px dashed rgba(20,40,60,.18);
    position:relative;z-index:1;
    font-size:12px;opacity:.86;
  }

  body[data-page="login"] .loginCard{
    border-radius:26px;
    border:1px solid rgba(20,40,60,.12);
    background: rgba(255,255,255,.70);
    box-shadow: 0 22px 55px rgba(2,6,23,.10);
    backdrop-filter: blur(10px);
    overflow:hidden;
  }
  body[data-page="login"] .loginHead{
    padding:18px 18px 12px;
    display:flex;align-items:center;justify-content:space-between;gap:10px;
    background: linear-gradient(180deg, rgba(255,255,255,.85), rgba(255,255,255,.60));
    border-bottom:1px solid rgba(20,40,60,.10);
  }
  body[data-page="login"] .loginHead .title{font-weight:900;font-size:15px;display:flex;align-items:center;gap:10px}
  body[data-page="login"] .premiumPill{
    display:inline-flex;align-items:center;gap:8px;
    padding:7px 10px;
    border-radius:999px;
    background: rgba(46,139,87,.12);
    border: 1px solid rgba(46,139,87,.22);
    font-size:10px;
    font-weight:800;
  }
  body[data-page="login"] .loginBody{padding:16px 18px 18px}

  body[data-page="login"] .field{display:flex;align-items:center;gap:10px;padding:12px 12px;border-radius:18px;background: rgba(255,255,255,.75);border:1px solid rgba(20,40,60,.12);margin-top:10px}
  body[data-page="login"] .field i{opacity:.72}
  body[data-page="login"] .field input{border:none;outline:none;background:transparent;width:100%;font-size:14px}

  body[data-page="login"] .ctaRow{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:14px}
  body[data-page="login"] .ctaRow .btn{border-radius:16px;padding:12px 12px;font-weight:900}

  body[data-page="login"] .mutedLine{margin-top:12px;font-size:12px;opacity:.78}
  body[data-page="login"] .alreadyBox{
    margin-top:12px;
    border-radius:18px;
    padding:12px;
    background: rgba(14,165,233,.10);
    border:1px solid rgba(14,165,233,.20);
    display:flex;align-items:center;justify-content:space-between;gap:10px;
  }
  body[data-page="login"] .alreadyBox a{margin:0}

  @media (max-width: 980px){
    body[data-page="login"] .loginShell{grid-template-columns: 1fr;}
  }
  @media (max-width: 520px){
    body[data-page="login"] .logoBadge{width:58px;height:58px;border-radius:18px}
    body[data-page="login"] .brandText .ttl{font-size:18px}
    body[data-page="login"] .ctaRow{grid-template-columns:1fr;}
  }
</style>
</head>
<body data-page="login">
  <div class="scroll-progress"><div class="scroll-progress-bar" id="scrollProgress"></div></div>
  <button class="scroll-to-top" id="scrollToTop" aria-label="Yuqoriga"><i class="fa-solid fa-arrow-up"></i></button>
  <canvas id="three-canvas"></canvas>

  <div class="app">
    <main class="loginShell" style="margin-top:14px">
      <!-- LEFT / HERO -->
      <section class="heroCard" aria-label="LeaderMath hero">
        <div class="brandRow">
          <div class="logoBadge" aria-label="Logo">
            <img src="logo.png" alt="LeaderMath.UZ" />
          </div>
          <div class="brandText">
            <div class="ttl">LeaderMath.UZ</div>
            <div class="sub">Sizni bu yerda ajoyib matematik sarguzashtlar kutmoqda. Testlar, o‘yinlar va simulyatorlar — hammasi bir joyda.</div>
          </div>
        </div>

        <div class="heroKpis" aria-label="Afzalliklar">
          <div class="kpi"><div class="ic"><i class="fa-solid fa-bolt"></i></div><div><b>Tez va yengil</b><small>Mobilga mos, silliq</small></div></div>
          <div class="kpi"><div class="ic"><i class="fa-solid fa-trophy"></i></div><div><b>Reyting va medallar</b><small>Progressni ko‘rasiz</small></div></div>
          <div class="kpi"><div class="ic"><i class="fa-solid fa-shield"></i></div><div><b>Xavfsiz kirish</b><small>ID + Parol</small></div></div>
          <div class="kpi"><div class="ic"><i class="fa-solid fa-star"></i></div><div><b>Premium UI</b><small>Glass + gradient</small></div></div>
        </div>

        <div class="heroNote">
          <i class="fa-solid fa-circle-info"></i>
          <span style="margin-left:8px">Agar avval kirgan bo‘lsangiz, token avtomatik aniqlanadi va “App’ga o‘tish” tugmasi chiqadi.</span>
        </div>
      </section>

      <!-- RIGHT / LOGIN -->
      <section class="loginCard" aria-label="Kirish kartasi">
        <div class="loginHead">
          <div class="title"><i class="fa-solid fa-right-to-bracket"></i> Kirish</div>
          <div class="premiumPill"><i class="fa-solid fa-gem"></i> Premium</div>
        </div>
        <div class="loginBody">
          <div class="card-desc" style="margin:0;opacity:.8">ID + Parol bilan kiring yoki 1 bosishda yangi hisob yarating.</div>

          <label class="field" for="inId">
            <i class="fa-solid fa-id-card"></i>
            <input id="inId" placeholder="IDni kiriting (masalan: LM-123456)" autocomplete="username" />
          </label>

          <label class="field" for="inPw">
            <i class="fa-solid fa-key"></i>
            <input id="inPw" placeholder="Parolni kiriting" type="password" autocomplete="current-password" />
          </label>

          <div class="ctaRow">
            <button class="btn" id="btnLogin" type="button"><i class="fa-solid fa-lock-open"></i> Kirish</button>
            <button class="btn secondary" id="btnStart" type="button"><i class="fa-solid fa-wand-magic-sparkles"></i> Men yangiman</button>
          </div>

          <div id="already" style="display:none;" class="alreadyBox">
            <div style="font-size:12px;opacity:.92"><i class="fa-solid fa-check"></i> Siz avval kirgansiz</div>
            <a href="app.html" class="footer-link" style="display:inline-flex; gap:8px; padding:10px 12px; border-radius:14px;">
              <i class="fa-solid fa-arrow-right"></i> App’ga o‘tish
            </a>
          </div>

          <div class="mutedLine"><i class="fa-solid fa-lock"></i> Eslatma: ID va Parolni esdan chiqarmang!</div>
        </div>
      </section>
    </main>

    <footer>
      <div class="footer-card">
        <div class="footer-left">
          <div class="footer-name">LeaderMath.UZ</div>
          <div class="small-note">Matematikadan super interaktiv sayt!</div>
        </div>
        <div class="footer-right">
          <a class="footer-link" href="#"><i class="fa-solid fa-headset"></i> Yordam</a>
        
          <div class="storeBar" id="lmStoreBar" style="margin-top:10px;">
            <a class="storeBtn" id="btnPlayStore" href="#" title="Android (Play Market)"><img class="osIcon" src="icon.png" alt=""> <span>Play Market</span></a>
            <a class="storeBtn" id="btnAppStore" href="#" title="iPhone/iPad (App Store)"><img class="osIcon" src="icon.png" alt=""> <span>App Store</span></a>
            <a class="storeBtn" id="btnMsStore" href="#" title="Windows (Microsoft Store)"><img class="osIcon" src="icon.png" alt=""> <span>Microsoft Store</span></a>
            <a class="storeBtn install" id="btnInstallPWA" href="#" title="PWA o‘rnatish"><img class="osIcon" src="icon.png" alt=""> <span>O‘rnatish</span></a>
          </div>
        </div>
      </div>
    </footer>
  </div>

  <div id="toast" class="toast">...</div>

  <!-- Credentials modal -->
  <div id="credsModal" class="lm-modal">
    <div id="credsBackdrop" class="lm-backdrop"></div>
    <div class="lm-modal-card">
      <button class="close-btn" id="credsClose" aria-label="Yopish"><i class="fa-solid fa-xmark"></i></button>
      <div class="card-title" style="margin-bottom:6px">✅ ID + Parol yaratildi</div>
      <div class="small-note" style="margin-bottom:12px">Iltimos, saqlab qo‘ying. Keyin shu ID va Parol bilan kirishingiz mumkin.</div>

      <div class="auth-grid">
        <div>
          <div class="card-label">Sizning ID</div>
          <div class="form-row">
            <input id="newId" class="input" readonly value="LM-000000" />
            <button class="btn" id="copyId" type="button"><i class="fa-solid fa-copy"></i> Nusxa</button>
          </div>
        </div>
        <div>
          <div class="card-label">Sizning Parol</div>
          <div class="form-row">
            <input id="newPw" class="input" readonly value="AB-1234" />
            <button class="btn" id="copyPw" type="button"><i class="fa-solid fa-copy"></i> Nusxa</button>
          </div>
        </div>

        <div class="auth-actions">
          <button class="btn" id="goApp" type="button"><i class="fa-solid fa-arrow-right"></i> Ilovaga o‘tish</button>
          <button class="btn secondary" type="button" onclick="document.getElementById('credsClose').click()"><i class="fa-solid fa-bookmark"></i> Keyinroq</button>
        </div>
      </div>
    </div>
  </div>

  <script src="assets/js/core.js"></script>

    <script src="assets/js/pwa.js" defer></script>

<script type="module">
    import { registerAuto, login, getToken } from "./assets/js/auth.js";
    const $=id=>document.getElementById(id);

    const toast=(t)=>{
      const el=$("toast");
      el.textContent=t;
      el.classList.add("show");
      clearTimeout(window.__t);
      window.__t=setTimeout(()=>el.classList.remove("show"), 2600);
    };

    // already logged in?
    try{
      if(getToken && getToken()){
        $("already").style.display="block";
      }
    }catch{}

    function openModal(){
      $("credsModal").classList.add("open");
    }
    function closeModal(){
      $("credsModal").classList.remove("open");
    }
    $("credsBackdrop").onclick = closeModal;
    $("credsClose").onclick = closeModal;

    async function copyText(t){
      try{ await navigator.clipboard.writeText(t); toast("✅ Nusxalandi"); }
      catch{ toast("⚠️ Nusxalab bo‘lmadi"); }
    }
    $("copyId").onclick = ()=> copyText($("newId").value);
    $("copyPw").onclick = ()=> copyText($("newPw").value);
    $("goApp").onclick = ()=> location.href="./app.html";

    $("btnStart").onclick = async ()=>{
      try{
        $("btnStart").disabled=true;
        const r = await registerAuto();
        $("inId").value = r.loginId;
        $("inPw").value = r.password;
        $("newId").value = r.loginId;
        $("newPw").value = r.password;
        openModal();
      }catch(e){
        toast(e?.message || "Xatolik");
      }finally{
        $("btnStart").disabled=false;
      }
    };

    $("btnLogin").onclick = async ()=>{
      const id=$("inId").value.trim();
      const pw=$("inPw").value;
      if(!id || !pw) return toast("ID va Parolni kiriting");
      try{
        $("btnLogin").disabled=true;
        await login(id,pw);
        location.href="./app.html";
      }catch(e){
        toast("Kirish xato: "+(e?.message || ""));
      }finally{
        $("btnLogin").disabled=false;
      }
    };
  </script>
</body>
</html>
