<!doctype html>
<html lang="uz">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1, viewport-fit=cover"/>
  <title>LeaderMath.UZ â€” Kirish</title>
  <link rel="icon" href="logo.png" sizes="192x192"/>
  <link rel="apple-touch-icon" href="logo.png"/>
  <meta name="theme-color" content="#0ea5e9"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <link rel="stylesheet" href="assets/css/skin-index1.css"/>
  <link href="./assets/css/app.css" rel="stylesheet"/>
</head>
<body class="login lm-skin">
  <canvas id="three-canvas"></canvas>

  <div class="app">
    <header>
      <div class="header-card">
        <img src="logo.png" class="logo-img" alt="LeaderMath"/>
        <div class="header-text">
          <div class="header-title">LeaderMath.UZ â€” Kirish</div>
          <div class="header-sub">Yagona index1 dizayn â€” premium glass + 3D fon</div>
        </div>
        <div class="header-tag">
          <i class="fa-solid fa-mobile-screen-button"></i>
          Mobil optimallashtirilgan
        </div>
      </div>
    </header>

    <main>
      <section class="section-shell">
        <div class="wrap"><div class="phone">
<div class="glass header" style="border-radius:24px">
<div class="brand">
<div class="logoWrap">
<img alt="LeaderMath logo" class="logoImg" decoding="async" loading="eager" src="./logo.png"/>
</div>
<div>
<div class="brandTitle">LeaderMath.UZ</div>
<div class="brandSub" id="dt"></div>
</div>
</div>
<div class="pill">âš¡ Premium</div>
</div>
<div class="glass card loginCard">
<div class="loginHero">
<div aria-hidden="true" class="heroArt">
<div class="orb"></div>
<div class="ring"></div>
<div class="pi">Ï€</div>
</div>
<div class="heroText">
<div class="badge">ğŸš€ Bir bosishda</div>
<h1 class="h1">Kirish</h1>
<p class="p">Yangi boâ€˜lsangiz â€” <b>Bir bosishda kirish</b> ni bosing. ID+Parol sizga alohida oynada koâ€˜rsatiladi.</p>
</div>
</div>
<div class="loginActions">
<button class="btn primary" id="btnStart">â–¶ï¸ Bir bosishda kirish</button>
<div class="miniDivider">yoki</div>
<div class="row">
<input autocomplete="username" class="input" id="inId" inputmode="numeric" placeholder="ID"/>
<input autocomplete="current-password" class="input" id="inPw" placeholder="Parol" type="password"/>
</div>
<button class="btn ghost" id="btnLogin" style="margin-top:10px">ğŸ”’ Kirish</button>
<small class="hint">Eslatma: birinchi kirishda profil toâ€˜ldirish oynasi chiqadi.</small>
</div>
</div>
</div></div>
 Credentials modal (shown after one-click register) 
<div aria-hidden="true" class="modalBackdrop" id="credModal">
<div class="modalOverlay" data-close=""></div>
<div aria-labelledby="credTitle" aria-modal="true" class="modalCard" role="dialog">
<div class="modalTop">
<div>
<div class="modalBadge">ğŸ§¾ ID + Parol</div>
<div class="modalTitle" id="credTitle">Saqlab oling</div>
<div class="modalSub">Bu maâ€™lumotlar keyingi kirishlarda kerak boâ€˜ladi.</div>
</div>
<button aria-label="Yopish" class="iconBtn" id="credClose">âœ•</button>
</div>
<div class="credGrid">
<div class="credBox">
<div class="credLabel">ID</div>
<div class="credRow">
<div class="credValue" id="credId">â€”</div>
<button aria-label="ID nusxalash" class="copyBtn" id="copyId" title="Nusxalash">
<svg aria-hidden="true" viewbox="0 0 24 24"><path d="M16 1H6a2 2 0 0 0-2 2v12h2V3h10V1Zm3 4H10a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h9a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2Zm0 16H10V7h9v14Z"></path></svg>
</button>
</div>
<div class="tinyNote">ID ni yozib oling yoki nusxalang.</div>
</div>
<div class="credBox">
<div class="credLabel">Parol</div>
<div class="credRow">
<div class="credValue" id="credPw">â€”</div>
<button aria-label="Parol nusxalash" class="copyBtn" id="copyPw" title="Nusxalash">
<svg aria-hidden="true" viewbox="0 0 24 24"><path d="M16 1H6a2 2 0 0 0-2 2v12h2V3h10V1Zm3 4H10a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h9a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2Zm0 16H10V7h9v14Z"></path></svg>
</button>
</div>
<div class="tinyNote">Parolni hech kimga bermang.</div>
</div>
</div>
<div class="modalActions">
<button class="btn ghost" id="copyBoth">ID + Parol nusxalash</button>
<button class="btn primary" id="goApp">Davom etish</button>
</div>
<div class="modalFoot" id="autoGoHint">Avto kirish: <b><span id="autoGo">10</span>s</b> (xohlasangiz darhol <b>Davom etish</b> ni bosing)</div>
</div>
</div>
<div class="toast" id="toast"></div>
      </section>
    </main>

    <footer>
      <div class="footer-card">
        <div class="footer-left">
          <div class="footer-name">LeaderMath.UZ</div>
          <div style="color: var(--muted); font-size: 13px;">Â© 2025 â€¢ index1 premium skin</div>
        </div>
        <div class="footer-right">
          <a class="footer-link" href="app.html"><i class="fa-solid fa-house"></i> Bosh sahifa</a>
          <a class="footer-link" href="challenge.html"><i class="fa-solid fa-trophy"></i> Challenge</a>
          <a class="footer-link" href="test.html"><i class="fa-solid fa-pen-to-square"></i> Testlar</a>
        </div>
      </div>
    </footer>
  </div>

  <script src="assets/js/skin-bg.js"></script>
  <script type="module">
  import { registerAuto, login } from "./assets/js/auth.js";
  const $=id=>document.getElementById(id);
  const toast=(t)=>{ const el=$("toast"); el.textContent=t; el.style.display="block";
    clearTimeout(window.__t); window.__t=setTimeout(()=>el.style.display="none", 2600); };

  function fmtUZ(){
    const d=new Date();
    return d.toLocaleDateString("uz-UZ",{weekday:"long", year:"numeric", month:"long", day:"numeric"})+
      " â€¢ " + d.toLocaleTimeString("uz-UZ",{hour:"2-digit",minute:"2-digit"});
  }
  $("dt").textContent=fmtUZ(); setInterval(()=>$("dt").textContent=fmtUZ(), 1000*30);

  $("btnStart").onclick = async ()=>{
    try{
      $("btnStart").disabled=true;
      const r = await registerAuto();
      // Login token is set by registerAuto(); show credentials in a small modal for saving.
      $("inId").value = r.loginId;
      $("inPw").value = r.password;
      showCredModal(r.loginId, r.password);
    }catch(e){ toast(e.message||"Xatolik"); }
    finally{ $("btnStart").disabled=false; }
  };

  $("btnLogin").onclick = async ()=>{
    try{
      const id=$("inId").value.trim();
      const pw=$("inPw").value;
      if(!id||!pw) return toast("ID va Parolni kiriting");
      $("btnLogin").disabled=true;
      await login(id,pw);
      location.href="./app.html";
    }catch(e){ toast("Kirish xato: "+(e.message||"")); }
    finally{ $("btnLogin").disabled=false; }
  };

  // --- Credentials modal helpers ---
  let autoTimer=null;
  function openModal(){
    const m=$("credModal");
    m.classList.add("open");
    m.setAttribute("aria-hidden","false");
  }
  function closeModal(){
    const m=$("credModal");
    m.classList.remove("open");
    m.setAttribute("aria-hidden","true");
    if(autoTimer) { clearInterval(autoTimer); autoTimer=null; }
  }
  async function copyText(t){
    try{ await navigator.clipboard.writeText(t); toast("âœ… Nusxalandi"); }
    catch{ toast("âš ï¸ Nusxalab boâ€˜lmadi"); }
  }
  function prettyId(raw){
    // Always show full ID (including possible LM- prefix) so user can write it down.
    const s = String(raw||"").trim();
    return s || "â€”";
  }
  function showCredModal(id,pw){
    $("credId").textContent = prettyId(id);
    $("credPw").textContent = String(pw||"â€”");
    openModal();

    // countdown
    let s=10;
    $("autoGo").textContent=String(s);
    autoTimer=setInterval(()=>{
      s--; $("autoGo").textContent=String(Math.max(s,0));
      if(s<=0){ clearInterval(autoTimer); autoTimer=null; location.href="./app.html"; }
    },1000);
  }

  $("credClose").onclick = closeModal;
  $("goApp").onclick = ()=> location.href="./app.html";
  $("copyId").onclick = ()=> copyText($("credId").textContent.trim());
  $("copyPw").onclick = ()=> copyText($("credPw").textContent.trim());
  $("copyBoth").onclick = ()=> copyText(`ID: ${$("credId").textContent.trim()}\nParol: ${$("credPw").textContent.trim()}`);
  $("credModal").addEventListener("click", (e)=>{ if(e.target && e.target.hasAttribute("data-close")) closeModal(); });
</script>
</body>
</html>