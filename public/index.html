<!doctype html>
<html lang="uz">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>LeaderMath.UZ â€” Kirish</title>
  <link rel="stylesheet" href="./assets/css/app.css"/>
</head>
<body class="login">
<div class="wrap"><div class="phone">
  <div class="glass header" style="border-radius:24px">
    <div class="brand">
      <div class="logoWrap">
        <img class="logoImg" src="./logo.png" alt="LeaderMath logo" loading="eager" decoding="async" />
      </div>
      <div>
        <div class="brandTitle">LeaderMath.UZ</div>
        <div class="brandSub" id="dt"></div>
      </div>
    </div>
    <div class="pill">âš¡ Premium</div>
  </div>

  <div class="glass card loginCard">
    <div class="loginHero">
      <div class="heroArt" aria-hidden="true">
        <div class="orb"></div>
        <div class="ring"></div>
        <div class="pi">Ï€</div>
      </div>
      <div class="heroText">
        <div class="badge">ğŸš€ Bir bosishda boshlang</div>
        <h1 class="h1">Premium Kirish</h1>
        <p class="p">Bir marta bosing â€” tizim avtomatik <b>ID</b> va <b>Parol</b> yaratadi va darhol ichkariga kiritadi.</p>
        <div class="chips" role="list">
          <span class="chip" role="listitem">ğŸ”’ Xavfsiz token</span>
          <span class="chip" role="listitem">âš¡ Tez kirish</span>
          <span class="chip" role="listitem">ğŸ“± Mobileâ€‘first</span>
        </div>
      </div>
    </div>

    <div class="loginActions">
      <button class="btn primary" id="btnStart">â–¶ï¸ Bir bosishda kirish</button>

	      <details class="loginDetails" id="haveId">
        <summary class="loginSummary">Menda ID bor (kirish) <span class="chev" aria-hidden="true">âŒ„</span></summary>
	        <div class="row" style="margin-top:10px">
	          <input class="input" id="inId" inputmode="numeric" autocomplete="username" placeholder="ID (masalan 179604)"/>
	          <input class="input" id="inPw" type="password" autocomplete="current-password" placeholder="Parol"/>
	        </div>
	        <button class="btn ghost" id="btnLogin" style="margin-top:10px">ğŸ”’ Kirish</button>
	        <small class="hint">Birinchi kirishda profil toâ€˜ldirish va parolni yangilash oynasi chiqadi.</small>
	      </details>
    </div>
  </div>
</div></div>

<div id="toast" class="toast"></div>

<script type="module">
  import { registerAuto, login } from "./assets/js/auth.js";
  const $=id=>document.getElementById(id);
  const toast=(t)=>{ const el=$("toast"); el.textContent=t; el.style.display="block";
    clearTimeout(window.__t); window.__t=setTimeout(()=>el.style.display="none", 2600); };

  function fmtUZ(){
    const d=new Date();
    return d.toLocaleDateString("uz-UZ",{weekday:"long", year:"numeric", month:"long", day:"numeric"})+
      " â€¢ " + d.toLocaleTimeString("uz-UZ",{hour:"2-digit",minute:"2-digit"});
  }
  $("dt").textContent=fmtUZ(); setInterval(()=>$("dt").textContent=fmtUZ(), 1000*30);

  $("btnStart").onclick = async ()=>{
    try{
      $("btnStart").disabled=true;
      const r = await registerAuto();
      // Login token is set by registerAuto(); we still show credentials for user.
      $("inId").value = r.loginId;
      $("inPw").value = r.password;
      toast("âœ… Tayyor! Siz tizimga kiryapsizâ€¦ (ID+Parol saqlab qoâ€˜ying)");
      setTimeout(()=>{ location.href = "./app.html"; }, 700);
    }catch(e){ toast(e.message||"Xatolik"); }
    finally{ $("btnStart").disabled=false; }
  };

  $("btnLogin").onclick = async ()=>{
    try{
      const id=$("inId").value.trim();
      const pw=$("inPw").value;
      if(!id||!pw) return toast("ID va Parolni kiriting");
      $("btnLogin").disabled=true;
      await login(id,pw);
      location.href="./app.html";
    }catch(e){ toast("Kirish xato: "+(e.message||"")); }
    finally{ $("btnLogin").disabled=false; }
  };
</script>
</body>
</html>
