<!doctype html>
<html lang="uz">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>LeaderMath.UZ â€” Kirish</title>
  <link rel="stylesheet" href="./assets/css/app.css"/>
</head>
<body>
<div class="wrap"><div class="phone app-shell">
  <div class="glass header" style="border-radius:24px">
    <div class="brand">
      <img class="logo-img" src="/assets/img/logo.png" alt="LeaderMath logo">
      <div>
        <div class="brandTitle">LeaderMath.UZ</div>
        <div class="brandSub" id="dt"></div>
      </div>
    </div>
    <div class="pill">âš¡ Premium</div>
  </div>

  <div class="glass card">
    <h1 class="h1">Bir bosishda kirish</h1>
    <p class="p">Yangi foydalanuvchi boâ€˜lsangiz â€” â€œBoshlashâ€ ni bosing: tizim sizga avtomatik <b>ID + Parol</b> yaratadi.</p>

    <div style="margin-top:14px; display:grid; gap:10px">
      <button class="btn primary" id="btnStart">ğŸš€ Boshlash (Auto ID+Parol)</button>
      <div class="row">
        <input class="input" id="inId" placeholder="ID (masalan LM-000001)"/>
        <input class="input" id="inPw" type="password" placeholder="Parol"/>
      </div>
      <button class="btn ghost" id="btnLogin">ğŸ”’ Kirish</button>
      <small class="p">Eslatma: birinchi kirishda profil toâ€˜ldirish + parolni yangilash majburiy.</small>
    </div>
  </div>

  <div class="glass card">
    <div style="font-weight:950">Bugun nima bor?</div>
    <div class="sectionGrid" style="margin-top:10px">
      <div class="glass sectionItem">
        <div class="title">Online Challenge</div>
        <div class="desc">Kunlik va haftalik jonli masalalar.</div>
        <button class="btn primary" style="width:100%; margin-top:10px" disabled>Tez kunda</button>
      </div>
      <div class="glass sectionItem">
        <div class="title">EXAM</div>
        <div class="desc">Imtihon rejimi: vaqt, ball, natija.</div>
        <button class="btn primary" style="width:100%; margin-top:10px" disabled>Tez kunda</button>
      </div>
      <div class="glass sectionItem">
        <div class="title">PLAY</div>
        <div class="desc">Oâ€˜yin tarzida mantiqiy mashqlar.</div>
        <button class="btn primary" style="width:100%; margin-top:10px" disabled>Tez kunda</button>
      </div>
    </div>
  </div>
</div></div>

<div id="toast" class="toast"></div>

<script type="module">
  import { initSeasonalBackground } from "./assets/js/seasons.js";
initSeasonalBackground();
import { registerAuto, login } from "./assets/js/auth.js";
  const $=id=>document.getElementById(id);
  const toast=(t)=>{ const el=$("toast"); el.textContent=t; el.style.display="block";
    clearTimeout(window.__t); window.__t=setTimeout(()=>el.style.display="none", 2600); };

  function fmtUZ(){
    const d=new Date();
    return d.toLocaleDateString("uz-UZ",{weekday:"long", year:"numeric", month:"long", day:"numeric"})+
      " â€¢ " + d.toLocaleTimeString("uz-UZ",{hour:"2-digit",minute:"2-digit"});
  }
  $("dt").textContent=fmtUZ(); setInterval(()=>$("dt").textContent=fmtUZ(), 1000*30);

  $("btnStart").onclick = async ()=>{
    try{
      $("btnStart").disabled=true;
      const r = await registerAuto();
      $("inId").value = r.loginId;
      $("inPw").value = r.password;
      toast("âœ… ID+Parol yaratildi. Endi Kirish bosing.");
    }catch(e){ toast(e.message||"Xatolik"); }
    finally{ $("btnStart").disabled=false; }
  };

  $("btnLogin").onclick = async ()=>{
    try{
      const id=$("inId").value.trim();
      const pw=$("inPw").value;
      if(!id||!pw) return toast("ID va Parolni kiriting");
      $("btnLogin").disabled=true;
      await login(id,pw);
      location.href="./app.html";
    }catch(e){ toast("Kirish xato: "+(e.message||"")); }
    finally{ $("btnLogin").disabled=false; }
  };
</script>
</body>
</html>
