<!doctype html>
<html lang="uz">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#2E8B57" />
  <title>Profil — OrzuMall</title>
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="./styles.css?v=80" />
  <style>
    body{background: var(--bg, #f6f7fb);}
    .pWrap{min-height:100vh; display:grid; place-items:center; padding: 18px 14px;}
    .pCard{width:min(520px,100%); background: rgba(255,255,255,.92); border:1px solid rgba(15,23,42,.10); border-radius: 22px; box-shadow: 0 18px 50px rgba(15,23,42,.14); overflow:hidden;}
    .pTop{padding:16px; display:flex; align-items:center; justify-content:space-between; gap:12px;}
    .pBrand{display:flex; align-items:center; gap:10px}
    .pLogo{width:42px;height:42px;border-radius:14px;display:grid;place-items:center;color:#fff;background: linear-gradient(135deg,#2E8B57,#1f6e44);}
    .pBody{padding: 0 16px 16px;}
    .pRow{display:flex; align-items:center; gap:10px; padding: 12px; border:1px solid rgba(15,23,42,.10); border-radius: 16px; background: rgba(255,255,255,.86); margin-top:10px;}
    .pRow i{color:#64748b}
    .pK{min-width:90px; color:#64748b; font-size:12px}
    .pV{font-weight:800}
    .pPill{display:inline-flex; align-items:center; gap:8px; padding: 8px 10px; border-radius: 999px; border:1px solid rgba(46,139,87,.22); background: rgba(46,139,87,.10); color:#2E8B57; font-weight:900; font-size:12px}
    .btn{border:none;border-radius:16px;padding:12px 14px;font-weight:900;cursor:pointer}
    .btnPrimary{background: linear-gradient(135deg,#2E8B57,#1f6e44); color:#fff; width:100%; margin-top:12px}
    .btnGhost{width:40px;height:40px;border-radius:14px;border:1px solid rgba(15,23,42,.10); background: rgba(255,255,255,.86); display:grid; place-items:center; color:#334155}
  </style>
</head>
<body>
  <div class="pWrap">
    <div class="pCard">
      <div class="pTop">
        <div class="pBrand">
          <div class="pLogo"><i class="fa-solid fa-user"></i></div>
          <div>
            <div style="font-weight:900">Profil</div>
            <div style="color:#64748b;font-size:12px">OrzuMall</div>
          </div>
        </div>
        <button class="btnGhost" id="logoutBtn" title="Chiqish"><i class="fa-solid fa-right-from-bracket"></i></button>
      </div>

      <div class="pBody">
        <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; padding: 6px 2px 2px;">
          <div>
            <div id="name" style="font-weight:900; font-size:16px">User</div>
            <div class="pPill" style="margin-top:6px"><i class="fa-solid fa-id-card"></i><span id="omId">ID: —</span></div>
          </div>
        </div>

        <div class="pRow">
          <i class="fa-solid fa-phone"></i><div class="pK">Telefon</div><div class="pV" id="phone">—</div>
        </div>
        <div class="pRow">
          <i class="fa-solid fa-envelope"></i><div class="pK">Email</div><div class="pV" id="email">—</div>
        </div>

        <button class="btn btnPrimary" id="goApp"><i class="fa-solid fa-house" style="margin-right:8px"></i> Bosh sahifa</button>
      </div>
    </div>
  </div>

  <script type="module">
    import { auth, db } from "./firebase-config.js";
    import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";
    import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

    const $ = (s)=>document.querySelector(s);

    async function ensureProfile(user){
      const ref = doc(db, "users", user.uid);
      const snap = await getDoc(ref);
      const u = snap.exists() ? snap.data() : {};
      $("#name").textContent = (u.name || user.displayName || "User").trim();
      $("#omId").textContent = "ID: " + (u.omId || "—");
      $("#email").textContent = "—"; // hide technical email
      $("#phone").textContent = u.phone || "—";
    }

    onAuthStateChanged(auth, async (user)=>{
      if(!user){ location.href = "login.html?next=%2F%23profile"; return; }
      await ensureProfile(user);
    });

    $("#logoutBtn").addEventListener("click", async ()=>{
      await signOut(auth);
      location.href = "login.html";
    });
    $("#goApp").addEventListener("click", ()=> location.href="index.html#home");
  </script>
</body>
</html>
