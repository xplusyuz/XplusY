<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Challenge Test — LeaderMath.UZ</title>
  <link rel="stylesheet" href="assets/css/app.css"/>
  <link rel="stylesheet" href="assets/css/ui.css"/>
  <script>
    // MathJax (optional): question text may contain LaTeX
    window.MathJax = { tex: { inlineMath: [['$','$'],['\\(','\\)']] }, options:{ renderActions:{ addMenu:[] } } };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
  <canvas class="seasonCanvas" id="seasonCanvas"></canvas>
  <div class="toast" id="toast"></div>

  <div class="container">
    <div id="appHeader"></div>

    <div class="glass section" id="runShell">
      <div class="sectionTitle">
        <h2 id="runTitle">Challenge</h2>
        <div class="hint" id="runHint">Yuklanmoqda…</div>
      </div>
      <div class="hr"></div>

      <div class="test-info-grid" style="margin-bottom:12px;">
        <div class="glass" style="padding:12px;border-radius:22px;">
          <div class="nameLine">Vaqt</div>
          <div class="big" id="timeLeft" style="font-size:22px;font-weight:900;">—</div>
          <div class="small" id="timeMeta">—</div>
        </div>
        <div class="glass" style="padding:12px;border-radius:22px;">
          <div class="nameLine">Jarayon</div>
          <div class="big" id="progress" style="font-size:22px;font-weight:900;">—</div>
          <div class="small" id="scoreMeta">—</div>
        </div>
      </div>

      <div class="question-content-wrapper" style="gap:12px;">
        <div class="glass" style="padding:14px;border-radius:24px; flex:1; min-width:0;">
          <div class="nameLine" id="qTitle">Savol</div>
          <div class="hr"></div>
          <div id="qBody" class="p" style="line-height:1.55;"></div>
          <div class="image-container" id="qImgWrap" style="display:none; margin-top:10px;">
            <img class="question-image" id="qImg" alt="Savol rasm" />
          </div>
          <div class="hr"></div>
          <div id="options" class="options" style="display:grid; gap:10px;"></div>
          <div style="height:10px;"></div>
          <div class="btn-group" style="display:flex; gap:10px;">
            <button class="btn" id="prevBtn" type="button">← Oldingi</button>
            <button class="btn btnPrimary" id="nextBtn" type="button">Keyingi →</button>
          </div>
        </div>

        <div class="glass" style="padding:12px;border-radius:24px; width:110px;">
          <div class="nameLine">Savollar</div>
          <div class="hr"></div>
          <div class="vertical-nav-dots" id="dots" style="display:flex; flex-wrap:wrap; gap:8px;">
            <div class="small">—</div>
          </div>
          <div style="height:10px;"></div>
          <button class="btn" id="finishBtn" type="button" style="width:100%;">Yakunlash</button>
        </div>
      </div>

      <div class="hr"></div>
      <div class="small" style="opacity:.85; line-height:1.5;">
        Eslatma: natija Firestore’ga <code>challenge_results</code> kolleksiyasiga yoziladi (userId + challengeId bo‘yicha).
      </div>
    </div>

    <div class="modalOverlay modalApp" id="resultModal" aria-hidden="true">
      <div class="modal glass" role="dialog" aria-modal="true" aria-label="Natija">
        <div class="modalHead">
          <div>
            <div class="modalTitle">Natija</div>
            <div class="small" id="resultHint">—</div>
          </div>
          <button class="iconBtn" id="resultClose" type="button" aria-label="Yopish">✕</button>
        </div>
        <div class="hr"></div>
        <div class="modalBody">
          <div class="scoreCircle" id="resultScore" style="margin:0 auto 12px;">0</div>
          <div class="small" id="resultMeta" style="text-align:center;">—</div>
          <div style="height:12px;"></div>
          <a class="btn btnPrimary" href="challenge.html" style="width:100%; text-align:center; display:inline-flex; justify-content:center;">Challenge ro‘yxatiga</a>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import { initSeasons } from "./assets/js/seasons.js";
    import { initHeader } from "./assets/js/header.js";
    import { initChallengeRun } from "./assets/js/challenge_run.js";
    initSeasons("seasonCanvas");
    const user = await initHeader({ requireAuth:true });
    await initChallengeRun(user);
  </script>
</body>
</html>
