<!doctype html>
<html lang="uz">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Math Editor</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mathquill@0.10.1/build/mathquill.css">
  <style>
    :root{--bg:#0b1220;--card:rgba(255,255,255,.08);--b:rgba(255,255,255,.14);--txt:#e8eefc;--mut:#a9b4cc;}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:radial-gradient(1200px 800px at 20% 10%, rgba(46,139,87,.25), transparent 60%),radial-gradient(900px 700px at 80% 90%, rgba(59,130,246,.22), transparent 55%),var(--bg);color:var(--txt);height:100vh;display:flex;align-items:center;justify-content:center;padding:16px}
    .card{width:min(900px,100%);background:var(--card);border:1px solid var(--b);border-radius:18px;backdrop-filter:blur(16px);box-shadow:0 16px 60px rgba(0,0,0,.35);padding:16px}
    .top{display:flex;gap:10px;align-items:center;justify-content:space-between;margin-bottom:12px}
    .title{font-weight:800;letter-spacing:.2px}
    .sub{font-size:13px;color:var(--mut)}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between}
    .btn{border:0;border-radius:12px;padding:10px 12px;font-weight:800;cursor:pointer}
    .btn.primary{background:linear-gradient(135deg,#2E8B57,#22c55e);color:#052012}
    .btn.ghost{background:rgba(255,255,255,.10);color:var(--txt);border:1px solid rgba(255,255,255,.18)}
    .mqWrap{background:rgba(255,255,255,.10);border:1px solid rgba(255,255,255,.18);border-radius:14px;padding:14px;min-height:64px}
    .mq-editable-field{min-height:36px;font-size:26px}
    .hint{margin-top:10px;color:var(--mut);font-size:13px}
  </style>
</head>
<body>
  <div class="card">
    <div class="top">
      <div>
        <div class="title">üßÆ Matematik editor</div>
        <div class="sub">Formulani yozing ‚Äî ‚ÄúSaqlash‚Äù bosilganda test oynasiga yuboriladi.</div>
      </div>
      <div class="row">
        <button class="btn ghost" id="btnClear">üßπ Tozalash</button>
        <button class="btn primary" id="btnSave">‚úÖ Saqlash</button>
      </div>
    </div>

    <div class="mqWrap">
      <span id="mq"></span>
    </div>

    <div class="hint">Masalan: \frac{a}{b}, \sqrt{x}, x^2, \pi, \sin x ...</div>
  </div>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathquill@0.10.1/build/mathquill.js"></script>
  <script>
    const MQ = window.MathQuill.getInterface(2);
    const el = document.getElementById('mq');
    const field = MQ.MathField(el, { spaceBehavesLikeTab: true });

    function currentLatex(){ return field.latex() || ""; }
    function setLatex(lx){ field.latex(lx||""); }

    function sendInserted(){
      parent.postMessage({ type:'mathFormulaInserted', latex: currentLatex() }, '*');
    }

    document.getElementById('btnSave').onclick = () => {
      // 1) insert event (old handler)
      sendInserted();
      // 2) response event (requested by modal save)
      parent.postMessage({ type:'mathFormulaResponse', latex: currentLatex() }, '*');
    };

    document.getElementById('btnClear').onclick = () => setLatex('');

    window.addEventListener('message', (e)=>{
      const d = e.data || {};
      if(d.type === 'loadFormula') setLatex(d.latex || '');
      if(d.type === 'getFormula') parent.postMessage({ type:'mathFormulaResponse', latex: currentLatex() }, '*');
    });
  </script>
</body>
</html>
