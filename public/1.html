<!DOCTYPE html>

<html lang="uz">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" name="viewport"/>
<meta content="#0ea5e9" name="theme-color"/>
<link href="logo.webp" rel="icon" sizes="192x192"/>
<link href="logo.webp" rel="apple-touch-icon"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>

<link rel="manifest" href="manifest.webmanifest"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<meta name="mobile-web-app-capable" content="yes"/>
<link rel="apple-touch-icon" sizes="180x180" href="icons/icon-180x180.webp"/>
<link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192x192.webp"/>
<title>LeaderMath.UZ</title>

<style id="lm-bundle">
:root {
--brand: #2E8B57;
--brand-light: #44c37a;
--brand-dark: #1b7045;
--bg: #ecfff6;
--text: #0f172a;
--muted: #475569;
--card-bg: rgba(255, 255, 255, 0.78);
--glass: rgba(255, 255, 255, 0.55);
--shadow: 0 24px 60px rgba(15, 23, 42, 0.14);
--radius: 24px;
--transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.1);
}

* {
margin: 0;
padding: 0;
box-sizing: border-box;
}

html {
scroll-behavior: smooth;
}

html, body {
width: 100%;
font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
background:
radial-gradient(1000px 700px at 20% 10%, rgba(68,195,122,.22), transparent 55%),
radial-gradient(900px 700px at 90% 20%, rgba(120,180,255,.18), transparent 55%),
linear-gradient(180deg, var(--bg), #e7f1ff);
color: var(--text);
overflow-x: hidden;
}

body {
position: relative;
min-height: 100vh;
}

#three-canvas {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
z-index: 0;
pointer-events: none;
}

.app {
position: relative;
z-index: 10;
width: 100%;
max-width: 1200px;
margin: 0 auto;
padding: 20px;
min-height: 100vh;
display: flex;
flex-direction: column;
gap: 25px;
}

::-webkit-scrollbar {
width: 10px;
}

::-webkit-scrollbar-track {
background: rgba(255,255,255,.55);
backdrop-filter: blur(10px);
}

::-webkit-scrollbar-thumb {
background: linear-gradient(135deg, var(--brand), var(--brand-dark));
border-radius: 5px;
border: 2px solid rgba(255,255,255,.65);
}

::-webkit-scrollbar-thumb:hover {
background: linear-gradient(135deg, var(--brand-light), var(--brand));
}

header {
animation: slideDown 0.8s ease-out;
}

.header-card {
background: var(--card-bg);
backdrop-filter: blur(20px);
-webkit-backdrop-filter: blur(20px);
border: 1px solid var(--glass);
border-radius: var(--radius);
padding: 18px 24px;
display: flex;
align-items: center;
gap: 20px;
box-shadow: var(--shadow);
transition: var(--transition);
}

.header-card:hover {
transform: translateY(-5px);
border-color: var(--brand);
box-shadow: 0 25px 50px rgba(14, 165, 233, 0.2);
}

.logo-img {
width: 70px;
height: 70px;
border-radius: 50%;
object-fit: cover;
border: 3px solid var(--brand);
box-shadow: 0 0 30px var(--brand);
animation: pulse 4s infinite;
}


/* =========================
   WORLD INTERACTIVE LOGO
========================= */
.lmLogo{
  position: relative;
  width: 72px; height: 72px;
  border-radius: 22px;
  display: grid;
  place-items: center;
  isolation: isolate;
}
.lmLogo .lmCore{
  width: 62px; height: 62px;
  border-radius: 18px;
  overflow: hidden;
  border: 1px solid rgba(255,255,255,.55);
  box-shadow: 0 18px 44px rgba(46,139,87,.20);
  background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.85), rgba(255,255,255,.35));
}
.lmLogo .logo-img{
  width: 100%;
  height: 100%;
  border-radius: 0;
  border: none;
  box-shadow: none;
  animation: none;
  object-fit: cover;
}
.lmOrbit{
  position:absolute; inset:-2px;
  border-radius: 26px;
  pointer-events:none;
  border: 1px solid rgba(255,255,255,.28);
  background: conic-gradient(from 210deg, rgba(59,130,246,.0), rgba(22,245,167,.65), rgba(46,139,87,.0));
  filter: blur(.0px);
  opacity: .85;
  mix-blend-mode: normal;
  mask: radial-gradient(circle at center, transparent 58%, #000 59%);
  -webkit-mask: radial-gradient(circle at center, transparent 58%, #000 59%);
  animation: lmSpin 6.8s linear infinite;
  z-index: -1;
}
.lmOrbit.o2{ inset:-7px; opacity:.55; animation-duration: 10.5s; animation-direction: reverse; }
.lmOrbit.o3{ inset:-12px; opacity:.35; animation-duration: 14.5s; }
.lmSpark{
  position:absolute; inset:-18px;
  border-radius: 30px;
  background: radial-gradient(circle at 30% 30%, rgba(22,245,167,.18), transparent 55%),
              radial-gradient(circle at 70% 60%, rgba(59,130,246,.16), transparent 55%);
  z-index: -2;
  filter: blur(.2px);
}
@keyframes lmSpin{ to{ transform: rotate(360deg); } }

@media (prefers-reduced-motion: reduce){
  .lmOrbit{ animation:none !important; }
}

/* =========================
   WORLD LEVEL WINDOW (NEO)
========================= */
.levelNeoCard{
  margin-top: 14px;
  display: grid;
  grid-template-columns: 220px 1fr;
  gap: 16px;
  align-items: center;
  padding: 16px;
  border-radius: 22px;
  background:
    radial-gradient(360px 240px at 10% 10%, rgba(22,245,167,.18), transparent 60%),
    radial-gradient(380px 260px at 90% 20%, rgba(59,130,246,.14), transparent 60%),
    linear-gradient(135deg, rgba(255,255,255,.92), rgba(233,247,240,.72));
  border: 1px solid rgba(46,139,87,.14);
  box-shadow: 0 22px 58px rgba(12,38,28,.14);
  overflow:visible;
  position: relative;
}
.levelNeoCard::before{
  content:"";
  position:absolute; inset:-2px;
  border-radius: 24px;
  padding: 2px;
  background: linear-gradient(135deg, rgba(46,139,87,.32), rgba(22,245,167,.24), rgba(59,130,246,.18));
  -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite: xor;
  mask-composite: exclude;
  pointer-events:none;
  opacity:.85;
}
.levelOrb{
  position: relative;
  width: 220px;
  height: 220px;
  display:grid;
  place-items:center;
}
.levelRing{
  position:absolute;
  width: 220px;
  height: 220px;
  transform: rotate(-90deg);
}
.ringTrack{
  fill:none;
  stroke: rgba(15,23,42,.10);
  stroke-width: 10;
}
.ringGlow{
  fill:none;
  stroke: rgba(46,139,87,.18);
  stroke-width: 10;
  filter: url(#lmGlow);
}
.ringProg{
  fill:none;
  stroke: url(#lmRingGrad);
  stroke-width: 10;
  stroke-linecap: round;
  stroke-dasharray: 289; /* 2*pi*r, r=46 => ~289 */
  stroke-dashoffset: 289;
  filter: url(#lmGlow);
  transition: stroke-dashoffset .35s ease;
}
.orbCore{
  padding: 10px;

  position:relative;
  width: 152px;
  height: 152px;
  border-radius: 44px;
  background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.92), rgba(255,255,255,.55));
  border: 1px solid rgba(46,139,87,.18);
  box-shadow: 0 20px 50px rgba(46,139,87,.16);
  overflow:hidden;
overflow-y:hidden;
  display:grid;
  place-items:center;
}
.orbCore img{
  width: 100%;
  height: 100%;
  max-width: 120px;
  max-height: 120px;
  object-fit: contain;
  border-radius: 26px;
  filter: drop-shadow(0 16px 26px rgba(12,38,28,.20));
}
.orbSheen{
  position:absolute; inset:-60px -40px auto auto;
  width: 200px; height: 200px;
  background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.65), transparent 58%);
  transform: rotate(12deg);
  opacity:.55;
  pointer-events:none;
}
.orbDots{
  position:absolute; inset:0;
  pointer-events:none;
}
.orbDots i{
  position:absolute; width:10px; height:10px; border-radius:999px;
  background: rgba(22,245,167,.90);
  box-shadow: 0 0 0 7px rgba(22,245,167,.14);
  animation: orbFloat 3.8s ease-in-out infinite;
}
.orbDots i:nth-child(1){ left:14px; top:18px; animation-delay: .0s; }
.orbDots i:nth-child(2){ right:16px; top:52px; background: rgba(59,130,246,.90); box-shadow: 0 0 0 7px rgba(59,130,246,.14); animation-delay: .6s; }
.orbDots i:nth-child(3){ left:34px; bottom:18px; background: rgba(46,139,87,.95); box-shadow: 0 0 0 7px rgba(46,139,87,.14); animation-delay: 1.1s; }
@keyframes orbFloat{
  0%,100%{ transform: translateY(0); opacity:.85; }
  50%{ transform: translateY(-8px); opacity:.55; }
}

.levelInfo{ position:relative; z-index:1; }
.levelMini{
  margin-top: 10px;
  display:flex;
  align-items:center;
  gap: 10px;
}
.levelMiniBar{
  flex:1;
  height: 16px;
  border-radius: 999px;
  background: rgba(15,23,42,.08);
  border: 1px solid rgba(15,23,42,.06);
  overflow:hidden;
overflow-y:hidden;
}
.levelMiniFill{
  display:block;
  height:100%;
  border-radius: 999px;
  background: linear-gradient(90deg, rgba(46,139,87,.92), rgba(22,245,167,.86), rgba(59,130,246,.70));
  box-shadow: 0 12px 26px rgba(46,139,87,.16);
}

.levelMiniFill{ position: relative; overflow: hidden; }
.levelMiniFill::after{
  content:"";
  position:absolute; top:-8px; left:-40%;
  width:40%; height: 32px;
  transform: skewX(-18deg);
  background: linear-gradient(90deg, transparent, rgba(255,255,255,.55), transparent);
  opacity:.9;
  animation: lmFillShine 3.2s ease-in-out infinite;
  pointer-events:none;
}
@keyframes lmFillShine{
  0%{ left:-45%; opacity:0; }
  15%{ opacity:.65; }
  50%{ opacity:1; }
  85%{ opacity:.55; }
  100%{ left:105%; opacity:0; }
}
@media (prefers-reduced-motion: reduce){
  .levelMiniFill::after{ animation:none !important; }
}



.levelMiniBar{ position: relative; }
.levelMiniFill{ display:block; height:100%; border-radius:999px; }
.levelMiniKnob{
position:absolute;
top:50%;
transform: translate(-50%,-50%);
width: 16px; height: 16px;
border-radius: 999px;
background: #fff;
border: 2px solid rgba(46,139,87,.65);
box-shadow: 0 10px 22px rgba(15,23,42,.12);
}
.levelMiniTooltip{
position:absolute;
top:-42px;
transform: translateX(-50%);
padding: 6px 10px;
border-radius: 999px;
background: rgba(255,255,255,.92);
border: 1px solid rgba(46,139,87,.18);
box-shadow: 0 14px 30px rgba(15,23,42,.10);
font-size: 12px;
font-weight: 900;
color: rgba(15,23,42,.78);
white-space: nowrap;
opacity: 0;
pointer-events:none;
transition: opacity .12s ease, transform .12s ease;
}
.levelMiniBar:hover .levelMiniTooltip{ opacity: 1; transform: translateX(-50%) translateY(-2px); }
.levelMiniPct{
  width: 52px;
  text-align:right;
  font-size: 12px;
  color: rgba(15,23,42,.58);
  font-weight: 800;
}
.levelActions{
  margin-top: 12px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
.levelActions .btn{ width:auto; padding:10px 14px; }
.rank-btn-mini .rankIcon{
  width:16px;height:16px;border-radius:6px;
  background: conic-gradient(from 210deg, rgba(59,130,246,.85), rgba(22,245,167,.92), rgba(46,139,87,.90));
  box-shadow: 0 10px 22px rgba(12,38,28,.10);
  border: 1px solid rgba(255,255,255,.75);
}

@media (max-width: 820px){
  .levelNeoCard{ grid-template-columns: 1fr; }
  .levelOrb{ width: 100%; }
  .levelRing{ margin: 0 auto; }
}
@media (max-width: 520px){
  .levelOrb{ height: 210px; }
  .levelRing{ width: 210px; height: 210px; }
  .orbCore{ width: 144px; height: 144px; border-radius: 40px; }
  .orbCore img{ width: 100px; height: 100px; }
}
.header-text {
flex: 1;
display: flex;
flex-direction: column;
gap: 5px;
}

.header-title {
font-size: 24px;
font-weight: 800;
background: linear-gradient(90deg, var(--brand), var(--brand-light));
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
letter-spacing: -0.5px;
}

.header-sub {
font-size: 14px;
color: var(--muted);
}

.header-tag {
padding: 10px 20px;
background: rgba(14, 165, 233, 0.15);
border: 1px solid rgba(14, 165, 233, 0.3);
border-radius: 50px;
display: flex;
align-items: center;
gap: 10px;
font-size: 14px;
font-weight: 600;
color: var(--brand-light);
backdrop-filter: blur(10px);
transition: var(--transition);
}

.header-tag:hover {
background: rgba(14, 165, 233, 0.25);
transform: scale(1.05);
}

main {
flex: 1;
display: flex;
flex-direction: column;
gap: 30px;
}

.section-shell {
background: var(--card-bg);
backdrop-filter: blur(20px);
border: 1px solid var(--glass);
border-radius: var(--radius);
padding: 25px;
box-shadow: var(--shadow);
animation: fadeIn 1s ease-out 0.2s both;
}

.section-header {
margin-bottom: 25px;
display: flex;
justify-content: space-between;
align-items: center;
gap: 15px;
}

.section-title-wrap {
display: flex;
flex-direction: column;
gap: 8px;
}

.section-title {
font-size: 22px;
font-weight: 700;
display: flex;
align-items: center;
gap: 12px;
}

.section-title i {
color: var(--brand);
font-size: 24px;
}

.section-sub {
font-size: 14px;
color: var(--muted);
max-width: 600px;
}

.section-chip {
padding: 8px 16px;
background: rgba(14, 165, 233, 0.1);
border: 1px dashed var(--brand);
border-radius: 50px;
font-size: 12px;
font-weight: 600;
color: var(--brand-light);
}

.card-list {
display: grid;
grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
gap: 25px;
}

.card {
background: rgba(30, 41, 59, 0.6);
border-radius: 20px;
border: 1px solid rgba(255, 255, 255, 0.05);
overflow: hidden;
transition: var(--transition);
position: relative;
cursor: pointer;
transform-style: preserve-3d;
perspective: 1000px;
height: 100%;
}

.card::before {
content: '';
position: absolute;
inset: 0;
background: linear-gradient(135deg, rgba(14, 165, 233, 0.1), transparent);
border-radius: 20px;
opacity: 0;
transition: opacity 0.4s;
pointer-events: none;
}

.card:hover {
transform: translateY(-15px) rotateX(5deg);
border-color: var(--brand);
box-shadow: 0 30px 60px rgba(14, 165, 233, 0.3);
}

.card:hover::before {
opacity: 1;
}

.card-img-wrap {
position: relative;
height: 180px;
overflow: hidden;
}

.card-img-wrap img {
width: 100%;
height: 100%;
object-fit: cover;
transition: transform 0.6s;
}

.card:hover .card-img-wrap img {
transform: scale(1.1);
}

.card-label {
position: absolute;
top: 15px;
left: 15px;
padding: 8px 15px;
background: rgba(15, 23, 42, 0.9);
border-radius: 50px;
font-size: 12px;
font-weight: 600;
display: flex;
align-items: center;
gap: 8px;
color: white;
backdrop-filter: blur(10px);
}

.card-label i {
color: var(--brand);
}

.card-body {
padding: 20px;
display: flex;
flex-direction: column;
gap: 12px;
height: calc(100% - 180px);
}

.card-title {
font-size: 18px;
font-weight: 700;
color: white;
}

.card-desc {
font-size: 13px;
color: var(--muted);
line-height: 1.5;
flex-grow: 1;
}

.card-meta-row {
display: flex;
justify-content: space-between;
align-items: center;
margin-top: 10px;
}

.card-meta-left {
display: flex;
align-items: center;
gap: 10px;
font-size: 12px;
color: var(--brand-light);
}

.dot {
width: 8px;
height: 8px;
border-radius: 50%;
background: var(--brand);
box-shadow: 0 0 10px var(--brand);
}

.card-tag-mini {
padding: 5px 12px;
background: rgba(14, 165, 233, 0.1);
border-radius: 50px;
font-size: 11px;
font-weight: 600;
color: var(--brand-light);
}

.card-footer {
margin-top: auto;
}

.btn {
width: 100%;
padding: 14px;
background: linear-gradient(135deg, var(--brand), var(--brand-dark));
border: none;
border-radius: 12px;
color: white;
font-size: 14px;
font-weight: 700;
cursor: pointer;
display: flex;
align-items: center;
justify-content: center;
gap: 10px;
transition: var(--transition);
position: relative;
overflow: hidden;
}

.btn::after {
content: '';
position: absolute;
top: -50%;
left: -50%;
width: 200%;
height: 200%;
background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
transform: rotate(45deg);
transition: transform 0.6s;
}

.btn:hover {
transform: translateY(-3px);
box-shadow: 0 15px 30px rgba(14, 165, 233, 0.4);
}

.btn:hover::after {
transform: rotate(45deg) translate(10%, 10%);
}

.btn i {
font-size: 16px;
}

footer {
animation: slideUp 0.8s ease-out 0.4s both;
margin-top: 40px;
}

.footer-card {
background: var(--card-bg);
backdrop-filter: blur(20px);
border: 1px solid var(--glass);
border-radius: var(--radius);
padding: 20px 25px;
display: flex;
justify-content: space-between;
align-items: center;
gap: 20px;
box-shadow: var(--shadow);
}

.footer-left {
display: flex;
flex-direction: column;
gap: 8px;
}

.footer-name {
font-size: 16px;
font-weight: 800;
color: var(--brand);
letter-spacing: 1px;
}

.footer-right {
display: flex;
gap: 15px;
}

.footer-link {
padding: 10px 20px;
background: rgba(14, 165, 233, 0.1);
border: 1px solid rgba(14, 165, 233, 0.3);
border-radius: 50px;
color: var(--brand-light);
text-decoration: none;
display: flex;
align-items: center;
gap: 10px;
font-size: 14px;
font-weight: 600;
transition: var(--transition);
}

.footer-link:hover {
background: rgba(14, 165, 233, 0.2);
transform: translateY(-3px);
}

#page-modal {
position: fixed;
inset: 0;
z-index: 1000;
display: none;
background: rgba(15, 23, 42, 0.95);
backdrop-filter: blur(20px);
}

#page-modal.open {
display: flex;
animation: modalFadeIn 0.3s ease-out;
}

.modal-inner {
flex: 1;
max-width: 1200px;
margin: auto;
padding: 20px;
position: relative;
}

.close-btn {
position: absolute;
top: 30px;
right: 30px;
width: 50px;
height: 50px;
background: rgba(14, 165, 233, 0.2);
border: 2px solid var(--brand);
border-radius: 50%;
color: white;
font-size: 20px;
cursor: pointer;
z-index: 1001;
transition: var(--transition);
display: flex;
align-items: center;
justify-content: center;
}

.close-btn:hover {
background: var(--brand);
transform: rotate(90deg);
}

.modal-frame {
width: 100%;
height: 100%;
border-radius: var(--radius);
border: 2px solid var(--brand);
background: white;
box-shadow: 0 40px 80px rgba(0, 0, 0, 0.5);
}

@keyframes slideDown {
from {
opacity: 0;
transform: translateY(-50px);
}
to {
opacity: 1;
transform: translateY(0);
}
}

@keyframes slideUp {
from {
opacity: 0;
transform: translateY(50px);
}
to {
opacity: 1;
transform: translateY(0);
}
}

@keyframes fadeIn {
from {
opacity: 0;
transform: scale(0.95);
}
to {
opacity: 1;
transform: scale(1);
}
}

@keyframes pulse {
0%, 100% {
box-shadow: 0 0 30px var(--brand);
}
50% {
box-shadow: 0 0 50px var(--brand-light);
}
}

@keyframes modalFadeIn {
from {
opacity: 0;
}
to {
opacity: 1;
}
}

.scroll-progress {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 4px;
background: rgba(14, 165, 233, 0.1);
z-index: 1000;
}

.scroll-progress-bar {
height: 100%;
background: linear-gradient(90deg, var(--brand), var(--brand-light));
width: 0%;
transition: width 0.1s;
box-shadow: 0 0 10px var(--brand);
}

.scroll-to-top {
position: fixed;
bottom: 30px;
right: 30px;
width: 50px;
height: 50px;
background: rgba(14, 165, 233, 0.2);
border: 2px solid var(--brand);
border-radius: 50%;
color: white;
font-size: 20px;
cursor: pointer;
z-index: 99;
display: none;
align-items: center;
justify-content: center;
transition: var(--transition);
backdrop-filter: blur(10px);
}

.scroll-to-top:hover {
background: var(--brand);
transform: translateY(-5px);
box-shadow: 0 10px 20px rgba(14, 165, 233, 0.3);
}

.scroll-to-top.show {
display: flex;
}

@media (max-width: 768px) {
.app {
padding: 15px;
}
.header-card {
flex-direction: column;
text-align: center;
gap: 15px;
}
.header-tag {
margin-top: 10px;
}
.card-list {
grid-template-columns: 1fr;
}
.footer-card {
flex-direction: column;
text-align: center;
gap: 20px;
}
.section-header {
flex-direction: column;
align-items: flex-start;
}
.scroll-to-top {
bottom: 20px;
right: 20px;
}
}

@media (max-width: 480px) {
.header-title {
font-size: 20px;
}
.section-title {
font-size: 18px;
}
.card-title {
font-size: 16px;
}
}

.form-row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}

.input{
width:100%;
padding:14px 14px;
border-radius:14px;
border:1px solid rgba(20,40,60,.10);
background:rgba(2,6,23,.35);
color: rgba(15,23,42,.88);
outline:none;
box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
}

.input::placeholder{color:rgba(226,232,240,.6)}

.input:focus{border-color:rgba(56,189,248,.6); box-shadow:0 0 0 4px rgba(14,165,233,.12)}

.small-note{font-size:12px;opacity:.78;line-height:1.4}

.auth-grid{display:grid;gap:14px}

.auth-actions{display:flex;gap:10px;flex-wrap:wrap}

.btn.secondary{
background: linear-gradient(135deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
border:1px solid rgba(148,163,184,.20);
}

.btn.danger{
background: linear-gradient(135deg, rgba(239,68,68,.85), rgba(190,18,60,.75));
}

.header-right{display:flex;align-items:center;gap:12px;flex-wrap:wrap;justify-content:flex-end}

.header-actions{display:flex;align-items:center;gap:12px;justify-content:flex-end}

.user-chip{
display:flex;align-items:center;gap:10px;
padding:10px 12px;border-radius:999px;
background:rgba(2,6,23,.35);
border:1px solid rgba(20,40,60,.10);
box-shadow: 0 10px 30px rgba(2,6,23,.35);
}

.user-chip .mini{
font-size:12px;opacity:.75;line-height:1.15
}

.user-chip .name{font-weight:800}

.icon-btn{
width:42px;height:42px;border-radius:999px;
display:grid;place-items:center;
border:1px solid rgba(20,40,60,.10);
background:rgba(2,6,23,.35);
color: rgba(15,23,42,.88);
cursor:pointer;
}

.icon-btn:active{transform:translateY(1px)}

@media (max-width:520px){
.header-sub{display:none}
.header-card{padding:14px 14px}
.logo-img{width:46px;height:46px}
.header-text{display:none}
.header-title{display:none}
.header-card{display:grid; grid-template-columns:auto 1fr auto; align-items:center; gap:10px}
.header-actions{gap:10px; flex-wrap:nowrap}
.user-chip{padding:8px 10px; min-width:0; max-width:none; overflow:visible}
.user-chip .name{white-space:normal; overflow:visible; text-overflow:unset; line-height:1.1}
.user-chip .mini{display:block; font-size:11px; opacity:.8}
.icon-btn{width:40px;height:40px}
.user-chip{
background:transparent !important;
border:none !important;
box-shadow:none !important;
padding:0 !important;
gap:10px;
}
.user-meta{min-width:0}
.user-chip .name{font-size:12px; font-weight:800}
.user-chip .mini{font-size:10px; opacity:.78}
#userAvatar{cursor:pointer}
.icon-btn{background:rgba(255,255,255,.55) !important; border:1px solid rgba(15,23,42,.10) !important; box-shadow:0 10px 24px rgba(2,6,23,.10)}
footer{margin-top:18px}
.footer-card{padding:10px 10px; border-radius:14px; flex-direction:column; align-items:stretch; gap:8px}
.footer-left{display:flex; flex-direction:column; gap:6px}
.footer-name{font-size:13px}
.small-note{font-size:11px}
.footer-right{display:flex; flex-direction:column; gap:8px}
.footer-link{justify-content:center}
.storeBar{display:flex; flex-wrap:wrap; gap:8px; margin-top:0 !important}
.storeBtn{flex:1 1 calc(50% - 8px); justify-content:center; padding:8px 10px; font-size:12px}
.storeBtn.install{flex:1 1 100%}
}

.toast{
position:fixed;left:50%;bottom:22px;transform:translateX(-50%);
background:rgba(255,255,255,.78);
border:1px solid rgba(20,40,60,.10);
backdrop-filter: blur(12px);
color: rgba(15,23,42,.88);
padding:12px 14px;border-radius:999px;
box-shadow: 0 18px 40px rgba(2,6,23,.10);
opacity:0;pointer-events:none;
transition: opacity .22s ease, transform .22s ease;
z-index:9999;
font-weight:700;
}

.toast.show{opacity:1; transform:translateX(-50%) translateY(-4px)}

.lm-modal{position:fixed; inset:0; display:none; z-index:9998;}

.lm-modal.open{display:block;}

.lm-backdrop{position:absolute; inset:0; background:rgba(2,6,23,.62); backdrop-filter: blur(10px);}

.lm-modal-card{
position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
width:min(680px, calc(100vw - 28px));
background: rgba(15,23,42,.78);
border:1px solid rgba(20,40,60,.10);
border-radius: 22px;
padding: 18px;
box-shadow: 0 30px 80px rgba(2,6,23,.55);
}

.lm-modal-card .close-btn{position:absolute; right:14px; top:14px;}

.osIcon{width:18px;height:18px;vertical-align:-3px;display:inline-block;}

.rank-btn-mini{
display:inline-flex;align-items:center;gap:6px;
padding:4px 10px;height:28px;
font-size:12px;font-weight:500;
border-radius:999px;
background:linear-gradient(135deg,#e8f5ee,#f6fffb);
border:1px solid #d9eee5;
color:#2e8b57;cursor:pointer;white-space:nowrap;
}

.rank-btn-mini img{width:14px;height:14px}

.app-header,.header-user,.header-actions{
background:rgba(255,255,255,.88)!important;
backdrop-filter:blur(12px);
box-shadow:0 10px 30px rgba(46,139,87,.12)!important;
}

.user-chip{
background:linear-gradient(135deg,#f4fffa,#e9f7f0);
box-shadow:0 6px 18px rgba(46,139,87,.15);
}

.header-actions button,
.header-actions .icon-btn,
.header-actions .btn,
.header-actions a {
background: linear-gradient(135deg,#f4fffa,#e9f7f0)!important;
color:#2e8b57!important;
box-shadow:0 4px 12px rgba(46,139,87,.15)!important;
}

.rank-btn,.rating-btn,.reting-btn{
width:auto!important;
padding:4px 10px!important;
border-radius:999px!important;
font-size:12px!important;
max-width:max-content!important;
}

.header-actions{
background: transparent !important;
box-shadow: none !important;
border: none !important;
padding: 0 !important;
gap: 10px !important;
}

.header-actions .icon-btn,
.header-actions button.icon-btn{
width: 38px;
height: 38px;
border-radius: 999px;
background: rgba(255,255,255,.75) !important;
border: 1px solid rgba(46,139,87,.18) !important;
box-shadow: 0 8px 18px rgba(46,139,87,.12) !important;
color: rgba(46,139,87,.95) !important;
}

.header-actions .icon-btn:hover{
background: rgba(255,255,255,.9) !important;
}

.levelSection .levelHead{
display:flex;
align-items:center;
justify-content:space-between;
gap:12px;
}

.levelSection .levelH2{ margin:0; font-size:18px; letter-spacing:.2px; }

.levelCardX{
margin-top: 12px;
display:grid;
grid-template-columns: 110px 1fr;
gap: 14px;
align-items: center;
padding: 14px;
border-radius: 18px;
background: linear-gradient(135deg, rgba(255,255,255,.82), rgba(233,247,240,.72));
border: 1px solid rgba(46,139,87,.12);
box-shadow: 0 18px 38px rgba(46,139,87,.10);
position: relative;
overflow:hidden;
overflow-y:hidden;
}

.levelCardX:before{
content:"";
position:absolute; inset:-40px -80px auto auto;
width: 220px; height: 220px;
background: radial-gradient(circle at 30% 30%, rgba(46,139,87,.20), transparent 60%);
filter: blur(1px);
}

.levelMedalWrap{
position: relative;
width: 110px;
height: 110px;
border-radius: 22px;
background: rgba(255,255,255,.70);
border: 1px solid rgba(46,139,87,.14);
box-shadow: 0 14px 28px rgba(46,139,87,.12);
display:flex;
align-items:center;
justify-content:center;
overflow:hidden;
overflow-y:hidden;
}

.levelMedalImg{
width: 86px;
height: 86px;
object-fit: contain;
border-radius: 18px;
z-index: 2;
}

.levelGlow{
position:absolute;
inset:auto -30px -40px auto;
width: 140px; height: 140px;
background: radial-gradient(circle at 30% 30%, rgba(59,130,246,.22), transparent 65%);
transform: rotate(18deg);
z-index: 1;
}

.levelMain{ position: relative; z-index: 2; }

.levelTopRow{
display:flex;
align-items:baseline;
justify-content:space-between;
gap: 10px;
}

.levelText{ font-weight: 700; font-size: 16px; color: rgba(15,23,42,.88); }

.levelRange{ font-size: 12px; color: rgba(15,23,42,.55); }

.levelBarsRow{ margin-top: 8px; }

.levelBars{
display:flex;
align-items:flex-end;
gap: 6px;
height: 46px;
}

.levelProgressRow{
margin-top: 10px;
display:flex;
align-items:center;
gap: 10px;
}

.levelBar{
flex: 1 1 auto;
height: 12px;
border-radius: 999px;
background: rgba(15,23,42,.08);
overflow:hidden;
overflow-y:hidden;
border: 1px solid rgba(15,23,42,.06);
}

.levelFill{
height: 100%;
border-radius: 999px;
background: linear-gradient(90deg, rgba(46,139,87,.88), rgba(59,130,246,.70));
box-shadow: 0 8px 18px rgba(46,139,87,.20);
}

.levelPct{
width: 44px;
text-align:right;
font-size: 12px;
color: rgba(15,23,42,.55);
}

.levelHint{
margin-top: 8px;
font-size: 12px;
color: rgba(15,23,42,.60);
}


/* ===== Progress shimmer (more visible) ===== */
.levelMiniFill{
  background: linear-gradient(90deg, rgba(46,139,87,.95), rgba(22,245,167,.85), rgba(59,130,246,.78));
  position: relative;
  overflow: hidden;
  transition: width .9s cubic-bezier(.2,.9,.2,1);
}
.levelMiniFill::after{
  content:"";
  position:absolute; inset:0;
  background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,.35) 50%, rgba(255,255,255,0) 100%);
  transform: translateX(-60%);
  animation: lmShimmer 2.8s ease-in-out infinite;
  mix-blend-mode: overlay;
  opacity:.55;
}
@keyframes lmShimmer{
  0%{ transform: translateX(-70%); }
  60%{ transform: translateX(80%); }
  100%{ transform: translateX(80%); }
}

/* ===== Top-10 ticker (Level card) ===== */
.top10Row{ margin-top: 10px; display:flex; flex-direction:column; gap:8px; }
.top10Label{
display:flex; align-items:center; gap:8px;
font-size:12px; font-weight:900; letter-spacing:.2px;
color: rgba(15,23,42,.78);
}
.top10Label i{ color: var(--brand); }
.top10Marquee{
position:relative;
contain: layout paint;;
border-radius: 16px;
border: 1px solid rgba(46,139,87,.14);
background: linear-gradient(135deg, rgba(255,255,255,.72), rgba(233,247,240,.60));
box-shadow: 0 16px 34px rgba(46,139,87,.08);
overflow:hidden;
overflow-y:hidden;
padding: 10px 10px;
height: 64px;
min-height: 64px;
display:flex;
align-items:center;
}
.top10Marquee::before,
.top10Marquee::after{
content:"";
position:absolute; top:0; bottom:0; width:42px;
pointer-events:none; z-index:2;
}
.top10Marquee::before{ left:0; background: linear-gradient(90deg, rgba(255,255,255,.92), rgba(255,255,255,0)); }
.top10Marquee::after{ right:0; background: linear-gradient(270deg, rgba(255,255,255,.92), rgba(255,255,255,0)); }

.top10Track{
flex-shrink:0;
display:flex; gap:10px; align-items:center;
width:max-content;
will-change: transform;
}
.top10Track.run{
animation: lmMarquee var(--marquee-duration, 140s) linear infinite;
}
.top10Marquee:hover .top10Track.run{ animation-play-state: paused; }
.top10Marquee:active .top10Track.run{ animation-play-state: paused; }
@media (prefers-reduced-motion: reduce){
  .top10Track.run{ animation:none !important; transform:none !important; }
}

@keyframes lmMarquee{
from{ transform: translateX(0); }
to{ transform: translateX(-50%); }
}

.top10Item{
display:flex; align-items:center; gap:10px;
padding: 8px 10px;
border-radius: 14px;
border: 1px solid rgba(15,23,42,.08);
background: rgba(255,255,255,.78);
box-shadow: 0 10px 22px rgba(2,6,23,.06);
white-space:nowrap;
}
.top10Item.me{ border-color: rgba(46,139,87,.45); box-shadow: 0 14px 28px rgba(46,139,87,.14); }
.top10Avatar{
width:32px; height:32px; border-radius: 12px;
background: rgba(255,255,255,.55);
border: 1px solid rgba(15,23,42,.10);
object-fit: cover;
}
.top10Name{ font-weight:1000; font-size:12px; color: rgba(15,23,42,.84); max-width: 130px; overflow:hidden;
overflow-y:hidden; text-overflow:ellipsis; }
.top10Pts{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
font-weight:900; font-size:12px; color: rgba(46,139,87,.92); }
.top10Sep{ opacity:.35; }

@media (max-width:560px){
.top10Name{ max-width: 96px; }
.top10Marquee{ padding: 9px 8px; }
.top10Item{ padding: 7px 9px; }
}
/* --- FIX: Top10 items should never wrap (prevents level bar layout breaking) --- */
.top10Marquee{ width:100%; max-width:100%; }
.top10Track{
flex-shrink:0; flex-wrap:nowrap; }
.top10Item{ flex: 0 0 auto; }
.top10Name{ white-space:nowrap; }



@media (max-width: 560px){
.header-actions .icon-btn{ width:34px; height:34px; }
.levelCardX{
grid-template-columns: 84px 1fr;
padding: 12px;
border-radius: 16px;
}
.levelMedalWrap{ width:84px; height:84px; border-radius: 18px; }
.levelMedalImg{ width:66px; height:66px; border-radius: 14px; }
.levelBars{ gap:5px; height: 38px; }
.levelText{ font-size: 14px; }
}

@keyframes lmFloat {
0%   { transform: translateY(0px) rotate(-1deg); }
50%  { transform: translateY(-6px) rotate(1.2deg); }
100% { transform: translateY(0px) rotate(-1deg); }
}

.levelMedalImg{
animation: lmFloat 4.6s ease-in-out infinite;
will-change: transform;
}

.levelBar{
position: relative;
}

.levelBar::after{
content:"";
position:absolute;
top:-8px;
left:-40%;
width: 40%;
height: 26px;
transform: skewX(-18deg);
background: linear-gradient(90deg, transparent, rgba(255,255,255,.55), transparent);
filter: blur(.2px);
opacity: .9;
animation: lmShine 2.8s ease-in-out infinite;
pointer-events:none;
}

@keyframes lmShine{
0%   { left:-45%; opacity:.0; }
15%  { opacity:.7; }
50%  { opacity:1; }
85%  { opacity:.6; }
100% { left:105%; opacity:.0; }
}

@media (prefers-reduced-motion: reduce){
.levelMedalImg{ animation:none !important; }
.levelBar::after{ animation:none !important; }
}

@media (max-width: 560px){
.app-header .header-row{
flex-wrap: wrap;
justify-content: center !important;
gap: 10px !important;
}
.app-header .brand{
flex: 1 1 100%;
justify-content: center !important;
text-align: center !important;
}
.app-header .brand-title,
.app-header h1,
.app-header .title{
font-size: 16px !important;
line-height: 1.15 !important;
white-space: normal !important;
overflow: visible !important;
text-overflow: clip !important;
max-width: 100% !important;
display: -webkit-box;
-webkit-line-clamp: 2;
-webkit-box-orient: vertical;
}
.app-header .brand-subtitle,
.app-header .subtitle{
font-size: 12px !important;
}
.app-header .header-user{
margin: 0 auto !important;
max-width: 92% !important;
}
.app-header .user-chip{
justify-content: center !important;
text-align: center !important;
}
.app-header .header-actions{
position: absolute;
right: 12px;
top: 12px;
}
}

@media (max-width: 520px){
header .header-card{
justify-content: center !important;
text-align: center !important;
}
header .brandBox{
order: 1 !important;
justify-content: center !important;
}
header .header-text{
display: flex !important;
order: 2 !important;
flex: 1 1 auto !important;
min-width: 160px;
align-items: flex-start;
justify-content: center !important;
text-align: left !important;
gap: 2px;
}
header .header-title{
font-size: 14px !important;
line-height: 1.15 !important;
font-weight: 800 !important;
white-space: normal !important;
overflow: visible !important;
text-overflow: clip !important;
max-width: 100% !important;
display: -webkit-box !important;
-webkit-line-clamp: 2 !important;
-webkit-box-orient: vertical !important;
}
header .header-sub{
font-size: 11px !important;
opacity: .75 !important;
}
header .header-actions{
order: 3 !important;
margin-left: 0 !important;
}
header .user-chip{
order: 4 !important;
width: 100% !important;
margin: 6px auto 0 !important;
justify-content: center !important;
text-align: center !important;
}
header .user-chip .user-meta{
text-align: center !important;
}
header .user-chip .name,
header .user-chip .mini{
justify-content: center !important;
}
}

.modalOverlay.modalApp{
background: radial-gradient(800px 480px at 20% 10%, rgba(46,139,87,.16), transparent 60%),
radial-gradient(760px 460px at 85% 20%, rgba(59,130,246,.14), transparent 60%),
rgba(10,18,30,.20);
backdrop-filter: blur(10px);
}

.modalOverlay.modalApp .modal{
position: relative;
border-radius: 18px !important;
background: linear-gradient(135deg, rgba(255,255,255,.92), rgba(235,249,243,.82)) !important;
border: 1px solid rgba(46,139,87,.14) !important;
box-shadow:
0 26px 70px rgba(15,23,42,.18),
0 18px 40px rgba(46,139,87,.10) !important;
overflow: hidden;
transform: translateY(10px) scale(.98);
opacity: .0;
animation: lmModalIn .22s ease-out forwards;
}

.modalOverlay.modalApp .modal::before{
content:"";
position:absolute;
inset:-2px;
border-radius: 20px;
padding:2px;
background: linear-gradient(135deg, rgba(46,139,87,.35), rgba(59,130,246,.25), rgba(46,139,87,.18));
-webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
-webkit-mask-composite: xor;
mask-composite: exclude;
pointer-events:none;
opacity:.85;
}

.modalOverlay.modalApp .modal::after{
content:"";
position:absolute;
width: 240px; height: 240px;
right:-120px; top:-120px;
background: radial-gradient(circle at 30% 30%, rgba(46,139,87,.22), transparent 60%);
filter: blur(0.2px);
pointer-events:none;
}

@keyframes lmModalIn{
to{ transform: translateY(0px) scale(1); opacity: 1; }
}

.modalOverlay.modalApp .modalHead{
background: linear-gradient(180deg, rgba(255,255,255,.85), rgba(255,255,255,0));
}

.modalOverlay.modalApp .modalTitle{
letter-spacing:.2px;
}

.notifList li,
.commentList li{
background: rgba(255,255,255,.62);
border: 1px solid rgba(15,23,42,.07);
border-radius: 14px;
padding: 10px 12px;
box-shadow: 0 10px 20px rgba(15,23,42,.06);
}

.modalOverlay.modalApp .commentBox{
background: rgba(255,255,255,.55);
border: 1px solid rgba(46,139,87,.12);
border-radius: 14px;
padding: 10px;
}

@media (max-width: 560px){
.modalOverlay.modalApp .modal{
width: min(94vw, 520px) !important;
border-radius: 16px !important;
}
}

:root{
--bg0:#f4fbf7;
--bg1:#ecf7f0;
--ink:#0f2a1f;
--muted:#4a6b5c;
--card: rgba(255,255,255,.78);
--card2: rgba(255,255,255,.92);
--stroke: rgba(14,42,31,.10);
--shadow: 0 18px 50px rgba(12,38,28,.12);
--shadow2: 0 10px 26px rgba(12,38,28,.10);
--brand:#2E8B57;
--brand2:#44c37a;
--danger:#e84d6e;
--radius:18px;
--radius2:24px;
--gap:12px;
--tap:44px;
}

html,body{height:100%;}

body{
color:var(--ink);
background:
radial-gradient(1000px 700px at 70% 0%, rgba(68,195,122,.25), transparent 55%),
radial-gradient(900px 700px at 0% 30%, rgba(46,139,87,.18), transparent 55%),
linear-gradient(180deg, var(--bg0), var(--bg1));
}

.seasonCanvas{ position:fixed; inset:0; z-index:0; pointer-events:none; opacity:.22; }

.container{ position:relative; z-index:1; }

.glass{
background: linear-gradient(180deg, var(--card2), var(--card));
border:1px solid var(--stroke);
border-radius: var(--radius2);
box-shadow: var(--shadow);
backdrop-filter: blur(10px);
}

.topbar{
position:sticky; top:12px; z-index:5;
border-radius: var(--radius2);
padding: 12px 12px;
}

@media (max-width: 520px){
.topbar{ position:relative; top:auto; }
}

.brand .logo{
width:42px; height:42px; border-radius:16px;
background: radial-gradient(circle at 30% 30%, var(--brand2), var(--brand));
box-shadow: 0 10px 24px rgba(46,139,87,.18);
border:1px solid rgba(255,255,255,.65);
}

.brand .logo span{ color:white; font-weight:800; }

.title{ letter-spacing:.2px; }

.subtitle{ color:var(--muted); }

.btn, .iconBtn, .chipBtn, .linkBtn{
border:1px solid var(--stroke) !important;
background: rgba(255,255,255,.72) !important;
color: var(--ink) !important;
border-radius: 999px !important;
transition: transform .12s ease, box-shadow .12s ease, background .12s ease;
box-shadow: 0 8px 18px rgba(12,38,28,.08);
}

.btn:hover, .iconBtn:hover, .chipBtn:hover, .linkBtn:hover{
transform: translateY(-1px);
background: rgba(255,255,255,.92) !important;
}

.btnPrimary, .btn.btnPrimary, .btn.btnPrimary *{
background: linear-gradient(180deg, rgba(46,139,87,.95), rgba(46,139,87,.70)) !important;
color: #fff !important;
border-color: rgba(46,139,87,.25) !important;
box-shadow: 0 12px 26px rgba(46,139,87,.20);
}

.btnPrimary:hover{ filter: brightness(1.02); }

.iconBtn{
width: 40px; height: 40px;
display:inline-flex; align-items:center; justify-content:center;
border-radius: 14px !important;
}

.bellBtn{ position:relative; }

.badge{
position:absolute; top:-6px; right:-6px;
min-width:18px; height:18px; padding:0 5px;
border-radius:999px;
background: var(--danger);
color:#fff;
font-size:11px;
display:flex; align-items:center; justify-content:center;
border:2px solid rgba(255,255,255,.95);
box-shadow: 0 10px 22px rgba(232,77,110,.18);
}

.badge.pulse{
animation: lmPulse 1.15s ease-in-out infinite;
}

@keyframes lmPulse{
0%,100%{ transform: translateZ(0) scale(1); }
50%{ transform: translateZ(0) scale(1.08); }
}

.section{ padding: 16px; border-radius: var(--radius2); }

.sectionTitle h2{ margin:0; font-size:16px; }

.hint{ color:var(--muted) !important; }

.profileRow{ gap:10px; }

.chip{
border:1px solid var(--stroke) !important;
background: rgba(255,255,255,.78) !important;
color: var(--ink) !important;
border-radius: 16px !important;
}

.k{ color: var(--muted) !important; }

.stats .stat{
border:1px dashed rgba(46,139,87,.20);
background: rgba(68,195,122,.10);
border-radius: 16px;
padding:10px 12px;
}

.sideFab{
position: fixed;
top: 50%;
right: -22px;
transform: translateY(-50%);
width: 52px;
height: 52px;
border-radius: 18px;
border:1px solid rgba(46,139,87,.28);
background: radial-gradient(circle at 30% 30%, rgba(68,195,122,.95), rgba(46,139,87,.80));
box-shadow: 0 16px 44px rgba(12,38,28,.22);
z-index: 40;
display:flex; align-items:center; justify-content:center;
cursor:pointer;
transition: transform .12s ease, filter .12s ease;
}

.sideFab:hover{ transform: translateY(-50%) translateX(-2px); filter: brightness(1.02); }

.sideFab:active{ transform: translateY(-50%) translateX(-1px) scale(.98); }

.sideFab::after{
content:"";
position:absolute; inset:-2px;
border-radius: 20px;
border:1px solid rgba(255,255,255,.22);
pointer-events:none;
}

.sideFab::before{
content:"";
position:absolute;
width:120%; height:120%;
border-radius: 28px;
background: radial-gradient(circle, rgba(68,195,122,.28), transparent 55%);
animation: fabPulse 1.8s ease-in-out infinite;
z-index:-1;
}

@keyframes fabPulse{
0%,100%{ transform: scale(.92); opacity:.55; }
50%{ transform: scale(1.08); opacity:.20; }
}

.sideFabIcon{
font-weight: 900;
color: #fff;
font-size: 18px;
line-height: 1;
display:flex; flex-direction:column; align-items:center;
}

.sideFabIcon small{ font-size:10px; opacity:.95; margin-top:2px; }

.sidePanel{
border-radius: var(--radius2);
background: linear-gradient(180deg, rgba(255,255,255,.94), rgba(255,255,255,.78));
}

.sideHead .sideTitle{ color: var(--ink); letter-spacing:.2px; }

.sideTabs .tabBtn{
border-radius: 999px;
border:1px solid var(--stroke);
background: rgba(255,255,255,.70);
}

.sideTabs .tabBtn.active{
background: rgba(46,139,87,.14);
border-color: rgba(46,139,87,.22);
}

.lbTools{ gap:10px; }

.lbSearch, #userSearch, #q{
border:1px solid var(--stroke) !important;
background: rgba(255,255,255,.85) !important;
color: var(--ink) !important;
border-radius: 16px !important;
}

.lbSearch:focus, #userSearch:focus, #q:focus{
outline: none;
box-shadow: 0 0 0 4px rgba(68,195,122,.18);
border-color: rgba(46,139,87,.35) !important;
}

.table{
border-radius: 18px;
overflow:hidden;
overflow-y:hidden;
border:1px solid var(--stroke);
background: rgba(255,255,255,.70);
}

.table thead th{
background: rgba(46,139,87,.10);
color: var(--muted);
font-weight: 800;
}

.table tbody tr:hover{
background: rgba(68,195,122,.10);
}

.lbPodium .podCard{
border:1px solid rgba(46,139,87,.18);
background: rgba(68,195,122,.10);
box-shadow: var(--shadow2);
}

.lbPodium .podCard:hover{ transform: translateY(-2px); }

.commentActions.compact .actBtn,
.commentActions .miniBtn,
.commentActions .actBtn{
padding: 6px 10px !important;
border-radius: 999px !important;
font-size: 12px !important;
border: 1px solid var(--stroke) !important;
background: rgba(255,255,255,.70) !important;
}

.commentActions .actBtn:hover{ background: rgba(255,255,255,.92) !important; }

.commentItem .commentText{ color: var(--ink); }

.replyBox input{
border:1px solid var(--stroke) !important;
background: rgba(255,255,255,.85) !important;
color: var(--ink) !important;
border-radius: 14px !important;
}

.replyItem{ border-color: rgba(14,42,31,.10) !important; }

.adm{
display:grid;
grid-template-columns: 280px 1fr;
gap:14px;
padding:14px;
min-height:100vh;
}

.admSide{ padding:14px; display:flex; flex-direction:column; }

.admBrand{ display:flex; gap:12px; align-items:center; padding:10px 10px 16px; }

.admLogoDot{ width:44px; height:44px; border-radius:16px; background: radial-gradient(circle at 30% 30%, var(--brand2), var(--brand)); box-shadow: 0 10px 30px rgba(46,139,87,.20); }

.admNav{ display:flex; flex-direction:column; gap:8px; padding:8px; }

.admNav .tabBtn{
text-align:left;
padding:12px 12px;
border-radius:14px !important;
border:1px solid rgba(14,42,31,.10) !important;
background: rgba(255,255,255,.72) !important;
}

.admNav .tabBtn.active{
background: rgba(46,139,87,.14) !important;
border-color: rgba(46,139,87,.24) !important;
}

.admFoot{ margin-top:auto; padding:8px; display:flex; gap:10px; flex-wrap:wrap; }

.admMain{ display:flex; flex-direction:column; gap:14px; }

.admTop{
padding:12px;
display:flex;
gap:12px;
align-items:center;
justify-content:space-between;
}

.admGrid{ display:grid; grid-template-columns: 1.2fr .8fr; gap:14px; }

.admPanel{ padding:14px; min-height: calc(100vh - 104px); }

@media (max-width: 980px){
.adm{ grid-template-columns: 1fr; }
.admGrid{ grid-template-columns: 1fr; }
.sideFab{ top:auto; bottom: 18px; transform:none; }
}

.gateOverlay{
position:fixed; inset:0;
background: rgba(9,15,26,.55);
backdrop-filter: blur(10px);
display:flex; align-items:center; justify-content:center;
z-index: 200;
padding:18px;
}

.profileMini{
display:flex; align-items:center; gap:10px;
padding:8px 10px;
border-radius: 999px;
border:1px solid rgba(46,139,87,.20);
background: rgba(255,255,255,.65);
box-shadow: 0 10px 28px rgba(12,38,28,.12);
}

.profileMini .avatarImg{
width:30px; height:30px; border-radius: 12px;
object-fit: cover;
background: radial-gradient(circle at 30% 30%, rgba(68,195,122,.95), rgba(46,139,87,.85));
border: 1px solid rgba(255,255,255,0.9);
}

.profileMini .line1{ font-weight:800; font-size:12px; color: var(--ink); }

.profileMini .line2{ font-size:11px; color: rgba(255,255,255,0.9); display:flex; gap:10px; flex-wrap:wrap; }

.profileMini b{ color: var(--ink); }

@media (max-width:520px){
.profileMini{ padding:6px 8px; gap:8px; }
.profileMini .avatarImg{ width:26px; height:26px; border-radius: 10px; }
.profileMini .line1{ font-size:11px; }
.profileMini .line2{ font-size:10px; gap:8px; }
}

.avatarGrid{
display:grid;
grid-template-columns: repeat(4, minmax(0, 1fr));
gap: 10px;
}

.avaBtn{
border:1px solid rgba(255,255,255,.18);
background: rgba(255,255,255,.06);
border-radius: 16px;
padding: 8px;
cursor:pointer;
display:flex;
flex-direction:column;
align-items:center;
gap:8px;
}

.avaBtn:hover{ transform: translateY(-1px); box-shadow: 0 14px 30px rgba(255,255,255,0.9); }

.avaBtn img{
width: 56px; height:56px; border-radius: 18px;
object-fit: cover;
background: rgba(255,255,255,.08);
}

.avaBtn .small{ font-size: 11px; opacity: .85; }

.avaBtn.active{ border-color: rgba(68,195,122,.55); box-shadow: 0 0 0 4px rgba(68,195,122,.12); }

@media (max-width:520px){
.avatarGrid{ grid-template-columns: repeat(3, minmax(0, 1fr)); }
.avaBtn img{ width: 64px; height:64px; }
}

:root{
--bg0:#e9fff7;
--bg1:#e7f1ff;
--card:#ffffffcc;
--stroke:#ffffff55;
--text:#0f172a;
--muted:#64748b;
--brand:#2E8B57;
--brand2:#16a34a;
--shadow: 0 18px 55px rgba(15, 23, 42, .14);
--shadow2: 0 10px 30px rgba(15, 23, 42, .10);
--r: 26px;
}

.wrap{min-height:100vh; display:flex; align-items:center; justify-content:center; padding:26px;}

.phone{width:100%; max-width:520px; border-radius:36px; padding:18px; background:rgba(255,255,255,.16);
box-shadow:0 30px 90px rgba(255,255,255,0.9); border:1px solid rgba(255,255,255,.26);
backdrop-filter: blur(18px);
}

.loginCard{padding:18px 18px 14px;}

.loginHero{display:flex; gap:12px; align-items:center; margin-bottom:10px;}

.logoMark{width:44px; height:44px; border-radius:14px; display:grid; place-items:center;
background:radial-gradient(circle at 30% 30%, rgba(46,139,87,.35), rgba(46,139,87,.12));
border:1px solid rgba(46,139,87,.35);
box-shadow:0 12px 28px rgba(46,139,87,.18);
font-weight:900; font-size:18px; color:var(--primary);
}

.loginTitles .brandTitle{font-size:16px; line-height:1.1; font-weight:900;}

.loginTitles .brandSub{font-size:12px; opacity:.7; margin-top:2px;}

.orLine{position:relative; margin:12px 0 10px; text-align:center;}

.orLine:before{content:""; position:absolute; left:0; right:0; top:50%; height:1px; background:rgba(255,255,255,0.9);}

.orLine span{position:relative; padding:0 10px; background:rgba(255,255,255,.65); border:1px solid rgba(255,255,255,0.9);
border-radius:999px; font-size:12px; opacity:.8;}

.loginGrid{display:grid; grid-template-columns:1fr 1fr; gap:10px;}

.loginGrid .input{min-width:0;}

.loginNote{margin-top:10px; font-size:12px; opacity:.75;}

.loginDetails{
background:rgba(255,255,255,.55);
border:1px solid rgba(255,255,255,0.9);
border-radius:18px;
padding:12px;
}

.loginDetails summary{
list-style:none;
cursor:pointer;
font-weight:800;
color:var(--text);
display:flex;
align-items:center;
justify-content:space-between;
gap:10px;
}

.loginDetails summary::-webkit-details-marker{display:none}

.loginDetails summary:after{
content:"▾";
opacity:.7;
transform: translateY(-1px);
}

.loginDetails[open] summary:after{content:"▴"}

.loginDetails .muted{font-weight:600; opacity:.72}

.loginDetails .loginGrid{margin-top:10px}

.loginDetails .btn{margin-top:10px}

@media (min-width: 900px){
.phone{max-width:620px; padding:22px;}
.loginCard{padding:22px 22px 18px;}
}

*{box-sizing:border-box}

html,body{height:100%}

body{
margin:0;
font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Arial, sans-serif;
color:var(--text);
background:
radial-gradient(900px 700px at 12% 18%, rgba(46,139,87,.18), transparent 58%),
radial-gradient(900px 700px at 85% 10%, rgba(59,130,246,.14), transparent 60%),
linear-gradient(120deg, var(--bg0), var(--bg1));
overflow-x:hidden;
}

a{color:inherit;text-decoration:none}

button, input{font:inherit}

.container{
max-width: 1120px;
margin: 0 auto;
padding: 22px 16px 44px;
}

.glass{
background: var(--card);
border: 1px solid var(--stroke);
border-radius: var(--r);
box-shadow: var(--shadow2);
backdrop-filter: blur(14px);
}

.section{padding:16px}

.sectionTitle{display:flex; align-items:baseline; justify-content:space-between; gap:10px; margin-bottom:12px}

.sectionTitle h2{margin:0; font-size:18px; letter-spacing:.2px}

.sectionTitle .hint{font-size:12px; color:var(--muted); font-weight:700}

.storyBar{display:flex; gap:10px; align-items:center; overflow:auto; padding:6px 2px 10px; scroll-snap-type:x mandatory}

.storyBar::-webkit-scrollbar{height:0}

.storyBubble{scroll-snap-align:start; width:62px; flex:0 0 62px; text-align:center; cursor:pointer}

.storyRing{width:56px; height:56px; border-radius:999px; margin:0 auto; padding:3px;
background: conic-gradient(from 210deg, rgba(59,130,246,.85), rgba(46,139,87,.9), rgba(59,130,246,.85));
box-shadow:0 10px 30px rgba(15,23,42,.14);
}

.storyRingInner{width:100%; height:100%; border-radius:999px; background:rgba(255,255,255,.9); display:grid; place-items:center; overflow:hidden;
overflow-y:hidden; border:1px solid rgba(255,255,255,0.9)}

.storyRingInner img{width:100%; height:100%; object-fit:cover}

.storyLabel{font-size:11px; font-weight:800; color:rgba(15,23,42,.74); margin-top:6px; white-space:nowrap; overflow:hidden;
overflow-y:hidden; text-overflow:ellipsis}

.storyViewer{position:relative; border-radius:22px; overflow:hidden;
overflow-y:hidden; background:rgba(255,255,255,.55); border:1px solid rgba(255,255,255,0.9); box-shadow:var(--shadow2)}

.storyImg{display:block; width:100%; height:260px; object-fit:cover; background:linear-gradient(135deg, rgba(46,139,87,.12), rgba(59,130,246,.10))}

.storyProgress{position:absolute; left:10px; right:10px; top:10px; display:flex; gap:6px; z-index:2}

.storyProgressDot{flex:1; height:4px; border-radius:999px; background:rgba(255,255,255,.40); overflow:hidden}

.storyProgressDot > i{display:block; height:100%; width:0%; background:rgba(255,255,255,.92)}

.storyNav{position:absolute; top:50%; transform:translateY(-50%); z-index:3; width:38px; height:38px; border-radius:999px;
border:1px solid rgba(255,255,255,.55); background:rgba(255,255,255,.65); backdrop-filter: blur(10px);
box-shadow:0 10px 25px rgba(15,23,42,.14); display:grid; place-items:center; font-size:22px; cursor:pointer;
}

.storyNav.prev{left:10px}

.storyNav.next{right:10px}

.storyNav:active{transform:translateY(-50%) scale(.98)}

.storyEmpty{position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:6px; z-index:2; color:rgba(15,23,42,.75)}

.storyEmpty .big{font-weight:900; font-size:18px}

.challengeRow{display:grid; grid-template-columns: 1fr auto; gap:10px; align-items:center}

.chipsRow{display:flex; gap:8px; overflow:auto; padding:2px 0 4px}

.chipsRow::-webkit-scrollbar{height:0}

.chip{border:1px solid rgba(255,255,255,0.9); background:rgba(255,255,255,.65); padding:9px 12px; border-radius:999px; font-weight:800; font-size:12px; cursor:pointer; white-space:nowrap}

.chip.active{background:rgba(46,139,87,.14); border-color:rgba(46,139,87,.35)}

.searchRow{display:flex; align-items:center; gap:10px; padding:10px 12px; border-radius:999px; border:1px solid rgba(255,255,255,0.9); background:rgba(255,255,255,.65)}

.searchRow i{opacity:.7}

.searchRow .input{border:none; background:transparent; padding:0; height:auto; box-shadow:none}

.cardsGrid{display:grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap:12px}

.miniCard{position:relative; overflow:hidden;
overflow-y:hidden; border-radius:22px; border:1px solid rgba(255,255,255,0.9); background:rgba(255,255,255,.65); box-shadow:var(--shadow2); cursor:pointer; min-height:132px}

.miniCard .bg{position:absolute; inset:0; background:radial-gradient(120px 120px at 20% 20%, rgba(46,139,87,.22), transparent 60%), radial-gradient(140px 140px at 80% 30%, rgba(59,130,246,.18), transparent 55%)}

.miniCard .inner{position:relative; padding:14px}

.miniCard .tag{display:inline-flex; gap:6px; align-items:center; padding:6px 10px; border-radius:999px; font-weight:900; font-size:11px; background:rgba(255,255,255,.75); border:1px solid rgba(255,255,255,0.9)}

.miniCard .title{margin-top:10px; font-weight:1000; letter-spacing:.2px}

.miniCard .meta{margin-top:6px; font-size:12px; color:var(--muted); font-weight:700}

.miniCard:active{transform:scale(.995)}

@media (max-width: 520px){
.storyImg{height:220px}
.cardsGrid{grid-template-columns: 1fr}
}

.topbar{
display:flex;
align-items:center;
justify-content:space-between;
gap: 14px;
padding: 14px 16px;
}

.brand{
display:flex; align-items:center; gap:12px; min-width: 0;
}

.brand .logo{
width:42px; height:42px; border-radius:14px;
background: linear-gradient(135deg, rgba(46,139,87,.95), rgba(168,255,241,.85));
display:grid; place-items:center;
box-shadow: 0 10px 25px rgba(46,139,87,.25);
flex: 0 0 auto;
}

.brand .logo span{font-weight:900;color:#064e3b}

.brand .titleWrap{min-width:0}

.brand .title{font-weight:900; letter-spacing:.2px; white-space:nowrap; overflow:hidden;
overflow-y:hidden; text-overflow:ellipsis}

.brand .subtitle{font-size:12px; color:var(--muted); margin-top:2px}

.pill{
padding: 10px 14px;
border-radius: 999px;
border: 1px solid var(--stroke);
background: rgba(255,255,255,.55);
box-shadow: 0 10px 24px rgba(15,23,42,.08);
white-space:nowrap;
}

.btn{
border:none; cursor:pointer;
border-radius: 999px;
padding: 10px 16px;
background: rgba(255,255,255,.70);
border:1px solid var(--stroke);
box-shadow: 0 12px 28px rgba(15,23,42,.10);
font-weight: 800;
}

.btn:active{transform: translateY(1px)}

.btnPrimary{
background: linear-gradient(135deg, var(--brand), var(--brand2));
color:#fff; border: none;
}

.section{
margin-top: 16px;
padding: 16px;
}

.sectionTitle{
display:flex; align-items:center; justify-content:space-between;
gap: 10px;
margin-bottom: 12px;
}

.sectionTitle h2{margin:0;font-size:18px}

.sectionTitle .hint{font-size:12px;color:var(--muted)}

.profileRow{
display:flex; flex-wrap:wrap;
gap:10px;
align-items:center;
}

.chip{
display:flex; align-items:center; gap:8px;
padding: 10px 12px;
border-radius: 16px;
background: rgba(255,255,255,.65);
border:1px solid var(--stroke);
box-shadow: 0 10px 22px rgba(15,23,42,.08);
min-width: 160px;
}

.chip b{font-size:13px}

.chip span{font-size:13px;color:var(--muted)}

.chip .k{font-weight:900;color:#0b2b1e}

.stats{
display:flex; gap:10px; flex-wrap:wrap;
}

.stat{
display:flex; align-items:center; gap:8px;
padding: 10px 12px;
border-radius: 16px;
background: rgba(255,255,255,.65);
border:1px solid var(--stroke);
box-shadow: 0 10px 22px rgba(15,23,42,.08);
}

.dot{
width:10px;height:10px;border-radius:999px;background: var(--brand);
box-shadow: 0 0 0 6px rgba(46,139,87,.18);
}

.cards{
display:grid;
grid-template-columns: repeat(3, minmax(0, 1fr));
gap: 16px;
}

@media (max-width: 940px){
.cards{
grid-template-columns: 1fr;
}
}

.featureCard{
position:relative;
border-radius: 26px;
overflow:hidden;
overflow-y:hidden;
background: rgba(255,255,255,.55);
border: 1px solid var(--stroke);
box-shadow: var(--shadow);
transform-style: preserve-3d;
perspective: 900px;
}

.poster{
aspect-ratio: 9 / 16;
width:100%;
background: #dbeafe;
display:block;
}

.poster img{
width:100%; height:100%; object-fit:cover;
display:block;
}

.fOverlay{
position:absolute; inset:0;
background: linear-gradient(180deg, rgba(2,6,23,.10), rgba(2,6,23,.40) 70%, rgba(2,6,23,.58));
opacity:.92;
}

.fMeta{
position:absolute; left: 14px; right: 14px; bottom: 14px;
display:flex; align-items:flex-end; justify-content:space-between; gap:12px;
}

.fText h3{margin:0;font-size:18px;color:#fff;font-weight:900}

.fText p{margin:6px 0 0;font-size:12px;color:rgba(255,255,255,.82)}

.playBtn{
width:56px;height:56px;border-radius: 18px;
display:grid; place-items:center;
background: linear-gradient(135deg, rgba(46,139,87,.95), rgba(16,185,129,.92));
box-shadow: 0 18px 40px rgba(255,255,255,0.9);
border: 1px solid rgba(255,255,255,.35);
transform: translateZ(34px);
opacity: 0;
transition: .22s ease;
}

.playBtn svg{width:22px;height:22px;fill:#fff;margin-left:2px}

.featureCard:hover .playBtn,
.featureCard:focus-within .playBtn{
opacity: 1;
}

.featureCard:hover{transform: translateY(-2px)}

.lbGrid{
display:grid;
grid-template-columns: 1.2fr .8fr;
gap: 16px;
}

@media (max-width: 940px){.lbGrid{grid-template-columns:1fr}}

.table{
width:100%;
border-collapse: collapse;
overflow:hidden;
overflow-y:hidden;
border-radius: 18px;
}

.table th, .table td{
padding: 12px 12px;
border-bottom: 1px solid rgba(15,23,42,.06);
font-size: 13px;
}

.table th{
text-align:left;
color: var(--muted);
font-weight: 800;
background: rgba(255,255,255,.55);
}

.rankBadge{
display:inline-flex; align-items:center; justify-content:center;
width:30px;height:30px;border-radius: 12px;
background: rgba(46,139,87,.12);
border: 1px solid rgba(46,139,87,.25);
font-weight: 900;
color:#0b2b1e;
}

.lbTools{display:flex; gap:10px; align-items:center; margin: 10px 0 12px;}

.lbSearch{
flex:1;
padding: 10px 12px;
border-radius: 16px;
border: 1px solid rgba(15,23,42,.10);
background: rgba(255,255,255,.72);
outline:none;
}

.chipBtn{
padding: 9px 12px;
border-radius: 999px;
border: 1px solid rgba(15,23,42,.10);
background: rgba(255,255,255,.55);
cursor:pointer;
font-weight: 900;
font-size: 12px;
box-shadow: 0 10px 22px rgba(15,23,42,.08);
}

.chipBtn.active{background: rgba(46,139,87,.18); border-color: rgba(46,139,87,.35);}

.lbPodium{display:grid; grid-template-columns: repeat(3, 1fr); gap:10px; margin: 0 0 12px;}

.podCard{
text-align:left;
padding: 10px 10px;
height: 64px;
min-height: 64px;
display:flex;
align-items:center;
border-radius: 18px;
background: rgba(255,255,255,.62);
border: 1px solid rgba(255,255,255,.60);
box-shadow: 0 14px 32px rgba(15,23,42,.10);
cursor:pointer;
transition: transform .12s ease, box-shadow .12s ease;
}

.podCard:hover{transform: translateY(-2px); box-shadow: 0 18px 40px rgba(15,23,42,.14);}

.podCard.me{border-color: rgba(46,139,87,.55);}

.podTop{display:flex; align-items:center; justify-content:space-between; gap:8px;}

.podMedal{font-size: 18px;}

.podRank{font-weight: 1000; opacity:.78;}

.podName{font-weight: 1000; margin-top: 6px;}

.podId{font-size: 11px; color: var(--muted); margin-top: 2px;}

.podBar{height: 8px; border-radius: 999px; background: rgba(15,23,42,.07); margin-top: 8px; overflow:hidden;
overflow-y:hidden;}

.podBar span{display:block; height:100%; background: rgba(46,139,87,.45); border-radius: 999px;}

.podPts{margin-top: 6px; font-weight: 900; font-size: 12px;}

.lbRow{cursor:pointer;}

.lbRow:hover{background: rgba(46,139,87,.08);}

.lbRow.me{background: rgba(46,139,87,.12);}

.miniBar{height: 6px; border-radius: 999px; background: rgba(15,23,42,.06); margin-top: 6px; overflow:hidden;
overflow-y:hidden;}

.miniBar span{display:block; height:100%; background: rgba(46,139,87,.38); border-radius: 999px;}

.nameLine{font-weight:900}

.small{font-size:12px;color:var(--muted)}

.lbList{
display:flex;
flex-direction:column;
gap:10px;
}

.lbEmpty{
padding: 12px 12px;
border-radius: 16px;
background: rgba(255,255,255,.55);
border: 1px dashed rgba(15,23,42,.14);
text-align:center;
}

.lbItem{
width:100%;
display:grid;
grid-template-columns: 54px 66px 1fr 18px;
gap:10px;
align-items:center;
text-align:left;
padding: 10px 10px;
height: 64px;
min-height: 64px;
display:flex;
align-items:center;
border-radius: 20px;
background: rgba(255,255,255,.66);
border: 1px solid rgba(255,255,255,.70);
box-shadow: 0 16px 38px rgba(2,6,23,.10);
cursor:pointer;
transition: transform .12s ease, box-shadow .12s ease, border-color .12s ease;
}

.lbItem:hover{
transform: translateY(-1px);
box-shadow: 0 22px 50px rgba(2,6,23,.14);
}

.lbItem.me{
border-color: rgba(46,139,87,.55);
box-shadow: 0 20px 52px rgba(46,139,87,.18);
}

.lbRank{display:flex; align-items:center; justify-content:center;}

.lbAvatarWrap{
position:relative;
width:66px; height:66px;
display:flex; align-items:center; justify-content:center;
}

.lbAvatar{
width:56px;height:56px;
border-radius: 18px;
background: rgba(255,255,255,.55);
border: 1px solid rgba(15,23,42,.10);
object-fit:cover;
box-shadow: 0 14px 28px rgba(2,6,23,.10);
}

.lbLvl{
position:absolute;
top:-6px; right:-6px;
width:20px; height:20px;
border-radius: 999px;
display:flex; align-items:center; justify-content:center;
font-size:10px;
font-weight: 1000;
letter-spacing: -.02em;
background: rgba(46,139,87,.92);
color: rgba(255,255,255,.96);
border: 1px solid rgba(255,255,255,.22);
box-shadow: 0 10px 18px rgba(2,6,23,.18);
}

.lbMain{min-width:0;}

.lbNameLine{display:flex; align-items:center; gap:8px; min-width:0;}

.lbNameLine .nameLine{
display:block;
white-space:nowrap; overflow:hidden;
overflow-y:hidden; text-overflow:ellipsis;
}

.meTag{
font-size:10px;
padding: 4px 8px;
border-radius: 999px;
background: rgba(46,139,87,.16);
border: 1px solid rgba(46,139,87,.35);
font-weight: 1000;
flex:0 0 auto;
}

.lbSub{display:flex; gap:8px; align-items:center; margin-top:2px; flex-wrap:wrap;}

.lbSub .dot{opacity:.5}

.lbPts{font-size:12px}

.lbChevron{
opacity:.55;
font-size: 18px;
font-weight: 900;
display:flex; align-items:center; justify-content:center;
}

.lbItemSmall{
grid-template-columns: 54px 66px 1fr 68px;
}

.lbItemSmall .lbRight{justify-self:end; font-size:13px}

.lbPodium{grid-template-columns: 1fr 1.08fr 1fr; gap:12px;}

.podCard{position:relative; overflow:hidden;
overflow-y:hidden;}

.podTop{display:flex; align-items:center; justify-content:space-between; gap:10px;}

.podLeft{display:flex; align-items:center; gap:10px;}

.podAvatar{
width:52px;height:52px;
border-radius: 18px;
background: rgba(255,255,255,.55);
border: 1px solid rgba(15,23,42,.10);
object-fit:cover;
box-shadow: 0 14px 30px rgba(2,6,23,.10);
}

.podCard::after{
content:"";
position:absolute; inset:-40%;
background: radial-gradient(circle at 30% 30%, rgba(46,139,87,.22), transparent 55%),
radial-gradient(circle at 80% 20%, rgba(59,130,246,.18), transparent 60%);
transform: rotate(12deg);
pointer-events:none;
}

@media (max-width: 720px){
.lbItem{grid-template-columns: 48px 60px 1fr 16px; border-radius: 18px;}
.lbAvatarWrap{width:60px;height:60px}
.lbAvatar{width:52px;height:52px;border-radius:16px}
.lbItemSmall{grid-template-columns: 48px 60px 1fr 62px;}
.lbPodium{grid-template-columns: 1fr; }
}

.commentBox{
display:flex; gap:10px; margin-top:10px;
}

.commentBox input{
flex:1;
padding: 12px 14px;
border-radius: 16px;
border: 1px solid rgba(15,23,42,.10);
background: rgba(255,255,255,.72);
outline:none;
}

.commentList{
margin:0; padding:0; list-style:none; display:grid; gap:10px;
}

.commentItem{
padding: 12px 12px;
border-radius: 18px;
background: rgba(255,255,255,.62);
border: 1px solid rgba(255,255,255,.60);
box-shadow: 0 10px 22px rgba(15,23,42,.08);
}

.commentItem .top{
display:flex; justify-content:space-between; gap:12px;
}

.commentText{margin-top:6px;}

.commentActions{
display:flex;
gap:8px;
margin-top:8px;
flex-wrap:wrap;
}

.actBtn{
display:inline-flex;
align-items:center;
gap:6px;
padding: 6px 8px;
border-radius: 999px;
background: rgba(255,255,255,.72);
border: 1px solid rgba(15,23,42,.10);
cursor:pointer;
font-weight:800;
box-shadow: 0 10px 22px rgba(15,23,42,.08);
}

.actBtn:active{transform: translateY(1px)}

.actBtn .ic{font-size:13px; line-height:1}

.actBtn .lbl{font-size:11px; color:var(--muted); font-weight:900}

.actBtn .cnt{
min-width: 24px;
text-align:center;
padding: 4px 6px;
border-radius: 999px;
background: rgba(46,139,87,.12);
border: 1px solid rgba(46,139,87,.22);
color:#0b2b1e;
font-size:11px;
font-weight:900;
}

.actBtn.liked{
background: linear-gradient(135deg, rgba(46,139,87,.20), rgba(16,185,129,.16));
border-color: rgba(46,139,87,.35);
}

.repliesWrap{
margin-top: 10px;
padding-top: 10px;
border-top: 1px dashed rgba(15,23,42,.10);
display:none;
}

.repliesWrap[data-open="1"]{display:block;}

.replyList{
margin:0;
padding:0;
list-style:none;
display:grid;
gap:10px;
}

.replyItem{
padding: 10px 10px;
height: 64px;
min-height: 64px;
display:flex;
align-items:center;
border-radius: 16px;
background: rgba(255,255,255,.62);
border: 1px solid rgba(255,255,255,.60);
box-shadow: 0 10px 22px rgba(15,23,42,.06);
}

.replyText{margin-top:6px; font-size:13px;}

.replyBox{
display:flex;
gap:10px;
margin-top:10px;
}

.replyBox .replyInput{
flex:1;
padding: 12px 14px;
border-radius: 16px;
border: 1px solid rgba(15,23,42,.10);
background: rgba(255,255,255,.72);
outline:none;
}

.replySend{padding: 10px 14px;}

.toast{
position: fixed;
left: 50%;
bottom: 18px;
transform: translateX(-50%);
padding: 10px 14px;
border-radius: 999px;
background: rgba(15,23,42,.86);
color:#fff;
font-size: 13px;
opacity:0;
pointer-events:none;
transition: .2s ease;
z-index:9999;
}

.toast.show{opacity:1; transform: translateX(-50%) translateY(-4px);}

.seasonCanvas{
position: fixed;
inset:0;
pointer-events:none;
z-index: 0;
opacity: .75;
}

.container, .toast{position:relative; z-index:1;}

.hr{height:1px;background:rgba(15,23,42,.08);margin:12px 0}

.row{display:grid; grid-template-columns:1fr 1fr; gap:10px}

@media (max-width:520px){.row{grid-template-columns:1fr}}

.input{
width:100%;
padding: 12px 14px;
border-radius: 16px;
border: 1px solid rgba(15,23,42,.10);
background: rgba(255,255,255,.72);
outline:none;
box-shadow: 0 10px 22px rgba(15,23,42,.08);
}

.p{color:var(--muted); margin:0}

.phone{
width:100%;
max-width:520px;
border-radius:36px;
padding:18px;
background:rgba(255,255,255,.16);
box-shadow:0 30px 90px rgba(15,23,42,.18);
backdrop-filter: blur(14px);
-webkit-backdrop-filter: blur(14px);
border:1px solid rgba(255,255,255,.45);
}

.loginCard{padding:18px;}

.loginHero{
display:flex;
align-items:center;
justify-content:space-between;
gap:12px;
margin-bottom:12px;
}

.loginBadge{
display:inline-flex;
align-items:center;
gap:8px;
padding:10px 12px;
border-radius:16px;
background:rgba(255,255,255,.72);
border:1px solid rgba(15,23,42,.08);
box-shadow:0 10px 24px rgba(15,23,42,.10);
}

.loginBrand{
display:flex;
align-items:center;
gap:10px;
min-width:0;
}

.loginBrand .logo{
width:42px;
height:42px;
border-radius:16px;
display:grid;
place-items:center;
background: radial-gradient(circle at 30% 20%, rgba(46,139,87,.32), rgba(46,139,87,.06));
border:1px solid rgba(46,139,87,.25);
box-shadow:0 12px 26px rgba(46,139,87,.18);
flex:0 0 auto;
font-weight:800;
color: var(--primary);
}

.loginBrandTitle{font-weight:900; letter-spacing:.2px; line-height:1.1;}

.loginBrandSub{font-size:12px; color:var(--muted);}

.orLine{
position:relative;
margin:10px 0;
height:1px;
background:rgba(15,23,42,.08);
}

.orLine span{
position:absolute;
left:50%;
top:50%;
transform:translate(-50%,-50%);
font-size:12px;
color:var(--muted);
background:rgba(255,255,255,.86);
padding:2px 10px;
border-radius:999px;
border:1px solid rgba(15,23,42,.06);
}

@media (min-width:920px){
.phone{max-width:560px; padding:22px;}
.loginCard{padding:22px;}
}

.login .wrap{
max-width: 1100px;
margin: 0 auto;
min-height: 100vh;
display: flex;
align-items: center;
justify-content: center;
padding: clamp(18px, 3vw, 44px);
}

.login .phone{
width: min(980px, 100%);
border-radius: 28px;
position: relative;
}

.login .glass.header{
padding: 14px 16px;
border-radius: 26px !important;
box-shadow: 0 18px 60px rgba(255,255,255,0.9);
border: 1px solid rgba(255,255,255,.55);
background: linear-gradient(180deg, rgba(255,255,255,.88), rgba(255,255,255,.72));
}

.login .brand{gap: 12px}

.logoWrap{
width: 44px;
height: 44px;
border-radius: 16px;
overflow: hidden;
display: grid;
place-items: center;
background: radial-gradient(circle at 30% 30%, rgba(46,139,87,.95), rgba(20,80,48,.95));
box-shadow: 0 10px 24px rgba(46,139,87,.25), inset 0 1px 0 rgba(255,255,255,.35);
}

.logoImg{
width: 100%;
height: 100%;
object-fit: cover;
display: block;
}

.login .pill{
border-radius: 999px;
padding: 8px 12px;
background: rgba(255,255,255,.75);
border: 1px solid rgba(255,255,255,0.9);
box-shadow: 0 10px 26px rgba(255,255,255,0.9);
}

.login .loginCard{
margin-top: 16px;
padding: 18px;
border-radius: 26px;
border: 1px solid rgba(255,255,255,.55);
box-shadow: 0 22px 80px rgba(255,255,255,0.9);
background: linear-gradient(180deg, rgba(255,255,255,.88), rgba(255,255,255,.70));
position: relative;
overflow: hidden;
}

.login .loginHero{
display: grid;
grid-template-columns: 1fr;
gap: 14px;
}

@media (min-width: 860px){
.login .loginHero{
grid-template-columns: 1.15fr .85fr;
gap: 18px;
align-items: center;
}
}

.heroArt{
position: absolute;
right: -40px;
top: -40px;
width: 280px;
height: 280px;
border-radius: 50%;
background: radial-gradient(circle at 30% 30%, rgba(46,139,87,.25), rgba(46,139,87,0) 62%),
radial-gradient(circle at 70% 60%, rgba(0,180,255,.18), rgba(0,180,255,0) 60%),
radial-gradient(circle at 45% 80%, rgba(255,200,0,.14), rgba(255,255,255,0.9) 62%);
filter: blur(0px);
pointer-events: none;
transform: translate3d(0,0,0);
opacity: .95;
}

.heroArt:after{
content:"";
position: absolute;
inset: 26px;
border-radius: 50%;
background: radial-gradient(circle at 35% 35%, rgba(255,255,255,.55), rgba(255,255,255,0) 55%);
border: 1px solid rgba(255,255,255,.45);
box-shadow: inset 0 1px 0 rgba(255,255,255,.55);
transform: rotate(12deg);
}

.login .h1{
font-size: clamp(26px, 2.6vw, 40px);
line-height: 1.08;
letter-spacing: -0.02em;
margin: 0;
}

.login .lead{
margin: 6px 0 0;
color: rgba(12,26,17,.72);
font-size: 14px;
}

.badgesRow{
display: flex;
flex-wrap: wrap;
gap: 8px;
margin-top: 10px;
}

.badgeChip{
display: inline-flex;
align-items: center;
gap: 8px;
padding: 8px 10px;
border-radius: 999px;
background: rgba(255,255,255,.72);
border: 1px solid rgba(255,255,255,0.9);
box-shadow: 0 10px 24px rgba(255,255,255,0.9);
font-size: 12.5px;
color: rgba(12,26,17,.75);
}

.login .btn-primary{
border-radius: 16px;
padding: 14px 14px;
font-weight: 800;
letter-spacing: .01em;
box-shadow: 0 18px 36px rgba(46,139,87,.24);
transform: translateZ(0);
}

.login .btn-primary:hover{transform: translateY(-1px)}

.login .btn-primary:active{transform: translateY(0)}

.login details{
border-radius: 16px;
overflow: hidden;
border: 1px solid rgba(255,255,255,0.9);
background: rgba(255,255,255,.66);
}

.login summary{
list-style: none;
cursor: pointer;
padding: 12px 12px;
display: flex;
align-items: center;
justify-content: space-between;
gap: 10px;
font-weight: 700;
}

.login summary::-webkit-details-marker{display:none}

.login .chev{
width: 28px;
height: 28px;
border-radius: 999px;
display: grid;
place-items: center;
background: rgba(46,139,87,.10);
color: #1d6f43;
border: 1px solid rgba(46,139,87,.20);
}

.login details[open] .chev{transform: rotate(180deg)}

.login .loginDetails{padding: 12px 12px 14px}

.login .row{
display: grid;
grid-template-columns: 1fr;
gap: 10px;
}

@media (min-width: 560px){
.login .row{grid-template-columns: 1fr 1fr;}
}

.login input{
border-radius: 14px;
background: rgba(255,255,255,.86);
border: 1px solid rgba(255,255,255,0.9);
box-shadow: inset 0 1px 0 rgba(255,255,255,.70);
}

.login input:focus{
outline: none;
border-color: rgba(46,139,87,.55);
box-shadow: 0 0 0 4px rgba(46,139,87,.14);
}

.login .btn{
border-radius: 14px;
font-weight: 800;
}

.login .muted{color: rgba(12,26,17,.62)}

.login .loginDetails{margin-top:12px;}

.login .loginDetails > summary::-webkit-details-marker{display:none;}

.login .loginSummary{
list-style:none;
cursor:pointer;
padding:12px 14px;
border-radius:14px;
background: rgba(255,255,255,.75);
border:1px solid rgba(17,54,32,.14);
box-shadow: 0 10px 24px rgba(8,15,12,.08);
display:flex;
align-items:center;
justify-content:space-between;
gap:10px;
font-weight:800;
color:#13211b;
}

.login .loginSummary .chev{display:inline-block; transform: translateY(-1px); transition: transform .2s ease; opacity:.7;}

.login .loginDetails[open] .loginSummary .chev{transform: translateY(-1px) rotate(180deg);}

.loginActions{margin-top:14px; display:flex; flex-direction:column; gap:10px;}

.primaryCta{
display:flex; align-items:center; justify-content:center; gap:10px;
padding:14px 16px; border-radius:16px;
background: linear-gradient(180deg, rgba(46,139,87,1), rgba(27,112,69,1));
color:#fff; font-weight:900; letter-spacing:.2px;
box-shadow: 0 18px 38px rgba(10,20,14,.18), inset 0 1px 0 rgba(255,255,255,.25);
border: 1px solid rgba(255,255,255,.15);
transition: transform .12s ease, filter .12s ease;
}

.primaryCta:hover{transform: translateY(-1px); filter:saturate(1.02)}

.primaryCta:active{transform: translateY(0px) scale(.99)}

.secondaryCta{
display:flex; flex-direction:column; gap:10px;
padding:14px; border-radius:16px;
background: rgba(255,255,255,.72);
border: 1px solid rgba(17,54,32,.14);
box-shadow: 0 14px 32px rgba(8,15,12,.10);
}

.secondaryCta .subtitle{font-weight:900; color:#13211b}

.miniGrid{display:grid; grid-template-columns: 1fr 1fr; gap:10px;}

.miniGrid input{height:46px;}

.miniGrid .btn{height:46px; border-radius:14px; font-weight:900;}

@media (max-width: 420px){
.miniGrid{grid-template-columns:1fr;}
}

.modalBackdrop{
position:fixed; inset:0; display:none; place-items:center;
background: rgba(8,12,10,.42);
backdrop-filter: blur(10px);
z-index: 9999;
}

.modalBackdrop{ position:fixed; inset:0; display:grid; place-items:center; padding:18px; z-index:9999; }

.modalBackdrop[aria-hidden="true"]{ display:none; }

.modalOverlay{ position:absolute; inset:0; background:rgba(7,18,32,.28); backdrop-filter: blur(12px) saturate(140%); }

.modalCard{ position:relative; width:min(560px, 100%); border-radius:22px; background:rgba(255,255,255,.92);
box-shadow: 0 40px 120px rgba(255,255,255,0.9), 0 10px 24px rgba(255,255,255,0.9);
border: 1px solid rgba(255,255,255,.55); overflow:hidden;
overflow-y:hidden; }

.modalTop{ display:flex; align-items:center; justify-content:space-between; padding:14px 16px; border-bottom:1px solid rgba(10,20,30,.08); }

.modalTitle{ font-weight:800; letter-spacing:.2px; }

.iconBtn{ width:38px; height:38px; border-radius:12px; border:1px solid rgba(10,20,30,.10); background:rgba(255,255,255,.75); display:grid; place-items:center; cursor:pointer; }

.iconBtn:hover{ transform: translateY(-1px); box-shadow: 0 10px 22px rgba(255,255,255,0.9); }

.modalBackdrop.show{display:grid;}

.modalCard{
width:min(520px, calc(100vw - 28px));
border-radius: 22px;
background: rgba(255,255,255,.86);
border: 1px solid rgba(255,255,255,.35);
box-shadow: 0 30px 70px rgba(255,255,255,0.9);
overflow:hidden;
overflow-y:hidden;
}

.modalHead{padding:14px 16px; display:flex; align-items:center; justify-content:space-between; gap:12px;
background: linear-gradient(180deg, rgba(46,139,87,.16), rgba(255,255,255,0));
}

.modalTitle{font-weight:1000; letter-spacing:.2px; color:#0e1a12;}

.modalClose{width:38px; height:38px; border-radius:12px; display:grid; place-items:center;
border:1px solid rgba(255,255,255,0.9); background: rgba(255,255,255,.75);
}

.modalBody{padding:14px 16px 16px; display:grid; gap:12px;}

.credRow{display:grid; grid-template-columns: 120px 1fr auto; gap:10px; align-items:center;
padding:12px 12px; border-radius:16px;
background: rgba(255,255,255,.70);
border:1px solid rgba(255,255,255,0.9);
}

.credKey{font-weight:900; color:#13211b; opacity:.86;}

.credVal{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
font-weight:900; color:#0e1a12; word-break:break-all;}

.copyBtn{padding:10px 12px; border-radius:14px; font-weight:900; border:1px solid rgba(255,255,255,0.9);
background: rgba(46,139,87,.10); color:#155c3a;}

.modalFoot{display:flex; gap:10px; justify-content:flex-end; padding:0 16px 16px;}

.ghostBtn{padding:12px 14px; border-radius:14px; font-weight:900; border:1px solid rgba(255,255,255,0.9); background: rgba(255,255,255,.70);}

.goBtn{padding:12px 14px; border-radius:14px; font-weight:1000; color:#fff;
background: linear-gradient(180deg, rgba(46,139,87,1), rgba(27,112,69,1));
border:1px solid rgba(255,255,255,.15);
box-shadow: 0 16px 34px rgba(10,20,14,.18);
}

.tinyNote{font-size:12px; color: rgba(12,26,17,.62); line-height:1.35;}

.panelHead{
display:flex;
align-items:center;
justify-content:space-between;
gap:12px;
margin-bottom:10px;
}

.linkBtn{
appearance:none;
border:1px solid rgba(46,139,87,.28);
background: rgba(46,139,87,.10);
color: rgba(8,20,13,.92);
padding: 8px 12px;
border-radius: 14px;
font-weight: 800;
cursor:pointer;
transition: transform .15s ease, box-shadow .15s ease, background .15s ease;
}

.linkBtn:hover{transform: translateY(-1px); box-shadow: 0 12px 24px rgba(255,255,255,0.9); background: rgba(46,139,87,.14);}

.linkBtn:active{transform: translateY(0px);}

.modalApp{
position: fixed;
inset: 0;
display: none;
align-items: center;
justify-content: center;
padding: 18px;
z-index: 9999;
}

.modalApp .modal{
width: min(860px, calc(100vw - 28px));
max-height: min(82vh, 720px);
overflow: hidden;
border-radius: 26px;
padding: 0;
}

.modalApp .modalHead{
display:flex;
align-items:center;
justify-content:space-between;
gap: 12px;
padding: 14px 16px;
}

.modalApp .modalBody{
padding: 14px 16px 16px;
overflow:auto;
max-height: calc(82vh - 72px);
}

@media (max-width: 520px){
.modalApp .modal{border-radius: 22px;}
.modalApp .modalBody{padding: 12px 12px 14px;}
}

@media (max-width: 520px){
header .header-card{
display:flex;
flex-direction: row !important;
flex-wrap:wrap;
align-items:center;
justify-content:flex-start;
text-align: left !important;
gap:10px;
padding: 12px 12px;
}
header .header-text{display:none !important;}
header .brandBox{
order:1;
width:60px;
height:60px;
border-radius:18px;
padding:8px;
display:flex;
align-items:center;
justify-content:center;
background: rgba(255,255,255,.72);
border:1px solid rgba(20,40,60,.12);
box-shadow: 0 14px 30px rgba(2,6,23,.06);
}
.brandBox::after{
content:"";
position:absolute;
inset:-1px;
border-radius:18px;
pointer-events:none;
background: radial-gradient(60% 60% at 30% 20%, rgba(46,139,87,.22), transparent 65%),
radial-gradient(80% 80% at 80% 90%, rgba(14,165,233,.14), transparent 70%);
opacity:.9;
}
.brandBox{position:relative; overflow:hidden;
overflow-y:hidden;}
header .logo-img{
width:100%;
height:100%;
object-fit:contain;
display:block;
filter: drop-shadow(0 4px 10px rgba(2,6,23,.18));
}
header .header-actions{order:2; margin-left:auto; display:flex; gap:10px;}
header .user-chip{order:3; width:100%; margin-top:2px; padding:10px 10px;}
header .user-chip .name{font-size: 12px; line-height: 1.2;}
header .user-chip .mini{font-size: 11px; opacity:.85;}
header .brandTag{display:none;}
}

.modalBackdrop{background: rgba(6,10,16,.55); backdrop-filter: blur(14px) saturate(140%);}

.modalOverlay{background:
radial-gradient(900px 420px at 50% 0%, rgba(46,139,87,.18), transparent 55%),
radial-gradient(900px 520px at 0% 100%, rgba(120,180,255,.14), transparent 55%),
rgba(6,10,16,.35);
backdrop-filter: blur(16px) saturate(160%);
}

.modalCard{
width: min(420px, calc(100vw - 28px));
border-radius: 26px;
background: linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.82));
border: 1px solid rgba(255,255,255,.52);
box-shadow: 0 50px 140px rgba(255,255,255,0.9), 0 18px 40px rgba(255,255,255,0.9);
}

.modalHead{
padding: 16px 18px;
background:
linear-gradient(180deg, rgba(255,255,255,.95), rgba(255,255,255,.70)),
radial-gradient(700px 220px at 30% -40%, rgba(46,139,87,.22), transparent 60%);
}

.modalTitle{font-weight: 1000; font-size: 18px;}

.modalBody{padding: 14px 18px 18px; gap: 12px;}

.credRow{
grid-template-columns: 90px 1fr 44px;
padding: 10px 10px;
height: 64px;
min-height: 64px;
display:flex;
align-items:center;
border-radius: 18px;
background: rgba(255,255,255,.72);
border: 1px solid rgba(255,255,255,0.9);
box-shadow: 0 10px 24px rgba(255,255,255,0.9);
}

.credVal{
white-space: nowrap;
overflow-x: auto;
scrollbar-width: none;
}

.credVal::-webkit-scrollbar{display:none;}

.credKey{opacity:.78; font-size: 12px; text-transform: uppercase; letter-spacing: .8px;}

.credVal{font-size: 14px;}

.copyBtn{
width: 44px; height: 40px; padding: 0;
display:grid; place-items:center;
border-radius: 14px;
background: rgba(46,139,87,.12);
border: 1px solid rgba(46,139,87,.22);
}

.copyBtn:hover{transform: translateY(-1px); box-shadow: 0 14px 28px rgba(255,255,255,0.9);}

.modalFoot{padding: 0 18px 18px; justify-content: space-between; align-items:center;}

.ghostBtn{opacity:.92;}

.goBtn{padding: 12px 16px; min-width: 150px;}

.tinyNote{margin-top:-2px;}

@media (max-width: 520px){
.modalCard{border-radius: 22px;}
.credRow{grid-template-columns: 78px 1fr 44px;}
.modalFoot{flex-direction: column; align-items: stretch; gap:10px;}
.goBtn{width:100%;}
}

.sideFab{
position: fixed;
right: -18px;
top: 50%;
transform: translateY(-50%);
z-index: 60;
width: 44px;
height: 44px;
border-radius: 14px 0 0 14px;
border: 1px solid rgba(255,255,255,.18);
background: rgba(20,24,28,.35);
backdrop-filter: blur(14px);
-webkit-backdrop-filter: blur(14px);
box-shadow: 0 14px 40px rgba(255,255,255,0.9);
display: grid;
place-items: center;
cursor: pointer;
}

.sideFab:hover{ transform: translateY(-50%) scale(1.03); }

.sideFab:active{ transform: translateY(-50%) scale(.98); }

.sideFabIcon{ font-size: 18px; line-height: 1; opacity: .95; }

.sideOverlay{
position: fixed;
inset: 0;
z-index: 80;
background: rgba(255,255,255,0.9);
opacity: 0;
pointer-events: none;
transition: opacity .18s ease;
}

.sideOverlay.open{
opacity: 1;
pointer-events: auto;
}

.sidePanel{
position: absolute;
top: 0;
right: 0;
height: 100%;
width: min(420px, 92vw);
border-radius: 22px 0 0 22px;
transform: translateX(103%);
transition: transform .22s ease;
padding: 14px;
display: flex;
flex-direction: column;
overflow: hidden;
}

.sideOverlay.open .sidePanel{ transform: translateX(0); }

.sideHead{
display:flex;
align-items:flex-start;
justify-content:space-between;
gap: 10px;
padding: 6px 4px 10px 4px;
}

.sideTitle{ font-weight: 800; letter-spacing: .2px; }

.iconBtn{
width: 38px;
height: 38px;
border-radius: 12px;
border: 1px solid rgba(255,255,255,.14);
background: rgba(255,255,255,.06);
cursor: pointer;
}

.iconBtn:hover{ background: rgba(255,255,255,.10); }

.sideTabs{
display:flex;
gap: 10px;
padding: 8px 4px 10px 4px;
}

.tabBtn{
flex:1;
padding: 10px 12px;
border-radius: 14px;
border: 1px solid rgba(255,255,255,.12);
background: rgba(255,255,255,.05);
cursor: pointer;
font-weight: 700;
opacity: .9;
}

.tabBtn.active{
background: rgba(46,139,87,.22);
border-color: rgba(46,139,87,.45);
opacity: 1;
}

.sideBody{
flex:1;
overflow: auto;
padding: 4px;
}

.sidePane{ display:none; }

.sidePane.active{ display:block; }

.noScroll{ overflow: hidden; }

.topbarRight{ display:flex; align-items:center; gap:10px; }

.bellBtn{ position:relative; width:44px; height:44px; border-radius:14px; }

.bellBtn.hasUnread{ animation: bellPulse 1.35s ease-in-out infinite; }

.bellBtn.hasUnread .badge{ animation: badgePop 0.9s ease-in-out infinite; }

@keyframes bellPulse{
0%,100%{ transform: translateZ(0) scale(1); }
50%{ transform: translateZ(0) scale(1.06); }
}

@keyframes badgePop{
0%,100%{ transform: translateZ(0) scale(1); }
50%{ transform: translateZ(0) scale(1.12); }
}

.badge{
position:absolute;
top:-6px;
right:-6px;
min-width: 20px;
height: 20px;
padding: 0 6px;
border-radius: 999px;
display:inline-flex;
align-items:center;
justify-content:center;
font-size: 12px;
font-weight: 800;
border: 1px solid rgba(255,255,255,.22);
background: rgba(255,40,120,.35);
backdrop-filter: blur(10px);
}

@media (max-width: 520px){
.topbar{
display: grid;
grid-template-columns: 1fr auto;
grid-template-rows: auto auto;
align-items: center;
padding: 12px 12px;
gap: 8px 10px;
}
.topbarRight{ display: contents; }
.brand{ grid-column: 1 / 2; grid-row: 1; min-width: 0; }
.brand .logo{ width:50px; height:50px; border-radius:12px; }
.brand .title{ font-size: 14px; }
.brand .subtitle{ font-size: 11px; }
#btnBell{ grid-column: 2 / 3; grid-row: 1; justify-self: end; width:40px; height:40px; border-radius:12px; }
.profileMini{ grid-column: 1 / 2; grid-row: 2; min-width: 0; justify-content: flex-start; }
.profileMini .line2{ flex-wrap: nowrap; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; gap: 8px; }
#btnLogout{ grid-column: 2 / 3; grid-row: 2; justify-self: end; padding: 9px 12px; font-size: 13px; }
}

.notifList{ list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:10px; }

.notifItem{
padding: 12px;
border-radius: 16px;
border: 1px solid rgba(255,255,255,.12);
background: rgba(255,255,255,.05);
}

.notifItem.unread{ border-color: rgba(46,139,87,.45); background: rgba(46,139,87,.12); }

.notifBody{ margin-top: 6px; line-height: 1.5; }

.notifActions{ margin-top: 10px; display:flex; justify-content:flex-end; }

.notifActions{ gap:8px; }

.ownerActions{ display:flex; gap:8px; justify-content:flex-end; margin-top: 8px; }

.miniBtn{
padding: 6px 10px;
border-radius: 999px;
border: 1px solid rgba(255,255,255,.14);
background: rgba(255,255,255,.06);
cursor:pointer;
font-weight:800;
font-size: 12px;
}

.miniBtn:hover{ background: rgba(255,255,255,.10); }

.miniBtn.danger{ border-color: rgba(255,90,90,.35); background: rgba(255,90,90,.12); }

.miniBtn.ghost{ padding: 6px 10px; min-width: 38px; justify-content:center; opacity:.9; }

.miniBtn.ghost:hover{ opacity:1; }

.editedTag{ opacity:.75; margin-top: 6px; }

.commentActions.compact .actBtn{ padding: 8px 10px; border-radius: 14px; }

.commentActions.compact .actBtn .lbl{ font-size: 12px; }

.commentActions.compact .actBtn .ic{ font-size: 13px; }

.editArea{
width:100%;
min-height: 84px;
resize: vertical;
padding: 10px 12px;
border-radius: 16px;
border: 1px solid rgba(255,255,255,.14);
background: rgba(2,6,23,.25);
color: inherit;
outline:none;
}

.editBar{ display:flex; justify-content:flex-end; gap:10px; margin-top:10px; }

.btnSm{ padding: 10px 12px; border-radius: 14px; font-size: 13px; }

@media (max-width: 520px){
#userName{font-size:12px; font-weight:700; letter-spacing:.2px;}
#userId{font-size:11px; opacity:.8;}
}

body{position:relative;}

.container, .wrap{
position: relative;
z-index: 10;
width: 100%;
max-width: 1200px;
margin: 0 auto;
padding: 20px;
}

.glass{
background: linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.70));
border: 1px solid rgba(15,23,42,.10);
box-shadow: 0 18px 55px rgba(15,23,42,.12);
border-radius: var(--radius);
backdrop-filter: blur(18px) saturate(140%);
}

.btn, button.btn{
border: 1px solid rgba(15,23,42,.10);
background: rgba(255,255,255,.78);
color: #0f172a;
border-radius: 999px;
padding: 12px 16px;
font-weight: 700;
cursor: pointer;
transition: var(--transition);
}

.btn:hover{transform: translateY(-2px); box-shadow: 0 10px 20px rgba(14,165,233,.25);}

.btn.ghost, .btn.secondary{
background: rgba(255,255,255,.68);
}

.iconBtn{
border: 1px solid rgba(15,23,42,.10);
background: rgba(255,255,255,.74);
color: #0f172a;
border-radius: 999px;
padding: 10px 12px;
cursor: pointer;
}

.input, input, select, textarea{
background: rgba(255,255,255,.78);
border: 1px solid rgba(15,23,42,.10);
color: #0f172a;
border-radius: 16px;
}

body[data-page="login"] main{ align-items: center; }

body[data-page="login"] main > section{ width: 100%; max-width: 920px; }

body[data-page="login"] .card{ cursor: default; }

body[data-page="login"] .card,
body[data-page="login"] .footer-card,
body[data-page="login"] .header-card{
background: linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.74));
border: 1px solid rgba(15,23,42,.10);
box-shadow: 0 18px 55px rgba(15,23,42,.12);
backdrop-filter: blur(18px) saturate(140%);
-webkit-backdrop-filter: blur(18px) saturate(140%);
}

body[data-page="login"] .card::before{ opacity: .25; }

body[data-page="login"] .card-title,
body[data-page="login"] .card-desc,
body[data-page="login"] .card-label,
body[data-page="login"] .small-note,
body[data-page="login"] .header-sub{ color: rgba(15,23,42,.72) !important; }

body[data-page="login"] .card-title{ color: rgba(15,23,42,.92) !important; }

body[data-page="login"] .input{
background: rgba(255,255,255,.86);
border: 1px solid rgba(15,23,42,.12);
color: #0f172a;
caret-color: #0f172a;
}

body[data-page="login"] .input::placeholder{ color: rgba(15,23,42,.45) !important; }

body[data-page="login"] .auth-actions .btn{ background: rgba(255,255,255,.82); }

.table{
width: 100%;
border-collapse: collapse;
background: rgba(255,255,255,.72);
border: 1px solid rgba(15,23,42,.10);
border-radius: 16px;
overflow: hidden;
}

.table th, .table td{
padding: 10px 12px;
border-bottom: 1px solid rgba(15,23,42,.08);
}

.table th{color: rgba(15,23,42,.62); font-weight: 800;}

.touchFab{
position: fixed;
right: 18px;
bottom: 18px;
z-index: 10050;
display: grid;
gap: 10px;
justify-items: end;
user-select: none;
}

.touchMain{
width: 60px;
height: 60px;
border-radius: 999px;
border: 1px solid rgba(15,23,42,.10);
background: rgba(255,255,255,.82);
color: #0f172a;
font-size: 22px;
font-weight: 900;
box-shadow:
0 18px 45px rgba(15,23,42,.22),
inset 0 1px 0 rgba(255,255,255,.55);
cursor: pointer;
touch-action: none;
backdrop-filter: blur(18px) saturate(160%);
-webkit-backdrop-filter: blur(18px) saturate(160%);
transition: transform .18s ease, box-shadow .18s ease, background .18s ease;
}

.touchMain:active{ transform: translateY(1px) scale(.98); }

.touchFab.open .touchMain{
background: rgba(255,255,255,.92);
box-shadow:
0 22px 60px rgba(15,23,42,.26),
inset 0 1px 0 rgba(255,255,255,.65);
}

.touchMenu{
display: grid;
gap: 10px;
opacity: 0;
transform: translateY(8px);
pointer-events: none;
transition: .18s ease;
}

.touchFab.open .touchMenu{
opacity: 1;
transform: translateY(0);
pointer-events: auto;
}

.touchAction{
display: flex;
align-items: center;
gap: 10px;
border-radius: 999px;
padding: 10px 12px 10px 10px;
min-width: 170px;
border: 1px solid rgba(15,23,42,.10);
background: rgba(255,255,255,.86);
color: #0f172a;
box-shadow:
0 14px 32px rgba(15,23,42,.20),
inset 0 1px 0 rgba(255,255,255,.55);
backdrop-filter: blur(16px) saturate(160%);
-webkit-backdrop-filter: blur(16px) saturate(160%);
cursor: pointer;
font-weight: 800;
transition: transform .16s ease, background .16s ease;
}

.touchAction:hover{ transform: translateY(-1px); background: rgba(255,255,255,.95); }

.touchAction:active{ transform: translateY(1px) scale(.99); }

.touchAction .emo{
width: 36px;
height: 36px;
display: grid;
place-items: center;
border-radius: 999px;
background: rgba(46,139,87,.10);
border: 1px solid rgba(46,139,87,.18);
font-size: 18px;
}

.touchBadge{
margin-left: auto;
min-width: 22px;
height: 22px;
padding: 0 7px;
border-radius: 999px;
display: inline-flex;
align-items: center;
justify-content: center;
font-size: 12px;
font-weight: 900;
background: rgba(232,77,110,.12);
color: #b4233d;
border: 1px solid rgba(232,77,110,.30);
}

@media (max-width: 520px){
.touchFab{ right: 14px; bottom: 14px; }
.touchAction{ min-width: 160px; }
}

body[data-page="app"] .scroll-to-top{ right: 96px; }

@media (max-width: 520px){ body[data-page="app"] .scroll-to-top{ right: 86px; } }

body.noScroll{ overflow: hidden; }

.modalOverlay.modalApp{
position: fixed;
inset: 0;
z-index: 9996;
display: none;
align-items: center;
justify-content: center;
padding: 18px;
background:
radial-gradient(900px 520px at 30% 0%, rgba(46,139,87,.18), transparent 55%),
radial-gradient(900px 520px at 100% 100%, rgba(120,180,255,.16), transparent 55%),
rgba(255,255,255,.35);
backdrop-filter: blur(12px) saturate(140%);
-webkit-backdrop-filter: blur(12px) saturate(140%);
}

.modalOverlay.modalApp.open{ display: flex; }

.modalOverlay.modalApp[aria-hidden="false"]{ display:flex; }

.modalOverlay.modalApp[aria-hidden="false"] .modal{
transform: translateY(0) scale(1);
opacity: 1;
}

.modalOverlay.modalApp .modal{
width: min(560px, calc(100vw - 28px));
max-height: min(82vh, 760px);
overflow: hidden;
border-radius: 28px;
border: 1px solid rgba(15,23,42,.10);
background: linear-gradient(180deg, rgba(255,255,255,.94), rgba(255,255,255,.76));
box-shadow: 0 30px 80px rgba(15,23,42,.28);
backdrop-filter: blur(18px) saturate(160%);
-webkit-backdrop-filter: blur(18px) saturate(160%);
transform: translateY(14px) scale(.98);
opacity: 0;
transition: .18s ease;
}

.modalOverlay.modalApp.open .modal{ transform: translateY(0) scale(1); opacity: 1; }

.modalHead{
display:flex;
align-items:center;
justify-content:space-between;
gap: 12px;
padding: 16px 16px 12px;
background: linear-gradient(180deg, rgba(46,139,87,.14), rgba(255,255,255,0));
}

.modalTitle{ font-weight: 1000; font-size: 18px; letter-spacing: .2px; }

.modalBody{
padding: 14px 16px 16px;
overflow: auto;
max-height: calc(min(82vh, 760px) - 64px);
}

.hr{ height:1px; background: rgba(15,23,42,.08); }

@media (max-width: 560px){
.modalOverlay.modalApp{ align-items: flex-end; padding: 12px; }
.modalOverlay.modalApp .modal{
width: 100%;
max-height: 86vh;
border-radius: 26px 26px 18px 18px;
}
.modalHead{
padding-top: 18px;
position: relative;
}
.modalHead::before{
content:"";
position:absolute;
left:50%; top:8px;
transform: translateX(-50%);
width: 48px; height: 5px;
border-radius: 999px;
background: rgba(255,255,255,.22);
}
}

body[data-page="app"] .cards{
display: grid;
grid-template-columns: repeat(2, minmax(0, 1fr));
gap: 14px;
}

@media (max-width: 940px){
body[data-page="app"] .cards{ grid-template-columns: 1fr; }
}

body[data-page="app"] .featureCard{
border-radius: 28px;
border: 1px solid rgba(15,23,42,.10);
background: rgba(255,255,255,.74);
box-shadow: 0 28px 70px rgba(15,23,42,.18);
}

body[data-page="app"] .poster{ aspect-ratio: 16/9; background: rgba(2,132,199,.18); }

body[data-page="app"] .fOverlay{
background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.55) 70%, rgba(255,255,255,.78));
}

body[data-page="app"] .fMeta{ left: 16px; right: 16px; bottom: 16px; }

body[data-page="app"] .fText h3{ font-size: 19px; }

body[data-page="app"] .fText p{ font-size: 12.5px; line-height: 1.25; }

body[data-page="app"] .playBtn{
width: 54px; height: 54px; border-radius: 18px;
background: linear-gradient(135deg, rgba(14,165,233,.95), rgba(56,189,248,.78));
border: 1px solid rgba(255,255,255,.26);
}

.commentBox{
display:flex;
gap: 10px;
align-items: center;
}

.commentBox input{
flex:1;
padding: 12px 14px;
border-radius: 16px;
}

.commentList{
list-style: none;
padding: 0;
margin: 0;
display: grid;
gap: 10px;
}

.commentItem{
border-radius: 20px;
border: 1px solid rgba(255,255,255,.14);
background: rgba(255,255,255,.06);
padding: 12px;
box-shadow: 0 18px 40px rgba(255,255,255,0.9);
}

.cHead{ display:flex; align-items:center; justify-content:space-between; gap: 10px; }

.cUser{ display:flex; align-items:center; gap: 10px; min-width: 0; }

.cAva{
width: 38px; height: 38px; border-radius: 999px;
border: 2px solid rgba(56,189,248,.35);
background: rgba(255,255,255,.20);
object-fit: cover;
}

.cName{ font-weight: 1000; font-size: 13px; white-space: nowrap; overflow:hidden;
overflow-y:hidden; text-overflow: ellipsis; }

.cMeta{ font-size: 11px; color: rgba(255,255,255,.62); }

.cText{ margin: 8px 0 0; line-height: 1.35; color: rgba(255,255,255,.92); }

.cActions{ display:flex; align-items:center; gap: 8px; flex-wrap: wrap; margin-top: 10px; }

.cBtn{
display:inline-flex;
align-items:center;
gap: 8px;
border-radius: 999px;
padding: 8px 10px;
border: 1px solid rgba(255,255,255,.14);
background: rgba(255,255,255,.08);
color: rgba(255,255,255,.9);
font-weight: 900;
cursor: pointer;
}

.cBtn:hover{ background: rgba(255,255,255,.12); }

.cBtn.liked{ border-color: rgba(239,68,68,.45); box-shadow: 0 10px 26px rgba(239,68,68,.18); }

.repliesWrap{ margin-top: 10px; display:none; }

.replyList{ list-style:none; padding:0; margin: 0 0 10px 0; display:grid; gap: 8px; }

.replyItem{
border-radius: 16px;
border: 1px solid rgba(255,255,255,.12);
background: rgba(255,255,255,.18);
padding: 10px;
}

.replyBox{ display:flex; gap: 10px; }

.replyInput{ flex:1; padding: 10px 12px; border-radius: 14px; }

body[data-page="app"]{ padding-bottom: 18px; }

.commentsDock{
position: fixed;
right: 14px;
bottom: calc(14px + env(safe-area-inset-bottom));
z-index: 9995;
display: block;
padding: 0;
background: transparent;
border: 0;
}

.commentsDock .dockBtn{
width: 56px;
height: 56px;
border-radius: 999px;
display: inline-flex;
align-items: center;
justify-content: center;
position: relative;
border: 1px solid rgba(15,23,42,.14);
background: rgba(255,255,255,.88);
box-shadow: 0 14px 34px rgba(15,23,42,.18), inset 0 1px 0 rgba(255,255,255,.7);
backdrop-filter: blur(14px) saturate(160%);
-webkit-backdrop-filter: blur(14px) saturate(160%);
font-size: 20px;
font-weight: 950;
cursor: pointer;
}

.commentsDock .dockBtn:active{ transform: translateY(1px) scale(.99); }

.commentsDock .dockBadge{
position: absolute;
top: -6px;
right: -6px;
min-width: 22px;
height: 22px;
border-radius: 999px;
display: inline-flex;
align-items: center;
justify-content: center;
font-size: 12px;
font-weight: 950;
padding: 0 8px;
background: rgba(239,68,68,.92);
color: rgba(15,23,42,.85);
border: 2px solid rgba(255,255,255,.92);
}

/* ====== Modern Comments Dock (Pill) ====== */
.commentsDock{ right: 16px; bottom: calc(16px + env(safe-area-inset-bottom)); }
.commentsDock .dockPill{
  height: 54px;
  padding: 0 14px 0 12px;
  border-radius: 999px;
  display: inline-flex;
  align-items: center;
  gap: 10px;
  position: relative;
  border: 1px solid rgba(46,139,87,.20);
  background: rgba(255,255,255,.82);
  box-shadow: 0 18px 44px rgba(12,38,28,.18), inset 0 1px 0 rgba(255,255,255,.75);
  backdrop-filter: blur(16px) saturate(170%);
  -webkit-backdrop-filter: blur(16px) saturate(170%);
  cursor: pointer;
  user-select: none;
  transform: translateZ(0);
}
.commentsDock .dockPill .dockGlow{
  position:absolute; inset:-2px;
  border-radius: inherit;
  background: radial-gradient(120px 80px at 20% 30%, rgba(46,139,87,.22), transparent 60%),
              radial-gradient(120px 80px at 80% 70%, rgba(14,165,233,.18), transparent 60%);
  filter: blur(10px);
  opacity: .8;
  pointer-events:none;
}
.commentsDock .dockPill .dockIcon{
  width: 36px; height: 36px;
  border-radius: 12px;
  display:grid; place-items:center;
  background: linear-gradient(135deg, rgba(46,139,87,.20), rgba(14,165,233,.16));
  border: 1px solid rgba(15,23,42,.10);
  box-shadow: 0 10px 22px rgba(15,23,42,.12), inset 0 1px 0 rgba(255,255,255,.70);
  font-size: 18px;
}
.commentsDock .dockPill .dockText{
  font-weight: 900;
  letter-spacing: .2px;
  font-size: 14px;
  color: rgba(15,23,42,.92);
}
.commentsDock .dockPill:active{ transform: translateY(1px) scale(.99); }
.commentsDock .dockPill:hover{ box-shadow: 0 22px 60px rgba(12,38,28,.20), inset 0 1px 0 rgba(255,255,255,.78); }
.commentsDock .dockBadge{
  position: absolute;
  top: -6px; right: -6px;
  min-width: 20px;
  height: 20px;
  padding: 0 6px;
  border-radius: 999px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-weight: 900;
  font-size: 11px;
  color: #fff;
  background: linear-gradient(135deg, #2E8B57, #0ea5e9);
  border: 2px solid rgba(255,255,255,.92);
  box-shadow: 0 10px 22px rgba(15,23,42,.18);
}

/* ====== Modern Comment Composer ====== */
#commentModal .commentComposer{
  display:flex;
  gap: 10px;
  align-items: center;
  padding: 10px;
  border-radius: 18px;
  background: linear-gradient(180deg, rgba(255,255,255,.88), rgba(255,255,255,.72));
  border: 1px solid rgba(46,139,87,.18);
  box-shadow: 0 16px 36px rgba(12,38,28,.10);
  backdrop-filter: blur(12px) saturate(160%);
  -webkit-backdrop-filter: blur(12px) saturate(160%);
}
#commentModal .composerField{
  flex: 1 1 auto;
  height: 48px;
  border-radius: 999px;
  display:flex;
  align-items:center;
  gap: 10px;
  padding: 0 14px 0 12px;
  border: 1px solid rgba(46,139,87,.16);
  background: rgba(255,255,255,.92);
  box-shadow: inset 0 1px 0 rgba(255,255,255,.70);
}
#commentModal .composerIcon{
  width: 34px; height: 34px;
  border-radius: 12px;
  display:grid; place-items:center;
  background: rgba(46,139,87,.10);
  border: 1px solid rgba(46,139,87,.14);
  font-size: 16px;
}
#commentModal #commentInput{
  flex: 1 1 auto;
  height: 100%;
  border: 0 !important;
  outline: none !important;
  background: transparent !important;
  padding: 0 !important;
  font-weight: 800;
  font-size: 14px;
  color: rgba(15,23,42,.92);
}
#commentModal .composerSend{
  height: 48px;
  min-width: 52px;
  padding: 0 16px;
  border-radius: 999px;
  display:inline-flex;
  align-items:center;
  gap: 10px;
  border: 1px solid rgba(46,139,87,.22);
  background: linear-gradient(135deg, rgba(46,139,87,1), rgba(14,165,233,1));
  color: #fff;
  font-weight: 950;
  letter-spacing: .2px;
  box-shadow: 0 18px 42px rgba(12,38,28,.20);
  cursor: pointer;
}
#commentModal .composerSend .sendIcon{
  width: 30px; height: 30px;
  border-radius: 12px;
  display:grid; place-items:center;
  background: rgba(255,255,255,.18);
  border: 1px solid rgba(255,255,255,.22);
}
#commentModal .composerSend:active{ transform: translateY(1px) scale(.99); }
#commentModal .composerSend:hover{ filter: brightness(1.02); }

@media (max-width: 420px){
  .commentsDock .dockText{ display:none; }
  .commentsDock .dockPill{ padding: 0 12px; }
  #commentModal .composerSend .sendText{ display:none; }
  #commentModal .composerSend{ padding:0 12px; }
}.videoHero{
position: relative;
width: 100%;
aspect-ratio: 16 / 9;
border-radius: 18px;
overflow: hidden;
background: rgba(255,255,255,.18);
border: 1px solid rgba(255,255,255,.12);
}

.heroVideo{
width: 100%;
height: 100%;
display: block;
object-fit: cover;
}

.videoControls{
position: absolute;
right: 10px;
bottom: 10px;
display: flex;
gap: 8px;
z-index: 3;
}

.videoControls .vBtn{
border: none;
border-radius: 12px;
padding: 8px 10px;
background: rgba(255,255,255,.55);
color: rgba(15,23,42,.85);
cursor: pointer;
backdrop-filter: blur(10px);
-webkit-backdrop-filter: blur(10px);
}

.videoControls .vBtn:hover{ background: rgba(255,255,255,.78); }

#commentModal.modalApp{
align-items: flex-end;
justify-content: center;
padding: 12px 12px calc(12px + env(safe-area-inset-bottom));
}

#commentModal.modalApp .modal{
width: min(760px, calc(100vw - 24px));
max-height: 78vh;
border-radius: 22px 22px 0 0;
}

.storeBar{
display:flex;
flex-wrap:wrap;
gap:10px;
align-items:center;
justify-content:flex-end;
}

@media (max-width:720px){
.storeBar{justify-content:flex-start;}
}

.storeBtn{
display:inline-flex;
align-items:center;
gap:8px;
padding:8px 10px;
border-radius:14px;
border:1px solid rgba(20,40,60,.12);
background: rgba(255,255,255,.65);
text-decoration:none;
color: inherit;
font-weight:800;
font-size:12px;
white-space:nowrap;
}

.storeBtn .sub{font-weight:700; opacity:.72; font-size:11px;}

.storeBtn.install{
border-color: rgba(46,139,87,.26);
background: rgba(46,139,87,.12);
}

.storeBtn.installed{
border-color: rgba(148,163,184,.30);
background: rgba(148,163,184,.18);
pointer-events:none;
opacity:.85;
}

.pwaSheet{
position:fixed;
inset:0;
display:none;
align-items:flex-end;
justify-content:center;
z-index: 9999;
}

.pwaSheet.open{display:flex;}

.pwaSheet .backdrop{
position:absolute; inset:0;
background: rgba(2,6,23,.55);
backdrop-filter: blur(10px);
}

.pwaSheet .card{
position:relative;
width:min(560px, 100%);
margin: 0 10px 12px;
border-radius: 20px;
border:1px solid rgba(20,40,60,.14);
background: rgba(255,255,255,.82);
box-shadow: 0 20px 60px rgba(2,6,23,.28);
padding: 14px 14px 12px;
}

.pwaSheet .hd{
display:flex; align-items:flex-start; justify-content:space-between; gap:12px;
}

.pwaSheet .ttl{font-weight:950; font-size:14px;}

.pwaSheet .txt{font-size:12px; opacity:.8; margin-top:4px; line-height:1.45;}

.pwaSheet .x{
border:none; background:transparent; cursor:pointer;
width:40px;height:40px;border-radius:999px;
display:flex;align-items:center;justify-content:center;
border:1px solid rgba(20,40,60,.12);
}

.pwaSteps{margin-top:10px; display:flex; flex-direction:column; gap:8px;}

.pwaStep{
display:flex; gap:10px; align-items:flex-start;
padding:10px 10px; border-radius:16px;
background: rgba(15,23,42,.06);
border:1px solid rgba(20,40,60,.10);
}

.pwaStep .n{
width:22px;height:22px;border-radius:999px;
display:flex;align-items:center;justify-content:center;
background: rgba(255,255,255,.9);
border:1px solid rgba(20,40,60,.12);
font-weight:900; font-size:12px;
flex:0 0 auto;
}

.pwaUpdateToast{
position:fixed;
left:14px;
right:14px;
bottom:14px;
z-index:99999;
display:flex;
justify-content:center;
pointer-events:none;
}

.pwaUpdateToast .tCard{
pointer-events:auto;
width:min(560px, 96vw);
border-radius:18px;
border:1px solid rgba(255,255,255,.16);
background: rgba(10,14,22,.78);
backdrop-filter: blur(14px);
box-shadow: 0 18px 60px rgba(255,255,255,0.9);
padding:14px 14px 12px;
color: rgba(255,255,255,.92);
}

.pwaUpdateToast .tTitle{
font-weight:800;
letter-spacing:.2px;
margin-bottom:4px;
}

.pwaUpdateToast .tText{
font-size:13px;
opacity:.82;
line-height:1.35;
}

.pwaUpdateToast .tBtns{
display:flex;
gap:10px;
justify-content:flex-end;
margin-top:10px;
flex-wrap:wrap;
}

.pwaUpdateToast .tBtn{
border-radius:14px;
border:1px solid rgba(255,255,255,.18);
background: rgba(255,255,255,.08);
color: rgba(255,255,255,.92);
padding:8px 12px;
font-weight:700;
cursor:pointer;
}

.pwaUpdateToast .tBtn.primary{
background: rgba(46,139,87,.26);
border-color: rgba(46,139,87,.48);
}

#challengeSection .challengeList{display:flex;flex-direction:column;gap:10px}

.challengeCard{
display:flex; align-items:center; gap:14px;
padding:14px; border-radius:18px;
background: rgba(255,255,255,.65);
border: 1px solid rgba(20,40,60,.10);
}

.challengeCard .left{display:flex;align-items:center;gap:10px;flex:1;min-width:0}

.challengeLogo{
width:54px;height:54px;border-radius:16px; flex:0 0 auto;
background: radial-gradient(circle at 30% 30%, rgba(46,139,87,.28), transparent 60%),
linear-gradient(135deg, rgba(46,139,87,.25), rgba(59,130,246,.16));
border:1px solid rgba(46,139,87,.22);
display:flex;align-items:center;justify-content:center;
font-size:22px;
}

.challengeLogoImg{width:30px;height:30px;object-fit:contain;filter: drop-shadow(0 6px 10px rgba(2,6,23,.18));}

.challengeMeta{min-width:0}

.challengeMeta .kicker{font-size:9px;letter-spacing:.12em;opacity:.7}

.challengeMeta .ttl{font-weight:800;font-size:14px;white-space:nowrap;overflow:hidden;
overflow-y:hidden;text-overflow:ellipsis}

.badges{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}

.badgePill{
font-size:9px; padding:4px 8px; border-radius:999px;
background: rgba(15,23,42,.06);
border:1px solid rgba(20,40,60,.10);
}

.badgeLive{background: rgba(46,139,87,.12); border-color: rgba(46,139,87,.24)}

.badgeUp{background: rgba(245,158,11,.14); border-color: rgba(245,158,11,.26)}

.badgeEnd{background: rgba(148,163,184,.22); border-color: rgba(148,163,184,.28)}

.challengeRight{display:flex;align-items:center;gap:10px;flex:0 0 auto}

.challengeBtn{
border:none; cursor:pointer;
padding:10px 14px; border-radius:999px;
background: rgba(255,255,255,.85);
border:1px solid rgba(20,40,60,.12);
font-weight:800;
}

.challengeBtn:disabled{opacity:.6;cursor:not-allowed}

@media (max-width: 720px){
.challengeList{gap:12px}
.challengeCard{flex-direction:column;align-items:stretch;gap:10px;padding:12px}
.challengeIcon{width:48px;height:48px}
.challengeLeft{gap:10px;align-items:flex-start}
.challengeMeta .ttl{font-size:15px;line-height:1.2;white-space:normal}
.challengeMeta .sub{font-size:12px}
.challengeBadges{flex-wrap:wrap}
.challengeRight{width:100%;justify-content:space-between;gap:10px}
.timerLine{font-size:12px;opacity:.92}
.challengeBtn{width:100%;padding:12px 14px;border-radius:14px}
}

.timerLine{font-size:12px;opacity:.75;white-space:nowrap}

#contentSection .contentBox{display:flex;flex-direction:column;gap:10px}

.bigRow,.tagRow{
display:flex; gap:10px; overflow-x:auto; overflow-y:hidden;
-webkit-overflow-scrolling: touch;
scrollbar-width:none;
}

.bigRow::-webkit-scrollbar,.tagRow::-webkit-scrollbar{display:none}

.bigChip{
flex:0 0 auto;
min-width:176px;
display:flex; align-items:center; gap:10px;
padding:10px 12px;
border-radius:16px;
background: rgba(255,255,255,.72);
border:1px solid rgba(20,40,60,.12);
cursor:pointer;
box-shadow: 0 14px 30px rgba(2,6,23,.06);
}

.bigChip.active{
background: linear-gradient(135deg, rgba(46,139,87,.85), rgba(59,183,143,.85));
color: rgba(15,23,42,.85);
border-color: rgba(46,139,87,.30);
}

.bigChip .ico{
width:40px;height:40px;border-radius:14px;
display:flex;align-items:center;justify-content:center;
background: rgba(15,23,42,.06);
border:1px solid rgba(20,40,60,.10);
}

.bigChip .ico img{width:26px;height:26px;object-fit:contain}

.bigChip .ico .emoji{font-size:16px;line-height:1}

.bigChip .tWrap{display:flex;flex-direction:column;gap:2px}

.bigChip .tWrap b{font-size:12.5px}

.bigChip .tWrap small{font-size:10px;opacity:.72}

.bigChip .count{
margin-left:auto;
width:22px;height:22px;border-radius:999px;
display:flex;align-items:center;justify-content:center;
background: rgba(15,23,42,.08);
}

.bigChip.active .count{background: rgba(255,255,255,.22)}

.tagChip{
flex:0 0 auto;
display:inline-flex; align-items:center; gap:8px;
padding:4px 7px;
border-radius:999px;
background: rgba(255,255,255,.65);
border:1px solid rgba(20,40,60,.12);
cursor:pointer;
font-size:9px;
}

.tagChip.active{background: rgba(46,139,87,.12); border-color: rgba(46,139,87,.25)}

.tagChip .tCount{
width:16px;height:16px;border-radius:999px;
display:flex;align-items:center;justify-content:center;
border:1px solid rgba(20,40,60,.12);
background: rgba(255,255,255,.8);
font-size:9px;
}

header .header-card{
border-radius: 26px !important;
border: 1px solid rgba(20,40,60,.14) !important;
background:
radial-gradient(900px 520px at 15% 20%, rgba(14,165,233,.22), transparent 60%),
radial-gradient(900px 520px at 85% 25%, rgba(46,139,87,.20), transparent 60%),
linear-gradient(180deg, rgba(255,255,255,.78), rgba(255,255,255,.62)) !important;
box-shadow: 0 26px 70px rgba(2,6,23,.12) !important;
backdrop-filter: blur(10px);
overflow: visible !important;
}

header .brandBox{
width: 62px;
height: 62px;
border-radius: 20px;
padding: 10px;
background: rgba(255,255,255,.82);
border: 1px solid rgba(20,40,60,.14);
box-shadow: 0 16px 44px rgba(2,6,23,.12);
position: relative;
overflow: hidden;
}

header .brandBox:after{
content:"";
position:absolute;
inset:-30% -60%;
background: linear-gradient(135deg, transparent, rgba(255,255,255,.65), transparent);
transform: rotate(18deg);
opacity:.35;
animation: lm_shine 4.8s ease-in-out infinite;
pointer-events:none;
}

@keyframes lm_shine{
0%{transform: translateX(-30%) rotate(18deg); opacity:.0}
18%{opacity:.35}
38%{transform: translateX(30%) rotate(18deg); opacity:.0}
100%{transform: translateX(30%) rotate(18deg); opacity:.0}
}

header img.logo-img{
width: 100% !important;
height: 100% !important;
object-fit: contain !important;
filter: drop-shadow(0 10px 18px rgba(2,6,23,.18));
}

header .header-text .header-title{
font-weight: 900 !important;
letter-spacing: .2px;
}

header .user-chip{
border-radius: 22px !important;
background: rgba(255,255,255,.72) !important;
border: 1px solid rgba(20,40,60,.12) !important;
box-shadow: 0 18px 52px rgba(2,6,23,.10) !important;
}

header .user-chip:hover{transform: translateY(-1px)}

header .user-chip:active{transform: translateY(0px)}

header .icon-btn{
width: 44px !important;
height: 44px !important;
border-radius: 16px !important;
background: rgba(255,255,255,.80) !important;
border: 1px solid rgba(20,40,60,.12) !important;
box-shadow: 0 18px 48px rgba(2,6,23,.10) !important;
}

header .icon-btn:hover{transform: translateY(-1px)}

header .icon-btn:active{transform: translateY(0px)}

@media (max-width: 640px){
header .header-card{border-radius:22px !important}
header .brandBox{width:56px;height:56px;border-radius:18px}
header .icon-btn{width:42px;height:42px;border-radius:15px}
}

.searchRow{
display:flex; align-items:center; gap:10px;
flex-wrap:wrap;
}

.searchToggle{
width:36px;height:36px;border-radius:999px;
display:inline-flex;align-items:center;justify-content:center;
border:1px solid rgba(20,40,60,.12);
background: rgba(255,255,255,.78);
cursor:pointer;
flex:0 0 auto;
}

.searchWrap{
flex:1 1 220px;
min-width:180px;
display:flex; align-items:center; gap:10px;
padding:10px 12px;
border-radius:16px;
background: rgba(255,255,255,.70);
border:1px solid rgba(20,40,60,.12);
}

.searchWrap.isHidden{
display:none;
}

.searchWrap input{
border:none; outline:none; background:transparent;
width:100%;
font-size:14px;
}

.iconClear{
width:36px; height:36px;
border-radius:999px;
border:1px solid rgba(20,40,60,.12);
background: rgba(255,255,255,.75);
cursor:pointer;
flex:0 0 auto;
}

.resultInfo{font-size:12px;opacity:.7;white-space:nowrap;flex:0 0 auto}

.cardGrid{
display:grid;
grid-template-columns: repeat(4, minmax(0, 1fr));
gap: 12px;
}

.contentCard{
background: rgba(255,255,255,.65);
border:1px solid rgba(20,40,60,.10);
border-radius:18px;
padding:14px;
display:flex;flex-direction:column;gap:10px;
}

.contentCard h3{margin:0;font-size:14px}

.contentCard p{margin:0;font-size:12px;opacity:.72}

.cardTop{display:flex;align-items:flex-start;gap:12px}

.cardThumb{width:54px;height:54px;border-radius:16px;flex:0 0 auto;overflow:hidden;
overflow-y:hidden;
background: radial-gradient(circle at 30% 30%, rgba(46,139,87,.20), transparent 60%),
linear-gradient(135deg, rgba(46,139,87,.18), rgba(59,130,246,.12));
border:1px solid rgba(46,139,87,.20);
display:grid;place-items:center;
}

.cardThumb img{width:78%;height:78%;object-fit:contain;filter: drop-shadow(0 6px 10px rgba(2,6,23,.18));}

.cardThumb .emoji{font-size:20px;line-height:1}

.cardHead{min-width:0}

.cardHead h3{white-space:nowrap;overflow:hidden;
overflow-y:hidden;text-overflow:ellipsis}

.cardTags{display:flex;gap:8px;flex-wrap:wrap}

.cardTag{font-size:9px;padding:4px 8px;border-radius:999px;background: rgba(15,23,42,.06);border:1px dashed rgba(20,40,60,.12)}

.openBtn{
margin-top:auto;
display:inline-flex;align-items:center;justify-content:center;gap:8px;
padding:10px 12px;border-radius:14px;
border:1px solid rgba(46,139,87,.25);
background: rgba(46,139,87,.12);
font-weight:800;
text-decoration:none;
color: rgba(15,23,42,.85);
}

@media (max-width: 900px){
.cardGrid{ grid-template-columns: repeat(3, minmax(0, 1fr)); }
}

@media (max-width: 640px){
.cardGrid{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
.contentCard{ padding:12px; border-radius:16px; }
.contentCard h3{font-size:13px}
.contentCard p{font-size:11px}
.cardThumb{width:50px;height:50px;border-radius:15px}
}

@media (max-width: 520px){
.bigRow{gap:8px}
.bigChip{min-width:136px;padding:8px 10px;border-radius:14px;gap:8px}
.bigChip .ico{width:24px;height:24px;border-radius:9px}
.bigChip .ico img{width:14px;height:14px}
.bigChip .ico .emoji{font-size:14px}
.bigChip .tWrap b{font-size:12.5px}
.bigChip .tWrap small{font-size:9px}
.bigChip .count{width:20px;height:20px}
.tagRow{gap:6px}
.tagChip{padding:3px 6px;font-size:9.5px}
.tagChip .tCount{width:15px;height:15px;font-size:8.5px}
.searchToggle,.iconClear{width:34px;height:34px}
.searchWrap{padding:9px 10px;border-radius:14px}
.searchWrap input{font-size:13px}
}

#storyBar{display:none !important;}

:root{ --story-ar: 16 / 9; --story-maxh: min(72vh, 760px); }

@media (max-width: 720px){
:root{ --story-ar: 9 / 16; --story-maxh: 84vh; }
}

#storyViewer{
aspect-ratio: var(--story-ar);
max-height: var(--story-maxh);
padding: 0 !important;
position: relative;
background: rgba(255,255,255,0.18) !important;
overflow: hidden;
border-radius: 18px;
width: 100% !important;
margin: 12px auto 0 !important;
display:flex;
align-items:center;
justify-content:center;
}

#storyViewer::before{
content:"";
position:absolute;
inset:-24px;
background-image: var(--story-bg, none);
background-size: cover;
background-position: center;
filter: blur(18px) saturate(1.1);
transform: scale(1.08);
opacity: .55;
}

#storyViewer img#storyImg{
position: relative;
z-index: 1;
width:100% !important;
height:100% !important;
object-fit: cover !important;
object-position: center;
display:block;
}

@media (max-width: 720px){
#storyViewer img#storyImg{ object-fit: contain; }
#storyViewer::before{ opacity: .75; filter: blur(20px) saturate(1.05); }
}

.videoHero{
position:relative;
width:100%;
border-radius:18px;
overflow:hidden;
overflow-y:hidden;
background:#000;
border:1px solid rgba(20,40,60,.10);
box-shadow: 0 10px 30px rgba(0,0,0,.18);
aspect-ratio: 16 / 9;
}

.heroVideo{
width:100%;
height:100%;
display:block;
object-fit: contain;
}

@media (max-width: 720px){
.heroVideo{ aspect-ratio: 9 / 16; }
}

.videoControls{
position:absolute;
right:12px;
bottom:12px;
display:flex;
gap:10px;
align-items:center;
}

.vBtn{
width:44px;height:44px;
border-radius:999px;
border:1px solid rgba(15,23,42,.12);
background: rgba(255,255,255,.55);
color: rgba(15,23,42,.85);
font-size:18px;
cursor:pointer;
backdrop-filter: blur(8px);
}

.vBtn:hover{ background: rgba(255,255,255,.78); }

#medalSection{
position: relative;
overflow: hidden;
}

#medalSection::before{
content:"";
position:absolute; inset:-2px;
background:
radial-gradient(700px 240px at 20% 0%, rgba(46,139,87,.22), transparent 60%),
radial-gradient(650px 240px at 90% 10%, rgba(59,130,246,.18), transparent 60%),
linear-gradient(135deg, rgba(255,255,255,.35), rgba(255,255,255,.10));
pointer-events:none;
}

#medalSection::after{
content:"";
position:absolute; top:-40%; left:-60%;
width:220%; height:180%;
background: linear-gradient(120deg, transparent 35%, rgba(255,255,255,.55) 50%, transparent 65%);
transform: rotate(10deg);
opacity:.35;
animation: shineMove 6s linear infinite;
pointer-events:none;
}

@keyframes shineMove{
0%{ transform: translateX(-18%) rotate(10deg); }
100%{ transform: translateX(18%) rotate(10deg); }
}

#medalSection .sectionTitle{position:relative; z-index:1;}

#medalSection > *{position:relative; z-index:1;}

#medalLarge{
box-shadow: 0 18px 40px rgba(2,6,23,.12);
border: 1px solid rgba(46,139,87,.22) !important;
background: rgba(255,255,255,.75) !important;
}

#openRating.btnSm{
padding:6px 10px !important;
border-radius:999px !important;
font-size:11px !important;
line-height:1 !important;
min-height:auto !important;
box-shadow: 0 10px 20px rgba(2,6,23,.08);
}

#openRating.btnSm::before{
content:"";
display:inline-block;
width:12px;height:12px;
margin-right:6px;
background: url('logo.webp') center/contain no-repeat;
vertical-align:-2px;
}


/* ===== NEW Logo v7.1: Minimal Neo Frame ===== */
.lmLogo{
  position:relative;
  width:60px; height:60px;
  display:grid;
  place-items:center;
  isolation:isolate;
}
.lmLogo .lmTile{
  position:absolute; inset:0;
  border-radius:20px;
  background:
    radial-gradient(circle at 30% 20%, rgba(255,255,255,.85), rgba(255,255,255,0) 55%),
    conic-gradient(from 210deg,
      rgba(46,139,87,.0),
      rgba(46,139,87,.55),
      rgba(22,245,167,.55),
      rgba(59,130,246,.55),
      rgba(46,139,87,.0));
  opacity:.95;
  mask: radial-gradient(circle at center, transparent 58%, #000 59%);
  -webkit-mask: radial-gradient(circle at center, transparent 58%, #000 59%);
  pointer-events:none;
}
.lmLogo .lmBadge{
  position:relative;
  width:54px; height:54px;
  border-radius:18px;
  display:grid; place-items:center;
  background: rgba(255,255,255,.80);
  border: 1px solid rgba(15,23,42,.10);
  box-shadow:
    0 18px 40px rgba(2,6,23,.10),
    0 10px 22px rgba(46,139,87,.10),
    inset 0 1px 0 rgba(255,255,255,.55);
  overflow:hidden;
  transform: translateZ(0);
}
.lmLogo .logo-img{
  width:46px; height:46px;
  object-fit:contain;
  filter: drop-shadow(0 10px 18px rgba(46,139,87,.18));
}
.lmLogo .lmPulse{ display:none; }

.brandBox:hover .lmBadge{ transform: translateY(-1px) scale(1.015); }
.brandBox:active .lmBadge{ transform: scale(.985); }

@media (prefers-reduced-motion: no-preference){
  .brandBox:hover .lmTile{ animation: lmSpinSoft 8.5s linear infinite; }
  @keyframes lmSpinSoft{ from{ transform: rotate(0deg);} to{ transform: rotate(360deg);} }
}


/* ===== v7 FIX: Level layout stable + no clipping + interactive progress ===== */
.levelSection, #medalSection{ overflow: visible !important; }
.levelWrap{
  display:flex;
  align-items:center;
  gap: 22px;
  padding: 12px;
  border-radius: 26px;
  border: 1px solid rgba(46,139,87,.18);
  background: linear-gradient(135deg, rgba(255,255,255,.70), rgba(231,248,240,.56));
  box-shadow: 0 22px 48px rgba(15,23,42,.08);
  overflow: visible;
}
@media (max-width: 720px){
  .levelWrap{ flex-direction: column; align-items: stretch; gap: 14px; }
  .levelOrbWrap{ align-self: center; }
}
.levelOrbWrap{
  flex: 0 0 auto;
  position: relative;
  z-index: 3;
  overflow: visible;
}
.levelOrb{ overflow: visible !important; filter: drop-shadow(0 18px 38px rgba(46,139,87,.18)); }
.levelCardMain{
  flex: 1 1 auto;
  overflow: visible;
  min-width: 0;
  padding: 10px 10px;
  border-radius: 22px;
}
.levelInfo{ min-width: 0; }

/* Progress bar: keep stable and visually obvious */
.levelMini{ display:flex; align-items:center; gap:12px; }
.levelMiniBar{
  position: relative;
  height: 16px;
  flex: 1 1 auto;
  border-radius: 999px;
  background: rgba(15,23,42,.10);
  overflow: hidden;
  box-shadow: inset 0 1px 0 rgba(255,255,255,.45);
}
.levelMiniFill{
  height: 100%;
  display:block;
  width: 0%;
  border-radius: 999px;
  background: linear-gradient(90deg, #2E8B57, #16f5a7, #3b82f6);
  transition: width 1100ms cubic-bezier(.22,1,.36,1);
  position: relative;
}
.levelMiniFill::after{
  content:"";
  position:absolute; inset:0;
  background: linear-gradient(90deg, rgba(255,255,255,0), rgba(255,255,255,.35), rgba(255,255,255,0));
  transform: translateX(-40%);
  animation: lmShimmer 2.2s linear infinite;
  opacity:.55;
}
@keyframes lmShimmer{ from{ transform: translateX(-60%);} to{ transform: translateX(140%);} }
.levelMiniKnob{
  position:absolute;
  top: 50%;
  transform: translate(-50%,-50%);
  width: 14px; height: 14px;
  border-radius: 999px;
  background: rgba(255,255,255,.92);
  border: 2px solid rgba(46,139,87,.70);
  box-shadow: 0 10px 18px rgba(46,139,87,.22);
  transition: left 1100ms cubic-bezier(.22,1,.36,1);
  pointer-events:none;
}
.levelMiniTooltip{
  position:absolute;
  top: -30px;
  transform: translateX(-50%);
  padding: 6px 9px;
  border-radius: 999px;
  font-size: 12px;
  font-weight: 800;
  background: rgba(255,255,255,.92);
  border: 1px solid rgba(46,139,87,.18);
  box-shadow: 0 12px 24px rgba(15,23,42,.12);
  opacity: 0;
  transition: opacity .2s ease;
  white-space: nowrap;
  pointer-events:none;
}
.levelMiniBar:hover .levelMiniTooltip{ opacity: 1; }

/* Top10: prevent layout jumps + no wrapping */
.top10Row{ width:100%; }
.top10Marquee{
  height: 64px !important;
  min-height: 64px !important;
  display:flex;
  align-items:center;
  contain: layout paint;
}
.top10Track{
  display:flex;
  align-items:center;
  gap:10px;
  width:max-content;
  flex: 0 0 auto;
  white-space: nowrap;
}
.top10Item{
  flex: 0 0 auto;
  min-width: 220px;
  max-width: 260px;
}
.top10Name{
  min-width: 0;
  max-width: 160px;
  overflow:hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* Ensure no accidental clipping from older styles */
.levelNeoCard{ overflow: visible !important; }


/* ===== Modern Chat (Comments) + Modern Notifications — v1 ===== */
#commentModal .modal{ max-width: 920px; }
#commentModal .modalBody{
  display:flex; flex-direction:column;
  gap:12px;
  height:min(70vh, 720px);
}
#commentModal .modalBody .hr{ display:none; }
#commentModal .commentList{
  order:1;
  flex:1 1 auto;
  overflow:auto;
  padding: 4px 6px 10px;
  display:flex;
  flex-direction:column;
  gap:10px;
  scroll-behavior:smooth;
}
#commentModal .commentBox{
  order:2;
  position:sticky;
  bottom:0;
  margin:0 !important;
  padding:10px;
  border-radius: 18px;
  background: linear-gradient(180deg, rgba(255,255,255,.85), rgba(255,255,255,.70));
  border: 1px solid rgba(46,139,87,.18);
  box-shadow: 0 12px 28px rgba(12,38,28,.10);
  backdrop-filter: blur(10px);
  display:flex;
  gap:10px;
}
#commentModal #commentInput{
  flex:1 1 auto;
  height:44px;
  border-radius: 999px;
  padding: 0 14px;
  border: 1px solid rgba(46,139,87,.18);
  background: rgba(255,255,255,.92);
}
#commentModal #commentSend{
  height:44px;
  padding:0 16px;
  border-radius: 999px;
  white-space:nowrap;
}

/* Chat bubbles */
#commentModal .commentItem{
  list-style:none;
  border:none;
  background: transparent;
  padding:0;
  margin:0;
  display:flex;
  flex-direction:column;
  max-width: min(680px, 92%);
}
#commentModal .commentItem .top{
  order:2;
  display:flex;
  gap:10px;
  align-items:baseline;
  justify-content:space-between;
  padding: 4px 10px 0;
}
#commentModal .commentItem .top .nameLine{
  font-weight:800;
  font-size:12px;
  opacity:.78;
}
#commentModal .commentItem .commentText{
  order:1;
  padding: 12px 14px;
  border-radius: 18px;
  border: 1px solid rgba(46,139,87,.16);
  box-shadow: 0 10px 22px rgba(12,38,28,.08);
  line-height:1.35;
  word-break: break-word;
}
#commentModal .commentItem.other{ align-self:flex-start; }
#commentModal .commentItem.other .commentText{
  background: rgba(255,255,255,.88);
  border-top-left-radius: 10px;
}
#commentModal .commentItem.me{ align-self:flex-end; }
#commentModal .commentItem.me .top{ justify-content:flex-end; gap:8px; }
#commentModal .commentItem.me .top .nameLine{ display:none; }
#commentModal .commentItem.me .commentText{
  background: linear-gradient(135deg, rgba(46,139,87,.95), rgba(68,195,122,.82));
  color:#fff;
  border-color: rgba(255,255,255,.22);
  border-top-right-radius: 10px;
}
#commentModal .commentItem.me .commentText::selection{ background: rgba(255,255,255,.25); }

/* Compact actions like modern chat */
#commentModal .commentActions.compact{
  display:flex;
  gap:8px;
  padding: 6px 10px 0;
}
#commentModal .actBtn{
  border-radius: 999px;
  padding: 8px 10px;
  background: rgba(255,255,255,.75);
  border: 1px solid rgba(46,139,87,.14);
}
#commentModal .actBtn.liked{ background: rgba(232,77,110,.12); border-color: rgba(232,77,110,.25); }
#commentModal .ownerActions{
  display:flex;
  gap:8px;
  padding: 6px 10px 0;
  justify-content:flex-end;
}

/* Replies as nested mini chat */
#commentModal .repliesWrap{
  margin: 8px 0 0 10px;
  padding-left: 10px;
  border-left: 2px dashed rgba(46,139,87,.18);
}
#commentModal .replyList{
  display:flex;
  flex-direction:column;
  gap:8px;
  padding: 8px 0 8px 0;
}
#commentModal .replyBox{
  display:flex;
  gap:10px;
  padding-top: 6px;
}
#commentModal .replyInput{
  flex:1;
  height:40px;
  border-radius: 999px;
  padding:0 12px;
}

/* Notifications — modern cards */
#notifModal .modal{ max-width: 900px; }
#notifModal .modalBody{
  height:min(70vh, 720px);
  display:flex;
  flex-direction:column;
  gap:10px;
}
#notifModal .notifList{
  flex:1;
  overflow:auto;
  padding: 6px 6px 10px;
  display:flex;
  flex-direction:column;
  gap:10px;
}
#notifModal .notifItem{
  list-style:none;
  border-radius: 18px;
  padding: 12px 14px;
  border: 1px solid rgba(46,139,87,.14);
  background: rgba(255,255,255,.84);
  box-shadow: 0 12px 26px rgba(12,38,28,.10);
  position:relative;
  overflow:hidden;
}
#notifModal .notifItem::before{
  content:'';
  position:absolute;
  left:0; top:0; bottom:0;
  width: 6px;
  background: rgba(46,139,87,.35);
}
#notifModal .notifItem.unread{
  background: linear-gradient(180deg, rgba(46,139,87,.10), rgba(255,255,255,.88));
  border-color: rgba(46,139,87,.25);
}
#notifModal .notifItem.unread::before{ background: linear-gradient(180deg, rgba(46,139,87,.95), rgba(68,195,122,.75)); }
#notifModal .notifBody{
  margin-top: 6px;
  line-height:1.35;
  color: rgba(9,20,14,.86);
}
#notifModal .notifActions{
  margin-top: 10px;
  display:flex;
  gap:10px;
  justify-content:flex-end;
}
#notifModal .notifItem .top{
  display:flex;
  justify-content:space-between;
  gap:10px;
  align-items:baseline;
}
#notifModal .notifItem .nameLine{ font-weight:900; }



/* ============================
   PRO CHAT UI — v10 (Sharxlar)
   ============================ */

/* Dock button — more "product" feel */
.commentsDock .dockPill{
  height: 56px;
  padding: 0 16px 0 14px;
  border-radius: 999px;
  border: 1px solid rgba(46,139,87,.22);
  background: linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.74));
  box-shadow: 0 22px 70px rgba(12,38,28,.22), 0 8px 18px rgba(15,23,42,.10), inset 0 1px 0 rgba(255,255,255,.82);
}
.commentsDock .dockPill .dockIcon{
  width: 38px; height: 38px;
  border-radius: 999px;
  background: radial-gradient(120% 120% at 30% 20%, rgba(46,139,87,.26), rgba(14,165,233,.12));
  border: 1px solid rgba(15,23,42,.10);
  box-shadow: 0 16px 30px rgba(15,23,42,.10), inset 0 1px 0 rgba(255,255,255,.75);
  font-size: 0; /* hide emoji */
  position: relative;
}
.commentsDock .dockPill .dockIcon::before{
  content:"\f086"; /* fa-comment */
  font-family: "Font Awesome 6 Free";
  font-weight: 900;
  font-size: 16px;
  color: rgba(15,23,42,.88);
  position:absolute; inset:0;
  display:grid; place-items:center;
}
.commentsDock .dockPill .dockText{
  font-weight: 950;
  letter-spacing: .2px;
  font-size: 14px;
}
.commentsDock .dockPill .dockGlow{
  opacity: 1;
  filter: blur(14px);
}
.commentsDock .dockBadge{
  top: -7px; right: -7px;
  min-width: 22px;
  height: 22px;
  border-radius: 999px;
  display:grid; place-items:center;
  font-weight: 950;
  background: linear-gradient(135deg, #16a34a, #0ea5e9);
  border: 2px solid rgba(255,255,255,.95);
  box-shadow: 0 14px 24px rgba(12,38,28,.18);
}

/* Modal layout like real messenger */
#commentModal.modalApp{ align-items:flex-end; justify-content:center; }
#commentModal.modalApp .modal{
  width: min(860px, calc(100vw - 24px));
  max-height: min(84vh, 760px);
  border-radius: 24px;
  overflow: hidden;           /* safe — internal elements handle overflow */
}
#commentModal .modalHead{
  position: sticky;
  top: 0;
  z-index: 4;
  background: linear-gradient(135deg, rgba(255,255,255,.92), rgba(255,255,255,.72));
  backdrop-filter: blur(16px) saturate(170%);
  -webkit-backdrop-filter: blur(16px) saturate(170%);
}
#commentModal .modalBody{
  display:flex;
  flex-direction: column;
  gap: 12px;
  padding: 14px;
  height: calc(84vh - 72px);
  max-height: calc(min(84vh, 760px) - 72px);
}

/* Message list = scrollable like chat apps */
#commentModal .commentList{
  flex: 1 1 auto;
  overflow: auto;
  overscroll-behavior: contain;
  padding: 6px 2px 2px;
  display: flex;
  flex-direction: column;
  gap: 14px;
  list-style: none;
  margin: 0;
}
#commentModal .commentList::-webkit-scrollbar{ width: 10px; }
#commentModal .commentList::-webkit-scrollbar-thumb{
  background: rgba(15,23,42,.12);
  border-radius: 999px;
  border: 3px solid rgba(255,255,255,.0);
  background-clip: padding-box;
}

/* Message row */
#commentModal .commentItem{
  border: 0 !important;
  background: transparent !important;
  box-shadow: none !important;
  padding: 0 !important;
}
#commentModal .msgRow{
  display:flex;
  align-items: flex-end;
  gap: 10px;
}
#commentModal .commentItem.me .msgRow{
  flex-direction: row-reverse;
}
#commentModal .avatar{
  width: 36px; height: 36px;
  border-radius: 999px;
  display:grid; place-items:center;
  background: radial-gradient(120% 120% at 30% 20%, rgba(46,139,87,.24), rgba(14,165,233,.12));
  border: 1px solid rgba(15,23,42,.10);
  box-shadow: 0 12px 26px rgba(15,23,42,.10), inset 0 1px 0 rgba(255,255,255,.75);
  font-weight: 950;
  color: rgba(15,23,42,.84);
  letter-spacing: .4px;
}
#commentModal .commentItem.me .avatar{ display:none; } /* like messengers */

/* Content column */
#commentModal .msgCol{ max-width: min(560px, 78%); }
#commentModal .commentItem.me .msgCol{ max-width: min(560px, 84%); }

#commentModal .metaLine{
  display:flex;
  align-items: center;
  gap: 8px;
  margin: 0 6px 6px;
  color: rgba(15,23,42,.62);
  font-size: 12px;
  font-weight: 800;
}
#commentModal .metaLine .who{ color: rgba(15,23,42,.82); }
#commentModal .commentItem.me .metaLine{ justify-content: flex-end; }
#commentModal .editedTag{
  margin-left: 8px;
  font-size: 11px;
  padding: 2px 8px;
  border-radius: 999px;
  border: 1px solid rgba(15,23,42,.10);
  background: rgba(255,255,255,.60);
}

/* Bubble */
#commentModal .bubble{
  border-radius: 18px;
  border: 1px solid rgba(15,23,42,.08);
  background: rgba(255,255,255,.78);
  box-shadow: 0 16px 44px rgba(15,23,42,.08);
  padding: 12px 14px;
}
#commentModal .commentItem.me .bubble{
  background: linear-gradient(135deg, rgba(46,139,87,.22), rgba(14,165,233,.16));
  border-color: rgba(46,139,87,.22);
}
#commentModal .commentText{
  font-size: 14px;
  line-height: 1.45;
  color: rgba(15,23,42,.92);
  font-weight: 750;
  white-space: pre-wrap;
  word-break: break-word;
}
#commentModal .commentItem.me .commentText{ color: rgba(9,28,20,.95); }

/* Action row like reactions */
#commentModal .actionRow{
  display:flex;
  align-items:center;
  gap: 8px;
  margin: 8px 6px 0;
  opacity: .92;
}
#commentModal .commentItem.me .actionRow{ justify-content: flex-end; }

#commentModal .actIcon{
  height: 34px;
  padding: 0 10px;
  border-radius: 999px;
  border: 1px solid rgba(15,23,42,.10);
  background: rgba(255,255,255,.66);
  box-shadow: inset 0 1px 0 rgba(255,255,255,.72);
  display:inline-flex;
  align-items:center;
  gap: 8px;
  cursor: pointer;
  font-weight: 900;
  color: rgba(15,23,42,.82);
}
#commentModal .actIcon i{ font-size: 14px; }
#commentModal .actIcon .cnt{
  min-width: 18px;
  text-align:center;
  font-size: 12px;
  font-weight: 950;
  color: rgba(15,23,42,.78);
}
#commentModal .actIcon:hover{ background: rgba(255,255,255,.82); }
#commentModal .actIcon:active{ transform: translateY(1px) scale(.99); }
#commentModal .actIcon.liked{
  background: linear-gradient(135deg, rgba(232,76,110,.16), rgba(46,139,87,.14));
  border-color: rgba(232,76,110,.22);
}
#commentModal .actIcon.ghost{
  background: rgba(255,255,255,.42);
}
#commentModal .actIcon.danger{
  background: rgba(232,76,110,.10);
  border-color: rgba(232,76,110,.22);
  color: rgba(232,76,110,.92);
}
#commentModal .spacer{ flex: 1 1 auto; }

/* Replies — nested chat */
#commentModal .repliesWrap{
  margin: 10px 6px 0;
  padding-top: 10px;
  border-top: 1px dashed rgba(15,23,42,.14);
}
#commentModal .replyList{
  display:flex;
  flex-direction: column;
  gap: 10px;
}
#commentModal .replyItem{
  height: auto !important;
  min-height: 0 !important;
  padding: 10px 10px;
  display:flex;
  gap: 10px;
  align-items: flex-start;
  border-radius: 16px;
  background: rgba(255,255,255,.66);
  border: 1px solid rgba(15,23,42,.08);
  box-shadow: 0 12px 26px rgba(15,23,42,.06);
}
#commentModal .rAvatar{
  width: 30px; height: 30px;
  border-radius: 999px;
  display:grid; place-items:center;
  background: rgba(46,139,87,.10);
  border: 1px solid rgba(46,139,87,.14);
  font-weight: 950;
  font-size: 12px;
  color: rgba(15,23,42,.78);
}
#commentModal .rMeta{
  display:flex; align-items:center; gap: 8px;
  font-size: 12px;
  font-weight: 850;
  color: rgba(15,23,42,.62);
}
#commentModal .rWho{ color: rgba(15,23,42,.82); }
#commentModal .rText{
  margin-top: 4px;
  font-size: 13px;
  font-weight: 750;
  color: rgba(15,23,42,.90);
  line-height: 1.35;
}

/* Reply composer */
#commentModal .replyComposer{
  margin-top: 10px;
  display:flex;
  gap: 10px;
  align-items: center;
}
#commentModal .replyInput{
  flex: 1 1 auto;
  height: 42px;
  border-radius: 999px;
  padding: 0 14px;
  border: 1px solid rgba(15,23,42,.10);
  background: rgba(255,255,255,.86);
  outline:none;
  font-weight: 800;
}
#commentModal .replySendBtn{
  width: 42px; height: 42px;
  border-radius: 999px;
  border: 1px solid rgba(46,139,87,.22);
  background: linear-gradient(135deg, rgba(46,139,87,1), rgba(14,165,233,1));
  color:#fff;
  display:grid; place-items:center;
  box-shadow: 0 16px 34px rgba(12,38,28,.20);
  cursor: pointer;
}
#commentModal .replySendBtn:active{ transform: translateY(1px) scale(.99); }

/* Main composer = sticky bottom like messengers */
#commentModal .commentComposer{
  position: sticky;
  bottom: 0;
  z-index: 3;
  padding: 10px;
  border-radius: 18px;
  background: linear-gradient(180deg, rgba(255,255,255,.94), rgba(255,255,255,.78));
  border: 1px solid rgba(46,139,87,.18);
  box-shadow: 0 -12px 30px rgba(15,23,42,.08), 0 16px 36px rgba(12,38,28,.10);
}
#commentModal .composerField{
  height: 50px;
  border-radius: 999px;
  background: rgba(255,255,255,.92);
}
#commentModal .composerIcon{
  width: 34px; height: 34px;
  border-radius: 999px;
  background: rgba(46,139,87,.10);
}
#commentModal .composerSend{
  height: 50px;
  min-width: 50px;
  padding: 0 14px;
}
#commentModal .composerSend .sendIcon{
  width: 30px; height: 30px;
  border-radius: 999px;
}
@media (max-width: 520px){
  #commentModal.modalApp .modal{
    width: calc(100vw - 16px);
    max-height: 86vh;
    border-radius: 20px;
  }
  #commentModal .modalBody{ padding: 12px; }
  #commentModal .msgCol{ max-width: 86%; }
}


/* === LeaderMath: remove ONLINE/STATUS green dots === */
.dot{ width:auto !important; height:auto !important; border-radius:0 !important; background:transparent !important; box-shadow:none !important; display:inline !important; }
.sep{ opacity:.65; padding:0 6px; }
.orbDots{ display:none !important; }



/* ============================
   GAME-STYLE LEADERBOARD (2026)
   Overrides for ratingModal + lbModal
============================ */

/* modal header feel */
#ratingModal .modalHead, #lbModal .modalHead{
  position: sticky;
  top: 0;
  z-index: 5;
  background: linear-gradient(135deg, rgba(255,255,255,.92), rgba(255,255,255,.72));
  backdrop-filter: blur(14px);
  -webkit-backdrop-filter: blur(14px);
}

/* tools sticky (search + "Meni") */
#ratingModal .lbTools{
  position: sticky;
  top: 74px;
  z-index: 4;
  padding-top: 8px;
  background: linear-gradient(180deg, rgba(255,255,255,.90), rgba(255,255,255,.55));
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border-bottom: 1px solid rgba(15,23,42,.06);
}

/* ---------- PODIUM ---------- */
#ratingModal .lbPodium{
  display: grid !important;
  grid-template-columns: 1fr 1.15fr 1fr;
  grid-template-areas: "two one three";
  gap: 14px;
  align-items: stretch;
  margin-top: 10px;
}

#ratingModal .lbPodium .podCard{
  position: relative;
  overflow: hidden;
  border-radius: 26px !important;
  padding: 14px 14px 14px 14px !important;
  min-height: 140px;
  border: 1px solid rgba(15,23,42,.08) !important;
  box-shadow: 0 22px 70px rgba(2,6,23,.14);
  transform: translateZ(0);
  isolation: isolate;
}

/* assign podium placement */
#ratingModal .lbPodium .podCard:nth-child(1){ grid-area: one; min-height: 168px; }
#ratingModal .lbPodium .podCard:nth-child(2){ grid-area: two; }
#ratingModal .lbPodium .podCard:nth-child(3){ grid-area: three; }

/* podium backgrounds (gold/silver/bronze vibe without hardcoding colors) */
#ratingModal .lbPodium .podCard::before{
  content:"";
  position:absolute; inset:-2px;
  background: radial-gradient(circle at 30% 20%, rgba(255,255,255,.95), rgba(255,255,255,.0) 55%),
              radial-gradient(circle at 70% 80%, rgba(46,139,87,.22), rgba(46,139,87,0) 60%),
              linear-gradient(135deg, rgba(255,255,255,.72), rgba(255,255,255,.40));
  z-index:-2;
}
#ratingModal .lbPodium .podCard::after{
  content:"";
  position:absolute; inset:0;
  background:
    radial-gradient(circle at 20% 35%, rgba(255,215,0,.22), rgba(255,215,0,0) 58%),
    radial-gradient(circle at 85% 20%, rgba(160,185,255,.22), rgba(160,185,255,0) 55%),
    radial-gradient(circle at 80% 85%, rgba(205,127,50,.20), rgba(205,127,50,0) 55%);
  opacity:.55;
  z-index:-1;
  pointer-events:none;
}

/* make #1 feel like winner */
#ratingModal .lbPodium .podCard:nth-child(1){
  box-shadow: 0 26px 90px rgba(2,6,23,.18);
  transform: translateY(-6px);
}
#ratingModal .lbPodium .podCard:hover{ transform: translateY(-3px) scale(1.01); }

/* tighten top row */
#ratingModal .podTop{ gap:10px; }
#ratingModal .podMedal{ font-size: 20px; filter: drop-shadow(0 10px 18px rgba(2,6,23,.18)); }
#ratingModal .podRank{ font-weight: 1000; opacity:.9; }

/* avatar medal bigger */
#ratingModal .podAvatar{
  width: 64px !important;
  height: 64px !important;
  border-radius: 22px !important;
  border: 1px solid rgba(255,255,255,.50) !important;
  box-shadow: 0 22px 44px rgba(2,6,23,.16) !important;
}

/* names */
#ratingModal .podName{
  font-size: 16px !important;
  line-height: 1.15;
  letter-spacing: .2px;
}
#ratingModal .podId{ opacity:.78; }

/* SCORE BADGE (big, game-like) */
#ratingModal .podPts{
  position: absolute;
  right: 12px;
  bottom: 12px;
  margin: 0 !important;
  padding: 10px 12px !important;
  border-radius: 18px !important;
  font-weight: 1000 !important;
  font-size: 16px !important;
  letter-spacing: .3px;
  background: radial-gradient(circle at 25% 20%, rgba(255,255,255,.90), rgba(255,255,255,.62));
  border: 1px solid rgba(15,23,42,.10);
  box-shadow: 0 18px 40px rgba(2,6,23,.14);
}
#ratingModal .podPts::after{
  content:"BALL";
  margin-left: 8px;
  font-size: 11px;
  font-weight: 1000;
  opacity: .7;
}

/* progress bar more gamey */
#ratingModal .podBar{
  height: 10px !important;
  border-radius: 999px !important;
  background: rgba(2,6,23,.06) !important;
  border: 1px solid rgba(255,255,255,.55);
}
#ratingModal .podBar span{
  background: linear-gradient(90deg, rgba(46,139,87,.35), rgba(46,139,87,.75)) !important;
}

/* ---------- LIST (Top-20) ---------- */
#ratingModal .lbList{ gap: 12px !important; }

/* fix the old grid/flex conflict and make it true game layout */
#ratingModal .lbItem,
#lbModal .lbItem{
  display: grid !important;
  grid-template-columns: 64px 72px 1fr auto 18px;
  gap: 12px;
  align-items: center;
  height: auto !important;
  min-height: 76px !important;
  padding: 12px 12px !important;
  border-radius: 24px !important;
  background: linear-gradient(135deg, rgba(255,255,255,.82), rgba(255,255,255,.58)) !important;
  border: 1px solid rgba(15,23,42,.08) !important;
  box-shadow: 0 22px 70px rgba(2,6,23,.12) !important;
}

#lbModal .lbItem{ grid-template-columns: 64px 72px 1fr auto; }

/* rank badge bigger */
.rankBadge{
  width: 44px !important;
  height: 44px !important;
  border-radius: 18px !important;
  display:flex; align-items:center; justify-content:center;
  font-weight: 1000 !important;
  font-size: 16px !important;
  background: radial-gradient(circle at 30% 20%, rgba(255,255,255,.95), rgba(255,255,255,.62)) !important;
  border: 1px solid rgba(15,23,42,.10) !important;
  box-shadow: 0 16px 36px rgba(2,6,23,.12) !important;
}

/* avatar slightly larger */
.lbAvatarWrap{ width:72px !important; height:72px !important; }
.lbAvatar{ width:62px !important; height:62px !important; border-radius: 22px !important; }

/* main text */
#ratingModal .lbNameLine .nameLine,
#lbModal .lbMain .nameLine{
  font-size: 15px;
  font-weight: 1000;
}
#ratingModal .lbSub{ margin-top: 4px !important; }

/* BIG SCORE PILL */
#ratingModal .lbPts{
  margin-left: auto;
}
#ratingModal .lbPts b{
  font-size: 22px !important;
  font-weight: 1000 !important;
  letter-spacing: .2px;
}
#ratingModal .lbPts{
  display: inline-flex;
  align-items: baseline;
  gap: 8px;
  padding: 10px 12px;
  border-radius: 18px;
  background: radial-gradient(circle at 25% 20%, rgba(255,255,255,.92), rgba(255,255,255,.62));
  border: 1px solid rgba(15,23,42,.10);
  box-shadow: 0 18px 40px rgba(2,6,23,.12);
  white-space: nowrap;
}

/* move miniBar to full width under content */
#ratingModal .miniBar{
  height: 8px !important;
  margin-top: 10px !important;
  grid-column: 3 / 6;
}
#ratingModal .miniBar span{
  background: linear-gradient(90deg, rgba(46,139,87,.25), rgba(46,139,87,.78)) !important;
}

/* chevron align */
#ratingModal .lbChevron{ grid-column: 5; opacity:.55; }

/* ---------- ALL RANKS MODAL ---------- */
#lbModal .lbItemSmall{
  grid-template-columns: 64px 72px 1fr auto !important;
  min-height: 74px !important;
}

/* points at right in all ranks: make it BIG badge */
#lbModal .lbRight{
  justify-self: end;
  font-size: 22px !important;
  font-weight: 1000 !important;
  padding: 12px 14px;
  border-radius: 18px;
  background: radial-gradient(circle at 25% 20%, rgba(255,255,255,.92), rgba(255,255,255,.62));
  border: 1px solid rgba(15,23,42,.10);
  box-shadow: 0 18px 40px rgba(2,6,23,.12);
  min-width: 96px;
  text-align: center;
}
#lbModal .lbRight::after{
  content:"BALL";
  display:block;
  font-size: 11px;
  font-weight: 1000;
  opacity: .65;
  margin-top: 2px;
  letter-spacing: .6px;
}

/* better spacing on small screens */
@media (max-width: 520px){
  #ratingModal .lbPodium{ grid-template-columns: 1fr; grid-template-areas: "one" "two" "three"; }
  #ratingModal .lbPodium .podCard:nth-child(1){ transform:none; }
  #ratingModal .lbItem{ grid-template-columns: 56px 66px 1fr auto 16px; }
  #lbModal .lbItem{ grid-template-columns: 56px 66px 1fr auto; }
  #lbModal .lbRight{ min-width: 86px; font-size: 20px !important; padding: 10px 12px; }
}

</style>
</head>
<body data-page="app">
<div class="scroll-progress"><div class="scroll-progress-bar" id="scrollProgress"></div></div>
<button aria-label="Yuqoriga" class="scroll-to-top" id="scrollToTop"><i class="fa-solid fa-arrow-up"></i></button>
<canvas id="three-canvas"></canvas>
<!-- old seasonal particles (kept for logic) -->
<canvas class="seasonCanvas" id="seasonCanvas"></canvas>
<div class="app">
<header>
<div class="header-card">
<div aria-label="LeaderMath" class="brandBox">

<div class="lmLogo" aria-label="LeaderMath.UZ logo">
  <span class="lmTile" aria-hidden="true"></span>
  <span class="lmBadge">
    <img alt="LeaderMath.UZ" class="logo-img" src="logo.webp"/>
  </span>
  <span class="lmPulse" aria-hidden="true"></span>
</div>
</div>
<!-- Desktop subtitle / time (mobile'da yashiriladi) -->
<div class="header-text">
<div class="header-title">LeaderMath.UZ</div>
<div class="header-sub" id="dt">...</div>
</div>
<!-- Mobile layout: logo chapda, profil o'rtada (to'liq), ikonlar o'ngda -->
<div class="user-chip" id="profileMini" title="Profil / Medalyon">
<img alt="avatar" id="userAvatar" src="logo.webp" style="width:36px;height:36px;border-radius:999px;border:2px solid rgba(56,189,248,.65)">
<div class="user-meta">
<div class="name"><span id="userName">—</span> · <span id="userId">—</span></div>
<div class="mini">🏆 <span id="userPoints">0</span> • 💰 <span id="userBalance">0</span> • 🎂 <span id="userAge">—</span></div>
</div>
</img></div>
<div aria-label="Header actions" class="header-actions">
<button aria-label="Bildirishnoma" class="icon-btn" id="btnBell"><i class="fa-solid fa-bell"></i></button>
<button aria-label="Chiqish" class="icon-btn" id="btnLogout"><i class="fa-solid fa-right-from-bracket"></i></button>
</div>
</div>
</header>
<main style="display:flex;flex-direction:column;gap:18px;">
<!-- ★ Medalyon / Level progress (100 bosqich) -->
<section class="glass section levelSection levelNeo" id="medalSection">
  <div class="levelHead">
    <div class="levelHeadLeft">
      <h2 class="levelH2">Sizning darajangiz</h2>
      <div class="hint">Ball → bosqich • real progress</div>
    </div>
    <button class="rank-btn-mini" id="openRating" type="button" title="Reytingni ko'rish">
      <span class="rankIcon" aria-hidden="true"></span>
      <span>Reyting</span>
    </button>
  </div>

  <div class="levelWrap" role="group" aria-label="Level progress card">
    <div class="levelOrbWrap">
      <div class="levelOrb" aria-hidden="false">
      <svg class="levelRing" viewBox="0 0 120 120" aria-hidden="true">
        <defs>
          <linearGradient id="lmRingGrad" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0%" stop-color="#2E8B57"></stop>
            <stop offset="55%" stop-color="#16f5a7"></stop>
            <stop offset="100%" stop-color="#3b82f6"></stop>
          </linearGradient>
          <filter id="lmGlow">
            <feGaussianBlur stdDeviation="2.2" result="blur"/>
            <feMerge>
              <feMergeNode in="blur"/>
              <feMergeNode in="SourceGraphic"/>
            </feMerge>
          </filter>
        </defs>
        <circle class="ringTrack" cx="60" cy="60" r="46"></circle>
        <circle class="ringGlow" cx="60" cy="60" r="46"></circle>
        <circle id="levelRingCircle" class="ringProg" cx="60" cy="60" r="46"></circle>
      </svg>

      <div class="orbCore">
        <img alt="Medalyon" id="medalLarge" src="logo.webp" class="levelMedalImg"/>
        <div class="orbSheen" aria-hidden="true"></div>
</div>
    </div>
    </div>

    <div class="levelCardMain">
<div class="levelInfo">
      <div class="levelTopRow">
        <div class="levelText" id="levelText">Daraja: 1</div>
        <div class="levelRange" id="levelRange">0 → 100</div>
      </div>

      <div class="levelMini">
        <div class="levelMiniBar" id="levelMiniBar">
          <span class="levelMiniFill" id="levelProgress" style="width:0%"></span>
          <span class="levelMiniKnob" id="levelKnob" style="left:0%"></span>
          <span class="levelMiniTooltip" id="levelTip" style="left:0%">0%</span>
        </div>
        <div class="levelMiniPct" id="levelPct">0%</div>
      </div>

      <div class="levelHint" id="nextHint">Keyingi darajagacha: 0 ball</div>
      <div class="top10Row" aria-label="Top 10 ball jamg‘arganlar">
        <div class="top10Label"><i class="fa-solid fa-trophy"></i> Top 10</div>
        <div class="top10Marquee" role="region" aria-label="Top 10 lenta">
          <div id="top10Track" class="top10Track"></div>
        </div>
      </div>
<div class="levelActions">
        <button class="btn btnPrimary" type="button" id="goChallengeBtn" onclick="lmQuickNav(\'challenges\')"><i class="fa-solid fa-bolt"></i> Challenge</button>
        <button class="btn" type="button" id="goTestsBtn" onclick="lmQuickNav(\'tests\')"><i class="fa-solid fa-file-circle-check"></i> Testlar</button>
      </div>
    </div>
    </div>
  </div>
</section>
<!-- 1) Video Banner (public/hero.mp4) -->
<section class="glass section" id="bannerSection">
  <div class="sectionTitle">
    <h2>Yangiliklar</h2>
    <div class="hint">Videoni tomosha qiling — pauza va ovoz boshqaruvi bor.</div>
  </div>

  <div class="videoHero" aria-label="Video banner">
    <video
      id="heroVideo"
      class="heroVideo"
      src="videos/banner.mp4"
      autoplay
      muted
      loop
      playsinline
      preload="metadata"
    ></video>

    <div class="videoControls" aria-label="Video boshqaruvlari">
      <button class="vBtn" id="playPauseBtn" type="button" aria-label="Pause / Play" title="Pause / Play">⏸</button>
      <button class="vBtn" id="muteBtn" type="button" aria-label="Mute / Unmute" title="Mute / Unmute">🔇</button>
    </div>
  </div>
</section>

<!-- 2) Challenge container (code + start) -->
<section class="glass section" id="challengeSection">
<div class="sectionTitle">
<h2>Challenge</h2>
<div class="hint" id="challengeHint">Bellashing! Bilimingizni sinab ko'ring!</div>
</div>
<div class="challengeList" id="challengeList">
<div class="muted">Yuklanmoqda...</div>
</div>
</section>
<section class="glass section" id="contentSection">
<div class="sectionTitle">
<h2>Kontent</h2>
<div class="hint">Bo‘lim → tag → qidiruv</div>
</div>
<div class="contentBox">
<div class="bigRow" id="bigChipsRow"></div>
<div class="tagRow" id="tagChipsRow"></div>
<div class="searchRow">
<button class="searchToggle" id="searchToggle" type="button" aria-label="Qidiruv" title="Qidiruv">🔎</button>
<div class="searchWrap isHidden" id="searchWrap">
<input autocapitalize="off" autocomplete="new-password" autocorrect="off" id="q" inputmode="search" placeholder="Test, simulyator yoki mavzu qidiring..." spellcheck="false" type="search"/>
</div>
<button aria-label="Tozalash" class="iconClear" id="clearBtn" title="Tozalash"><i class="fa-solid fa-broom"></i></button>
<div class="resultInfo" id="resultInfo">Natija: —</div>
</div>
<div class="cardGrid" id="grid"></div>
<div class="muted" id="empty" style="display:none;padding:10px 2px;">Hech narsa topilmadi.</div>
</div>
</section>
<!-- 3) Tests container (chips + search) -->
<!-- 4) Simulators container (same style) -->
<!-- Reyting/Izohlar endi suzuvchi "touch" tugma orqali premium modalda ochiladi -->
<!-- Floating Touch Button (expand: 🏆 Reyting / 💬 Izoh) -->
<!-- Reyting Modal (Top-20 + podium + qidiruv) -->
<div aria-hidden="true" class="modalOverlay modalApp" id="ratingModal">
<div aria-label="Reyting" aria-modal="true" class="modal glass" role="dialog">
<div class="modalHead">
<div>
<div class="modalTitle">Reyting</div>
<div class="small">Top-20 • podium • qidiruv</div>
</div>
<div style="display:flex; align-items:center; gap:10px;">
<button class="chipBtn" id="btnLbAll" type="button">📋 Barchasi</button>
<button aria-label="Yopish" class="iconBtn" id="ratingClose" type="button">✕</button>
</div>
</div>
<div class="hr"></div>
<div class="modalBody">
<div class="lbTools" style="margin-top:0;">
<input class="lbSearch" id="lbSearch" placeholder="Qidirish (ID yoki ism)…"/>
<button aria-pressed="false" class="chipBtn" id="lbOnlyMe" type="button">⭐ Meni</button>
</div>
<div aria-label="Top-3 podium" class="lbPodium" id="lbPodium"></div>
<div class="lbList" id="lbBody" aria-label="Leaderboard">
  <div class="lbEmpty small">Yuklanmoqda…</div>
</div>
</div>
</div>
</div>
<!-- Comment Modal -->
<div aria-hidden="true" class="modalOverlay modalApp" id="commentModal">
<div aria-label="Izohlar" aria-modal="true" class="modal glass" role="dialog">
<div class="modalHead">
<div>
<div class="modalTitle">Izohlar</div>
<div class="small">Barcha izohlar</div>
</div>
<div style="display:flex; align-items:center; gap:10px;">
<span class="pill" id="commentCount">0</span>
<button aria-label="Yopish" class="iconBtn" id="commentClose" type="button">✕</button>
</div>
</div>
<div class="hr"></div>
<div class="modalBody">
<div class="commentComposer" style="margin-top:0;">
  <div class="composerField" role="group" aria-label="Izoh yozish">
    <span class="composerIcon" aria-hidden="true">💬</span>
    <input id="commentInput" maxlength="140" placeholder="Izoh yozing… (140 ta belgi)"/>
  </div>
  <button class="composerSend" id="commentSend" type="button" aria-label="Yuborish">
    <span class="sendIcon" aria-hidden="true">➤</span>
    <span class="sendText">Yuborish</span>
  </button>
</div>
<div class="hr"></div>
<ul class="commentList" id="commentList"></ul>
<div style="height:10px;"></div>
<button class="btn" id="cmLoadMoreInline" type="button">Yana yuklash</button>
</div>
</div>
</div>
<!-- Leaderboard Modal -->
<div aria-hidden="true" class="modalOverlay modalApp" id="lbModal">
<div aria-label="Reyting" aria-modal="true" class="modal glass" role="dialog">
<div class="modalHead">
<div>
<div class="modalTitle">Reyting — barcha o‘rinlar</div>
<div class="small" id="lbModalHint">Ball bo‘yicha saralangan</div>
</div>
<button aria-label="Yopish" class="iconBtn" id="lbModalClose" type="button">✕</button>
</div>
<div class="hr"></div>
<div class="modalBody">
<div class="lbList lbAll" id="lbAllBody" aria-label="Leaderboard all">
  <div class="lbEmpty small">Yuklanmoqda…</div>
</div>
<div style="height:10px;"></div>
<button class="btn" id="lbLoadMore" type="button">Yana yuklash</button>
</div>
</div>
</div>
<!-- Notifications Modal -->
<div aria-hidden="true" class="modalOverlay modalApp" id="notifModal">
<div aria-label="Bildirishnomalar" aria-modal="true" class="modal glass" role="dialog">
<div class="modalHead">
<div>
<div class="modalTitle">Bildirishnomalar</div>
<div class="small" id="notifHint">Yangi xabarlar shu yerda chiqadi</div>
</div>
<div style="display:flex; align-items:center; gap:10px;">
<button class="chipBtn" id="notifMarkAll" type="button">✅ Hammasini o‘qildi</button>
<button aria-label="Yopish" class="iconBtn" id="notifClose" type="button">✕</button>
</div>
</div>
<div class="hr"></div>
<div class="modalBody">
<ul class="notifList" id="notifList"></ul>
<div style="height:10px;"></div>
<button class="btn" id="notifLoadMore" type="button">Yana yuklash</button>
</div>
</div>
</div>
<!-- Level Up Modal (Medalyon) -->
<div aria-hidden="true" class="modalOverlay modalApp" id="levelUpModal" style="display:none;">
<div aria-label="Yangi bosqich" aria-modal="true" class="modal glass" role="dialog">
<div class="modalHead">
<div>
<div class="modalTitle">Tabriklaymiz! 🎉</div>
<div class="small" id="levelUpSub">Siz yangi darajaga ko'tarildingiz!</div>
</div>
<button aria-label="Yopish" class="iconBtn" id="levelUpClose" type="button">✕</button>
</div>
<div class="hr"></div>
<div class="modalBody" style="display:flex;flex-direction:column;align-items:center;gap:10px;text-align:center;">
<img alt="Medalyon" id="levelUpImg" src="logo.webp" style="width:120px;height:120px;border-radius:24px;border:1px solid rgba(20,40,60,.12);background:rgba(255,255,255,.55);object-fit:contain;"/>
<div id="levelUpTitle" style="font-weight:900;font-size:16px;">Daraja: 1</div>
<div class="small muted" id="levelUpHint">Keyingi bosqichga yaqinlashishda davom eting!</div>
<button class="btn btnPrimary" id="levelUpOk" style="width:min(320px,100%);" type="button">Zo'r! Davom etaman</button>
</div>
</div>
</div>
<!-- Embedded viewer (single-page feel) -->
<div aria-hidden="true" class="modalOverlay modalApp" id="embedModal">
<div aria-label="Oyna" aria-modal="true" class="modal glass" role="dialog">
<div class="modalHead">
<div>
<div class="modalTitle" id="embedTitle">Oyna</div>
<div class="small muted" id="embedSub">LeaderMath.UZ</div>
</div>
<div style="display:flex; align-items:center; gap:10px;">
<button aria-label="Yopish" class="iconBtn" id="embedClose" type="button">✕</button>
</div>
</div>
<div class="hr"></div>
<div class="modalBody" style="padding:0;">
<iframe id="embedFrame" style="width:100%; height:70vh; border:0; border-radius: 0 0 var(--r) var(--r); background:transparent;" title="Embed"></iframe>
</div>
</div>
</div>
<!-- Onboarding overlay (original flow preserved) -->
<div id="onboardOverlay" style="display:none; position:fixed; inset:0; background: rgba(2,6,23,.55); backdrop-filter: blur(10px); z-index: 9998;">
<div class="container" style="display:flex; align-items:center; justify-content:center; min-height: 100%;">
<div class="glass section" style="max-width: 520px; width: 100%;">
<div class="sectionTitle">
<h2>Profilni to‘ldiring</h2>
<div class="hint">Birinchi kirishda</div>
</div>
<p class="p">Ism, familiya, tug‘ilgan sana va yangi parolni kiriting.</p>
<div class="hr"></div>
<div class="row">
<input class="input" id="obFirst" placeholder="Ism"/>
<input class="input" id="obLast" placeholder="Familiya"/>
</div>
<div style="height:10px;"></div>
<div class="row">
<input class="input" id="obBirth" placeholder="Tug‘ilgan sana (YYYY-MM-DD)" type="date"/>
<input class="input" id="obPass1" placeholder="Yangi parol" type="password"/>
</div>
<div style="height:10px;"></div>
<div class="row">
<input class="input" id="obPass2" placeholder="Yangi parolni takrorlang" type="password"/>
<div></div>
</div>
<div style="height:12px;"></div>
<button class="btn btnPrimary" id="obSave" style="width:100%;">Saqlash va davom etish</button>
<div class="small" style="margin-top:10px;">⚠️ Parolni eslab qoling. Keyingi kirishda shu parol ishlaydi.</div>
</div>
</div>
</div>
<script type="module">
    import { initSeasons } from "./assets/js/seasons.js";
    initSeasons("seasonCanvas");
  </script>
</main>
<footer>
<div class="footer-card">
<div class="footer-left">
<div class="footer-name">LeaderMath.UZ</div>
<div class="small-note">Matematikadan super interaktiv sayt!</div>
</div>
<div class="footer-right">
<a class="footer-link" href="index.html"><i class="fa-solid fa-house"></i> Home</a>

<div class="storeBar" id="lmStoreBar" style="margin-top:10px;">
<a class="storeBtn" id="btnPlayStore" href="#" title="Android"><img class="osIcon" src="icons/android.webp" alt=""> <span>Play Market</span></a>
    <a class="storeBtn" id="btnAppStore" href="#" title="iPhone/iPad"><img class="osIcon" src="icons/apple.webp" alt=""> <span>App Store</span></a>
<a class="storeBtn" id="btnMsStore" href="#" title="Windows"><img class="osIcon" src="icons/microsoft.webp" alt=""> <span>Microsoft Store</span></a>
    <a class="storeBtn install" id="btnInstallPWA" href="#" title="O‘rnatish"><img class="osIcon" src="icons/download.webp" alt=""> <span>O‘rnatish</span></a>
</div>
</div>
</div>
</footer>
</div>
<div class="toast" id="toast">...</div>
<script src="assets/js/core.js"></script>
<script src="assets/js/pwa.js" defer></script>
<script type="module">
    import { me, logout, updateProfile, changePassword, getToken } from "./assets/js/auth.js";
    import { api } from "./assets/js/api.js";

    const $ = (id)=>document.getElementById(id);

    // UZ date formatter
    const months = ["yanvar","fevral","mart","aprel","may","iyun","iyul","avgust","sentabr","oktabr","noyabr","dekabr"];
    const days = ["yakshanba","dushanba","seshanba","chorshanba","payshanba","juma","shanba"];
    function setDate(){
      const d = new Date();
      const s = `${days[d.getDay()]}, ${d.getDate()}-${months[d.getMonth()]} ${d.getFullYear()} • ${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}`;
      $("dt").textContent = s;
      const mini = `${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}`;
      const dtMini = $("dtMini");
      if(dtMini) dtMini.textContent = mini;
    }
    setDate(); setInterval(setDate, 15000);

    // Toast
    const toastEl = $("toast");
    function toast(msg){
      toastEl.textContent = msg;
      toastEl.classList.add("show");
      clearTimeout(window.__t);
      window.__t = setTimeout(()=>toastEl.classList.remove("show"), 1800);
    }

    function escapeHtml(s){
      return String(s||"").replace(/[&<>"']/g, m=>({ "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#039;" }[m]));
    }

    // Simple modal helpers
    function openModal(el){
      if(!el) return;
      // bridge.css modalApp animatsiyasi .open orqali ishlaydi
      el.classList.add("open");
      el.style.display = "flex";
      el.setAttribute("aria-hidden","false");
      document.body.classList.add("noScroll");
    }
    function closeModal(el){
      if(!el) return;
      el.classList.remove("open");
      el.style.display = "none";
      el.setAttribute("aria-hidden","true");
      document.body.classList.remove("noScroll");
    }

    function calcAgePrecise(iso){
      if(!iso) return "—";
      const b = new Date(iso);
      if(Number.isNaN(b.getTime())) return "—";
      const n = new Date();
      let y=n.getFullYear()-b.getFullYear();
      let m=n.getMonth()-b.getMonth();
      let d=n.getDate()-b.getDate();
      if(d<0){ m--; d += new Date(n.getFullYear(), n.getMonth(), 0).getDate(); }
      if(m<0){ y--; m+=12; }
      return `${y} yosh ${m} oy ${d} kun`;
    }

    function ageYears(birth){
      if(!birth) return null;
      // Accept ISO string or Firestore Timestamp-like objects
      try{
        if(typeof birth === "object"){
          if(typeof birth.toDate === "function") birth = birth.toDate();
          else if("seconds" in birth) birth = new Date(Number(birth.seconds)*1000);
          else if("_seconds" in birth) birth = new Date(Number(birth._seconds)*1000);
        }
        const d = (birth instanceof Date) ? birth : new Date(birth);
        if(Number.isNaN(d.getTime())) return null;
        const n = new Date();
        let y = n.getFullYear() - d.getFullYear();
        const mo = n.getMonth() - d.getMonth();
        if(mo < 0 || (mo === 0 && n.getDate() < d.getDate())) y--;
        return y >= 0 && y < 120 ? y : null;
      }catch(_){ return null; }
    }

    // ===============================
    // Medalyon (9999 gacha) tizimi
    //  - medals/1.webp ... medals/9999.webp 
    //  - Bosqich threshold: T(L) = BASE * (L-1)*L/2
    //    misol: 1→0, 2→100, 3→300, 4→600 ...
    //  - manifest.json kerak emas
    // ===============================
    var MEDAL_DIR = "medals";
    var LEVEL_MAX = 9999;
    var BASE_STEP = 100; // 100 ball = bazaviy qadam

    function clamp(n, a, b){ n = Number(n)||0; return Math.max(a, Math.min(b, n)); }

    function thresholdForLevel(L){
      L = clamp(L, 1, LEVEL_MAX);
      return Math.round(BASE_STEP * (L-1) * L / 2);
    }

    function levelFromPoints(points){
      var p = Math.max(0, Number(points)||0);
      // L = floor((1 + sqrt(1 + 8*(p/BASE_STEP))) / 2)
      var L = Math.floor((1 + Math.sqrt(1 + 8*(p/BASE_STEP))) / 2);
      return clamp(L, 1, LEVEL_MAX);
    }

    function medalUrl(level){
      var L = clamp(level, 1, LEVEL_MAX);
      return MEDAL_DIR + "/" + L + ".webp";
    }

    // Robust medal loader (low 404):
    // 1) Try current level (webp/png)
    // 2) If missing, try last known working medal level from localStorage (webp/png)
    // 3) Then try 1 (webp/png)
    // 4) Finally logo.webp
    function setMedalImg(imgEl, level){
      if(!imgEl) return;

      var L = clamp(level, 1, LEVEL_MAX);
      var bust = "?v=" + Date.now();

      var KEY = "lm_last_medal_ok_level";
      var lastOk = 1;
      try{
        lastOk = clamp(parseInt(localStorage.getItem(KEY), 10) || 1, 1, LEVEL_MAX);
      }catch(_){ lastOk = 1; }

      // Build attempt list (max 6 tries)
      var tries = [
        {l:L, ext:"webp"}, {l:L, ext:"png"},
        {l:lastOk, ext:"webp"}, {l:lastOk, ext:"png"},
        {l:1, ext:"webp"}, {l:1, ext:"png"}
      ];

      var i = 0;

      function doneToLogo(){
        imgEl.onerror = null;
        imgEl.onload = null;
        imgEl.src = "logo.webp";
      }

      function tryNext(){
        if(i >= tries.length){ doneToLogo(); return; }

        var t = tries[i++];
        var url = MEDAL_DIR + "/" + t.l + "." + t.ext + bust;

        imgEl.onload = function(){
          imgEl.onload = null;
          imgEl.onerror = null;
          // save last ok medal level
          try{ localStorage.setItem(KEY, String(t.l)); }catch(_){}
        };

        imgEl.onerror = function(){
          imgEl.onerror = null;
          imgEl.onload = null;
          tryNext();
        };

        imgEl.src = url;
      }

      tryNext();
    }

    function renderLevelBars(){ /* histogram removed intentionally */ }

function openLevelUp(level){
      var modal = $("levelUpModal");
      if(!modal) return;

      var img = $("levelUpImg");
      var ttl = $("levelUpTitle");
      var sub = $("levelUpSub");
      var hint = $("levelUpHint");

      var L = clamp(level, 1, LEVEL_MAX);

      if(img) setMedalImg(img, L);
      if(ttl) ttl.textContent = "Daraja: " + L + " • Yangi daraja!";
      if(sub) sub.textContent = "Siz " + L + "-bosqichga o‘tdingiz";

      if(hint){
        if(L < LEVEL_MAX){
          var next = thresholdForLevel(L+1);
          hint.textContent = "Keyingi bosqich uchun: " + next + " ball";
        }else{
          hint.textContent = "Siz maksimal darajadasiz!";
        }
      }

      openModal(modal);
    }

    function setupLevelUpModal(){
      var modal = $("levelUpModal");
      var closeBtn = $("levelUpClose");
      var okBtn = $("levelUpOk");
      if(closeBtn) closeBtn.addEventListener("click", function(){ closeModal(modal); });
      if(okBtn) okBtn.addEventListener("click", function(){ closeModal(modal); });
      if(modal){
        modal.addEventListener("click", function(e){
          if(e.target === modal) closeModal(modal);
        });
      }
    }

    
    // ===== Animated progress (ring + mini bar) =====
    var __lm_prog = { pct: 0 };
    function easeOutCubic(t){ return 1 - Math.pow(1 - t, 3); }

    function setLevelProgressInstant(pct){
      pct = Math.max(0, Math.min(1, pct||0));
      __lm_prog.pct = pct;

      var fill = $("levelProgress");
      var knob = $("levelKnob");
      var tip  = $("levelTip");
      var ring = $("levelRingCircle");

      var pct100 = Math.round(pct*100);

      if(fill) fill.style.width = pct100 + "%";
      if(knob) knob.style.left = pct100 + "%";
      if(tip){ tip.style.left = pct100 + "%"; tip.textContent = pct100 + "%"; }

      if(ring){
        var C = 289; // circumference for r=46
        ring.style.strokeDasharray = C;
        ring.style.strokeDashoffset = Math.round((1 - pct) * C);
      }

      var pctEl = $("levelPct");
      if(pctEl) pctEl.textContent = pct100 + "%";
    }

    function setLevelProgressAnimated(targetPct){
      targetPct = Math.max(0, Math.min(1, targetPct||0));
      var from = __lm_prog.pct || 0;
      var to   = targetPct;

      if(window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches){
        setLevelProgressInstant(to);
        return;
      }

      var start = performance.now();
      var dur = 650;

      function step(now){
        var t = Math.min(1, (now - start)/dur);
        var v = from + (to - from) * easeOutCubic(t);
        setLevelProgressInstant(v);
        if(t < 1) requestAnimationFrame(step);
      }
      requestAnimationFrame(step);
    }

    // ===== Top-10 marquee: auto speed by content width =====
    function startTop10Marquee(){
      var wrap = document.querySelector(".top10Marquee");
      var track = $("top10Track");
      if(!wrap || !track) return;

      // If not duplicated, duplicate once for seamless loop
      if(!track.dataset.duped){
        track.innerHTML = track.innerHTML + track.innerHTML;
        track.dataset.duped = "1";
      }

      // Measure half width (one set)
      requestAnimationFrame(function(){
        var w = track.scrollWidth / 2;
        // speed auto by content width (slower = premium)
        // target ~ 22px/sec (extra slow premium); clamp duration to [90..240]s
        var seconds = Math.max(120, Math.min(360, Math.round(w / 14)));
        wrap.style.setProperty("--marquee-duration", seconds + "s");
        track.classList.add("run");
      });
    }

    function updateMedalUI(points){
      var p = Math.max(0, Number(points)||0);
      var L = levelFromPoints(p);

      // Header avatar: medal kabi ko‘rsatish
      var headImg = $("userAvatar");
      if(headImg){
        setMedalImg(headImg, L);
        headImg.alt = "medalyon";
        headImg.dataset.level = String(L);
      }

      // Big medal section
      var big = $("medalLarge");
      if(big){
        setMedalImg(big, L);
      }

      var curStart = thresholdForLevel(L);
      var nextStart = (L < LEVEL_MAX) ? thresholdForLevel(L+1) : thresholdForLevel(LEVEL_MAX);
      var span = Math.max(1, nextStart - curStart);
      var pct = (L >= LEVEL_MAX) ? 1 : Math.max(0, Math.min(1, (p - curStart)/span));

      if($("levelText")) $("levelText").textContent = "Daraja: " + L;
      if($("levelRange")) $("levelRange").textContent = (L < LEVEL_MAX) ? (curStart + " → " + nextStart) : (nextStart + " (MAX)");

      // Animated progress (bar + ring + knob + tooltip)
      setLevelProgressAnimated(pct);

      /* histogram removed */

      // Level-up detect (local only)
      var KEY = "lm_medal_level";
      var prev = 0;
      try{ prev = Number(localStorage.getItem(KEY) || 0) || 0; }catch(_){ prev = 0; }

      if(L > prev){
        try{ localStorage.setItem(KEY, String(L)); }catch(_){}
        if(prev > 0) openLevelUp(L);
      }else if(prev === 0){
        try{ localStorage.setItem(KEY, String(L)); }catch(_){}
      }
    }

// ===============================
    // Single-page home (Video Hero + Challenge + Tests + Simulators)
    // ===============================

    function setupHeroVideo(){
      const v = $("heroVideo");
      const playBtn = $("playPauseBtn");
      const muteBtn = $("muteBtn");
      if(!v) return;

      // Autoplay policy: start muted (default)
      v.muted = true;

      // Try to play (some browsers may block until user gesture — that's OK)
      const tryPlay = ()=>{ try{ v.play(); }catch(_){ } };
      tryPlay();

      // Play/Pause toggle
      playBtn?.addEventListener("click", ()=>{
        if(v.paused){
          tryPlay();
          if(playBtn) playBtn.textContent = "⏸";
        }else{
          v.pause();
          if(playBtn) playBtn.textContent = "▶️";
        }
      });

      // Mute/Unmute toggle
      muteBtn?.addEventListener("click", ()=>{
        v.muted = !v.muted;
        if(muteBtn) muteBtn.textContent = v.muted ? "🔇" : "🔊";
      });

      // If video ends unexpectedly (shouldn't with loop), keep it running
      v.addEventListener("ended", tryPlay);

      // Optional: tap video to toggle play/pause (mobile friendly)
      v.addEventListener("click", ()=>{
        if(v.paused){ tryPlay(); if(playBtn) playBtn.textContent="⏸"; }
        else { v.pause(); if(playBtn) playBtn.textContent="▶️"; }
      }, {passive:true});
    }

    // ---- Challenge (code + start) ----
    function setupChallenge(){
      const input = $("challengeCode");
      const btn = $("challengeStart");
      btn?.addEventListener("click", ()=>{
        const code = (input?.value||"").trim();
        if(!code){ toast("Challenge kodi kiriting"); input?.focus(); return; }
        sessionStorage.setItem("lm_challenge_code", code);
        // Single-page: open embedded test.html (challenge kod bilan)
        openEmbed(`test.html#challenge`, `Challenge: ${code}`);
        // Also prefill for test.html if it wants
        localStorage.setItem("lm_lastChallengeCode", code);
      });
    }

    
    // ---- Tests & Simulators removed (unused on home) ----
// ---- Embedded viewer modal ----
    function openEmbed(url, title){
      const modal = $("embedModal");
      const frame = $("embedFrame");
      const ttl = $("embedTitle");
      if(!modal || !frame) { location.href = url; return; }
      ttl.textContent = title || "";
      frame.src = url;
      modal.style.display = "flex";
      document.body.style.overflow = "hidden";
    }
    function closeEmbed(){
      const modal = $("embedModal");
      const frame = $("embedFrame");
      if(!modal) return;
      modal.style.display = "none";
      if(frame) frame.src = "about:blank";
      document.body.style.overflow = "";
    }

    async function runOnboarding(){
      return new Promise((resolve)=>{
        const overlay=$("onboardOverlay");
        const bSave=$("obSave");
        overlay.style.display="flex";
        bSave.onclick = async ()=>{
          bSave.disabled=true;
          try{
            const first=$("obFirst").value.trim();
            const last=$("obLast").value.trim();
            const birth=$("obBirth").value.trim();
            const p1=$("obPass1").value, p2=$("obPass2").value;
            if(first.length<2) throw new Error("Ism kamida 2 ta harf bo‘lsin");
            if(last.length<2) throw new Error("Familiya kamida 2 ta harf bo‘lsin");
            if(!birth) throw new Error("Tug‘ilgan sanani kiriting");
            if(p1.length<6) throw new Error("Yangi parol kamida 6 belgidan iborat bo‘lsin");
            if(p1!==p2) throw new Error("Parollar mos emas");
            await changePassword(p1);
            await updateProfile(first,last,birth);
            overlay.style.display="none";
            resolve(true);
          }catch(e){ toast(e.message||"Xatolik"); }
          finally{ bSave.disabled=false; }
        };
      });
    }

    // Leaderboard (interactive)
    let lbAll = [];
    let lbMeOnly = false;
    let lbQuery = "";
    let myLoginId = null;

    function medal(i){
      return i===0 ? "🥇" : i===1 ? "🥈" : i===2 ? "🥉" : "";
    }

    function renderLeaderboard(){
      const body = $("lbBody");
      const podium = $("lbPodium");
      const q = (lbQuery||"").toLowerCase();

      let items = lbAll.slice();
      if(lbMeOnly && myLoginId){
        items = items.filter(u=>String(u.loginId||"")===String(myLoginId));
      }
      if(q){
        items = items.filter(u=>
          String(u.loginId||"").toLowerCase().includes(q) ||
          String(u.name||"").toLowerCase().includes(q)
        );
      }

      const top = items.slice(0,3);
      const topPts = Number(top?.[0]?.points || 0) || 1;

      // Podium (Top-3) — medal avatar + compact stats
      podium.innerHTML = top.map((u,i)=>{
        const pts = Number(u.points||0);
        const pct = Math.max(8, Math.round((pts/topPts)*100));
        const me = myLoginId && String(u.loginId||"")===String(myLoginId);
        const lvl = levelFromPoints(pts);
        return `
          <button class="podCard ${me?"me":""}" type="button" data-pick="${escapeHtml(u.loginId||"")}" title="${escapeHtml(u.name||u.loginId||"")}">
            <div class="podTop">
              <div class="podLeft">
                <div class="podMedal">${medal(i)}</div>
                <div class="podRank">#${i+1}</div>
              </div>
              <img class="podAvatar" data-lvl="${lvl}" alt="medal" src="logo.webp"/>
            </div>
            <div class="podName">${escapeHtml(u.name || u.loginId || "—")}</div>
            <div class="podId">${escapeHtml(u.loginId || "")}</div>
            <div class="podBar"><span style="width:${pct}%"></span></div>
            <div class="podPts">${pts} ball</div>
          </button>
        `;
      }).join("") || `<div class="small">Hozircha reyting yo‘q</div>`;

      // List (Top-20 of filtered)
      const show = items.slice(0,20);
      body.innerHTML = show.map((u,i)=>{
        const pts = Number(u.points||0);
        const me = myLoginId && String(u.loginId||"")===String(myLoginId);
        const pct = Math.max(6, Math.round((pts/topPts)*100));
        const lvl = levelFromPoints(pts);
        const age = ageYears(u.birthdate);
        const ageTxt = age==null ? "—" : String(age);
        return `
          <button class="lbItem ${me?"me":""}" type="button" data-pick="${escapeHtml(u.loginId||"")}">
            <div class="lbRank">
              <span class="rankBadge">${i+1}</span>
            </div>

            <div class="lbAvatarWrap">
              <img class="lbAvatar" data-lvl="${lvl}" alt="medal" src="logo.webp"/>
              <span class="lbLvl" title="Yosh" aria-label="Yosh">${ageTxt}</span>
            </div>

            <div class="lbMain">
              <div class="lbNameLine">
                <span class="nameLine">${escapeHtml(u.name || u.loginId || "—")}</span>
                ${me ? `<span class="meTag">MEN</span>` : ``}
              </div>
              <div class="lbSub">
                <span class="small">${escapeHtml(u.loginId || "")}</span>
                <span class="sep">•</span>
                <span class="lbPts"><b>${pts}</b> ball</span>
              </div>
              <div class="miniBar"><span style="width:${pct}%"></span></div>
            </div>

            <div class="lbChevron">›</div>
          </button>
        `;
      }).join("") || `<div class="lbEmpty small">Mos natija topilmadi</div>`;

      // hydrate medal images
      try{
        podium.querySelectorAll("img.podAvatar").forEach(img=>{
          const lvl = Number(img.dataset.lvl||1)||1;
          setMedalImg(img, lvl);
        });
        body.querySelectorAll("img.lbAvatar").forEach(img=>{
          const lvl = Number(img.dataset.lvl||1)||1;
          setMedalImg(img, lvl);
        });
      }catch(_){}
    }

    
    // ===== Top-10 ticker in Level card =====
    function renderTop10Ticker(items){
      const track = $("top10Track");
      if(!track) return;

      const list = Array.isArray(items) ? items.slice(0,10) : [];
      if(!list.length){
        track.classList.remove("run");
        track.dataset.duped = "";
        track.innerHTML = `<div class="muted" style="padding:6px 4px">Top 10 ma’lumotlari yo‘q</div>`;
        return;
      }

      const html = list.map((u, i)=>{
        const pts = Number(u.points||0);
        const lvl = levelFromPoints(pts);
        const me = myLoginId && String(u.loginId||"")===String(myLoginId);
        const name = (u.name||u.loginId||"User").trim();
        const short = name.length>18 ? (name.slice(0,16)+"…") : name;
        return `
          <div class="top10Item ${me?'me':''}" title="${escapeHtml(name)} • ${pts} ball">
            <img class="top10Avatar" data-lvl="${lvl}" alt="medal" src="logo.webp"/>
            <div class="top10Name">#${i+1} ${escapeHtml(short)}</div>
            <span class="top10Sep">•</span>
            <div class="top10Pts">${pts}</div>
          </div>
        `;
      }).join("");

      // set base items (duplication + speed handled by startTop10Marquee)
      track.innerHTML = html;
      track.dataset.duped = "";

      // hydrate medal images
      try{
        track.querySelectorAll("img.top10Avatar").forEach(img=>{
          const lvl = Number(img.dataset.lvl||1)||1;
          setMedalImg(img, lvl);
        });
      }catch(_){}

      // start marquee with adaptive speed
      startTop10Marquee();
    }

async function loadLeaderboard(){
      const body = $("lbBody");
      body.innerHTML = `<div class="lbEmpty small">Yuklanmoqda…</div>`;
      try{
        const data = await api("leaderboard", { query: { limit: 120 } });
        lbAll = (data?.items || []);
        renderLeaderboard();
        renderTop10Ticker(lbAll);
        }catch(_){
        body.innerHTML = `<div class="lbEmpty small">Reytingni yuklab bo‘lmadi</div>`;
        renderTop10Ticker([]);
        }
    }

    // ===== Leaderboard modal (all with paging) =====
    let lbCursor = null;
    let lbRankBase = 0;
    async function loadLeaderboardMore(reset=false){
      const body = $("lbAllBody");
      const btn = $("lbLoadMore");
      try{
        btn.disabled = true;
        if(reset){
          lbCursor = null;
          lbRankBase = 0;
          body.innerHTML = `<div class="lbEmpty small">Yuklanmoqda…</div>`;
        }
        const data = await api("leaderboard", { query: { limit: 60, cursor: lbCursor } });
        const items = data?.items || [];
        if(reset) body.innerHTML = "";
        body.insertAdjacentHTML("beforeend", items.map((u,i)=>{
          const pts = Number(u.points||0);
          const lvl = levelFromPoints(pts);
          const age = ageYears(u.birthdate);
          const ageTxt = age==null ? "—" : String(age);
          return `
            <button class="lbItem lbItemSmall" type="button" data-pick="${escapeHtml(u.loginId||"")}">
              <div class="lbRank"><span class="rankBadge">${lbRankBase + i + 1}</span></div>
              <div class="lbAvatarWrap">
                <img class="lbAvatar" data-lvl="${lvl}" alt="medal" src="logo.webp"/>
                <span class="lbLvl" title="Yosh" aria-label="Yosh">${ageTxt}</span>
              </div>
              <div class="lbMain">
                <div class="nameLine">${escapeHtml(u.name || u.loginId || "—")}</div>
                <div class="small">${escapeHtml(u.loginId || "")}</div>
              </div>
              <div class="lbRight"><b>${pts}</b></div>
            </button>
          `;
        }).join(""));
        lbRankBase += items.length;
        lbCursor = data?.nextCursor || null;
        try{ body.querySelectorAll("img.lbAvatar").forEach(img=>setMedalImg(img, Number(img.dataset.lvl||1)||1)); }catch(_){ }
        btn.style.display = lbCursor ? "inline-flex" : "none";
        if(!items.length && reset){
          body.innerHTML = `<div class="lbEmpty small">Hozircha reyting yo‘q</div>`;
          btn.style.display = "none";
        }
      }catch(_){
        if(reset) body.innerHTML = `<div class="lbEmpty small">Reytingni yuklab bo‘lmadi</div>`;
      }finally{
        btn.disabled = false;
      }
    }

    // Comments
    function fmtTime(ts){
      const d = ts ? new Date(ts) : new Date();
      return `${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}`;
    }
    let likedSet = new Set();

    function renderReplies(replies){
  const items = (replies||[]).map(r=>{
    const nm = (r.name || r.loginId || "—");
    const ini = initialsFromName(nm);
    return `
      <li class="replyItem">
        <div class="rAvatar" aria-hidden="true">${escapeHtml(ini)}</div>
        <div class="rBody">
          <div class="rMeta">
            <span class="rWho">${escapeHtml(nm)}</span>
            <span class="rDot">•</span>
            <span class="rWhen">${escapeHtml(fmtTime(r.createdAt))}</span>
          </div>
          <div class="rText">${escapeHtml(r.text || "")}</div>
        </div>
      </li>
    `;
  }).join("");
  return items || `<li class="small">Hozircha javob yo‘q</li>`;
}

    function initialsFromName(n){
  n = String(n||"").trim();
  if(!n) return "LM";
  const parts = n.split(/\s+/).slice(0,2);
  const ini = parts.map(p=>p[0]).join("").toUpperCase();
  return ini || "LM";
}

function renderCommentItem(c){
  const liked = likedSet.has(String(c.id));
  const isOwner = myLoginId && String(c.loginId||"") === String(myLoginId);
  const edited = c.edited === true;
  const nm = (c.name || c.loginId || "—");
  const ini = initialsFromName(nm);
  return `
    <li class="commentItem ${isOwner?"me":"other"}" data-id="${escapeHtml(c.id)}">
      <div class="msgRow">
        <div class="avatar" aria-hidden="true">
          <span>${escapeHtml(ini)}</span>
        </div>

        <div class="msgCol">
          <div class="metaLine">
            <span class="who">${escapeHtml(nm)}</span>
            <span class="sep">•</span>
            <span class="when">${escapeHtml(fmtTime(c.createdAt))}</span>
            ${edited ? `<span class="editedTag">tahrirlangan</span>` : ``}
          </div>

          <div class="bubble">
            <div class="commentText" data-role="text">${escapeHtml(c.text || "")}</div>
          </div>

          <div class="actionRow">
            <button class="actIcon ${liked?"liked":""}" data-act="like" type="button" aria-label="Like" title="Like">
              <i class="fa-solid fa-heart"></i>
              <span class="cnt" data-k="likeCount">${Number(c.likeCount||0)}</span>
            </button>

            <button class="actIcon" data-act="toggleReplies" type="button" aria-label="Javoblar" title="Javob yozish">
              <i class="fa-solid fa-reply"></i>
              <span class="cnt" data-k="replyCount">${Number(c.replyCount||0)}</span>
            </button>

            ${isOwner ? `
              <span class="spacer"></span>
              <button class="actIcon ghost" data-act="edit" type="button" title="Tahrirlash" aria-label="Tahrirlash"><i class="fa-solid fa-pen"></i></button>
              <button class="actIcon danger" data-act="delete" type="button" title="O‘chirish" aria-label="O‘chirish"><i class="fa-solid fa-trash"></i></button>
            ` : ``}
          </div>

          <div class="repliesWrap" data-open="0">
            <ul class="replyList" data-loaded="0"></ul>
            <div class="replyComposer" role="group" aria-label="Javob yozish">
              <input class="replyInput" maxlength="160" placeholder="Javob yozing… (160)" />
              <button class="replySendBtn" data-act="sendReply" type="button" aria-label="Yuborish"><i class="fa-solid fa-paper-plane"></i></button>
            </div>
          </div>
        </div>
      </div>
    </li>
  `;
}

    async function loadLiked(){
      likedSet = new Set();
      try{
        const token = await getToken();
        const data = await api("comments/liked", { token });
        for(const id of (data?.ids || [])) likedSet.add(String(id));
      }catch(_){ /* ignore */ }
    }

    // ===== Comments (always show all, paging in the panel) =====
    let cmCursor = null;
    let latestCommentMs = 0;
    const COMMENTS_SEEN_KEY = "lm_comments_seen_ms";

    function toMillis(v){
      if(v==null) return 0;
      if(typeof v === "number") return v;
      const t = Date.parse(v);
      return Number.isFinite(t) ? t : 0;
    }

    function updateCommentBadge(){
      const b = $("cmBadge");
      if(!b) return;
      const seen = Number(localStorage.getItem(COMMENTS_SEEN_KEY) || 0);
      const hasNew = seen > 0 && latestCommentMs > seen;
      b.textContent = hasNew ? "NEW" : "";
      b.style.display = hasNew ? "inline-flex" : "none";
    }

    function markCommentsSeen(){
      if(latestCommentMs > 0){
        localStorage.setItem(COMMENTS_SEEN_KEY, String(latestCommentMs));
      }else{
        localStorage.setItem(COMMENTS_SEEN_KEY, String(Date.now()));
      }
      updateCommentBadge();
    }
    async function loadComments(reset=false){
      const list = $("commentList");
      const btn = $("cmLoadMoreInline");
      const count = $("commentCount");
      try{
        btn.disabled = true;
        if(reset){
          cmCursor = null;
          list.innerHTML = `<li class="small">Yuklanmoqda…</li>`;
        }
        await loadLiked();
        const data = await api("comments", { query: { limit: 30, cursor: cmCursor } });
        const items = data?.items || [];
        // Track newest comment time to show a tiny "NEW" badge on the touch button
        for(const it of items){
          const ms = toMillis(it.createdAt || it.time || it.ts);
          if(ms > latestCommentMs) latestCommentMs = ms;
        }
        if(reset) list.innerHTML = "";
        list.insertAdjacentHTML("beforeend", items.map(renderCommentItem).join(""));
        cmCursor = data?.nextCursor || null;
        btn.style.display = cmCursor ? "inline-flex" : "none";
        // total (if server returns it), else show loaded count
        const total = Number(data?.total || 0);
        const loaded = list.querySelectorAll(".commentItem").length;
        count.textContent = total ? String(total) : String(loaded);
        if(!items.length && reset){
          list.innerHTML = `<li class="small">Hozircha izoh yo‘q. Birinchi bo‘ling 🙂</li>`;
          btn.style.display = "none";
          count.textContent = "0";
        }

        updateCommentBadge();
      }catch(_){
        if(reset) list.innerHTML = `<li class="small">Izohlarni yuklab bo‘lmadi</li>`;
      }finally{
        btn.disabled = false;
      }
    }

    async function loadReplies(commentId, li){
      const wrap = li.querySelector(".repliesWrap");
      const ul = li.querySelector(".replyList");
      if(!wrap || !ul) return;
      try{
        const data = await api("comments/replies", { method:"POST", body:{ commentId, limit: 30 } });
        ul.innerHTML = renderReplies(data?.items || []);
        ul.setAttribute("data-loaded","1");
      }catch(_){
        ul.innerHTML = `<li class="small">Javoblarni yuklab bo‘lmadi</li>`;
      }
    }

    function setRepliesOpen(li, open){
      const wrap = li.querySelector(".repliesWrap");
      if(!wrap) return;
      wrap.setAttribute("data-open", open?"1":"0");
    }

    // Delegated actions on comment lists (preview + modal)
    async function handleCommentActions(e){
      const btn = e.target.closest("button[data-act]");
      if(!btn) return;
      const li = e.target.closest(".commentItem");
      if(!li) return;
      const id = li.getAttribute("data-id");
      const act = btn.getAttribute("data-act");

      if(act === "like"){
        try{
          const token = await getToken();
          const out = await api("comments/like", { method:"POST", token, body:{ commentId: id } });
          const liked = !!out.liked;
          if(liked) likedSet.add(String(id)); else likedSet.delete(String(id));
          btn.classList.toggle("liked", liked);
          const cnt = li.querySelector('[data-k="likeCount"]');
          if(cnt) cnt.textContent = String(out.likeCount ?? 0);
        }catch(_){ toast("Like uchun kirish kerak"); }
        return;
      }

      if(act === "toggleReplies"){
        const wrap = li.querySelector(".repliesWrap");
        const isOpen = wrap?.getAttribute("data-open") === "1";
        setRepliesOpen(li, !isOpen);
        const ul = li.querySelector(".replyList");
        if(!isOpen && ul && ul.getAttribute("data-loaded") !== "1"){
          await loadReplies(id, li);
        }
        return;
      }

      if(act === "sendReply"){
        const input = li.querySelector(".replyInput");
        const text = (input?.value || "").trim();
        if(!text) return toast("Javob bo‘sh");
        try{
          const token = await getToken();
          btn.disabled = true;
          await api("comments/reply", { method:"POST", token, body:{ commentId: id, text } });
          if(input) input.value = "";
          toast("Javob yuborildi ✅");
          // update reply count UI
          const rc = li.querySelector('[data-k="replyCount"]');
          if(rc) rc.textContent = String(Number(rc.textContent||0) + 1);
          await loadReplies(id, li);
          setRepliesOpen(li, true);
        }catch(_){ toast("Reply uchun kirish kerak"); }
        finally{ btn.disabled = false; }
        return;
      }

      if(act === "edit"){
        const textEl = li.querySelector('[data-role="text"]');
        const cur = textEl ? (textEl.textContent || "") : "";
        // swap to editor
        li.classList.add("editing");
        if(textEl){
          textEl.innerHTML = `
            <textarea class="editArea" maxlength="140">${escapeHtml(cur)}</textarea>
            <div class="editBar">
              <button class="btn btnPrimary btnSm" data-act="saveEdit" type="button">Saqlash</button>
              <button class="btn btnSm" data-act="cancelEdit" type="button">Bekor</button>
            </div>
          `;
        }
        return;
      }

      if(act === "cancelEdit"){
        // easiest: reload comments to restore template
        await loadComments(true);
        return;
      }

      if(act === "saveEdit"){
        const area = li.querySelector(".editArea");
        const text = (area?.value || "").trim();
        if(!text) return toast("Izoh bo‘sh");
        try{
          const token = await getToken();
          btn.disabled = true;
          await api("comments/update", { method:"POST", token, body:{ commentId: id, text } });
          toast("Tahrirlandi ✅");
          await loadComments(true);
        }catch(_){ toast("Tahrirlash uchun ruxsat yo‘q"); }
        finally{ btn.disabled = false; }
        return;
      }

      if(act === "delete"){
        if(!confirm("Izoh o‘chirilsinmi?")) return;
        try{
          const token = await getToken();
          btn.disabled = true;
          await api("comments/delete", { method:"POST", token, body:{ commentId: id } });
          toast("O‘chirildi ✅");
          await loadComments(true);
        }catch(_){ toast("O‘chirish uchun ruxsat yo‘q"); }
        finally{ btn.disabled = false; }
        return;
      }
    }

    $("commentList").addEventListener("click", handleCommentActions, { passive:false });
    async function sendComment(){
      const input = $("commentInput");
      const text = (input.value||"").trim();
      if(!text) return toast("Izoh bo‘sh");
      input.value = "";
      try{
        const token = await getToken();
        await api("comments", { method:"POST", token, body: { text } });
        toast("Yuborildi ✅");
        await loadComments(true);
      }catch(e){
        toast("Xato: yuborilmadi");
      }
    }

    // Modal wiring (leaderboard only)
    const lbModal = $("lbModal");
    $("btnLbAll").onclick = async ()=>{ openModal(lbModal); await loadLeaderboardMore(true); };
    $("lbModalClose").onclick = ()=>closeModal(lbModal);
    $("lbLoadMore").onclick = ()=>loadLeaderboardMore(false);

    // close on backdrop click
    lbModal.addEventListener("click", (e)=>{ if(e.target === lbModal) closeModal(lbModal); });

    // ===== Notifications =====
    const notifModal = $("notifModal");
    let notifCursor = null;
    async function refreshUnread(){
      try{
        const token = await getToken();
        const d = await api("notifications/unread-count", { token });
        const n = Number(d?.unreadCount||0);
        const b = $("notifBadge");
        const bell = $("btnBell");
        if(b){
          b.textContent = String(n);
          b.style.display = n>0 ? "inline-flex" : "none";
        }
        if(bell) bell.classList.toggle("hasUnread", n>0);
      }catch(_){
        const b = $("notifBadge");
        if(b) b.style.display = "none";
        const bell = $("btnBell");
        if(bell) bell.classList.remove("hasUnread");
      }
    }

    function renderNotifItem(n){
      const read = !!n.read;
      return `
        <li class="notifItem ${read?"read":"unread"}" data-id="${escapeHtml(n.id)}">
          <div class="top">
            <div class="nameLine">${escapeHtml(n.title||"Xabar")}</div>
            <div class="small">${escapeHtml(fmtTime(n.createdAt))}</div>
          </div>
          <div class="notifBody">${escapeHtml(n.body||"")}</div>
          <div class="notifActions">
            <button class="miniBtn ghost" data-act="delNotif" type="button" aria-label="O‘chirish">🗑</button>
            ${read?"":"<button class=\"miniBtn\" data-act=\"readNotif\" type=\"button\">O‘qildi</button>"}
          </div>
        </li>
      `;
    }

    async function loadNotifs(reset=false){
      const list = $("notifList");
      const btn = $("notifLoadMore");
      try{
        btn.disabled = true;
        if(reset){
          notifCursor = null;
          list.innerHTML = `<li class="small">Yuklanmoqda…</li>`;
        }
        const token = await getToken();
        const data = await api("notifications", { token, query:{ limit: 20, cursor: notifCursor } });
        const items = data?.items || [];
        if(reset) list.innerHTML = "";
        list.insertAdjacentHTML("beforeend", items.map(renderNotifItem).join(""));
        notifCursor = data?.nextCursor || null;
        btn.style.display = notifCursor ? "inline-flex" : "none";
        const unreadCount = Number(data?.unreadCount||0);
        const b = $("notifBadge");
        if(b){
          b.textContent = String(unreadCount);
          b.style.display = unreadCount>0 ? "inline-flex" : "none";
        }
        if(!items.length && reset){
          list.innerHTML = `<li class="small">Hozircha bildirishnoma yo‘q 🙂</li>`;
          btn.style.display = "none";
        }
      }catch(_){
        if(reset) $("notifList").innerHTML = `<li class="small">Yuklab bo‘lmadi</li>`;
      }finally{ btn.disabled = false; }
    }

    async function markNotifRead(id){
      const token = await getToken();
      await api("notifications/read", { method:"POST", token, body:{ id } });
    }
    async function deleteNotif(id){
      const token = await getToken();
      await api("notifications/delete", { method:"POST", token, body:{ id } });
    }
    async function markAllRead(){
      const token = await getToken();
      await api("notifications/read", { method:"POST", token, body:{ all:true } });
    }

    $("btnBell")?.addEventListener("click", async ()=>{ openModal(notifModal); await loadNotifs(true); });
    $("notifClose")?.addEventListener("click", ()=>closeModal(notifModal));
    $("notifLoadMore")?.addEventListener("click", ()=>loadNotifs(false));
    $("notifMarkAll")?.addEventListener("click", async ()=>{ try{ await markAllRead(); await loadNotifs(true); await refreshUnread(); }catch(_){ toast("Xato"); } });
    notifModal.addEventListener("click", (e)=>{ if(e.target===notifModal) closeModal(notifModal); });
    $("notifList")?.addEventListener("click", async (e)=>{
      const li = e.target.closest(".notifItem");
      const id = li?.getAttribute("data-id");
      if(!id) return;

      const del = e.target.closest("button[data-act='delNotif']");
      if(del){
        try{ del.disabled = true; await deleteNotif(id); li.remove(); await refreshUnread(); }
        catch(_){ toast("Xato"); }
        finally{ del.disabled = false; }
        return;
      }

      const b = e.target.closest("button[data-act='readNotif']");
      if(!b) return;
      try{ b.disabled = true; await markNotifRead(id); li.classList.add("read"); li.classList.remove("unread"); await refreshUnread(); }
      catch(_){ toast("Xato"); }
      finally{ b.disabled=false; }
    });

    $("btnLogout").onclick = ()=>{ logout(); location.href="./"; };
    $("commentSend").onclick = sendComment;
    $("commentInput").addEventListener("keydown", (e)=>{ if(e.key==="Enter") sendComment(); });
    $("cmLoadMoreInline").onclick = ()=>loadComments(false);

    // Leaderboard interactivity
    $("lbSearch")?.addEventListener("input", (e)=>{
      lbQuery = e.target.value || "";
      renderLeaderboard();
    });
    $("lbOnlyMe")?.addEventListener("click", (e)=>{
      lbMeOnly = !lbMeOnly;
      e.currentTarget.setAttribute("aria-pressed", String(lbMeOnly));
      e.currentTarget.classList.toggle("active", lbMeOnly);
      renderLeaderboard();
    });
    // Click to spotlight a user in the table/podium
    function pickUser(loginId){
      if(!loginId) return;
      lbQuery = String(loginId);
      const inp = $("lbSearch");
      if(inp) inp.value = lbQuery;
      renderLeaderboard();
    }
    $("lbPodium")?.addEventListener("click", (e)=>{
      const b = e.target.closest("[data-pick]");
      if(b) pickUser(b.getAttribute("data-pick"));
    });
    $("lbBody")?.addEventListener("click", (e)=>{
      const r = e.target.closest("[data-pick]");
      if(r) pickUser(r.getAttribute("data-pick"));
    });

    async function boot(){
      setupTouchFab();
      setupLevelUpModal();

      try{
        const r = await me();
        const u = r.user;
        $("userId").textContent = u.loginId;
        $("userName").textContent = (u.name||u.loginId||"").trim().split(/\s+/)[0] || "";
        $("userPoints").textContent = String(u.points ?? 0);
        updateMedalUI(u.points ?? 0);
        $("userBalance").textContent = String(u.balance ?? 0);
        $("userAge").textContent = calcAgePrecise(u.birthdate);

        myLoginId = u.loginId;
        await refreshUnread();

        // Single-page sections
        setupHeroVideo();
        setupChallenge();
        if (typeof setupTestSearch === "function") setupTestSearch();
        if (typeof setupSimSearch === "function") setupSimSearch();
/* tests removed */
        if (typeof renderSims === "function") renderSims();

        // Embedded viewer modal
        $("embedClose")?.addEventListener("click", closeEmbed);
        $("embedModal")?.addEventListener("click", (e)=>{ if(e.target===$("embedModal")) closeEmbed(); });

        loadLeaderboard();
        loadComments(true);

        if(!u.profileComplete){
          await runOnboarding();
          const r2 = await me();
          $("userName").textContent = r2.user.name || r2.user.loginId;
          $("userAge").textContent = calcAgePrecise(r2.user.birthdate);
          updateMedalUI(r2.user.points ?? 0);
        }
      }catch(e){
        // 403: token bor, lekin profil to‘liq emas (yangi user). Redirect qilmaymiz, onboarding ochamiz.
        if (e && (e.status === 403)) {
          try{
            await runOnboarding();
            const r2 = await me();
            const u2 = r2.user;
            $("userId").textContent = u2.loginId;
            $("userName").textContent = (u2.name||u2.loginId||"").trim().split(/\s+/)[0] || "";
            $("userPoints").textContent = String(u2.points ?? 0);
            updateMedalUI(u2.points ?? 0);
            $("userBalance").textContent = String(u2.balance ?? 0);
            $("userAge").textContent = calcAgePrecise(u2.birthdate);
            myLoginId = u2.loginId;
            await refreshUnread();
            loadLeaderboard();
            loadComments(true);
            return;
          }catch(e2){
            toast(e2.message || "Profilni to‘ldirishda xatolik");
            return;
          }
        }
        toast(e.message||"Kirish yo‘q");
        setTimeout(()=>location.href="./", 600);
      }
    }
    
    function setupTouchFab(){
      
      // --- Reyting & Izohlar (bottom dock) ---
      const ratingModal = $("ratingModal");
      const commentModal = $("commentModal");

      function openModal(overlayEl, focusId){
        if(!overlayEl) return;
        overlayEl.setAttribute("aria-hidden","false");
        overlayEl.classList.add("open");
        document.body.classList.add("noScroll");
        if(focusId) setTimeout(()=>$(focusId)?.focus(), 50);
      }
      function closeModal(overlayEl){
        if(!overlayEl) return;
        overlayEl.setAttribute("aria-hidden","true");
        overlayEl.classList.remove("open");
        document.body.classList.remove("noScroll");
      }

      // Open buttons
      $("openRating")?.addEventListener("click", ()=> openModal(ratingModal, "ratingClose"));
      $("openRatingInline")?.addEventListener("click", ()=> openModal(ratingModal, "ratingClose"));

      const openCommentsAny = ()=>{
        openModal(commentModal, "commentClose");
        try{ markCommentsSeen(); }catch(_){ }
      };
      $("openCommentsDock")?.addEventListener("click", openCommentsAny);
      $("openComments")?.addEventListener("click", openCommentsAny);

      // Close buttons
      $("ratingClose")?.addEventListener("click", ()=>closeModal(ratingModal));
      $("commentClose")?.addEventListener("click", ()=>closeModal(commentModal));

      // Click outside to close
      ratingModal?.addEventListener("click", (e)=>{ if(e.target===ratingModal) closeModal(ratingModal); });
      commentModal?.addEventListener("click", (e)=>{ if(e.target===commentModal) closeModal(commentModal); });

      // Esc
      document.addEventListener("keydown", (e)=>{
        if(e.key!=="Escape") return;
        if(ratingModal?.classList.contains("open")) closeModal(ratingModal);
        if(commentModal?.classList.contains("open")) closeModal(commentModal);
      });
    }

    boot();

  </script>
<script>
/* ===== Challenge from challenge.json (list + timer) ===== */
(function(){
  const box = document.getElementById('challengeList');
  if(!box) return;

  const parseT = (v)=>{
    if(v===null || v===undefined || v==='') return NaN;

    // Firestore Timestamp-like objects
    if(typeof v==='object'){
      if(typeof v.toDate==='function'){
        const t = v.toDate().getTime();
        return isNaN(t) ? NaN : t;
      }
      if(typeof v.seconds==='number'){
        const t = v.seconds * 1000;
        return isNaN(t) ? NaN : t;
      }
    }

    if(typeof v==='number') return v;

    const s = String(v).trim();

    // Support 'YYYY-MM-DD HH:mm' (assume Asia/Tashkent +05:00)
    const m = s.match(/^(\d{4})-(\d{2})-(\d{2})[ T](\d{2}):(\d{2})(?::(\d{2}))?$/);
    if(m){
      const iso = `${m[1]}-${m[2]}-${m[3]}T${m[4]}:${m[5]}:${m[6]||'00'}+05:00`;
      const t = new Date(iso).getTime();
      return isNaN(t) ? NaN : t;
    }

    const t = new Date(s).getTime();
    return isNaN(t) ? NaN : t;
  };
  const pad2 = n => String(n).padStart(2,'0');
  const fmt = (ms)=>{
    ms = Math.max(0, ms|0);
    const s = Math.floor(ms/1000);
    const d = Math.floor(s/86400);
    const h = Math.floor((s%86400)/3600);
    const m = Math.floor((s%3600)/60);
    const ss = s%60;
    if(d>0) return `${d} kun ${pad2(h)}:${pad2(m)}:${pad2(ss)}`;
    return `${pad2(h)}:${pad2(m)}:${pad2(ss)}`;
  };

  function classify(c, now){
    const s = parseT(c.startAt);
    const e = parseT(c.endAt);
    if(!isNaN(s) && !isNaN(e)){
      if(now>=s && now<=e) return 'live';
      if(now<s) return 'upcoming';
      return 'ended';
    }
    // fallback: status field
    const st = (c.status||'').toLowerCase();
    if(st==='live') return 'live';
    if(st==='upcoming') return 'upcoming';
    return 'ended';
  }

  function render(list){
    const now = Date.now();
    const scored = list.map(c=>{
      const cls = classify(c, now);
      const s = parseT(c.startAt);
      const e = parseT(c.endAt);
      const w = cls==='live'?0:cls==='upcoming'?1:2;
      return {c, cls, s, e, w};
    }).sort((a,b)=>{
      if(a.w!==b.w) return a.w-b.w;
      const ta = a.cls==='ended' ? -a.e : a.s;
      const tb = b.cls==='ended' ? -b.e : b.s;
      return (ta||0) - (tb||0);
    });

    if(!scored.length){
      box.innerHTML = '<div class="muted">Challenge yo‘q</div>';
      return;
    }

    box.innerHTML = scored.map(({c,cls,s,e})=>{
      const badgeClass = cls==='live'?'badgeLive':cls==='upcoming'?'badgeUp':'badgeEnd';
      const badgeText  = cls==='live'?'LIVE':cls==='upcoming'?'KUTILMOQDA':'TUGAGAN';
      const btnText = (cls==='live') ? (c.cta || 'Boshlash') : (cls==='upcoming' ? 'Tez kunda' : 'Yakunlandi');
      const href = c.href || '#';
      const icon = c.icon || 'logo.webp';
      const disabled = (cls!=='live') ? 'disabled' : '';
      const timerAttr = cls==='live' ? `data-end="${e}"` : (cls==='upcoming'?`data-start="${s}"`:'');
      const timerLabel = cls==='live' ? 'Tugashiga' : (cls==='upcoming' ? 'Boshlanishiga' : '');
      const timerHtml = timerAttr ? `<div class="timerLine">${timerLabel}: <b ${timerAttr}></b></div>` : `<div class="timerLine"></div>`;
      return `
        <div class="challengeCard">
          <div class="left">
            <div class="challengeLogo"><img class="challengeLogoImg" src="${icon}" alt=""></div>
            <div class="challengeMeta">
              <div class="kicker">CHALLENGE</div>
              <div class="ttl">${(c.title||'').replace(/</g,'&lt;')}</div>
              <div class="badges">
                <span class="badgePill ${badgeClass}">${badgeText}</span>
                <span class="badgePill">${(c.id||'').replace(/</g,'&lt;')}</span>
              </div>
            </div>
          </div>
          <div class="challengeRight">
            ${timerHtml}
            <button class="challengeBtn" ${disabled} onclick="location.href='${href}'">${btnText} →</button>
          </div>
        </div>
      `;
    }).join('');

    setInterval(()=>{
      const now = Date.now();
      document.querySelectorAll('[data-end]').forEach(el=>{
        const e = +el.getAttribute('data-end');
        el.textContent = fmt(e-now);
      });
      document.querySelectorAll('[data-start]').forEach(el=>{
        const s = +el.getAttribute('data-start');
        el.textContent = fmt(s-now);
      });
    }, 1000);
  }

  fetch('./challenge.json', {cache:'no-store'})
    .then(r=> r.ok ? r.json() : [])
    .then(data=> render(Array.isArray(data)?data:[]))
    .catch(()=> box.innerHTML='<div class="muted">challenge.json topilmadi</div>');
})();

/* ===== Content from content.json (big chips + tags + search) ===== */
(function(){
  const bigRow = document.getElementById('bigChipsRow');
  const tagRow = document.getElementById('tagChipsRow');
  const grid   = document.getElementById('grid');
  const empty  = document.getElementById('empty');
  const info   = document.getElementById('resultInfo');
  const qInp   = document.getElementById('q');
  const clear  = document.getElementById('clearBtn');
  const sToggle= document.getElementById('searchToggle');
  const sWrap  = document.getElementById('searchWrap');
  if(!bigRow || !tagRow || !grid || !qInp) return;

  const state = { data:null, type:null, tag:'all', q:'' };

  const norm = s => (s||'').toString().trim().toLowerCase().replace(/\s+/g,' ');
  const esc = s => (s||'').toString().replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;').replaceAll("'","&#039;");

  // Anti-autofill hardening
  qInp.setAttribute('readonly','readonly');
  setTimeout(()=> qInp.removeAttribute('readonly'), 250);

  // Search opens only when 🔎 pressed
  const showSearch = ()=>{
    if(!sWrap) return;
    sWrap.classList.remove('isHidden');
    try{ qInp.focus({preventScroll:true}); }catch(e){ qInp.focus(); }
  };
  const hideSearch = ()=>{
    if(!sWrap) return;
    if((qInp.value||'').trim()) return; // keep open if there is text
    sWrap.classList.add('isHidden');
  };
  if(sToggle){
    sToggle.addEventListener('click', ()=>{
      if(!sWrap) return;
      if(sWrap.classList.contains('isHidden')) showSearch();
      else hideSearch();
    });
  }
  qInp.addEventListener('blur', ()=> setTimeout(hideSearch, 120));
  const killAuto = ()=>{
    const v = (qInp.value||'').trim();
    if(/^LM-\d+/i.test(v) || /^LM\d+/i.test(v)) qInp.value='';
  };
  window.addEventListener('pageshow', ()=> setTimeout(killAuto, 50));
  qInp.addEventListener('focus', ()=> setTimeout(killAuto, 20));
  setTimeout(killAuto, 50); setTimeout(killAuto, 300); setTimeout(killAuto, 1200);

  const countByType = (id)=> {
    const items = (state.data?.items||[]);
    if(id==='all') return items.length;
    return items.filter(it=> norm(it.type)===id).length;
  };
  const tagsInType = ()=>{
    const set = new Set();
    (state.data?.items||[]).filter(it=> state.type==='all' ? true : (norm(it.type)===state.type)).forEach(it=>{
      (it.tags||[]).forEach(t=> set.add(norm(t)));
    });
    return [...set].filter(Boolean).sort((a,b)=>a.localeCompare(b));
  };
  const countByTag = (t)=>{
    const items = (state.data?.items||[]).filter(it=> norm(it.type)===state.type);
    if(t==='all') return items.length;
    return items.filter(it=> (it.tags||[]).map(norm).includes(t)).length;
  };

  function setActive(container, id){
    [...container.children].forEach(el=> el.classList.toggle('active', el.dataset.id===id));
  }

  function renderBig(){
    const chips = (state.data?.bigChips||[]).map(c=> ({...c, id:norm(c.id)}));
    if(!state.type && chips.length) state.type = chips[0].id;

    const isImg = (v)=>/\.(png|jpe?g|webp|svg)$/i.test((v||'').trim());

    bigRow.innerHTML = chips.map(c=>{
      const cnt = countByType(c.id);
      const iconVal = c.iconImg || c.iconPath || c.icon || '';
      const iconHtml = isImg(iconVal)
        ? `<img src="${esc(iconVal)}" alt="" loading="lazy"/>`
        : `<span class="emoji">${esc(iconVal || '✨')}</span>`;
      return `<div class="bigChip ${c.id===state.type?'active':''}" data-id="${c.id}">
        <div class="ico">${iconHtml}</div>
        <div class="tWrap"><b>${esc(c.title||c.id)}</b><small>${cnt} ta</small></div>
        <div class="count">${cnt}</div>
      </div>`;
    }).join('');

    bigRow.querySelectorAll('.bigChip').forEach(el=>{
      el.addEventListener('click', ()=>{
        state.type = el.dataset.id;
        state.tag = 'all';
        setActive(bigRow, state.type);
        renderTags();
        renderCards();
      });
    });
  }

  function renderTags(){
    const tags = ['all', ...tagsInType()];
    tagRow.innerHTML = tags.map(t=>{
      const label = t==='all' ? 'Hammasi' : t;
      const cnt = countByTag(t);
      return `<div class="tagChip ${t===state.tag?'active':''}" data-id="${t}">
        <span>${esc(label)}</span><span class="tCount">${cnt}</span>
      </div>`;
    }).join('');

    tagRow.querySelectorAll('.tagChip').forEach(el=>{
      el.addEventListener('click', ()=>{
        state.tag = el.dataset.id;
        setActive(tagRow, state.tag);
        renderCards();
      });
    });
  }

  function getFiltered(){
    const q = norm(state.q);
    return (state.data?.items||[])
      .filter(it=> norm(it.type)===state.type)
      .filter(it=>{
        if(state.tag!=='all'){
          const tags = (it.tags||[]).map(norm);
          if(!tags.includes(state.tag)) return false;
        }
        if(q){
          const hay = [it.title,it.desc,it.type,(it.tags||[]).join(' ')].map(norm).join(' | ');
          if(!hay.includes(q)) return false;
        }
        return true;
      })
      .sort((a,b)=>(b.order||0)-(a.order||0));
  }

  function renderCards(){
    const list = getFiltered();
    info.textContent = `Natija: ${list.length} ta`;
    if(!list.length){
      grid.innerHTML='';
      empty.style.display='block';
      return;
    }
    empty.style.display='none';

    const isImg = (v)=>/\.(png|jpe?g|webp|svg)$/i.test((v||'').trim());

    grid.innerHTML = list.map(it=>{
      const tags = (it.tags||[]).slice(0,6).map(t=>`<span class="cardTag">${esc(t)}</span>`).join('');
      const href = it.href || '#';
      const btn = `<a class="openBtn" href="${esc(href)}">Ochish →</a>`;
      const iconVal = it.icon || it.iconPath || it.iconImg || '';
      const iconHtml = isImg(iconVal)
        ? `<img src="${esc(iconVal)}" alt="" loading="lazy"/>`
        : `<span class="emoji">${esc(iconVal || '📦')}</span>`;

      return `<div class="contentCard">
        <div class="cardTop">
          <div class="cardThumb">${iconHtml}</div>
          <div class="cardHead">
            <h3>${esc(it.title||'')}</h3>
            <p>${esc(it.desc||'')}</p>
          </div>
        </div>
        <div class="cardTags">${tags}</div>
        ${btn}
      </div>`;
    }).join('');
  }

  let t=null;
  qInp.addEventListener('input', ()=>{
    clearTimeout(t);
    t=setTimeout(()=>{ state.q=qInp.value; renderCards(); }, 120);
  });

  clear.addEventListener('click', ()=>{
    qInp.value=''; state.q=''; state.tag='all';
    renderTags();
    renderCards();
  });

  fetch('./content.json', {cache:'no-store'})
    .then(r=> r.ok ? r.json() : null)
    .then(data=>{
      state.data = data || {bigChips:[], items:[]};
      renderBig(); renderTags(); renderCards();
    })
    .catch(()=>{ info.textContent='Kontent yuklanmadi'; });
})();
</script>

<!-- Izohlar tugmasi (doim ko‘rinadi) -->
<div class="commentsDock" id="commentsDock" aria-label="Izohlar">
  <button class="dockPill" id="openCommentsDock" type="button" aria-label="Izohlar" title="Izohlar">
  <span class="dockGlow" aria-hidden="true"></span>
  <span class="dockIcon" aria-hidden="true">💬</span>
  <span class="dockText">Izoh</span>
  <span class="dockBadge" id="cmBadge" style="display:none">1</span>
</button>
</div>

<script>
(function(){
  const toastEl = document.getElementById('toast');
  function lmToast(msg){
    if(!toastEl){ return; }
    toastEl.textContent = msg;
    toastEl.classList.add('show');
    clearTimeout(window.__lmT);
    window.__lmT = setTimeout(()=>toastEl.classList.remove('show'), 1700);
  }
  window.lmQuickNav = function(which){
    const map = {
      challenges: ['#challengeSection', '#challengeList', '[data-type="challenges"]', '[data-kind="challenges"]'],
      tests: ['#testsSection', '#testsList', '[data-type="tests"]', '[data-kind="tests"]']
    };
    const sels = map[which] || [];
    let el = null;
    for(const s of sels){
      el = document.querySelector(s);
      if(el) break;
    }
    if(el){
      el.scrollIntoView({behavior:'smooth', block:'start'});
      lmToast(which === 'challenges' ? "⚡ Challenge bo‘limi" : "🧠 Testlar bo‘limi");
    }else{
      lmToast("Bo‘lim topilmadi (layoutni ayting — moslab qo‘yaman)");
    }
  };
})();
</script>

</body>
</html>