<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Test Tizimi - Xavfsizlik rejimi</title>
    
    <!-- MathJax 3 -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                packages: {'[+]': ['boldsymbol', 'ams']}
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
                ignoreHtmlClass: 'tex2jax_ignore',
                processHtmlClass: 'tex2jax_process'
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore-compat.js"></script>
    
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- BANNERLAR -->
    <div class="top-banner" id="topBanner"></div>
    <div class="bottom-banner" id="bottomBanner"></div>
    
    <!-- TEST HEADER -->
    <div id="testHeader" class="test-header hidden">
        <div class="student-info-card">
            <div class="student-name"><span>üë§</span><span id="headerStudentName">-</span></div>
            <div class="student-class"><span>üè´</span><span id="headerStudentClass">-</span></div>
        </div>
        <div class="test-info-card">
            <div class="current-section" id="currentSectionName">Umumiy</div>
            <div class="question-points"><span>‚≠ê</span><span id="currentQuestionPoints">0 ball</span></div>
        </div>
        <div class="violation-info-card">
            <div class="violation-count"><span>‚ö†Ô∏è</span><span>Qoidabuzarlik: <span id="violationCount">0</span></span></div>
            <div class="timer-display"><span>‚è±Ô∏è</span><span id="headerTimer">00:00</span></div>
        </div>
    </div>
    
    <!-- XAVFSIZLIK MONITOR -->
    <div id="securityMonitor" class="security-monitor hidden">
        <div class="warning-icon">‚ö†Ô∏è</div>
        <span id="monitorText">Xavfsizlik rejimi faol</span>
    </div>
    
    <!-- VIOLATION HISTORY -->
    <div id="violationHistoryPanel" class="violation-history-panel">
        <div class="violation-history-header">Qoidabuzarliklar tarixi:</div>
        <div id="violationHistoryList"></div>
    </div>
    
    <!-- MATH EDITOR MODAL -->
    <div id="mathModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> Matematik Formula Tahrirlagich</h3>
                <button class="modal-close" onclick="closeMathModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <iframe id="mathEditorFrame" 
                        src="math-editor.html"
                        title="Matematik formula tahrirlagich"></iframe>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeMathModal()">
                    <i class="fas fa-times"></i> Bekor qilish
                </button>
                <button class="btn btn-success" onclick="saveMathAnswer()">
                    <i class="fas fa-check"></i> Saqlash
                </button>
            </div>
        </div>
    </div>
    
    <!-- ASOSIY KONTENT -->
    <div class="wrap">
        <div class="card-container">
            <!-- LOADING -->
            <div id="loadingScreen" class="card">
                <div style="text-align: center;">
                    <div class="loading-spinner"></div>
                    <h2>Yuklanmoqda...</h2>
                    <p>Xavfsizlik tizimlari faollashtirilmoqda...</p>
                </div>
            </div>
            
            <!-- KOD KIRITISH -->
            <div id="codeInputCard" class="card hidden">
                <h1>üìù Test Tizimi</h1>
                <p style="text-align: center; margin-bottom: 20px;">Professional matematik test tizimi</p>
                <div class="input-group">
                    <label for="testCodeInput">Test kodini kiriting</label>
                    <input type="text" id="testCodeInput" placeholder="Masalan: 8001" maxlength="10" autocomplete="off">
                </div>
                <button id="loadTestBtn" class="btn">üîç Testni Yuklash</button>
            </div>
            
            <!-- SINFLAR -->
            <div id="classSelectionCard" class="card hidden">
                <h2>üéì Sinfni Tanlang</h2>
                <p style="margin-bottom: 15px;">O'qish sinfingizni tanlang:</p>
                <div class="input-group">
                    <label for="classSelect">Sinf</label>
                    <select id="classSelect"></select>
                </div>
                <div class="btn-group">
                    <button id="backToCodeBtn" class="btn btn-secondary">‚¨ÖÔ∏è Orqaga</button>
                    <button id="nextToStudentBtn" class="btn">‚û°Ô∏è Keyingi</button>
                </div>
            </div>
            
            <!-- O'QUVCHILAR -->
            <div id="studentSelectionCard" class="card hidden">
                <h2>üë§ O'quvchini Tanlang</h2>
                <p style="margin-bottom: 15px;">Ism familiyangizni tanlang:</p>
                <div class="input-group">
                    <label for="studentSelect">O'quvchi</label>
                    <select id="studentSelect"></select>
                </div>
                <div class="btn-group">
                    <button id="backToClassBtn" class="btn btn-secondary">‚¨ÖÔ∏è Orqaga</button>
                    <button id="nextToIntroBtn" class="btn">‚û°Ô∏è Keyingi</button>
                </div>
            </div>
            
            <!-- KIRISH -->
            <div id="introCard" class="card hidden">
                <h1 id="testTitle">üìã Test Ma'lumotlari</h1>
                <p id="testDescription" style="text-align: center; margin-bottom: 20px;"></p>
                
                <!-- OLDIN URINISH -->
                <div id="alreadyAttemptedWarning" class="already-attempted-warning hidden">
                    <h3>‚ö†Ô∏è Diqqat!</h3>
                    <p>Siz bu testni <strong id="attemptDate">oldin</strong> ishlagansiz.</p>
                    <div id="previousResult" class="previous-result hidden">
                        <p><strong>Oldingi natija:</strong> <span id="previousScore">0</span> ball</p>
                        <p><strong>Vaqt:</strong> <span id="previousTime">00:00</span></p>
                    </div>
                    <p style="margin-top: 10px; color: #b45309; font-weight: 600;">Har bir o'quvchi testni faqat bir marta ishlash huquqiga ega!</p>
                </div>
                
                <!-- TEST INFO -->
                <div class="test-info-grid">
                    <div class="info-card"><div class="info-label">Savollar soni</div><div class="info-value" id="totalQuestions">0</div></div>
                    <div class="info-card"><div class="info-label">Vaqt</div><div class="info-value" id="testDuration">0 daq</div></div>
                    <div class="info-card"><div class="info-label">Umumiy ball</div><div class="info-value" id="totalPoints">0</div></div>
                    <div class="info-card"><div class="info-label">Bo'limlar</div><div class="info-value" id="testSections">0</div></div>
                </div>
                
                <div id="sectionList" style="margin: 15px 0;"></div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <div id="selectedStudentInfo" style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 12px; border-radius: 6px; margin-bottom: 15px; border-left: 4px solid var(--brand);">
                        <strong>üë§ Tanlangan o'quvchi:</strong> <br>
                        <span id="studentName" style="font-size: 16px; font-weight: 600; color: var(--brand-dark);">-</span>
                    </div>
                    <button id="startTestBtn" class="btn">üöÄ Testni Boshlash</button>
                    <button id="viewPreviousAttemptBtn" class="btn btn-secondary hidden" style="margin-top: 10px;">üìã Oldingi Natijani Ko'rish</button>
                </div>
            </div>
            
            <!-- SAVOLLAR -->
            <div id="questionCard" class="card hidden">
                <div class="question-content-wrapper">
                    <div class="question-main-content">
                        <!-- SAVOL HEADER -->
                        <div class="question-header">
                            <div class="question-number-with-indicator">
                                <!-- KATTA SAVOL RAQAMI -->
                                <div class="q-number-large" id="currentQ">1</div>
                                
                                <!-- KATTA KO'Z/KO'RSATKICH -->
                                <div class="view-indicator-large" id="viewIndicator">
                                    <span id="viewIcon">üëÅÔ∏è</span>
                                </div>
                                
                                <!-- SECTION CHIP -->
                                <div class="section-display" id="sectionNameDisplay">Umumiy</div>
                            </div>
                            
                            <div class="timer" id="timer">00:00</div>
                        </div>
                        
                        <!-- RASM -->
                        <div id="questionImageContainer" class="image-container hidden">
                            <img id="questionImage" class="question-image hidden" alt="Savol rasmi">
                            <div id="imageNotFound" class="image-placeholder">Savol yuklanmoqda...</div>
                        </div>
                        
                        <!-- SAVOL MATNI -->
                        <div id="questionText" style="font-size: 16px; line-height: 1.6; padding: 15px; background: #f8f9fa; border-radius: 6px;"></div>
                        
                        <!-- VARIANTLAR -->
                        <div id="optionsContainer" class="options-grid hidden"></div>
                        
                        <!-- OCHIQ JAVOB -->
                        <div id="openAnswerContainer" class="hidden">
                            <!-- Javob ko'rinishi -->
                            <div id="answerPreview" class="answer-preview empty">
                                <div id="answerPreviewContent" class="answer-preview-content"></div>
                            </div>
                            
                            <!-- Matematik editor ochish tugmasi -->
                            <button id="openMathEditorBtn" class="math-answer-btn">
                                <i class="fas fa-calculator"></i> Matematik javob yozish
                            </button>
                            
                            <!-- Javobni o'chirish tugmasi -->
                            <button id="clearAnswerBtn" class="btn btn-secondary" style="display: none;">
                                <i class="fas fa-trash"></i> Javobni o'chirish
                            </button>
                        </div>
                        
                        <!-- OGOHLANTIRISH -->
                        <div id="viewWarning" class="view-warning hidden">
                            <div id="warningContent"></div>
                        </div>
                        
                        <!-- NAVIGATION -->
                        <div class="btn-group">
                            <button id="prevBtn" class="btn btn-secondary">‚¨ÖÔ∏è Oldingi</button>
                            <button id="nextBtn" class="btn">‚û°Ô∏è Keyingi</button>
                            <button id="finishBtn" class="btn btn-danger">‚úÖ Testni Yakunlash</button>
                        </div>
                    </div>
                    
                    <!-- VERTICAL NAV DOTS -->
                    <div class="vertical-nav-dots" id="verticalNavDots"></div>
                </div>
            </div>
            
            <!-- NATIJALAR -->
            <div id="resultsCard" class="card hidden">
                <div class="results-container">
                    <div class="score-circle">
                        <span id="finalScore">0</span>
                        <small>ball</small>
                    </div>
                    <h1 id="resultsTitle">üéâ Test Yakunlandi!</h1>
                    <div class="results-grid">
                        <div class="result-card"><div class="result-label">‚úÖ To'g'ri javoblar</div><div class="result-value" id="correctCount">0</div></div>
                        <div class="result-card"><div class="result-label">‚ùå Noto'g'ri javoblar</div><div class="result-value" id="wrongCount">0</div></div>
                        <div class="result-card"><div class="result-label">üìä Umumiy ball</div><div class="result-value" id="totalScoreResult">0</div></div>
                        <div class="result-card"><div class="result-label">‚è±Ô∏è Sarflangan vaqt</div><div class="result-value" id="timeUsed">00:00</div></div>
                    </div>

                    <!-- POINTS STATUS (umumiy ballga qo'shildi/qo'shilmadi) -->
                    <div id="pointsStatus" class="points-status" aria-live="polite"></div>

                    <div id="sectionScoreBreakdown" class="section-breakdown"></div>
                    
                    <!-- NATIJA TUGMALARI -->
                    <div class="results-buttons">
                        <button id="restartBtn" class="btn">
                            <i class="fas fa-redo"></i> Boshqa Test Yechish
                        </button>
                        <button id="homeBtn" class="btn btn-secondary" onclick="window.location.href = window.location.pathname">
                            <i class="fas fa-home"></i> Bosh Sahifaga Qaytish
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- FULLSCREEN WARNING -->
    <div id="fullscreenWarning" class="fullscreen-warning hidden">
        <h3>‚ö†Ô∏è FULL SCREEN TAVSIYA ETILADI!</h3>
        <p>Testni to'liq ekranda davom ettirishingiz tavsiya etiladi.</p>
        <p><strong>F11 tugmasini bosing</strong> yoki brauzer oynasining yuqori o'ng burchagidagi full screen tugmasini bosing.</p>
        <button onclick="enableMandatoryFullScreen()" class="btn">‚úÖ Full Screen Yoqish</button>
        <p style="margin-top: 10px; font-size: 12px; color: rgba(255,255,255,0.7);">Test to'liq ekranda davom etsa, yaxshi tajriba bo'ladi.</p>
    </div>
    
    <!-- Font Awesome icons -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <script src="js/01-config.js"></script>
    <script src="js/02-state.js"></script>
    <script src="js/03-utils.js"></script>
    <script src="js/04-dom.js"></script>
    <script src="js/05-modal.js"></script>
    <script src="js/06-firebase.js"></script>
    <script src="js/07-security.js"></script>
    <script src="js/08-fullscreen.js"></script>
    <script src="js/09-user-actions.js"></script>
    <script src="js/10-test-manager.js"></script>
    <script src="js/11-banner.js"></script>
    <script src="js/12-message-handler.js"></script>
    <script src="js/15-leadermath-auth.js"></script>
    <script src="js/13-event-handlers.js"></script>
    <script src="js/14-app-init.js"></script>
    <script src="js/15-globals.js"></script>
    <script src="js/16-start.js"></script>

    
    

<script>
  // UI micro-interaction: button highlight follows pointer (no functional impact)
  document.addEventListener('pointermove', (e) => {
    const b = e.target && e.target.closest && e.target.closest('.btn');
    if (!b) return;
    const r = b.getBoundingClientRect();
    const x = ((e.clientX - r.left) / r.width) * 100;
    const y = ((e.clientY - r.top) / r.height) * 100;
    b.style.setProperty('--x', x.toFixed(1) + '%');
    b.style.setProperty('--y', y.toFixed(1) + '%');
  }, {passive:true});
</script>

</body>
</html>