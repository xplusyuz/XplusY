<!doctype html>
<html lang="uz">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LeaderMath ‚Äî Kontent</title>
  <style>
    :root{
      --bg1:#f6fbff;
      --bg2:#ffffff;
      --glass: rgba(255,255,255,.72);
      --glass2: rgba(255,255,255,.58);
      --stroke: rgba(20,40,60,.12);
      --text:#0f172a;
      --muted: rgba(15,23,42,.65);
      --brand:#2E8B57;
      --shadow: 0 14px 38px rgba(15,23,42,.10);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans";
      color:var(--text);
      background:
        radial-gradient(1100px 700px at 15% -10%, rgba(46,139,87,.16), transparent 55%),
        radial-gradient(900px 600px at 110% 10%, rgba(59,130,246,.14), transparent 52%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      min-height:100vh;
    }
    .wrap{max-width:1100px;margin:0 auto;padding:18px 14px 34px}
    .panel{
      background: var(--glass);
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      overflow:hidden;
    }
    .topbar{
      display:flex; gap:12px; align-items:center; justify-content:space-between;
      padding:14px 14px 10px;
    }
    .title{display:flex; flex-direction:column; gap:2px;}
    .title h1{margin:0;font-size:16px;letter-spacing:.2px}
    .title p{margin:0;font-size:12px;color:var(--muted)}
    .search{flex:1; max-width:420px; position:relative;}
    .search input{
      width:100%;
      padding:11px 12px 11px 40px;
      border-radius: 14px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.85);
      outline:none;
      font-size:14px;
    }
    .search .icon{
      position:absolute; left:12px; top:50%; transform:translateY(-50%);
      font-size:16px; opacity:.75;
    }

    .chips{padding:0 14px 12px; display:flex; flex-direction:column; gap:10px;}

    /* GORIZONTAL SCROLL ‚Äî aniq */
    .row{
      display:flex; gap:10px;
      overflow-x:auto; overflow-y:hidden;
      padding-bottom:4px;
      -webkit-overflow-scrolling: touch;
      scroll-snap-type: x proximity;
      overscroll-behavior-x: contain;
      scrollbar-width: none;
      cursor: grab;
      user-select:none;
    }
    .row:active{cursor: grabbing;}
    .row::-webkit-scrollbar{display:none;}
    .row > * { scroll-snap-align: start; }

    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 12px;
      border-radius: 999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.75);
      cursor:pointer;
      user-select:none;
      white-space:nowrap;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
      font-size:13px;
      flex: 0 0 auto; /* MUHIM: scroll uchun */
    }
    .chip:active{transform: scale(.98)}
    .chip.active{
      background: rgba(46,139,87,.14);
      border-color: rgba(46,139,87,.28);
    }
    .chip .dot{width:8px;height:8px;border-radius:50%;background: rgba(46,139,87,.65);display:inline-block;}
    .chip.small{padding:8px 10px;font-size:12px;background: rgba(255,255,255,.68)}
    .chip.small.active{background: rgba(59,130,246,.12); border-color: rgba(59,130,246,.22)}
    .chip .count{
      font-size:12px;
      padding:2px 8px;
      border-radius:999px;
      background: rgba(15,23,42,.08);
      color: rgba(15,23,42,.75);
    }

    .meta{
      display:flex; gap:10px; justify-content:space-between; align-items:center;
      padding: 0 14px 12px;
      color: var(--muted);
      font-size: 12px;
    }
    .meta .btn{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.75);
      border-radius: 12px;
      padding:8px 10px;
      cursor:pointer;
      user-select:none;
    }

    .grid{
      padding: 12px 14px 16px;
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 12px;
    }
    .card{
      grid-column: span 6;
      background: var(--glass2);
      border: 1px solid var(--stroke);
      border-radius: 16px;
      padding: 12px;
      box-shadow: 0 10px 24px rgba(15,23,42,.08);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      display:flex; flex-direction:column; gap:10px;
      min-height: 112px;
      position:relative;
      overflow:hidden;
    }
    .card h3{margin:0;font-size:14px;line-height:1.25}
    .card p{margin:0;font-size:12px;color:var(--muted);line-height:1.4}
    .head{display:flex; align-items:flex-start; justify-content:space-between; gap:10px;}
    .badge{
      font-size:11px;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid rgba(46,139,87,.22);
      background: rgba(46,139,87,.12);
      color: rgba(25,90,55,1);
      white-space:nowrap;
      flex:0 0 auto;
    }
    .badge.soon{
      border-color: rgba(245,158,11,.26);
      background: rgba(245,158,11,.14);
      color: rgba(130,80,10,1);
    }
    .actions{display:flex; gap:8px; flex-wrap:wrap; align-items:center}
    .tag{
      font-size:11px;
      padding:4px 8px;
      border-radius:999px;
      border:1px dashed rgba(15,23,42,.16);
      background: rgba(255,255,255,.60);
      color: rgba(15,23,42,.72);
    }
    .go{
      margin-left:auto;
      display:inline-flex; align-items:center; gap:8px;
      padding:9px 10px;
      border-radius: 12px;
      border: 1px solid rgba(46,139,87,.22);
      background: rgba(46,139,87,.12);
      cursor:pointer;
      text-decoration:none;
      color: rgba(25,90,55,1);
      font-size: 12px;
      font-weight: 600;
      flex:0 0 auto;
    }
    .go.disabled{
      pointer-events:none;
      opacity:.65;
      border-color: rgba(245,158,11,.26);
      background: rgba(245,158,11,.12);
      color: rgba(130,80,10,1);
    }
    .empty{padding: 18px 14px 22px; color: var(--muted); font-size: 13px;}

    @media (max-width: 820px){
      .topbar{flex-direction:column;align-items:stretch}
      .search{max-width:none}
      .card{grid-column: span 12}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="panel">
      <div class="topbar">
        <div class="title">
          <h1>Kontent katalog</h1>
          <p>Katta chip ‚Üí tag ‚Üí qidiruv</p>
        </div>

        <div class="search">
          <div class="icon">üîé</div>
          <input id="q" type="search" placeholder="Qidiruv: ko'phad, kvadrat, latex..." autocomplete="off" />
        </div>
      </div>

      <div class="chips">
        <div class="row" id="bigChipsRow" aria-label="Katta chiplar"></div>
        <div class="row" id="tagChipsRow" aria-label="Tag chiplar"></div>
      </div>

      <div class="meta">
        <div id="resultInfo">Yuklanmoqda...</div>
        <div class="btn" id="clearBtn">Tozalash</div>
      </div>

      <div class="grid" id="grid"></div>
      <div class="empty" id="empty" style="display:none;">Hech narsa topilmadi. Tag/qidiruvni o‚Äòzgartirib ko‚Äòring.</div>
    </div>
  </div>

<script>
(() => {
  const state = {
    data: null,
    activeType: null,  // endi "all" yo‚Äòq
    activeTag: "all",
    query: ""
  };

  const elBig = document.getElementById("bigChipsRow");
  const elTag = document.getElementById("tagChipsRow");
  const elGrid = document.getElementById("grid");
  const elEmpty = document.getElementById("empty");
  const elInfo = document.getElementById("resultInfo");
  const elQ = document.getElementById("q");
  const elClear = document.getElementById("clearBtn");

  const norm = (s) => (s ?? "")
    .toString().trim().toLowerCase()
    .replace(/\s+/g, " ");

  function escapeHtml(str){
    return (str ?? "").toString()
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  // Drag-scroll + wheel->horizontal
  function enhanceHorizontalScroll(row){
    // wheel bilan x ga aylantirish
    row.addEventListener("wheel", (e) => {
      if (Math.abs(e.deltaY) > Math.abs(e.deltaX)) {
        row.scrollLeft += e.deltaY;
        e.preventDefault();
      }
    }, { passive:false });

    // mouse drag
    let isDown=false, startX=0, startLeft=0;
    row.addEventListener("mousedown", (e) => {
      isDown=true;
      startX = e.pageX;
      startLeft = row.scrollLeft;
    });
    window.addEventListener("mouseup", () => isDown=false);
    window.addEventListener("mousemove", (e) => {
      if(!isDown) return;
      const dx = e.pageX - startX;
      row.scrollLeft = startLeft - dx;
    });

    // touch drag (native scroll bor, shart emas) ‚Äî lekin user-select yo‚Äòq bo‚Äòlgani uchun ok
  }

  function pickAllTags(items){
    const set = new Set();
    items.forEach(it => (it.tags || []).forEach(t => set.add(norm(t))));
    return [...set].filter(Boolean).sort((a,b)=>a.localeCompare(b));
  }

  function countByType(typeId){
    const items = state.data?.items || [];
    return items.filter(it => norm(it.type) === typeId).length;
  }

  function countByTag(tag){
    const items = (state.data?.items || []).filter(it => norm(it.type) === state.activeType);
    if (tag === "all") return items.length;
    return items.filter(it => (it.tags||[]).map(norm).includes(tag)).length;
  }

  function setActiveChip(container, chipId){
    [...container.querySelectorAll(".chip")].forEach(c => {
      c.classList.toggle("active", c.dataset.id === chipId);
    });
  }

  function getFilteredItems(){
    const items = (state.data?.items || []).slice().filter(it => norm(it.type) === state.activeType);

    const q = norm(state.query);
    const byTag = state.activeTag;

    return items
      .filter(it => {
        if (byTag !== "all") {
          const tags = (it.tags || []).map(norm);
          if (!tags.includes(byTag)) return false;
        }
        if (q) {
          const hay = [it.title, it.desc, it.type, (it.tags || []).join(" ")].map(norm).join(" | ");
          if (!hay.includes(q)) return false;
        }
        return true;
      })
      .sort((a,b) => (b.order||0) - (a.order||0));
  }

  function renderBigChips(){
    const bigChips = (state.data?.bigChips || []).map(c => ({...c, id: norm(c.id)}));

    // default: birinchi chip active (BARCHASI YO‚ÄòQ)
    if (!state.activeType && bigChips.length) state.activeType = bigChips[0].id;

    elBig.innerHTML = bigChips.map(c => {
      const id = c.id;
      const count = countByType(id);
      return `
        <div class="chip ${id===state.activeType ? "active":""}" data-id="${id}">
          <span class="dot"></span>
          <span>${escapeHtml(c.icon || "")} ${escapeHtml(c.title || "")}</span>
          <span class="count">${count}</span>
        </div>
      `;
    }).join("");

    elBig.querySelectorAll(".chip").forEach(ch => {
      ch.addEventListener("click", () => {
        state.activeType = ch.dataset.id;
        state.activeTag = "all";
        setActiveChip(elBig, state.activeType);
        renderTagChips();
        renderCards();
      });
    });
  }

  function renderTagChips(){
    const itemsScope = (state.data?.items || []).filter(it => norm(it.type) === state.activeType);
    const tags = pickAllTags(itemsScope);
    const list = ["all", ...tags]; // taglarda "Hammasi" qolsin

    elTag.innerHTML = list.map(t => {
      const label = (t === "all") ? "Hammasi" : t;
      const count = countByTag(t);
      return `
        <div class="chip small ${t===state.activeTag ? "active":""}" data-id="${t}">
          <span>${escapeHtml(label)}</span>
          <span class="count">${count}</span>
        </div>
      `;
    }).join("");

    elTag.querySelectorAll(".chip").forEach(ch => {
      ch.addEventListener("click", () => {
        state.activeTag = ch.dataset.id;
        setActiveChip(elTag, state.activeTag);
        renderCards();
      });
    });
  }

  function renderCards(){
    const out = getFilteredItems();
    elInfo.textContent = `Bo‚Äòlim: ${state.activeType} ‚Ä¢ Natija: ${out.length} ta`;

    if (!out.length){
      elGrid.innerHTML = "";
      elEmpty.style.display = "block";
      return;
    }
    elEmpty.style.display = "none";

    elGrid.innerHTML = out.map(it => {
      const status = norm(it.status) || "available";
      const badgeText = it.badge || (status === "soon" ? "SOON" : "");
      const badgeClass = status === "soon" ? "badge soon" : "badge";
      const tags = (it.tags || []).slice(0, 6).map(t => `<span class="tag">${escapeHtml(t)}</span>`).join("");
      const href = it.href || "#";
      const goClass = status === "soon" ? "go disabled" : "go";
      const goText = status === "soon" ? "Tez kunda" : "Ochish";

      return `
        <div class="card">
          <div class="head">
            <div>
              <h3>${escapeHtml(it.title || "")}</h3>
              <p>${escapeHtml(it.desc || "")}</p>
            </div>
            ${badgeText ? `<div class="${badgeClass}">${escapeHtml(badgeText)}</div>` : ``}
          </div>
          <div class="actions">
            ${tags}
            <a class="${goClass}" href="${escapeHtml(href)}">${escapeHtml(goText)} <span>‚Üí</span></a>
          </div>
        </div>
      `;
    }).join("");
  }

  function bindSearch(){
    let t = null;
    elQ.addEventListener("input", () => {
      clearTimeout(t);
      t = setTimeout(() => {
        state.query = elQ.value;
        renderCards();
      }, 120);
    });
  }

  function bindClear(){
    elClear.addEventListener("click", () => {
      state.activeTag = "all";
      state.query = "";
      elQ.value = "";
      renderTagChips();
      renderCards();
    });
  }

  async function init(){
    try{
      const res = await fetch("./index.json", { cache:"no-store" });
      if (!res.ok) throw new Error("index.json topilmadi yoki ochilmadi");
      state.data = await res.json();

      renderBigChips();
      renderTagChips();
      bindSearch();
      bindClear();

      // scroll enhancement
      enhanceHorizontalScroll(elBig);
      enhanceHorizontalScroll(elTag);

      renderCards();
    } catch(err){
      elInfo.textContent = "Xatolik: JSON yuklanmadi";
      elGrid.innerHTML = `<div class="empty">‚ùå ${escapeHtml(err.message || err)}</div>`;
      elEmpty.style.display = "none";
    }
  }

  init();
})();
</script>
</body>
</html>
