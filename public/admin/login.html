<!doctype html>
<html lang="uz">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>OrzuMall Admin — Kirish</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root{
      --primary:#4361ee;--primary-dark:#3a56d4;--secondary:#7209b7;--success:#4cc9f0;--danger:#f72585;
      --bg:#f5f7fb;--text:#0b1220;--muted:#6c757d;--card:#ffffff;--line:rgba(15,23,42,.10);
      --shadow:0 18px 60px rgba(15,23,42,.14);
      --r:22px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;min-height:100vh;display:grid;place-items:center;
      background:
        radial-gradient(900px 520px at 15% 5%, rgba(67,97,238,.16), transparent 60%),
        radial-gradient(900px 520px at 85% 0%, rgba(114,9,183,.14), transparent 60%),
        linear-gradient(#f7f8fb,#f2f5fb);
      color:var(--text);
      font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;
      padding:24px;
    }
    .wrap{width:min(720px,94vw);display:grid;grid-template-columns:1.1fr .9fr;gap:18px;align-items:stretch}
    @media (max-width:760px){ .wrap{grid-template-columns:1fr} }
    .hero{
      border-radius:var(--r);
      padding:22px;
      background:linear-gradient(135deg, rgba(67,97,238,.96), rgba(114,9,183,.96));
      color:#fff;
      box-shadow:var(--shadow);
      position:relative;
      overflow:hidden;
    }
    .hero:before{
      content:"";
      position:absolute;inset:-120px -120px auto auto;
      width:320px;height:320px;border-radius:50%;
      background:rgba(76,201,240,.22);
      filter:blur(1px);
      transform:rotate(18deg);
    }
    .brand{display:flex;align-items:center;gap:12px;font-weight:900;font-size:20px;letter-spacing:.2px}
    .brand i{color:var(--success)}
    .hero p{margin:10px 0 0;color:rgba(255,255,255,.86);line-height:1.55;font-size:14px;max-width:52ch}
    .hero .pill{display:inline-flex;align-items:center;gap:8px;margin-top:14px;padding:10px 12px;border-radius:999px;
      background:rgba(255,255,255,.14);border:1px solid rgba(255,255,255,.18);font-weight:800;font-size:13px}
    .card{
      border-radius:var(--r);
      background:var(--card);
      border:1px solid var(--line);
      box-shadow:var(--shadow);
      padding:22px;
      display:flex;flex-direction:column;gap:12px;
    }
    .title{font-weight:900;font-size:18px;display:flex;align-items:center;gap:10px}
    .title i{color:var(--primary)}
    .muted{color:var(--muted);font-size:13px;line-height:1.55}
    code{background:rgba(67,97,238,.08);padding:2px 8px;border-radius:10px;border:1px solid rgba(67,97,238,.18);font-weight:800}
    .btn{
      width:100%;
      padding:12px 14px;
      border-radius:16px;
      border:0;
      cursor:pointer;
      font-weight:900;
      display:flex;align-items:center;justify-content:center;gap:10px;
      background:var(--primary);
      color:#fff;
      transition:transform .12s ease, filter .12s ease;
    }
    .btn:hover{transform:translateY(-1px);filter:brightness(1.03)}
    .btn:active{transform:translateY(0)}
    .btn[disabled]{opacity:.65;cursor:not-allowed;transform:none}
    .error{
      display:none;
      background:rgba(247,37,133,.08);
      border:1px solid rgba(247,37,133,.22);
      color:#9d174d;
      padding:10px 12px;border-radius:14px;
      font-size:13px;line-height:1.4;
    }
    .foot{margin-top:auto;padding-top:6px;border-top:1px dashed rgba(15,23,42,.12);font-size:12px;color:var(--muted)}
    .kpi{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:14px}
    .kpi .box{background:rgba(255,255,255,.12);border:1px solid rgba(255,255,255,.18);border-radius:16px;padding:10px 12px}
    .kpi .n{font-weight:900;font-size:16px}
    .kpi .t{opacity:.85;font-size:12px;margin-top:2px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="hero">
      <div class="brand"><i class="fas fa-cube"></i> OrzuMall Admin</div>
      <p>Bu sahifa <b>to‘liq yopiq</b>. Faqat ruxsat berilgan gmail orqali mahsulotlar, buyurtmalar va Payme tranzaksiyalarni boshqarish mumkin.</p>
      <div class="pill"><i class="fas fa-shield-halved"></i> Admin email: <code>sohibjonmath@gmail.com</code></div>
      <div class="kpi" aria-hidden="true">
        <div class="box"><div class="n"><i class="fas fa-receipt"></i> Buyurtmalar</div><div class="t">Statuslarni boshqarish</div></div>
        <div class="box"><div class="n"><i class="fas fa-wallet"></i> Turnover</div><div class="t">Topup & checkout</div></div>
      </div>
    </div>

    <div class="card">
      <div class="title"><i class="fas fa-right-to-bracket"></i> Kirish</div>
      <div class="muted">
        Google orqali kirishda <b>admin gmail</b> tanlang. Boshqa gmail tanlansa tizim avtomatik chiqib ketadi.
      </div>

      <button id="btn" class="btn"><i class="fab fa-google"></i> Google orqali kirish</button>
      <div id="err" class="error"></div>

      <div class="foot">
        Muammo bo‘lsa: brauzerda pop-up bloklanmaganini tekshiring.
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, setPersistence, browserLocalPersistence, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";

    const ADMIN_EMAIL = "sohibjonmath@gmail.com";

    // Firebase config (panel bilan bir xil)
    const cfg = {
      "apiKey": "AIzaSyDYwHJou_9GqHZcf8XxtTByC51Z8un8rrM",
      "authDomain": "xplusy-760fa.firebaseapp.com",
      "databaseURL": "https://xplusy-760fa-default-rtdb.firebaseio.com",
      "projectId": "xplusy-760fa",
      "storageBucket": "xplusy-760fa.firebasestorage.app",
      "messagingSenderId": "992512966017",
      "appId": "1:992512966017:web:5e919dbc9b8d8abcb43c80",
      "measurementId": "G-459PLJ7P7L"
    };

    const app = initializeApp(cfg);
    const auth = getAuth(app);
    setPersistence(auth, browserLocalPersistence).catch(()=>{});

    const btn = document.getElementById("btn");
    const err = document.getElementById("err");

    function showError(msg) {
      err.style.display = "block";
      err.textContent = msg;
    }

    onAuthStateChanged(auth, async (user)=>{
      if (user && user.email && user.email.toLowerCase().trim() === ADMIN_EMAIL.toLowerCase()) {
        location.replace("./panel.html");
        return;
      }
      if (user && (!user.email || user.email.toLowerCase().trim() !== ADMIN_EMAIL.toLowerCase())) {
        try { await signOut(auth); } catch(e){}
      }
    });

    btn.addEventListener("click", async () => {
      err.style.display = "none";
      btn.disabled = true;
      btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Kutilmoqda...';
      try {
        await setPersistence(auth, browserLocalPersistence);
        const provider = new GoogleAuthProvider();
        provider.setCustomParameters({ prompt: "select_account" });
        const res = await signInWithPopup(auth, provider);

        if (!res?.user?.email || res.user.email.toLowerCase().trim() !== ADMIN_EMAIL.toLowerCase()) {
          await signOut(auth);
          showError("Ruxsat yo‘q. Faqat admin gmail ishlaydi.");
          btn.disabled = false;
          btn.innerHTML = '<i class="fab fa-google"></i> Google orqali kirish';
          return;
        }

        location.replace("./panel.html");
      } catch (e) {
        console.error(e);
        showError("Kirishda xatolik: " + (e?.message || e));
        btn.disabled = false;
        btn.innerHTML = '<i class="fab fa-google"></i> Google orqali kirish';
      }
    });
  </script>
</body>
</html>
