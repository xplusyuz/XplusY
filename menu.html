<style>
    /* Asosiy AssistiveTouch tugmasi */
    .assistive-touch {
        position: fixed;
        right: 25px;
        bottom: 25px;
        width: 64px;
        height: 64px;
        background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        z-index: 1000;
        box-shadow: 0 6px 20px rgba(106, 17, 203, 0.3);
        transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        border: none;
        outline: none;
        user-select: none;
        opacity: 0.5; /* shaffoflik qo'shildi */
    }

    .assistive-touch:hover {
        transform: scale(1.1);
        box-shadow: 0 8px 25px rgba(106, 17, 203, 0.4);
        opacity: 1;
    }

    .assistive-touch:active {
        transform: scale(0.95);
    }

    .assistive-touch img {
        width: 32px;
        height: 32px;
        pointer-events: none; /* rasm tugma bilan surilishini toâ€˜sadi */
    }

    /* Matematika menyusi */
    .math-assistive-menu {
        position: fixed;
        right: 100px;
        bottom: 25px;
        width: 280px;
        background: white;
        border-radius: 16px;
        padding: 12px 0;
        flex-direction: column;
        z-index: 1000;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        animation: fadeIn 0.25s ease-out;
        border-top: 4px solid #6a11cb;
        overflow: hidden;
        display: none; /* Dastlab yashirin holatda */
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateX(20px); }
        to { opacity: 1; transform: translateX(0); }
    }

    .math-menu-item {
        padding: 14px 24px;
        color: #333;
        cursor: pointer;
        display: flex;
        align-items: center;
        transition: all 0.2s;
        font-family: 'Segoe UI', sans-serif;
        text-decoration: none;
        font-size: 15px;
    }

    .math-menu-item:hover {
        background: linear-gradient(to right, #f6f7ff, #fff);
        color: #6a11cb;
        padding-left: 28px;
    }

    .math-menu-item i {
        margin-right: 16px;
        font-size: 20px;
        color: #6a11cb;
        width: 24px;
        text-align: center;
    }

    .math-menu-header {
        padding: 14px 24px;
        font-weight: 600;
        color: #6a11cb;
        border-bottom: 1px solid #f0f0f0;
        display: flex;
        align-items: center;
        font-size: 16px;
        background: #f9f9ff;
    }

    .math-menu-header i {
        margin-right: 12px;
        font-size: 22px;
    }

    .new-badge {
        background: linear-gradient(to right, #ff8a00, #ff0058);
        color: white;
        font-size: 10px;
        padding: 3px 10px;
        border-radius: 10px;
        margin-left: 10px;
        font-weight: bold;
        animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
        0% { transform: scale(1); opacity: 0.9; }
        50% { transform: scale(1.05); opacity: 1; }
        100% { transform: scale(1); opacity: 0.9; }
    }
</style>

<!-- Font Awesome CDN for modern icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<!-- AssistiveTouch tugmasi -->
<button class="assistive-touch" id="assistiveBtn" aria-label="Math Assistant">
    <img src="logo.png" 
         alt="Calculator Logo" style="width:32px; height:32px;">
</button>

<!-- Matematika menyusi -->
<div class="math-assistive-menu" id="mathMenu">
    <div class="math-menu-header">
        <i class="fas fa-calculator"></i>
        Matematika Resurslari
    </div>
    <a href="#Kurslar" class="math-menu-item">
        <i class="fas fa-video"></i>
        Kurslar
    </a>
    <a href="#Testlar" class="math-menu-item">
        <i class="fas fa-clipboard-list"></i>
        Testlar
    </a>
    <a href="#simulyatorlar" class="math-menu-item">
        <i class="fas fa-lightbulb"></i>
        Simulyatorlar
    </a>
    <a href="#oyinlar" class="math-menu-item">
        <i class="fas fa-gamepad"></i>
        Matematik O'yinlar
    </a>
    <a href="#savollar" class="math-menu-item">
        <i class="fas fa-question-circle"></i>
        Savollar
    </a>
    <div class="math-menu-item" style="border-top: 1px solid #eee; color: #888;">
        <i class="fas fa-times-circle"></i>
        Yopish
    </div>
</div>

<script>
const assistiveBtn = document.getElementById('assistiveBtn');
const mathMenu = document.getElementById('mathMenu');

// Sahifa yuklanganda menyuni yopiq holatda qoldirish
document.addEventListener('DOMContentLoaded', function() {
    mathMenu.style.display = 'none';
});

// Tugma bosilganda menyuni ochish/yopish
assistiveBtn.addEventListener('click', function(e) {
    e.stopPropagation();
    mathMenu.style.display = mathMenu.style.display === 'none' ? 'flex' : 'none';
});

// Ekranda boshqa joyga bosilganda menyuni yopish
document.addEventListener('click', function() {
    mathMenu.style.display = 'none';
});

// Menyuni bosilganda yopilishining oldini olish
mathMenu.addEventListener('click', function(e) {
    e.stopPropagation();
    if (e.target.closest('.math-menu-item') && (e.target.textContent.includes('Yopish') || e.target.closest('i.fa-times-circle'))) {
        mathMenu.style.display = 'none';
    }
});

// Drag-and-drop funksiyasi
let isDragging = false;
let offsetX, offsetY;

assistiveBtn.addEventListener('mousedown', startDrag);
assistiveBtn.addEventListener('touchstart', startDrag, {passive: false});

function startDrag(e) {
    e.preventDefault();
    isDragging = true;
    const rect = assistiveBtn.getBoundingClientRect();
    offsetX = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
    offsetY = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;

    document.addEventListener('mousemove', drag);
    document.addEventListener('mouseup', stopDrag);
    document.addEventListener('touchmove', drag, {passive: false});
    document.addEventListener('touchend', stopDrag);
}

function drag(e) {
    if (!isDragging) return;
    e.preventDefault();
    const x = (e.touches ? e.touches[0].clientX : e.clientX) - offsetX;
    const y = (e.touches ? e.touches[0].clientY : e.clientY) - offsetY;

    // Ekran chegarasini cheklash
    const maxX = window.innerWidth - assistiveBtn.offsetWidth;
    const maxY = window.innerHeight - assistiveBtn.offsetHeight;

    assistiveBtn.style.left = Math.min(Math.max(0, x), maxX) + 'px';
    assistiveBtn.style.top = Math.min(Math.max(0, y), maxY) + 'px';
    assistiveBtn.style.right = 'auto';
    assistiveBtn.style.bottom = 'auto';
}

function stopDrag() {
    isDragging = false;
    document.removeEventListener('mousemove', drag);
    document.removeEventListener('mouseup', stopDrag);
    document.removeEventListener('touchmove', drag);
    document.removeEventListener('touchend', stopDrag);
}
</script>