<div class="header-wrap">
  <nav class="nav container">
    <div class="brand">
      <span class="dot"></span>
      <span>KiberMath</span>
    </div>

    <button class="burger" aria-label="Menu">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M3 6h18M3 12h18M3 18h18" stroke="rgba(255,255,255,.85)" stroke-width="2" stroke-linecap="round"/></svg>
    </button>

    <button class="btn btn-ghost" id="panelOpen" aria-label="Touch panel">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
        <rect x="3" y="4" width="18" height="6" rx="2" stroke="rgba(255,255,255,.85)" stroke-width="2"/>
        <rect x="3" y="14" width="18" height="6" rx="2" stroke="rgba(255,255,255,.85)" stroke-width="2"/>
        <circle cx="8" cy="17" r="1.5" fill="rgba(32,242,143,.9)"/>
        <circle cx="12" cy="7" r="1.5" fill="rgba(32,242,143,.9)"/>
      </svg>
    </button>

    <div class="nav-actions">
      <div class="user-pill" data-anon>
        <span>Kirish qilmagansiz</span>
        <a class="btn btn-primary" href="registor.html">Kirish / Ro'yxatdan o'tish</a>
      </div>
      <div class="user-pill" data-authed style="display:none">
        <span>👋 Salom, <strong data-username>—</strong></span>
        <span class="kpi">ID: <b data-userid>—</b></span>
        <span class="kpi">Balans: <b data-balance>0</b> so'm</span>
        <a class="plus-btn" href="balance.html">+</a>
        <span class="kpi">Ball: <b data-points>0</b></span>
        <span class="kpi">Unvon: <b data-title>—</b></span>
        <button class="btn btn-ghost" data-logout>Chiqish</button>
      </div>
    </div>
  </nav>
</div>


<!-- Touch Panel Overlay -->
<div class="panel-backdrop" id="panelBackdrop"></div>
<aside class="touch-panel" id="touchPanel" role="dialog" aria-modal="true" aria-labelledby="panelTitle">
  <div class="swipe-bar"></div>
  <div class="panel-header">
    <div class="panel-title"><span class="dot"></span><span id="panelTitle">Kiber Panel</span><span class="chip" data-title>—</span></div>
    <button class="btn btn-ghost" id="panelClose">Yopish</button>
  </div>
  <div class="panel-body">
    <div class="user-pill" data-authed style="display:none">
        <span>👋 Salom, <strong data-username>—</strong></span>
        <span class="kpi">ID: <b data-userid>—</b></span>
        <span class="kpi">Balans: <b data-balance>0</b> so'm</span>
        <a class="plus-btn" href="balance.html">+</a>
        <span class="kpi">Ball: <b data-points>0</b></span>
        <span class="kpi">Unvon: <b data-title>—</b></span>
    </div>

    <div class="panel-grid">
      <a class="panel-item" href="index.html">
        <svg width="24" height="24" viewBox="0 0 24 24"><path d="M3 11l9-7 9 7v9a1 1 0 0 1-1 1h-5v-6H9v6H4a1 1 0 0 1-1-1v-9z" fill="rgba(32,242,143,.6)" /></svg>
        <div class="label">Asosiy</div><div class="note">Bosh sahifa</div>
      </a>
      <a class="panel-item" href="#testlar">
        <svg width="24" height="24" viewBox="0 0 24 24"><path d="M4 4h16v4H4zM4 10h16v4H4zM4 16h10v4H4z" fill="rgba(32,242,143,.6)"/></svg>
        <div class="label">Testlar</div><div class="note">Onlayn sinovlar</div>
      </a>
      <a class="panel-item" href="#kurslar">
        <svg width="24" height="24" viewBox="0 0 24 24"><path d="M3 7l9-4 9 4-9 4-9-4zm0 6l9 4 9-4" fill="rgba(32,242,143,.6)"/></svg>
        <div class="label">Kurslar</div><div class="note">Video darslar</div>
      </a>
      <a class="panel-item" href="#simulyator">
        <svg width="24" height="24" viewBox="0 0 24 24"><path d="M6 4h12v4H6zM4 10h16v10H4z" fill="rgba(32,242,143,.6)"/></svg>
        <div class="label">Simulyator</div><div class="note">Mashq rejimi</div>
      </a>
      <a class="panel-item" href="#oyinlar">
        <svg width="24" height="24" viewBox="0 0 24 24"><path d="M8 7h8l3 10H5L8 7zm2-3h4v2h-4z" fill="rgba(32,242,143,.6)"/></svg>
        <div class="label">O'yinlar</div><div class="note">Gamifikatsiya</div>
      </a>
      <a class="panel-item" href="profil.html">
        <svg width="24" height="24" viewBox="0 0 24 24"><path d="M12 12a4 4 0 1 0-4-4 4 4 0 0 0 4 4zm0 2c-4 0-8 2-8 4v2h16v-2c0-2-4-4-8-4z" fill="rgba(32,242,143,.6)"/></svg>
        <div class="label">Profil</div><div class="note">Ma'lumotlar</div>
      </a>
      <a class="panel-item" href="balance.html">
        <svg width="24" height="24" viewBox="0 0 24 24"><path d="M3 6h18v12H3z M7 10h10v2H7z M7 14h10v2H7z" fill="rgba(32,242,143,.6)"/></svg>
        <div class="label">Balans</div><div class="note">To'ldirish</div>
      </a>
      <a class="panel-item" href="#" data-logout>
        <svg width="24" height="24" viewBox="0 0 24 24"><path d="M10 17l5-5-5-5v3H3v4h7v3zM20 5h-6v2h6v10h-6v2h6a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2z" fill="rgba(255,84,112,.8)"/></svg>
        <div class="label">Chiqish</div><div class="note">Hisobdan chiqish</div>
      </a>
    </div>

    <div class="panel-quick">
      <a class="btn btn-primary" href="#online">⚡ Online Olimpiada</a>
      <a class="btn" href="#top">🏆 Reyting</a>
      <a class="btn" href="#help">❓ Yordam</a>
    </div>
  </div>
</aside>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const panel = document.getElementById('touchPanel');
  const panelBody = panel?.querySelector('.panel-body');
  if (!panelBody) return;

  // 1) Panel ichidagi eski user-pill[data-authed] ni olib tashlash (dublikat bo'lmasin)
  const existingPanelPill = panelBody.querySelector('.user-pill[data-authed]');
  if (existingPanelPill) existingPanelPill.remove();

  // 2) Headerdan user-pill[data-authed] ni klonlab panelga qo'yish
  const headerPill = document.querySelector('.nav .user-pill[data-authed]');
  if (headerPill) {
    const clone = headerPill.cloneNode(true); // event listenerlar ko'chmaydi
    panelBody.insertBefore(clone, panelBody.firstChild);
  }

  // 3) Panel sarlavhasidagi Unvon chipini headerdagi data-title bilan sinxronlash
  const srcTitle = document.querySelector('.nav [data-title]');     // headerdagi Unvon
  const chip = panel.querySelector('.panel-header .chip[data-title]'); // panel sarlavhasidagi chip
  const copyTitle = () => {
    if (srcTitle && chip) chip.textContent = srcTitle.textContent || '—';
  };
  copyTitle();
  if (srcTitle) {
    const mo = new MutationObserver(copyTitle);
    mo.observe(srcTitle, { childList: true, characterData: true, subtree: true });
  }

  // 4) Logout tugmasi: delegatsiya orqali ushlaymiz
  document.addEventListener('click', (e) => {
    const btn = e.target.closest('[data-logout]');
    if (!btn) return;
    if (typeof window.logout === 'function') {
      window.logout();
    }
  });
});
</script>
