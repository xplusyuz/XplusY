<!doctype html>
<html lang="uz">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>MathCenter — Lite</title>
  <meta name="color-scheme" content="light"/>
  <style>
    :root{
      --green:#2E8B57;
      --green-700:#1F6B45;
      --bg:#f7faf8;
      --text:#1a1f1c;
      --muted:#6b7280;
      --card:#ffffff;
      --shadow:0 8px 24px rgba(0,0,0,.08);
      --radius:18px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;height:100%;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text)}
    a{text-decoration:none;color:inherit}
    img{display:block;max-width:100%}
    .container{max-width:1100px;margin:0 auto;padding:16px}
    .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow)}
    .row{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;background:var(--green);color:#fff;border:0;cursor:pointer;font-weight:600}
    .btn.ghost{background:#e9f5ef;color:var(--green)}
    header.nav{position:sticky;top:0;z-index:10;background:rgba(255,255,255,.8);backdrop-filter:saturate(1.2) blur(6px);border-bottom:1px solid #eee}
    .brand{display:flex;align-items:center;gap:10px;font-weight:800;color:var(--green)}
    .brand .pi{width:28px;height:28px;border-radius:8px;background:linear-gradient(135deg,var(--green),var(--green-700));display:grid;place-items:center;color:#fff;box-shadow:var(--shadow)}
    .stack{display:flex;align-items:center;gap:10px}
    .spacer{flex:1}
    /* Login panel */
    #loginPanel{max-width:420px;margin:56px auto;padding:22px}
    #loginPanel h2{margin:0 0 8px}
    label{font-size:13px;color:var(--muted)}
    input,select{width:100%;padding:12px 14px;border:1px solid #e5e7eb;border-radius:12px;background:#fff;outline:0}
    .hint{font-size:12px;color:var(--muted)}
    /* Banner carousel */
    .carousel{position:relative;overflow:hidden;border-radius:var(--radius)}
    .carousel .slides{display:flex;transition:transform .4s ease}
    .carousel .slide{min-width:100%;position:relative;height:220px}
    .carousel .slide img{object-fit:cover;width:100%;height:100%}
    .carousel .caption{position:absolute;inset:auto 16px 16px 16px;background:rgba(0,0,0,.45);color:#fff;padding:12px;border-radius:14px}
    .carousel .dots{position:absolute;left:0;right:0;bottom:10px;display:flex;justify-content:center;gap:6px}
    .dot{width:8px;height:8px;border-radius:50%;background:#ffffff80}
    .dot.active{background:#fff}
    /* Cards */
    .filters{display:flex;flex-wrap:wrap;gap:8px;margin:16px 0}
    .chip{padding:8px 12px;border-radius:999px;border:1px solid #d1d5db;background:#fff;font-size:13px;cursor:pointer}
    .chip.active{background:#e9f5ef;border-color:#b7e2c7;color:var(--green)}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
    .tile{overflow:hidden}
    .tile .thumb{height:160px}
    .tile .body{padding:12px}
    .meta{font-size:12px;color:var(--muted)}
    .badge{padding:4px 8px;border-radius:999px;background:#e9f5ef;color:var(--green);font-size:12px}
    /* User bar */
    .userbar{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:12px;background:#f0f7f3}
    .avatar{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,#d1fae5,#a7f3d0);display:grid;place-items:center;font-weight:700;color:var(--green-700)}
    /* Footer */
    footer{padding:30px 0;color:var(--muted);text-align:center}
    /* Responsive */
    @media (max-width:960px){ .grid{grid-template-columns:repeat(2,1fr)} .carousel .slide{height:180px} }
    @media (max-width:640px){ .row{grid-template-columns:repeat(6,1fr)} .grid{grid-template-columns:1fr} #loginPanel{margin:24px auto} }
  </style>
</head>
<body>
  <header class="nav">
    <div class="container stack">
      <div class="brand">
        <div class="pi">π</div>
        <div>MathCenter Lite</div>
      </div>
      <div class="spacer"></div>
      <button id="btnAdmin" class="btn ghost" style="display:none">Admin</button>
      <button id="btnLogout" class="btn ghost" style="display:none">Chiqish</button>
    </div>
  </header>

  <!-- LOGIN -->
  <section id="loginPanel" class="card">
    <h2>Kirish</h2>
    <p class="hint">Tizimga kirish faqat admin tomonidan ro‘yxatga olingan foydalanuvchilar uchun.</p>
    <div style="display:grid;gap:12px;margin-top:12px">
      <div>
        <label>Login</label>
        <input id="login" placeholder="Masalan: student1" autocomplete="username"/>
      </div>
      <div>
        <label>Parol</label>
        <input id="password" type="password" placeholder="••••••••" autocomplete="current-password"/>
      </div>
      <button id="doLogin" class="btn">Kirish</button>
      <div id="loginErr" class="hint" style="color:#b91c1c;display:none"></div>
    </div>
  </section>

  <!-- HOME -->
  <main id="home" style="display:none">
    <div class="container" style="display:grid;gap:16px">
      <div class="userbar card">
        <div class="avatar" id="avatar">U</div>
        <div style="line-height:1.2">
          <div id="greet" style="font-weight:700"></div>
          <div class="meta">Ball: <span id="points">0</span></div>
        </div>
        <div class="spacer"></div>
        <div class="badge" id="roleBadge">User</div>
      </div>

      <!-- Banners -->
      <div class="carousel card" id="carousel" aria-label="bannerlar">
        <div class="slides" id="slides"></div>
        <div class="dots" id="dots"></div>
      </div>

      <!-- Filters -->
      <div class="filters" id="filters"></div>

      <!-- Cards -->
      <div class="grid" id="grid"></div>
    </div>
  </main>

  <footer>
    <div class="container">© 2025 MathCenter Lite — faqat ballik, balanssiz.</div>
  </footer>

  <script>
    // helper
    const $ = sel => document.querySelector(sel);
    const state = { db: null, me: null, tag: 'hammasi', tags: new Set(['hammasi']) };

    async function loadDB(){
      const res = await fetch('liteadmin.json?_=' + Date.now());
      if(!res.ok){ throw new Error('liteadmin.json yuklanmadi'); }
      const db = await res.json();
      state.db = db;
      return db;
    }

    function saveSession(me){ localStorage.setItem('lite.me', JSON.stringify(me)); }
    function getSession(){ try{return JSON.parse(localStorage.getItem('lite.me'));}catch{return null;} }
    function logout(){ localStorage.removeItem('lite.me'); location.reload(); }

    function renderHome(){
      // header
      $('#btnLogout').style.display='inline-flex';
      const isAdmin = state.me.role === 'admin';
      $('#btnAdmin').style.display = isAdmin ? 'inline-flex' : 'none';
      // userbar
      $('#greet').textContent = `Salom, ${state.me.name} ${state.me.surname}`;
      $('#points').textContent = state.me.points ?? 0;
      $('#roleBadge').textContent = isAdmin ? 'Admin' : 'Foydalanuvchi';
      $('#avatar').textContent = (state.me.name?.[0] ?? 'U').toUpperCase();

      // banners
      const slides = $('#slides'); slides.innerHTML='';
      const dots = $('#dots'); dots.innerHTML='';
      const banners = (state.db.banners||[]).filter(b=>b.active);
      banners.forEach((b,i)=>{
        const s = document.createElement('a');
        s.className='slide'; s.href=b.link||'#'; s.target='_blank';
        s.innerHTML = `<img src="${b.image}" alt="${b.title}"><div class="caption"><div style="font-weight:800;font-size:18px">${b.title}</div><div>${b.subtitle||''}</div></div>`;
        slides.appendChild(s);
        const dot = document.createElement('div'); dot.className='dot'+(i===0?' active':''); dots.appendChild(dot);
      });
      let idx=0; setInterval(()=>{
        if(!banners.length) return;
        idx=(idx+1)%banners.length;
        slides.style.transform=`translateX(-${idx*100}%)`;
        [...dots.children].forEach((d,i)=>d.classList.toggle('active', i===idx));
      }, 3500);

      // tags & cards
      const filters = $('#filters'); filters.innerHTML='';
      state.tags = new Set(['hammasi']);
      (state.db.cards||[]).filter(c=>c.active).forEach(c=>c.tags?.forEach(t=>state.tags.add(t)));
      [...state.tags].forEach(t=>{
        const chip=document.createElement('button');
        chip.className='chip'+(t===state.tag?' active':'');
        chip.textContent=t; chip.onclick=()=>{state.tag=t; renderCards(); renderFilters();};
        filters.appendChild(chip);
      });
      function renderFilters(){
        filters.querySelectorAll('.chip').forEach(ch=>{
          ch.classList.toggle('active', ch.textContent===state.tag);
        });
      }
      renderCards();
      function renderCards(){
        const grid = $('#grid'); grid.innerHTML='';
        const list = (state.db.cards||[]).filter(c=>c.active && (state.tag==='hammasi' || (c.tags||[]).includes(state.tag)));
        list.forEach(c=>{
          const el = document.createElement('a');
          el.className='tile card'; el.href=c.link||'#'; el.target='_blank';
          el.innerHTML = `
            <div class="thumb"><img src="${c.image}" alt="${c.title}" style="width:100%;height:100%;object-fit:cover"></div>
            <div class="body">
              <div style="font-weight:700">${c.title}</div>
              <div class="meta" style="margin-top:4px">${(c.tags||[]).join(' · ')}</div>
            </div>`;
          grid.appendChild(el);
        });
      }
    }

    async function tryAutoLogin(){
      const me = getSession();
      if(me){ state.me = me; $('#loginPanel').style.display='none'; $('#home').style.display='block'; await loadDB(); renderHome(); }
    }

    // events
    $('#btnLogout').onclick=logout;
    $('#btnAdmin').onclick=()=>location.href='liteadmin.html';
    $('#doLogin').onclick=async ()=>{
      try{
        $('#loginErr').style.display='none';
        const login = $('#login').value.trim();
        const pass = $('#password').value.trim();
        const db = await loadDB();
        // admin?
        if(login===db.auth?.admin?.login && pass===db.auth?.admin?.password){
          const me={login,name:'Admin',surname:'',role:'admin',points:0};
          state.me=me; saveSession(me);
          location.href='liteadmin.html';
          return;
        }
        // users
        const u = (db.users||[]).find(u=>u.login===login && u.password===pass);
        if(!u){ throw new Error('Login yoki parol xato.'); }
        const me={login:u.login,name:u.name,surname:u.surname,role:'user',points:u.points||0};
        state.me=me; saveSession(me);
        $('#loginPanel').style.display='none';
        $('#home').style.display='block';
        renderHome();
      }catch(err){
        $('#loginErr').textContent=err.message;
        $('#loginErr').style.display='block';
      }
    };

    tryAutoLogin();
  </script>
</body>
</html>
