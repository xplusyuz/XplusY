<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MathCenter Admin</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{--brand:#16a34a;--brand2:#22c55e}
    .brand-grad{background:linear-gradient(135deg,#eafff2,white)}
    .btn{ @apply px-3 py-2 rounded-xl shadow hover:scale-[1.02] transition font-medium; }
    .btn-primary{ @apply bg-green-600 text-white; }
    .btn-secondary{ @apply bg-white border border-gray-200; }
    .tag{ @apply text-xs px-2 py-0.5 rounded-full bg-emerald-100 text-emerald-700 }
    .card{ @apply rounded-2xl shadow-sm border border-gray-100 bg-white }
    .input{ @apply w-full rounded-lg border border-gray-200 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-emerald-400 }
    dialog::backdrop{background:rgba(0,0,0,.35)}
  </style>
</head>
<body class="min-h-screen brand-grad text-gray-900">
  <!-- Topbar -->
  <header class="sticky top-0 z-40 bg-white/80 backdrop-blur border-b border-gray-100">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center gap-3">
      <div class="flex items-center gap-2">
        <div class="w-9 h-9 rounded-2xl bg-gradient-to-br from-emerald-500 to-emerald-600 grid place-items-center text-white text-xl font-black">Ï€</div>
        <div>
          <div class="text-sm font-semibold">MathCenter Admin</div>
          <div class="text-xs text-gray-500">Faqat ruxsat etilgan foydalanuvchi</div>
        </div>
      </div>
      <div class="ml-auto flex items-center gap-2">
        <span id="authEmail" class="text-sm text-gray-600"></span>
        <button id="btnSignIn" class="btn btn-primary">Google bilan kirish</button>
        <button id="btnSignOut" class="btn btn-secondary hidden">Chiqish</button>
      </div>
    </div>
  </header>

  <!-- App -->
  <main class="max-w-7xl mx-auto px-4 py-6">
    <div id="accessDenied" class="hidden">
      <div class="card p-6 text-center">
        <div class="text-3xl">ğŸš«</div>
        <h2 class="text-xl font-semibold mt-2">Kirish rad etildi</h2>
        <p class="text-sm text-gray-600 mt-1">Faqat <b>sohibjonmath@gmail.com</b> adminka kirishi mumkin.</p>
      </div>
    </div>

    <div id="adminUi" class="hidden">
      <!-- Tabs -->
      <div class="flex flex-wrap gap-2 mb-4">
        <button data-tab="tab-dashboard" class="tab btn btn-secondary">ğŸ  Asosiy (Banner)</button>
        <button data-tab="tab-courses" class="tab btn btn-secondary">ğŸ“š Kurslar</button>
        <button data-tab="tab-tests" class="tab btn btn-secondary">ğŸ“ Testlar</button>
        <button data-tab="tab-simulators" class="tab btn btn-secondary">ğŸ§ª Simulyatorlar</button>
        <button data-tab="tab-promos" class="tab btn btn-secondary">ğŸ·ï¸ Promo kodlar</button>
        <button data-tab="tab-users" class="tab btn btn-secondary">ğŸ‘¥ Foydalanuvchilar</button>
        <div class="ml-auto"></div>
        <button id="btnSeedAll" class="btn btn-primary">â• 6 ta namunani yaratish</button>
      </div>

      <!-- Dashboard / Banner -->
      <section id="tab-dashboard" class="tab-pane card p-5">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold">Katta reklama banneri</h3>
          <button id="btnEditBanner" class="btn btn-primary">âœï¸ Banner tahrirlash</button>
        </div>
        <div id="bannerView" class="grid lg:grid-cols-[2fr,1fr] gap-4">
          <div class="card p-4">
            <img id="bannerImage" class="w-full h-56 object-cover rounded-xl border border-gray-100" src="" alt="Banner"/>
          </div>
          <div class="card p-4">
            <div class="text-sm text-gray-500">Sarlavha</div>
            <div id="bannerTitle" class="text-xl font-semibold">â€”</div>
            <div class="text-sm text-gray-500 mt-3">Matn</div>
            <div id="bannerSubtitle" class="text-gray-700">â€”</div>
            <div class="text-sm text-gray-500 mt-3">Havola</div>
            <a id="bannerLink" class="text-emerald-700 underline" href="#" target="_blank">â€”</a>
          </div>
        </div>
      </section>

      <!-- Courses -->
      <section id="tab-courses" class="tab-pane card p-5 hidden">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold">Kurslar</h3>
          <button class="btn btn-primary" id="addCourse">â• Yangi kurs</button>
        </div>
        <div id="coursesGrid" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
      </section>

      <!-- Tests -->
      <section id="tab-tests" class="tab-pane card p-5 hidden">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold">Testlar</h3>
          <button class="btn btn-primary" id="addTest">â• Yangi test</button>
        </div>
        <div id="testsGrid" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
      </section>

      <!-- Simulators -->
      <section id="tab-simulators" class="tab-pane card p-5 hidden">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold">Simulyatorlar</h3>
          <button class="btn btn-primary" id="addSimulator">â• Yangi simulyator</button>
        </div>
        <div id="simulatorsGrid" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
      </section>

      <!-- Promos -->
      <section id="tab-promos" class="tab-pane card p-5 hidden">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold">Promo kodlar</h3>
          <button class="btn btn-primary" id="addPromo">â• Promo kod</button>
        </div>
        <div id="promosGrid" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
      </section>

      <!-- Users -->
      <section id="tab-users" class="tab-pane card p-5 hidden">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold">Foydalanuvchilar</h3>
          <div class="flex gap-2">
            <input id="userSearch" class="input w-60" placeholder="Qidirish (ism/email/id)" />
            <button id="btnReloadUsers" class="btn btn-secondary">ğŸ”„ Yangilash</button>
          </div>
        </div>
        <div class="overflow-x-auto">
          <table class="min-w-full text-sm">
            <thead>
              <tr class="text-left text-gray-500">
                <th class="py-2 pr-3">ID</th>
                <th class="py-2 pr-3">Ism</th>
                <th class="py-2 pr-3">Email</th>
                <th class="py-2 pr-3">Balans</th>
                <th class="py-2 pr-3">Ball (Gems)</th>
                <th class="py-2 pr-3">Rol</th>
                <th class="py-2 pr-3">Holat</th>
                <th class="py-2 pr-3">Amal</th>
              </tr>
            </thead>
            <tbody id="usersTbody"></tbody>
          </table>
        </div>
      </section>
    </div>
  </main>

  <!-- CRUD Modal -->
  <dialog id="crudModal" class="rounded-2xl w-[95vw] max-w-2xl p-0">
    <form method="dialog" class="card p-0">
      <div class="flex items-center justify-between px-5 py-3 border-b">
        <h3 id="crudTitle" class="text-lg font-semibold">Tahrirlash</h3>
        <button id="crudClose" class="px-2 py-1 text-gray-500">âœ–</button>
      </div>
      <div class="p-5 space-y-3" id="crudBody"></div>
      <div class="flex items-center justify-end gap-2 px-5 py-3 border-t">
        <button class="btn btn-secondary" value="cancel">Bekor</button>
        <button id="crudSave" class="btn btn-primary" value="default">Saqlash</button>
      </div>
    </form>
  </dialog>

  <template id="gridCardTpl">
    <div class="card overflow-hidden">
      <img class="w-full h-36 object-cover"/>
      <div class="p-3">
        <div class="font-semibold title line-clamp-1">â€”</div>
        <div class="text-xs text-gray-500 subtitle line-clamp-2">â€”</div>
        <div class="mt-2 flex items-center gap-2">
          <span class="tag rating">â­ 5.0</span>
          <a class="text-emerald-700 underline link target="_blank">Havola</a>
        </div>
        <div class="mt-3 flex gap-2">
          <button class="btn btn-secondary btn-edit">âœï¸</button>
          <button class="btn btn-secondary btn-delete">ğŸ—‘ï¸</button>
        </div>
      </div>
    </div>
  </template>

  <script type="module">
    // ===== Firebase Init =====
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js';
    import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js';
    import { getFirestore, collection, doc, getDoc, getDocs, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, query, orderBy, where, limit, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyDYwHJou_9GqHZcf8XxtTByC51Z8un8rrM",
      authDomain: "xplusy-760fa.firebaseapp.com",
      projectId: "xplusy-760fa",
      storageBucket: "xplusy-760fa.appspot.com",
      messagingSenderId: "992512966017",
      appId: "1:992512966017:web:5e919dbc9b8d8abcb43c80",
      measurementId: "G-459PLJ7P7L"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // ===== Auth (only one email allowed) =====
    const ADMIN_EMAIL = 'sohibjonmath@gmail.com';
    const btnSignIn = document.getElementById('btnSignIn');
    const btnSignOutEl = document.getElementById('btnSignOut');
    const authEmailEl = document.getElementById('authEmail');
    const adminUi = document.getElementById('adminUi');
    const accessDenied = document.getElementById('accessDenied');

    btnSignIn.addEventListener('click', async () => {
      try {
        const provider = new GoogleAuthProvider();
        await signInWithPopup(auth, provider);
      } catch (e) {
        alert('Kirishda xatolik: '+ e.message);
      }
    });
    btnSignOutEl.addEventListener('click', () => signOut(auth));

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        authEmailEl.textContent = '';
        btnSignIn.classList.remove('hidden');
        btnSignOutEl.classList.add('hidden');
        adminUi.classList.add('hidden');
        accessDenied.classList.add('hidden');
        return;
      }
      authEmailEl.textContent = user.email || '';
      btnSignIn.classList.add('hidden');
      btnSignOutEl.classList.remove('hidden');
      if (user.email !== ADMIN_EMAIL) {
        adminUi.classList.add('hidden');
        accessDenied.classList.remove('hidden');
        return;
      }
      accessDenied.classList.add('hidden');
      adminUi.classList.remove('hidden');
      // Load initial data
      selectTab('tab-dashboard');
      await loadBanner();
      await refreshAllGrids();
      await loadUsers();
    });

    // ===== Tabs =====
    document.querySelectorAll('.tab').forEach(b=>{
      b.addEventListener('click', ()=> selectTab(b.dataset.tab));
    });
    function selectTab(id){
      document.querySelectorAll('.tab-pane').forEach(p=>p.classList.add('hidden'));
      document.getElementById(id).classList.remove('hidden');
      document.querySelectorAll('.tab').forEach(t=>t.classList.remove('!bg-emerald-600','!text-white'));
      document.querySelector(`[data-tab="${id}"]`).classList.add('!bg-emerald-600','!text-white');
    }

    // ===== Banner (single doc: pages/home/banner) =====
    const btnEditBanner = document.getElementById('btnEditBanner');
    btnEditBanner.addEventListener('click', async()=>{
      const d = await getDoc(doc(db,'pages','home'));
      const banner = d.exists() ? (d.data().banner||{}) : {};
      openCrud({
        title:'Banner',
        fields:[
          {key:'imageUrl', label:'Rasm URL', type:'url', required:true, value: banner.imageUrl||''},
          {key:'title', label:'Sarlavha', type:'text', required:true, value: banner.title||''},
          {key:'subtitle', label:'Matn', type:'textarea', value: banner.subtitle||''},
          {key:'link', label:'Havola', type:'url', value: banner.link||''}
        ],
        onSave: async (vals)=>{
          await setDoc(doc(db,'pages','home'), { banner:{...vals, updatedAt: serverTimestamp()} }, { merge:true });
          await loadBanner();
        }
      });
    });
    async function loadBanner(){
      const image = document.getElementById('bannerImage');
      const title = document.getElementById('bannerTitle');
      const subtitle = document.getElementById('bannerSubtitle');
      const link = document.getElementById('bannerLink');
      const d = await getDoc(doc(db,'pages','home'));
      const banner = d.exists() ? (d.data().banner||{}) : {};
      image.src = banner.imageUrl || 'https://images.unsplash.com/photo-1549221986-3d8b6e8d3c61';
      title.textContent = banner.title || 'Matematika markazingiz uchun banner';
      subtitle.textContent = banner.subtitle || 'Bu yerda qisqa taÊ¼rif boâ€˜ladi.';
      link.textContent = banner.link || 'â€”';
      link.href = banner.link || '#';
    }

    // ===== Generic Grid CRUD =====
    const grids = [
      { name:'courses', title:'Kurs', addBtnId:'addCourse', gridId:'coursesGrid', fields:[
        {key:'imageUrl', label:'Rasm URL', type:'url', required:true},
        {key:'title', label:'Sarlavha', type:'text', required:true},
        {key:'subtitle', label:'Qisqa matn', type:'textarea'},
        {key:'link', label:'Havola', type:'url'},
        {key:'rating', label:'Reyting (0-5)', type:'number', step:'0.1', value:5}
      ]},
      { name:'tests', title:'Test', addBtnId:'addTest', gridId:'testsGrid', fields:[
        {key:'imageUrl', label:'Rasm URL', type:'url', required:true},
        {key:'title', label:'Sarlavha', type:'text', required:true},
        {key:'subtitle', label:'Qisqa matn', type:'textarea'},
        {key:'link', label:'Havola', type:'url'},
        {key:'rating', label:'Murakkablik (0-5)', type:'number', step:'0.1', value:4.5}
      ]},
      { name:'simulators', title:'Simulyator', addBtnId:'addSimulator', gridId:'simulatorsGrid', fields:[
        {key:'imageUrl', label:'Rasm URL', type:'url', required:true},
        {key:'title', label:'Sarlavha', type:'text', required:true},
        {key:'subtitle', label:'Qisqa matn', type:'textarea'},
        {key:'link', label:'Havola', type:'url'},
        {key:'rating', label:'Foydalilik (0-5)', type:'number', step:'0.1', value:4.8}
      ]},
      { name:'promos', title:'Promo kod', addBtnId:'addPromo', gridId:'promosGrid', fields:[
        {key:'code', label:'Kod (masalan: MC25)', type:'text', required:true},
        {key:'discountPercent', label:'Chegirma %', type:'number', value:25},
        {key:'maxUses', label:'Maks. foydalanish', type:'number', value:100},
        {key:'usedCount', label:'Ishlatilgan', type:'number', value:0},
        {key:'active', label:'Faol', type:'checkbox', value:true},
        {key:'expiresAt', label:'Tugash sanasi (YYYY-MM-DD)', type:'date'}
      ]}
    ];

    for (const g of grids){
      document.getElementById(g.addBtnId).addEventListener('click', ()=>
        openCrud({ title: g.title + ' qo\'shish', fields: g.fields, onSave: async(vals)=>{
          vals.createdAt = serverTimestamp();
          await addDoc(collection(db, g.name), vals);
        }})
      );
    }

    async function refreshAllGrids(){
      for (const g of grids){ await loadGrid(g); }
    }

    async function loadGrid(g){
      const wrap = document.getElementById(g.gridId);
      wrap.innerHTML = '<div class="text-sm text-gray-500">Yuklanmoqdaâ€¦</div>';
      const qs = query(collection(db,g.name), orderBy('createdAt','desc'));
      const snap = await getDocs(qs);
      wrap.innerHTML = '';
      snap.forEach(docu=>{
        const data = { id:docu.id, ...docu.data() };
        wrap.appendChild(makeCard(g, data));
      });
    }

    function makeCard(g, data){
      const tpl = document.getElementById('gridCardTpl');
      const el = tpl.content.cloneNode(true);
      const img = el.querySelector('img');
      const title = el.querySelector('.title');
      const sub = el.querySelector('.subtitle');
      const link = el.querySelector('.link');
      const rating = el.querySelector('.rating');
      img.src = data.imageUrl || 'https://images.unsplash.com/photo-1529101091764-c3526daf38fe';
      title.textContent = data.title || (data.code ? ('Kod: '+data.code) : 'â€”');
      sub.textContent = data.subtitle || (g.name==='promos' ? `Chegirma: ${data.discountPercent||0}% | Max: ${data.maxUses||0} | Ishlatilgan: ${data.usedCount||0}` : 'â€”');
      if (g.name==='promos'){
        rating.textContent = (data.active? 'âœ… Faol' : 'â›” Nofaol');
      } else {
        rating.textContent = `â­ ${Number(data.rating||0).toFixed(1)}`;
      }
      link.textContent = data.link ? 'Havola' : 'â€”';
      link.href = data.link || '#';
      // actions
      el.querySelector('.btn-edit').addEventListener('click', ()=>{
        const fields = g.fields.map(f=> ({...f, value: data[f.key] ?? (f.type==='checkbox'? false: '') }));
        openCrud({ title: g.title + ' tahrirlash', fields, onSave: async(vals)=>{
          await updateDoc(doc(db, g.name, data.id), vals);
          loadGrid(g);
        }});
      });
      el.querySelector('.btn-delete').addEventListener('click', async()=>{
        if (confirm('O\'chirishni tasdiqlaysizmi?')){
          await deleteDoc(doc(db, g.name, data.id));
          loadGrid(g);
        }
      });
      return el;
    }

    // ===== Users =====
    const usersTbody = document.getElementById('usersTbody');
    const userSearch = document.getElementById('userSearch');
    const btnReloadUsers = document.getElementById('btnReloadUsers');

    btnReloadUsers.addEventListener('click', ()=> loadUsers());
    userSearch.addEventListener('input', ()=> loadUsers(userSearch.value.trim()));

    async function loadUsers(qStr=''){
      usersTbody.innerHTML = '<tr><td class="py-3 text-sm text-gray-500" colspan="8">Yuklanmoqdaâ€¦</td></tr>';
      let qsRef = query(collection(db,'users'), orderBy('numericId','asc'), limit(100));
      // For simple client-side filtering after fetch (Firestore simple demo)
      const snap = await getDocs(qsRef);
      usersTbody.innerHTML = '';
      snap.forEach(d=>{
        const u = { id:d.id, ...d.data() };
        const needle = qStr.toLowerCase();
        const hay = `${u.numericId||''} ${u.name||''} ${u.email||''}`.toLowerCase();
        if (needle && !hay.includes(needle)) return;
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="py-2 pr-3">${u.numericId||'â€”'}</td>
          <td class="py-2 pr-3">${escapeHtml(u.name||'â€”')}</td>
          <td class="py-2 pr-3">${escapeHtml(u.email||'â€”')}</td>
          <td class="py-2 pr-3">${Number(u.balance||0).toFixed(2)}</td>
          <td class="py-2 pr-3">${Number(u.gems||0)}</td>
          <td class="py-2 pr-3">${escapeHtml(u.role||'user')}</td>
          <td class="py-2 pr-3">${escapeHtml(u.status||'active')}</td>
          <td class="py-2 pr-3">
            <button class="btn btn-secondary btn-edit-user">âœï¸</button>
          </td>`;
        tr.querySelector('.btn-edit-user').addEventListener('click', ()=>{
          openCrud({ title:'Foydalanuvchi tahrirlash', fields:[
            {key:'name', label:'Ism', type:'text', value:u.name||''},
            {key:'balance', label:'Balans', type:'number', value:u.balance||0},
            {key:'gems', label:'Ball (Gems)', type:'number', value:u.gems||0},
            {key:'role', label:'Rol (user/admin)', type:'text', value:u.role||'user'},
            {key:'status', label:'Holat (active/banned)', type:'text', value:u.status||'active'}
          ], onSave: async(vals)=>{
            await updateDoc(doc(db,'users',u.id), vals);
            loadUsers(userSearch.value.trim());
          }});
        });
        usersTbody.appendChild(tr);
      });
      if (!usersTbody.children.length){
        usersTbody.innerHTML = '<tr><td class="py-3 text-sm text-gray-500" colspan="8">Hech narsa topilmadi</td></tr>';
      }
    }

    // ===== CRUD Modal helper =====
    const crudModal = document.getElementById('crudModal');
    const crudTitle = document.getElementById('crudTitle');
    const crudBody = document.getElementById('crudBody');
    const crudSave = document.getElementById('crudSave');
    const crudClose = document.getElementById('crudClose');
    crudClose.addEventListener('click', (e)=>{ e.preventDefault(); crudModal.close(); });

    function openCrud({ title, fields, onSave }){
      crudTitle.textContent = title;
      crudBody.innerHTML = '';
      fields.forEach(f=>{
        const wrap = document.createElement('div');
        wrap.innerHTML = `
          <label class="text-sm text-gray-600">${f.label}${f.required? ' *':''}</label>
          ${ inputHtml(f) }
        `;
        if (f.type==='checkbox'){
          const inp = wrap.querySelector('input');
          inp.checked = !!f.value;
        } else {
          const inp = wrap.querySelector('input,textarea');
          if (inp) inp.value = f.value ?? '';
        }
        crudBody.appendChild(wrap);
      });
      crudModal.showModal();
      crudSave.onclick = async (e)=>{
        e.preventDefault();
        const vals = {};
        const inputs = crudBody.querySelectorAll('input,textarea');
        for (const el of inputs){
          const key = el.name;
          let v = (el.type==='checkbox') ? el.checked : el.value;
          if (el.type==='number') v = Number(v);
          if (el.required && !v){ alert('Majburiy maydon: '+ key); return; }
          vals[key] = v;
        }
        try{
          await onSave(vals);
          crudModal.close();
        }catch(err){
          alert('Saqlashda xatolik: '+ err.message);
        }
      };
    }
    function inputHtml(f){
      const base = `name="${f.key}" class="input" ${f.required? 'required':''}`;
      if (f.type==='textarea') return `<textarea ${base} rows="3"></textarea>`;
      if (f.type==='checkbox') return `<input type="checkbox" ${base}>`;
      const extra = f.step? ` step="${f.step}"` : '';
      return `<input type="${f.type||'text'}" ${base}${extra}>`;
    }
    function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c])); }

    // ===== Seed 6 sample docs for each collection =====
    document.getElementById('btnSeedAll').addEventListener('click', async()=>{
      if (!confirm('Har bir bo\'lim uchun 6 tadan namuna yaratiladi. Davom etaymi?')) return;
      await seedSamples();
      await refreshAllGrids();
    });

    async function seedSamples(){
      const now = new Date().toISOString().slice(0,10);
      const pics = [
        'https://images.unsplash.com/photo-1509228627152-72ae9ae6848d',
        'https://images.unsplash.com/photo-1523580846011-d3a5bc25702b',
        'https://images.unsplash.com/photo-1496307042754-b4aa456c4a2d',
        'https://images.unsplash.com/photo-1523246191915-33d1c9fbb6fd',
        'https://images.unsplash.com/photo-1522075469751-3a6694fb2f61',
        'https://images.unsplash.com/photo-1554469384-e58fac16e23a'
      ];
      const make = (i, kind)=>({
        imageUrl: pics[i%pics.length],
        title: `${kind} #${i+1}`,
        subtitle: `${kind} uchun qisqa tavsif` ,
        link: '#',
        rating: 4 + ((i%5)/10),
        createdAt: serverTimestamp()
      });
      for (let i=0;i<6;i++) await addDoc(collection(db,'courses'), make(i,'Kurs'));
      for (let i=0;i<6;i++) await addDoc(collection(db,'tests'), make(i,'Test'));
      for (let i=0;i<6;i++) await addDoc(collection(db,'simulators'), make(i,'Simulyator'));
      const promoSamples = [
        {code:'MC10', discountPercent:10, maxUses:100, usedCount:0, active:true, createdAt: serverTimestamp(), expiresAt: now},
        {code:'MC15', discountPercent:15, maxUses:100, usedCount:0, active:true, createdAt: serverTimestamp(), expiresAt: now},
        {code:'MC20', discountPercent:20, maxUses:100, usedCount:0, active:true, createdAt: serverTimestamp(), expiresAt: now},
        {code:'NEW25', discountPercent:25, maxUses:50, usedCount:0, active:true, createdAt: serverTimestamp(), expiresAt: now},
        {code:'VIP30', discountPercent:30, maxUses:30, usedCount:0, active:true, createdAt: serverTimestamp(), expiresAt: now},
        {code:'XPLUSY40', discountPercent:40, maxUses:10, usedCount:0, active:false, createdAt: serverTimestamp(), expiresAt: now}
      ];
      for (const p of promoSamples) await addDoc(collection(db,'promos'), p);
      await setDoc(doc(db,'pages','home'), { banner:{
        imageUrl:pics[0], title:'MathCenter â€” yangi mavsum!', subtitle:'Eng yaxshi kurslar, testlar va simulyatorlar bitta joyda', link:'#', updatedAt: serverTimestamp()
      }} , {merge:true});
    }
  </script>
</body>
</html>
