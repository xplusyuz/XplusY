<!doctype html><html lang="uz"><head>
<meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>LeaderMath — Admin</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
<style>
:root{--p:#2E8B57;--p2:#22c55e;--bg:#0B1220;--b:rgba(255,255,255,.12);--t:#EAF2FF;--m:rgba(234,242,255,.72)}
*{box-sizing:border-box;margin:0;padding:0} body{font-family:system-ui;background:linear-gradient(180deg,#070B14,#0B1220);color:var(--t);min-height:100vh}
.wrap{max-width:1100px;margin:0 auto;padding:16px}
.card{border-radius:22px;background:rgba(255,255,255,.08);border:1px solid var(--b);padding:16px}
h1{font-size:18px} p{color:var(--m);margin-top:6px;line-height:1.45}
textarea{width:100%;min-height:420px;margin-top:12px;border-radius:18px;border:1px solid var(--b);background:rgba(0,0,0,.25);color:var(--t);padding:12px;font-family:ui-monospace,Menlo,Consolas,monospace}
.btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
button{border:none;border-radius:999px;padding:12px 14px;font-weight:900;cursor:pointer}
.primary{background:linear-gradient(135deg,var(--p),var(--p2));color:#061013}
.ghost{background:rgba(255,255,255,.10);border:1px solid var(--b);color:var(--t)}
small{color:var(--m);display:block;margin-top:10px}
input{width:100%;margin-top:10px;border-radius:999px;border:1px solid var(--b);background:rgba(0,0,0,.25);color:var(--t);padding:12px}
</style></head><body>
<div class="wrap">
  <div class="card">
    <h1>Admin — Home Content</h1>
    <p>Bu sahifa <code>content/home</code> docni API orqali yangilaydi. Admin bo‘lish: user role=admin yoki <code>X-Admin-Token</code>.</p>
    <input id="tok" placeholder="ADMIN_TOKEN (ixtiyoriy)"/>
    <div class="btns">
      <button class="ghost" id="load">Yuklash</button>
      <button class="primary" id="pub">Publish</button>
      <button class="ghost" id="toPortal">Portal</button>
      <button class="ghost" id="logout">Chiqish</button>
    </div>
    <textarea id="ed"></textarea>
    <small id="st">—</small>
  </div>
</div>
<script src="api-client.js"></script><script src="auth-client.js"></script>
<script>
const $=id=>document.getElementById(id);
const status=t=>$('st').textContent=t;

$('toPortal').onclick=()=>location.href='index.html';
$('logout').onclick=async()=>{await lmAuth.logout();location.href='login.html';};

async function boot(){
  await lmAuth.require();
  await load();
}
async function load(){
  status('Yuklanmoqda…');
  try{
    const data = await lmApi.home();
    $('ed').value = JSON.stringify({navItems:data.navItems||[],banners:data.banners||[],cards:data.cards||[]},null,2);
    status('Yuklandi ✅');
  }catch(e){ status('Xato: '+(e.message||'')); }
}
$('load').onclick=load;
$('pub').onclick=async()=>{
  status('Publish…');
  try{
    const obj = JSON.parse($('ed').value);
    await lmApi.adminSetHome(obj, $('tok').value.trim());
    status('Publish bo‘ldi ✅');
  }catch(e){ status('Xato: '+(e.message||'')); }
};
boot();
</script>
</body></html>
