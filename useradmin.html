<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel - X+Y.uz</title>
  <style>
   <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background-color: #f5f7f9;
      color: #333;
      line-height: 1.6;
      padding: 20px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
      padding: 20px;
    }
    
    h1 {
      text-align: center;
      color: #2c3e50;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid #ecf0f1;
    }
    
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
      justify-content: space-between;
      align-items: center;
    }
    
    .search-box {
      flex: 1;
      min-width: 200px;
      padding: 10px 15px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
    }
    
    button {
      padding: 10px 15px;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s;
    }
    
    button:hover {
      background-color: #2980b9;
    }
    
    button:disabled {
      background-color: #95a5a6;
      cursor: not-allowed;
    }
    
    .btn-success {
      background-color: #2ecc71;
    }
    
    .btn-success:hover {
      background-color: #27ae60;
    }
    
    .btn-danger {
      background-color: #e74c3c;
    }
    
    .btn-danger:hover {
      background-color: #c0392b;
    }
    
    .status-message {
      padding: 10px 15px;
      margin-bottom: 15px;
      border-radius: 4px;
      text-align: center;
    }
    
    .status-message.success {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    .status-message.error {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    
    th, td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    
    th {
      background-color: #f2f2f2;
      font-weight: bold;
    }
    
    tr:hover {
      background-color: #f5f5f5;
    }
    
    input[type="number"] {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    
    .action-buttons {
      display: flex;
      gap: 5px;
    }
    
    .action-buttons button {
      padding: 6px 10px;
      font-size: 14px;
    }
    
    .empty-state {
      text-align: center;
      padding: 40px;
      color: #7f8c8d;
    }
    
    .empty-state i {
      font-size: 48px;
      margin-bottom: 15px;
      color: #bdc3c7;
    }
    
    @media (max-width: 768px) {
      .controls {
        flex-direction: column;
        align-items: stretch;
      }
      
      table {
        display: block;
        overflow-x: auto;
      }
      
      .action-buttons {
        flex-direction: column;
      }
    }
  </style>
  </style>
</head>
<body>
  <div class="container">
    <h1>Foydalanuvchi Balanslari Boshqaruvi</h1>
    
    <div class="controls">
      <input type="text" id="searchInput" class="search-box" placeholder="Foydalanuvchi qidirish...">
      <button id="refreshBtn">Yangilash</button>
      <button id="syncBtn" class="btn-warning">Index'dan Sinxronlash</button>
      <button id="addUserBtn" class="btn-success">+ Yangi</button>
      <button id="exportBtn">Yuklab Olish</button>
      <input type="file" id="importFile" accept=".json" style="display: none;">
      <button id="importBtn">Import Qilish</button>
    </div>
    
    <div id="statusMessage" class="status-message" style="display: none;"></div>
    <table id="usersTable">
      <thead>
        <tr>
          <th>ID</th>
          <th>Username</th>
          <th>Ism</th>
          <th>Balans</th>
          <th>Harakatlar</th>
        </tr>
      </thead>
      <tbody id="usersList">
        <!-- Foydalanuvchilar ro'yxati JavaScript orqali to'ldiriladi -->
      </tbody>
    </table>
    
    <div id="emptyState" class="empty-state" style="display: none;">
      <i class="fas fa-users"></i>
      <h3>Hozircha foydalanuvchilar mavjud emas</h3>
      <p>Yangi foydalanuvchi qo'shish uchun "Yangi Foydalanuvchi" tugmasini bosing.</p>
    </div>
  </div>

  <!-- Yangi foydalanuvchi qo'shish modali -->
  <div id="addUserModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
    <div style="background: white; padding: 20px; border-radius: 8px; width: 90%; max-width: 500px;">
      <h2 style="margin-bottom: 20px;">Yangi Foydalanuvchi Qo'shish</h2>
      <div style="margin-bottom: 15px;">
        <label style="display: block; margin-bottom: 5px;">ID:</label>
        <input type="number" id="newUserId" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
      </div>
      <div style="margin-bottom: 15px;">
        <label style="display: block; margin-bottom: 5px;">Username:</label>
        <input type="text" id="newUserUsername" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" placeholder="@username">
      </div>
      <div style="margin-bottom: 15px;">
        <label style="display: block; margin-bottom: 5px;">Ism:</label>
        <input type="text" id="newUserName" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
      </div>
      <div style="margin-bottom: 20px;">
        <label style="display: block; margin-bottom: 5px;">Boshlang'ich Balans:</label>
        <input type="number" id="newUserBalance" value="0" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
      </div>
      <div style="display: flex; gap: 10px; justify-content: flex-end;">
        <button id="cancelAddUser" class="btn-danger">Bekor Qilish</button>
        <button id="confirmAddUser" class="btn-success">Qo'shish</button>
      </div>
    </div>
  </div>
  <script>
    // ================= LOCALSTORAGE FUNCTIONS =================
    function getUsers() {
      const usersJSON = localStorage.getItem('xplusy_users');
      return usersJSON ? JSON.parse(usersJSON) : [];
    }

    function saveUsers(users) {
      localStorage.setItem('xplusy_users', JSON.stringify(users));
    }

    // ================= SINXRONLASH FUNKSIYASI =================
    function syncFromIndexPage() {
      try {
        // Boshqa brauzer/lokalstorage dan ma'lumotlarni o'qish
        const promptMessage = "Iltimos, index sahifasida brauzer konsolini oching va quyidagi komandani kiriting:\n\n" +
                             "copy(localStorage.getItem('xplusy_users'))\n\n" +
                             "Keyin chiqgan natijani bu yerga joylang:";
        
        const jsonData = prompt(promptMessage);
        
        if (jsonData && jsonData !== 'null') {
          const parsedUsers = JSON.parse(jsonData);
          saveUsers(parsedUsers);
          loadUsers();
          showStatus('Ma\'lumotlar muvaffaqiyatli sinxronlashtirildi!', 'success');
        } else {
          showStatus('Bekor qilindi yoki ma\'lumotlar topilmadi', 'error');
        }
      } catch (error) {
        showStatus('Xatolik: ' + error.message, 'error');
      }
    }

    // ================= SAHIFA YUKLANGANDA =================
    document.addEventListener('DOMContentLoaded', function() {
      // ... avvalgi kod ...
      
      // Sinxronlash tugmasi
      document.getElementById('syncBtn').addEventListener('click', syncFromIndexPage);
      
      // Import tugmasi
      document.getElementById('importBtn').addEventListener('click', function() {
        document.getElementById('importFile').click();
      });
      
      // Fayl yuklanganida
      document.getElementById('importFile').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function(e) {
            try {
              const importedData = JSON.parse(e.target.result);
              saveUsers(importedData);
              loadUsers();
              showStatus('Ma\'lumotlar import qilindi!', 'success');
            } catch (error) {
              showStatus('Noto‘g‘ri fayl formati', 'error');
            }
          };
          reader.readAsText(file);
        }
      });
    });
	    // LocalStorage dan foydalanuvchilarni olish
    function getUsers() {
      const usersJSON = localStorage.getItem('xplusy_users');
      return usersJSON ? JSON.parse(usersJSON) : [];
    }

    // LocalStorage ga foydalanuvchilarni saqlash
    function saveUsers(users) {
      localStorage.setItem('xplusy_users', JSON.stringify(users));
    }

    // Foydalanuvchi balansini yangilash
    function updateUserBalance(userId, newBalance) {
      const users = getUsers();
      const userIndex = users.findIndex(u => u.id === userId);
      
      if (userIndex !== -1) {
        users[userIndex].balans = parseInt(newBalance);
        saveUsers(users);
        return true;
      }
      
      return false;
    }

    // Yangi foydalanuvchi qo'shish
    function addNewUser(userData) {
      const users = getUsers();
      
      // ID unikal ligini tekshirish
      if (users.some(user => user.id === userData.id)) {
        return { success: false, error: 'Bu ID allaqachon mavjud' };
      }
      
      users.push({
        id: parseInt(userData.id),
        username: userData.username,
        first_name: userData.first_name,
        balans: parseInt(userData.balans)
      });
      
      saveUsers(users);
      return { success: true };
    }

    // Foydalanuvchini o'chirish
    function deleteUser(userId) {
      const users = getUsers();
      const filteredUsers = users.filter(user => user.id !== userId);
      saveUsers(filteredUsers);
      return users.length !== filteredUsers.length;
    }

    // Status xabarini ko'rsatish
    function showStatus(message, type = 'error') {
      const statusEl = document.getElementById('statusMessage');
      statusEl.textContent = message;
      statusEl.className = `status-message ${type}`;
      statusEl.style.display = 'block';
      
      if (type === 'success') {
        setTimeout(() => {
          statusEl.style.display = 'none';
        }, 3000);
      }
    }

    // Foydalanuvchilar ro'yxatini yuklash
    function loadUsers() {
      const users = getUsers();
      const usersList = document.getElementById('usersList');
      const emptyState = document.getElementById('emptyState');
      const usersTable = document.getElementById('usersTable');
      
      usersList.innerHTML = '';
      
      if (users.length > 0) {
        usersTable.style.display = 'table';
        emptyState.style.display = 'none';
        
        users.forEach(user => {
          const row = document.createElement('tr');
          
          row.innerHTML = `
            <td>${user.id}</td>
            <td>${user.username ? '@' + user.username : 'N/A'}</td>
            <td>${user.first_name || 'N/A'}</td>
            <td>
              <input type="number" id="balance-${user.id}" value="${user.balans || 0}">
            </td>
            <td>
              <div class="action-buttons">
                <button onclick="updateBalance(${user.id})" class="btn-success">Yangilash</button>
                <button onclick="deleteUserConfirm(${user.id})" class="btn-danger">O'chirish</button>
              </div>
            </td>
          `;
          
          usersList.appendChild(row);
        });
        
        showStatus(`${users.length} ta foydalanuvchi topildi`, 'success');
      } else {
        usersTable.style.display = 'none';
        emptyState.style.display = 'block';
        showStatus('Foydalanuvchilar topilmadi', 'error');
      }
    }

    // Balansni yangilash
    function updateBalance(userId) {
      try {
        const newBalance = document.getElementById(`balance-${userId}`).value;
        
        if (!newBalance || isNaN(newBalance)) {
          showStatus('Iltimos, toʻgʻri balans kiriting', 'error');
          return;
        }
        
        const success = updateUserBalance(userId, parseInt(newBalance));
        
        if (success) {
          showStatus('Balans muvaffaqiyatli yangilandi', 'success');
        } else {
          showStatus('Foydalanuvchi topilmadi', 'error');
        }
      } catch (error) {
        console.error('Xatolik:', error);
        showStatus(`Xatolik: ${error.message}`, 'error');
      }
    }

    // Foydalanuvchini o'chirishni tasdiqlash
    function deleteUserConfirm(userId) {
      if (confirm('Rostan ham bu foydalanuvchini oʻchirmoqchimisiz?')) {
        const success = deleteUser(userId);
        
        if (success) {
          showStatus('Foydalanuvchi muvaffaqiyatli oʻchirildi', 'success');
          loadUsers(); // Ro'yxatni yangilash
        } else {
          showStatus('Foydalanuvchini oʻchirishda xatolik', 'error');
        }
      }
    }

    // Qidiruv funksiyasi
    function setupSearch() {
      const searchInput = document.getElementById('searchInput');
      searchInput.addEventListener('input', function() {
        const searchText = this.value.toLowerCase();
        const rows = document.querySelectorAll('#usersList tr');
        let visibleCount = 0;
        
        rows.forEach(row => {
          const id = row.cells[0].textContent.toLowerCase();
          const username = row.cells[1].textContent.toLowerCase();
          const name = row.cells[2].textContent.toLowerCase();
          
          if (id.includes(searchText) || username.includes(searchText) || name.includes(searchText)) {
            row.style.display = '';
            visibleCount++;
          } else {
            row.style.display = 'none';
          }
        });
        
        // Agar hech narsa topilmasa
        if (visibleCount === 0 && searchText) {
          showStatus('Qidiruv boʻyicha hech narsa topilmadi', 'error');
        }
      });
    }

    // Ma'lumotlarni JSON fayl sifatida yuklab olish
    function exportData() {
      const users = getUsers();
      const dataStr = JSON.stringify(users, null, 2);
      const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
      
      const exportFileDefaultName = `xplusy_users_${new Date().toISOString().slice(0,10)}.json`;
      
      const linkElement = document.createElement('a');
      linkElement.setAttribute('href', dataUri);
      linkElement.setAttribute('download', exportFileDefaultName);
      linkElement.click();
      
      showStatus('Ma\'lumotlar yuklab olindi', 'success');
    }

    // Modalni boshqarish
    function setupModals() {
      const addUserModal = document.getElementById('addUserModal');
      const addUserBtn = document.getElementById('addUserBtn');
      const cancelAddUser = document.getElementById('cancelAddUser');
      const confirmAddUser = document.getElementById('confirmAddUser');
      
      // Modalni ochish
      addUserBtn.addEventListener('click', () => {
        addUserModal.style.display = 'flex';
      });
      
      // Modalni yopish
      cancelAddUser.addEventListener('click', () => {
        addUserModal.style.display = 'none';
      });
      
      // Yangi foydalanuvchi qo'shish
      confirmAddUser.addEventListener('click', () => {
        const newUserId = document.getElementById('newUserId').value;
        const newUserUsername = document.getElementById('newUserUsername').value;
        const newUserName = document.getElementById('newUserName').value;
        const newUserBalance = document.getElementById('newUserBalance').value;
        
        if (!newUserId || !newUserUsername || !newUserName) {
          showStatus('Iltimos, barcha maydonlarni toʻldiring', 'error');
          return;
        }
        
        const result = addNewUser({
          id: newUserId,
          username: newUserUsername,
          first_name: newUserName,
          balans: newUserBalance
        });
        
        if (result.success) {
          addUserModal.style.display = 'none';
          showStatus('Yangi foydalanuvchi muvaffaqiyatli qoʻshildi', 'success');
          loadUsers(); // Ro'yxatni yangilash
          
          // Maydonlarni tozalash
          document.getElementById('newUserId').value = '';
          document.getElementById('newUserUsername').value = '';
          document.getElementById('newUserName').value = '';
          document.getElementById('newUserBalance').value = '0';
        } else {
          showStatus(result.error, 'error');
        }
      });
      
      // Modal tashqarisiga bosilganda yopish
      addUserModal.addEventListener('click', (e) => {
        if (e.target === addUserModal) {
          addUserModal.style.display = 'none';
        }
      });
    }

    // Sahifa yuklanganda
    document.addEventListener('DOMContentLoaded', function() {
      // Dastlabki yuklash
      loadUsers();
      setupSearch();
      setupModals();
      
      // Yangilash tugmasi
      document.getElementById('refreshBtn').addEventListener('click', loadUsers);
      
      // Yuklab olish tugmasi
      document.getElementById('exportBtn').addEventListener('click', exportData);
      
      // Demo ma'lumotlar (agar bo'sh bo'lsa)
      const users = getUsers();
      if (users.length === 0)
  </script>
</body>
</html>