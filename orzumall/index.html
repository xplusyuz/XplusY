<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8">
  <title>OrzuMall</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>

<h3>Telegram Login Test</h3>

<script>
const tg = Telegram.WebApp;
tg.ready();

console.log("Telegram object:", tg);
console.log("Init data:", tg.initDataUnsafe);

if (!tg.initDataUnsafe.user) {
  alert("‚ùå Telegram user yo‚Äòq. WebApp bot ichida ochilmagan!");
} else {
  const u = tg.initDataUnsafe.user;

  alert("‚úÖ Telegram user topildi: " + u.id);

  fetch("https://wxxfjklwgnxuvxhrs.supabase.co/functions/v1/telegram-login", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "apikey": "sb_publishable__b8F70lFPo2LaQrDjW7dcA_nP5m3HDn"
    },
    body: JSON.stringify({
      telegram_id: u.id,
      username: u.username || "",
      full_name: u.first_name || ""
    })
  })
  .then(r => r.text())
  .then(t => {
    console.log("Function response:", t);
    alert("üì§ Yuborildi: " + t);
  })
  .catch(e => {
    console.error(e);
    alert("‚ùå Xato: " + e.message);
  });
}
</script>

</body>
</html>
