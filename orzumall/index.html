<h2>ðŸ›’ Mahsulotlar</h2>
<div id="products"></div>

<button onclick="order()">Buyurtma berish</button>

<script>
let tg = window.Telegram.WebApp;
tg.ready();

const user = tg.initDataUnsafe.user;
let cart = [];

fetch("/.netlify/functions/api", {
  method: "POST",
  body: JSON.stringify({ action: "get_products" })
})
.then(r => r.json())
.then(products => {
  const el = document.getElementById("products");
  products.forEach(p => {
    el.innerHTML += `
      <div>
        ${p.title} â€” ${p.price} soâ€˜m
        <button onclick='cart.push(${JSON.stringify(p)})'>+</button>
      </div>
    `;
  });
});

function order() {
  const total = cart.reduce((s,p)=>s+p.price,0);

  fetch("/.netlify/functions/api", {
    method: "POST",
    body: JSON.stringify({
      action: "create_order",
      telegram_id: user.id,
      username: user.username,
      items: cart,
      total
    })
  }).then(()=>alert("Buyurtma yuborildi âœ…"));
}
</script>
