<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8">
  <title>OrzuMall</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>

<h3>Telegram Login Test</h3>

<script>
const tg = Telegram.WebApp;
tg.ready();

const SUPABASE_URL = "https://wxxfjklwgnxuvxhrs.supabase.co";
const SUPABASE_ANON_KEY = "sb_publishable__b8F70lFPo2LaQrDjW7dcA_nP5m3HDn";

if (!tg.initDataUnsafe.user) {
  alert("‚ùå Telegram user yo‚Äòq");
} else {
  const u = tg.initDataUnsafe.user;
  alert("‚úÖ Telegram user topildi: " + u.id);

  fetch(`${SUPABASE_URL}/functions/telegram-login`, {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "apikey": SUPABASE_ANON_KEY,
      "Authorization": `Bearer ${SUPABASE_ANON_KEY}`
    },
    body: JSON.stringify({
      telegram_id: u.id,
      username: u.username || "",
      full_name: u.first_name || ""
    })
  })
  .then(res => res.text())
  .then(txt => {
    console.log("Function response:", txt);
    alert("üì§ Edge Function javob berdi");
  })
  .catch(err => {
    console.error(err);
    alert("‚ùå Fetch xato: " + err.message);
  });
}
</script>


</body>
</html>
