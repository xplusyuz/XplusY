<header class="main-header">
  <div class="container header-inner">
    <!-- SVG Logo (XplusY.uz) -->
    <a class="brand" href="index.html" aria-label="XplusY.uz">
      <span class="brand-badge" aria-hidden="true">
        <!-- plus in a circle -->
        <svg viewBox="0 0 24 24" role="presentation"><path d="M12 2a10 10 0 1 0 .001 20.001A10 10 0 0 0 12 2Zm1 6v3h3a1 1 0 1 1 0 2h-3v3a1 1 0 1 1-2 0v-3H8a1 1 0 1 1 0-2h3V8a1 1 0 1 1 2 0Z"/></svg>
      </span>
      <span class="brand-text">XplusY<span class="brand-dot">.uz</span></span>
    </a>

    <!-- User cluster -->
    <nav class="user-info">
      <div class="user-pill" title="Foydalanuvchi ID">
        <div class="kv">ID</div>
        <div class="val" id="userId">---</div>
      </div>
      <div class="user-pill" title="Balans">
        <div class="kv">Balans</div>
        <div class="val" id="userBalance">0</div>
      </div>
      <div class="user-pill" title="Ball">
        <div class="kv">Ball</div>
        <div class="val" id="userPoints">0</div>
      </div>
      <button class="btn" id="refreshUser" type="button">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4C7.58 4 4.01 7.58 4.01 12C4.01 16.42 7.58 20 12 20C15.73 20 18.84 17.45 19.73 14H17.65C16.83 16.33 14.61 18 12 18C8.69 18 6 15.31 6 12C6 8.69 8.69 6 12 6C13.66 6 15.14 6.69 16.22 7.78L13 11H20V4L17.65 6.35Z" fill="currentColor"/>
        </svg> 
      </button>

      <!-- Avatar (SVG) + Profile link -->
      <a class="avatar-btn" href="profile.html" title="Profilga o'tish">
        <span class="avatar" aria-hidden="true">
          <!-- user icon -->
          <svg viewBox="0 0 24 24" role="presentation"><path d="M12 12a5 5 0 1 0 0-10 5 5 0 0 0 0 10Zm0 2c-5.33 0-8 2.667-8 5.333V21a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-1.667C20 16.667 17.333 14 12 14Z"/></svg>
        </span>
        <span class="name" id="headerName">
          <span style="color: #007bff;">Salom! </span>
          <span>Profil</span>
        </span>
      </a>

      <!-- Theme switch (kun/tun) -->
      <div class="theme-toggle" role="button" aria-label="Kun/Tun rejim" onclick="toggleTheme()">
        <div class="switch"><div class="knob"></div></div>
      </div>
    </nav>
  </div>
</header>

<script>
// Integrates with your existing firebase.js getUser() method
document.addEventListener('click', async (e) => {
  if(e.target.id === 'refreshUser' || e.target.closest('#refreshUser')){
    // TODO: replace with current user id from auth/session
    const user = await getUser('100001');
    if(user){
      document.getElementById('userId').textContent = user.id;
      document.getElementById('userBalance').textContent = user.balance ?? 0;
      document.getElementById('userPoints').textContent = user.points ?? 0;
      
      // Yangilangan ismni "Salom! Ism" formatida ko'rsatish
      const userName = user.first_name ? (user.first_name + (user.last_name ? ' ' + user.last_name : '')) : 'Profil';
      document.getElementById('headerName').innerHTML = '<span style="color: #007bff;">Salom! </span>' + userName;
      
      // Yangilash animatsiyasi
      const refreshBtn = document.getElementById('refreshUser');
      refreshBtn.style.transform = 'rotate(360deg)';
      setTimeout(() => {
        refreshBtn.style.transform = 'rotate(0deg)';
      }, 500);
    }
  }
});
</script>