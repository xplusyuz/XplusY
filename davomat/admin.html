<!doctype html>
<html lang="uz">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>Maktab Davomati ‚Äî Ta‚Äôtil va ish kunlari (Admin)</title>

  <style>
    :root{
      --brand:#2E8B57; --brand-dark:#1F6B45;
      --bg:#F4F8F6; --card:#FFFFFF;
      --text:#102218; --muted:#667a6f;
      --line:#dfe7e2; --shadow:0 18px 40px rgba(12,35,22,.12);
      --radius:18px; --speed:.25s;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;}
    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:radial-gradient(circle at top,#f0fff6 0,#f5faf7 40%,#edf4ef 100%);
      color:var(--text);
    }
    header{
      position:sticky;top:0;z-index:10;
      backdrop-filter:blur(18px);
      background:linear-gradient(120deg,rgba(244,248,246,.95),rgba(236,246,240,.95));
      border-bottom:1px solid rgba(223,231,226,.9);
    }
    .row{max-width:800px;margin:0 auto;padding:10px 16px;display:flex;align-items:center;gap:10px;}
    .brand{display:flex;align-items:center;gap:10px;}
    .logo{
      width:32px;height:32px;border-radius:11px;
      background:conic-gradient(from 210deg,#2E8B57,#6B8E23,#2E8B57);
      display:flex;align-items:center;justify-content:center;
      color:#fff;font-weight:800;font-size:16px;
      box-shadow:0 10px 26px rgba(26,96,60,.55);
    }
    .brand-title{font-size:17px;font-weight:700;}
    .brand-sub{font-size:11px;color:var(--muted);}
    main{max-width:800px;margin:0 auto;padding:16px;display:grid;gap:12px;}
    .card{
      background:var(--card);border-radius:var(--radius);
      box-shadow:var(--shadow);border:1px solid var(--line);
      padding:14px 14px 12px;
    }
    .card-header{display:flex;justify-content:space-between;align-items:center;gap:8px;margin-bottom:8px;}
    .card-title{font-weight:650;font-size:15px;}
    .card-sub{font-size:12px;color:var(--muted);}
    label{font-size:12px;color:var(--muted);display:block;margin-bottom:3px;}
    input{
      width:100%;padding:7px 10px;border-radius:10px;
      border:1px solid var(--line);font-size:13px;background:#f9fcfa;
      outline:none;transition:border-color var(--speed),box-shadow var(--speed),background .2s;
    }
    input:focus{
      border-color:var(--brand);box-shadow:0 0 0 1px rgba(46,139,87,.28);background:#fff;
    }
    .btn{
      border:none;border-radius:999px;padding:7px 13px;font-size:13px;font-weight:600;
      cursor:pointer;display:inline-flex;align-items:center;gap:6px;
      transition:transform .15s,box-shadow .15s,background .15s;
      white-space:nowrap;
    }
    .btn-primary{
      background:linear-gradient(135deg,#2E8B57,#1F6B45);color:#fff;
      box-shadow:0 10px 26px rgba(18,92,55,.5);
    }
    .btn-primary:hover{transform:translateY(-1px);box-shadow:0 14px 32px rgba(18,92,55,.6);}
    .btn-ghost{
      background:transparent;border-radius:999px;
      padding:5px 11px;border:1px solid rgba(16,34,24,.12);
      font-size:11px;color:var(--muted);
    }
    .btn-ghost:hover{background:rgba(0,0,0,.02);}
    .btn[disabled]{opacity:.6;cursor:default;box-shadow:none;transform:none;}
    .alert{
      border-radius:12px;padding:7px 9px;font-size:11px;
      display:flex;align-items:flex-start;gap:8px;margin-bottom:8px;
    }
    .alert-icon{font-size:13px;margin-top:2px;}
    .alert-warn{background:#FFF7E5;border:1px solid #f7df99;color:#9a6407;}
    .alert-info{background:#e8f4ff;border:1px solid #c3dafe;color:#224c8c;}
    .tag-list{display:flex;flex-wrap:wrap;gap:6px;margin-top:6px;}
    .tag{
      border-radius:999px;padding:3px 8px;font-size:11px;
      border:1px solid var(--line);background:#f8fbf9;
      display:inline-flex;align-items:center;gap:6px;
    }
    .tag button{
      border:none;background:transparent;font-size:11px;cursor:pointer;color:#b0202f;
    }
    .small{font-size:11px;color:var(--muted);}
    .grid-2{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px;}
    @media(max-width:600px){.grid-2{grid-template-columns:1fr;}}
  </style>
</head>
<body>
<header>
  <div class="row">
    <div class="brand">
      <div class="logo">D</div>
      <div>
        <div class="brand-title">Davomat ‚Äî Admin</div>
        <div class="brand-sub">Faqat ta‚Äôtil va qo‚Äòshimcha ish kunlarini belgilash</div>
      </div>
    </div>
  </div>
</header>

<main>
  <!-- Admin kod -->
  <section id="login-card" class="card">
    <div class="card-header">
      <div>
        <div class="card-title">Admin kirishi</div>
        <div class="card-sub">Ta‚Äôtil va qo‚Äòshimcha ish kunlarini faqat ishonchli odamlar o‚Äòzgartirsin.</div>
      </div>
    </div>
    <div class="alert alert-warn">
      <div class="alert-icon">‚ö†Ô∏è</div>
      <div><b>Eslatma:</b> bu sahifaga kirish kodi hech kimga oshkor qilinmasin.</div>
    </div>
    <div style="max-width:320px;">
      <label for="admin-code-input">Admin kod</label>
      <input id="admin-code-input" type="password" placeholder="faqat direktor biladigan kod">
      <button id="admin-code-btn" class="btn btn-primary" style="margin-top:8px;">Kirish</button>
      <div class="small" style="margin-top:4px;">
        Kodni html fayl ichidagi <code>ADMIN_CODE</code> o‚Äòzgaruvchisidan o‚Äòzgartirasiz.
      </div>
    </div>
  </section>

  <!-- Asosiy sozlamalar -->
  <section id="content" class="card" style="display:none;">
    <div class="card-header">
      <div>
        <div class="card-title">Ta‚Äôtil va qo‚Äòshimcha ish kunlarini sozlash</div>
        <div class="card-sub">
          Asosiy qoida: dushanba‚Äìjuma dars, shanba-yakshanba dam. Bu yerda faqat istisnolar (ta‚Äôtil va qo‚Äòshimcha ish kunlari) belgilanadi.
        </div>
      </div>
      <button id="reload-btn" class="btn-ghost">Qayta yuklash</button>
    </div>

    <div class="alert alert-info">
      <div class="alert-icon">‚ÑπÔ∏è</div>
      <div>
        Bu sozlamalar <b>davomat_settings/global</b> Firestore hujjatida saqlanadi.
        Sinf rahbarlari davomat kiritganda aynan shu qoidalardan foydalaniladi.
      </div>
    </div>

    <div class="grid-2">
      <div>
        <label>Ta‚Äôtil boshlanish sanasi</label>
        <input type="date" id="hol-start-input">
        <label style="margin-top:6px;">Ta‚Äôtil tugash sanasi</label>
        <input type="date" id="hol-end-input">
        <label style="margin-top:6px;">Ta‚Äôtil nomi</label>
        <input id="hol-title-input" placeholder="Qishki ta‚Äôtil">
        <button id="hol-add-btn" class="btn btn-primary" style="margin-top:8px;">Ta‚Äôtil oraliƒüini qo‚Äòshish</button>

        <div style="margin-top:10px;">
          <div class="small"><b>Mavjud ta‚Äôtil oraliqlari:</b></div>
          <div id="holidays-list" class="tag-list"></div>
        </div>
      </div>
      <div>
        <label>Qo‚Äòshimcha ish kuni (odatda dam kuni bo‚Äòlgan sana)</label>
        <input type="date" id="extra-day-input">
        <button id="extra-add-btn" class="btn btn-primary" style="margin-top:8px;">Ish kunini qo‚Äòshish</button>

        <div style="margin-top:10px;">
          <div class="small">
            Masalan: <b>shanba</b> kuni maktabda dars bo‚Äòlsa, shu sanani bu yerga qo‚Äòshasiz.
          </div>
          <div class="small" style="margin-top:6px;"><b>Mavjud qo‚Äòshimcha ish kunlari:</b></div>
          <div id="extras-list" class="tag-list"></div>
        </div>
      </div>
    </div>
  </section>
</main>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore-compat.js"></script>

<script>
  // üîß FIREBASE CONFIG ‚Äî index.html dagisi bilan bir xil bo‚Äòlsin
  const firebaseConfig = {
  apiKey: "AIzaSyDYwHJou_9GqHZcf8XxtTByC51Z8un8rrM",
  authDomain: "xplusy-760fa.firebaseapp.com",
  projectId: "xplusy-760fa",
  storageBucket: "xplusy-760fa.firebasestorage.app",
  messagingSenderId: "992512966017",
  appId: "1:992512966017:web:5e919dbc9b8d8abcb43c80",
  measurementId: "G-459PLJ7P7L"
  };
  firebase.initializeApp(firebaseConfig);
  const db=firebase.firestore();
  const settingsDoc=db.collection('davomat_settings').doc('global');

  // Admin kodi (bu fayldan o‚Äòzgartirasiz)
  const ADMIN_CODE="director-2025";

  // Elements
  const loginCard=document.getElementById('login-card');
  const content=document.getElementById('content');
  const adminCodeInput=document.getElementById('admin-code-input');
  const adminCodeBtn=document.getElementById('admin-code-btn');

  const reloadBtn=document.getElementById('reload-btn');
  const holStartInput=document.getElementById('hol-start-input');
  const holEndInput=document.getElementById('hol-end-input');
  const holTitleInput=document.getElementById('hol-title-input');
  const holAddBtn=document.getElementById('hol-add-btn');
  const holidaysList=document.getElementById('holidays-list');

  const extraDayInput=document.getElementById('extra-day-input');
  const extraAddBtn=document.getElementById('extra-add-btn');
  const extrasList=document.getElementById('extras-list');

  let settings={holidays:[],extraSchoolDays:[]};

  function tryAdminLogin(){
    if(adminCodeInput.value===ADMIN_CODE){
      loginCard.style.display='none';
      content.style.display='block';
      loadSettings();
    }else{
      alert("Noto‚Äòg‚Äòri admin kod.");
    }
  }
  adminCodeBtn.addEventListener('click',tryAdminLogin);
  adminCodeInput.addEventListener('keydown',e=>{if(e.key==='Enter')tryAdminLogin();});

  async function loadSettings(){
    const snap=await settingsDoc.get();
    if(snap.exists){
      settings=snap.data();
      settings.holidays=settings.holidays||[];
      settings.extraSchoolDays=settings.extraSchoolDays||[];
    }else{
      settings={holidays:[],extraSchoolDays:[]};
    }
    renderSettingsUI();
  }
  function renderSettingsUI(){
    holidaysList.innerHTML='';
    settings.holidays.forEach((h,idx)=>{
      const div=document.createElement('div');
      div.className='tag';
      div.innerHTML=`
        <span>${h.start} ‚Üí ${h.end}</span>
        <span style="color:#666;">${h.title || ''}</span>
        <button data-idx="${idx}">√ó</button>
      `;
      holidaysList.appendChild(div);
    });
    holidaysList.querySelectorAll('button[data-idx]').forEach(btn=>{
      btn.addEventListener('click',async ()=>{
        const i=parseInt(btn.getAttribute('data-idx'));
        settings.holidays.splice(i,1);
        await settingsDoc.set(settings,{merge:true});
        renderSettingsUI();
      });
    });

    extrasList.innerHTML='';
    settings.extraSchoolDays.forEach((d,idx)=>{
      const div=document.createElement('div');
      div.className='tag';
      div.innerHTML=`${d} <button data-idx="${idx}">√ó</button>`;
      extrasList.appendChild(div);
    });
    extrasList.querySelectorAll('button[data-idx]').forEach(btn=>{
      btn.addEventListener('click',async ()=>{
        const i=parseInt(btn.getAttribute('data-idx'));
        settings.extraSchoolDays.splice(i,1);
        await settingsDoc.set(settings,{merge:true});
        renderSettingsUI();
      });
    });
  }

  holAddBtn.addEventListener('click',async ()=>{
    const s=holStartInput.value;
    const e=holEndInput.value;
    const title=holTitleInput.value.trim()||'Ta‚Äôtil';
    if(!s||!e){alert("Boshlanish va tugash sanasini kiriting.");return;}
    settings.holidays.push({start:s,end:e,title});
    await settingsDoc.set(settings,{merge:true});
    holStartInput.value='';holEndInput.value='';holTitleInput.value='';
    renderSettingsUI();
  });
  extraAddBtn.addEventListener('click',async ()=>{
    const d=extraDayInput.value;
    if(!d){alert("Sanani tanlang.");return;}
    if(!settings.extraSchoolDays.includes(d)){
      settings.extraSchoolDays.push(d);
      await settingsDoc.set(settings,{merge:true});
      extraDayInput.value='';
      renderSettingsUI();
    }
  });
  reloadBtn.addEventListener('click',loadSettings);
</script>
</body>
</html>
