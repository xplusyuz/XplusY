<!doctype html>
<html lang="uz">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Maktab Davomati — Admin</title>
  <style>
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:#f4f7f5;
      color:#102218;
    }
    header{
      padding:10px 16px;
      background:#2E8B57;
      color:#fff;
    }
    main{
      max-width:900px;
      margin:16px auto;
      background:#fff;
      border-radius:16px;
      padding:16px;
      box-shadow:0 12px 32px rgba(0,0,0,0.08);
    }
    h1{font-size:20px;margin:0;}
    h2{font-size:16px;margin-top:12px;}
    label{font-size:13px;display:block;margin-bottom:4px;color:#555;}
    input{
      padding:6px 8px;border-radius:8px;
      border:1px solid #dfe7e2;font-size:13px;
    }
    button{
      border:none;border-radius:999px;
      padding:6px 12px;font-size:13px;
      background:#2E8B57;color:#fff;
      cursor:pointer;
      margin-top:6px;
    }
    button:hover{background:#1f6b45;}
    table{width:100%;border-collapse:collapse;font-size:12px;margin-top:8px;}
    th,td{padding:5px 6px;border-bottom:1px solid #edf3ee;text-align:left;}
    th{background:#f4faf6;color:#6c7b73;font-weight:600;}
    .small{font-size:11px;color:#6c7b73;}
    .pill{display:inline-block;padding:2px 7px;border-radius:999px;font-size:11px;background:#eef7f2;}
  </style>
</head>
<body>
<header>
  <h1>Maktab Davomati — Admin</h1>
  <div class="small">Ta’til va qo‘shimcha ish kunlarini sozlash</div>
</header>

<main>
  <section>
    <h2>Ta’til kunlari</h2>
    <div class="small">Har bir qator: boshlanish sanasi, tugash sanasi, nomi (masalan: "Qishki ta’til")</div>
    <div>
      <label>Boshlanish sana</label>
      <input type="date" id="holiday-start">
      <label>Tugash sana</label>
      <input type="date" id="holiday-end">
      <label>Nom</label>
      <input type="text" id="holiday-title" placeholder="Qishki ta’til">
      <button id="add-holiday-btn">Ta’til qo‘shish</button>
    </div>
    <table>
      <thead>
        <tr><th>Davr</th><th>Nom</th><th></th></tr>
      </thead>
      <tbody id="holiday-tbody"></tbody>
    </table>
  </section>

  <section>
    <h2>Qo‘shimcha ish kunlari (dam kuni bo‘lsa ham o‘qish bo‘ladi)</h2>
    <div class="small">Shanba/yakshanba yoki boshqa sana bo‘lishi mumkin.</div>
    <div>
      <label>Sana</label>
      <input type="date" id="extra-date">
      <button id="add-extra-btn">Kunni qo‘shish</button>
    </div>
    <table>
      <thead><tr><th>Sana</th><th></th></tr></thead>
      <tbody id="extra-tbody"></tbody>
    </table>
  </section>

  <section>
    <h2>Saqlash</h2>
    <div class="small">Bu o‘zgarishlar `davomat_settings/global` hujjatiga yoziladi va index.html tomonidan o‘qiladi.</div>
    <button id="save-btn">Barchasini saqlash</button>
    <span id="save-status" class="small"></span>
  </section>
</main>

<script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDYwHJou_9GqHZcf8XxtTByC51Z8un8rrM",
    authDomain: "xplusy-760fa.firebaseapp.com",
    projectId: "xplusy-760fa",
    storageBucket: "xplusy-760fa.firebasestorage.app",
    messagingSenderId: "992512966017",
    appId: "1:992512966017:web:5e919dbc9b8d8abcb43c80",
    measurementId: "G-459PLJ7P7L"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const settingsDoc = db.collection('davomat_settings').doc('global');

  let holidays = [];
  let extraSchoolDays = [];

  const holidayTbody = document.getElementById('holiday-tbody');
  const extraTbody   = document.getElementById('extra-tbody');
  const saveStatus   = document.getElementById('save-status');

  function renderHolidays(){
    holidayTbody.innerHTML='';
    holidays.forEach((h,idx)=>{
      const tr=document.createElement('tr');
      tr.innerHTML = `
        <td>${h.start} → ${h.end}</td>
        <td>${h.title||''}</td>
        <td><button data-idx="${idx}" class="del-holiday">O‘chirish</button></td>
      `;
      holidayTbody.appendChild(tr);
    });
    document.querySelectorAll('.del-holiday').forEach(btn=>{
      btn.onclick=()=>{
        const i=parseInt(btn.dataset.idx,10);
        holidays.splice(i,1);
        renderHolidays();
      };
    });
  }
  function renderExtra(){
    extraTbody.innerHTML='';
    extraSchoolDays.forEach((d,idx)=>{
      const tr=document.createElement('tr');
      tr.innerHTML = `
        <td>${d}</td>
        <td><button data-idx="${idx}" class="del-extra">O‘chirish</button></td>
      `;
      extraTbody.appendChild(tr);
    });
    document.querySelectorAll('.del-extra').forEach(btn=>{
      btn.onclick=()=>{
        const i=parseInt(btn.dataset.idx,10);
        extraSchoolDays.splice(i,1);
        renderExtra();
      };
    });
  }

  document.getElementById('add-holiday-btn').onclick = ()=>{
    const s=document.getElementById('holiday-start').value;
    const e=document.getElementById('holiday-end').value;
    const t=document.getElementById('holiday-title').value.trim();
    if(!s||!e){alert('Boshlanish va tugash sanasini kiriting');return;}
    holidays.push({start:s,end:e,title:t});
    renderHolidays();
  };
  document.getElementById('add-extra-btn').onclick = ()=>{
    const d=document.getElementById('extra-date').value;
    if(!d){alert('Sana tanlang');return;}
    if(!extraSchoolDays.includes(d)) extraSchoolDays.push(d);
    renderExtra();
  };

  document.getElementById('save-btn').onclick = async()=>{
    saveStatus.textContent='Saqlanmoqda...';
    try{
      await settingsDoc.set({holidays,extraSchoolDays},{merge:true});
      saveStatus.textContent=' ✓ Saqlandi';
    }catch(e){
      console.error(e);
      saveStatus.textContent=' Xato';
    }
  };

  (async function load(){
    const snap=await settingsDoc.get();
    if(snap.exists){
      const d=snap.data();
      holidays=d.holidays||[];
      extraSchoolDays=d.extraSchoolDays||[];
      renderHolidays();
      renderExtra();
    }
  })();
</script>
</body>
</html>
