<!doctype html>
<html lang="uz">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>MathCenter — Super Admin</title>
<meta name="color-scheme" content="dark">
<style>
:root{
  --bg:#0b1220; --panel:#0f172a; --ink:#e5e7eb; --muted:#94a3b8;
  --border:rgba(148,163,184,.2); --brand1:#22d3ee; --brand2:#60a5fa;
  --ok:#10b981; --warn:#f59e0b; --err:#ef4444; --shadow:0 20px 50px rgba(2,6,23,.35); --r:18px;
}
*{box-sizing:border-box}
html,body{margin:0;height:100%;background:radial-gradient(1100px 520px at 12% -10%,#0f1a33 0%,transparent 60%),linear-gradient(180deg,#0b1220 0%,#0a0f1a 100%);color:var(--ink);font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
.container{max-width:1200px;margin:0 auto;padding:18px}
.card{background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.01));border:1px solid var(--border);border-radius:var(--r);box-shadow:var(--shadow);backdrop-filter:blur(8px)}
header{position:sticky;top:0;z-index:20;background:rgba(11,18,32,.7);backdrop-filter:blur(10px);border-bottom:1px solid var(--border)}
.brand{display:flex;align-items:center;gap:10px;font-weight:900}
.brand .pi{width:28px;height:28px;border-radius:10px;background:linear-gradient(135deg,var(--brand1),var(--brand2));display:grid;place-items:center;color:#001827}
.stack{display:flex;align-items:center;gap:10px}.sp{flex:1}
.btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;font-weight:700;border:1px solid var(--border);
background:linear-gradient(180deg,rgba(96,165,250,.12),rgba(34,211,238,.12));color:#dbeafe;cursor:pointer;transition:.2s}
.btn:hover{transform:translateY(-1px);box-shadow:0 8px 30px rgba(96,165,250,.25)}
.btn.ghost{background:transparent;color:var(--ink)}
.btn.danger{background:linear-gradient(180deg,rgba(239,68,68,.15),rgba(239,68,68,.08));border-color:rgba(239,68,68,.35);color:#fecaca}
.input,select,textarea{width:100%;padding:12px 14px;border:1px solid var(--border);border-radius:12px;background:rgba(15,23,42,.6);color:var(--ink);outline:0}
textarea{min-height:84px;resize:vertical}
.label{font-size:12px;color:var(--muted);margin-bottom:6px}
.grid{display:grid;gap:14px}
.cols-12{grid-template-columns:repeat(12,1fr)}
.col-12{grid-column:span 12}.col-8{grid-column:span 8}.col-6{grid-column:span 6}.col-4{grid-column:span 4}.col-3{grid-column:span 3}
@media (max-width:960px){ .cols-12{grid-template-columns:repeat(6,1fr)} .col-8,.col-6,.col-4,.col-3{grid-column:span 6} }
.table{width:100%;border-collapse:separate;border-spacing:0 10px}
.table th,.table td{text-align:left;padding:10px 12px;vertical-align:middle;background:rgba(15,23,42,.6);border:1px solid var(--border)}
.badge{padding:4px 8px;border-radius:10px;border:1px solid var(--border);font-size:12px;color:#a5b4fc}
.kbd{font-family:ui-monospace,Consolas,monospace;font-size:12px;padding:2px 6px;border-radius:6px;border:1px solid var(--border);background:rgba(15,23,42,.6)}
.hint{color:var(--muted);font-size:12px}
.mt{margin-top:12px}.mb{margin-bottom:12px}.p{padding:16px}
.row{display:flex;gap:8px;align-items:center}
.qcard{padding:12px;border:1px solid var(--border);border-radius:12px;background:rgba(15,23,42,.6)}
.navtabs{display:flex;gap:8px;flex-wrap:wrap}
.tab{padding:10px 14px;border-radius:12px;border:1px solid var(--border);cursor:pointer;background:rgba(2,6,23,.35)}
.tab.active{background:linear-gradient(180deg,rgba(34,211,238,.18),rgba(96,165,250,.18));border-color:rgba(125,211,252,.55)}
.link{color:#93c5fd}
.avatar{width:44px;height:44px;border-radius:50%;overflow:hidden;background:linear-gradient(135deg,#1e293b,#0ea5e9);display:grid;place-items:center;color:#cffafe;font-weight:800}
.small{font-size:12px}
</style>
</head>
<body>
<header>
  <div class="container row">
    <div class="brand"><div class="pi">π</div><div>Super Admin</div></div>
    <div class="sp"></div>
    <a class="btn ghost" href="liteindex.html">Bosh sahifa</a>
    <label class="btn ghost" style="cursor:pointer">
      <input type="file" id="impLite" accept=".json" style="display:none"> liteadmin.json Import
    </label>
    <label class="btn ghost" style="cursor:pointer">
      <input type="file" id="impTest" accept=".json" style="display:none"> test.json Import
    </label>
    <button id="expLite" class="btn">liteadmin.json</button>
    <button id="expTest" class="btn">test.json</button>
  </div>
</header>

<main class="container" style="display:grid;gap:16px;margin-top:16px">
  <div class="card p">
    <div class="navtabs">
      <div class="tab active" data-tab="users">Foydalanuvchilar</div>
      <div class="tab" data-tab="tests">Testlar</div>
      <div class="tab" data-tab="cards">Kartalar & Bannerlar</div>
    </div>
  </div>

  <!-- USERS TAB -->
  <section class="card p tabpage" id="tab-users">
    <div class="row">
      <h3 style="margin:0">Foydalanuvchilar</h3>
      <div class="sp"></div>
      <button class="btn" id="addUserBtn">Foydalanuvchi qo'shish</button>
    </div>
    <div class="hint mt">Eslatma: bu yerda ball qo'shilmaydi. Ballar test yechilganda avtomatik hisoblanadi.</div>
    <table class="table mt">
      <thead><tr>
        <th>Avatar</th><th>Login</th><th>Ism</th><th>Familiya</th><th>Sinf</th><th>Amal</th>
      </tr></thead>
      <tbody id="userRows"></tbody>
    </table>
  </section>

  <!-- TESTS TAB -->
  <section class="card p tabpage" id="tab-tests" style="display:none">
    <div class="row">
      <h3 style="margin:0">Testlar</h3>
      <div class="sp"></div>
      <button class="btn" id="addTestBtn">Yangi test</button>
    </div>
    <div id="testsList" class="mt"></div>
  </section>

  <!-- CARDS TAB -->
  <section class="card p tabpage" id="tab-cards" style="display:none">
    <div class="row">
      <h3 style="margin:0">Kartalar va Bannerlar</h3>
      <div class="sp"></div>
      <button class="btn" id="addCardBtn">Karta qo'shish</button>
      <button class="btn" id="addBannerBtn">Banner qo'shish</button>
    </div>
    <div class="mt">
      <h4>Kartalar</h4>
      <div id="cardsList"></div>
    </div>
    <div class="mt">
      <h4>Bannerlar</h4>
      <div id="bannersList"></div>
    </div>
  </section>
</main>

<script>
const $ = s=>document.querySelector(s);
const state = {
  lite: { auth:{admin:{login:"admin",password:"admin"}}, users:[], banners:[], cards:[] },
  tests: { meta:{version:"2.0.0"}, tests:[] }
};

// ---------- Tabs ----------
document.querySelectorAll('.tab').forEach(t=>{
  t.onclick = ()=>{
    document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
    t.classList.add('active');
    document.querySelectorAll('.tabpage').forEach(x=>x.style.display='none');
    $('#tab-'+t.dataset.tab).style.display='block';
  };
});

// ---------- Helpers ----------
function uid(p){ return p + Math.random().toString(36).slice(2,8); }
function fileToDataURL(file){ return new Promise((res,rej)=>{ const r=new FileReader(); r.onload=()=>res(r.result); r.onerror=rej; r.readAsDataURL(file); }); }
function downloadJSON(name,obj){ const blob=new Blob([JSON.stringify(obj,null,2)],{type:'application/json'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=name; a.click(); URL.revokeObjectURL(a.href); }

// ---------- USERS ----------
function renderUsers(){
  const tb = $('#userRows'); tb.innerHTML='';
  (state.lite.users||[]).forEach((u,idx)=>{
    const tr=document.createElement('tr');
    const av = u.avatar ? `<img src="${u.avatar}" style="width:44px;height:44px;border-radius:50%;object-fit:cover">` : `<div class="avatar">${(u.name?.[0]||'U').toUpperCase()}</div>`;
    tr.innerHTML = `<td>${av}</td><td>${u.login}</td><td>${u.name||''}</td><td>${u.surname||''}</td><td>${u.class||''}</td>
      <td class="row">
        <button class="btn ghost small" data-act="edit">Edit</button>
        <button class="btn danger small" data-act="del">Del</button>
        <label class="btn ghost small" style="cursor:pointer">
          <input type="file" data-act="avatar" accept="image/*" style="display:none"> Avatar
        </label>
      </td>`;
    tr.querySelector('[data-act="edit"]').onclick = ()=>editUser(idx);
    tr.querySelector('[data-act="del"]').onclick = ()=>{ if(confirm('O\\'chirasizmi?')){ state.lite.users.splice(idx,1); renderUsers(); } };
    tr.querySelector('input[type="file"][data-act="avatar"]').addEventListener('change', async (e)=>{
      const f = e.target.files[0]; if(!f) return; state.lite.users[idx].avatar = await fileToDataURL(f); renderUsers();
    });
    tb.appendChild(tr);
  });
}
function editUser(i){
  const u = state.lite.users[i];
  const login = prompt('Login:', u.login); if(login===null) return;
  const password = prompt('Parol:', u.password||''); if(password===null) return;
  const name = prompt('Ism:', u.name||''); if(name===null) return;
  const surname = prompt('Familiya:', u.surname||''); if(surname===null) return;
  const klass = prompt('Sinf:', u.class||''); if(klass===null) return;
  Object.assign(u, {login, password, name, surname, class:klass});
  renderUsers();
}
$('#addUserBtn').onclick = ()=>{
  const login = prompt('Login:'); if(!login) return;
  const password = prompt('Parol:','1234'); if(password===null) return;
  const name = prompt('Ism:',''); if(name===null) return;
  const surname = prompt('Familiya:',''); if(surname===null) return;
  const klass = prompt('Sinf:',''); if(klass===null) return;
  state.lite.users.push({login,password,name,surname,class:klass,avatar:""});
  renderUsers();
};

// ---------- TESTS ----------
function renderTests(){
  const box = $('#testsList'); box.innerHTML='';
  (state.tests.tests||[]).forEach((t,ti)=>{
    const wrap=document.createElement('div'); wrap.className='qcard mb';
    const qrows = (t.questions||[]).map((q,qi)=>`
      <div class="qcard mt">
        <div><b>Q${qi+1}.</b> ${q.text}</div>
        <div class="hint">Variantlar: ${q.options.join(' | ')} — To‘g‘ri: #${q.answerIndex+1} — Ball: ${q.points}</div>
        <div class="row mt">
          <button class="btn ghost small" onclick="editQ('${t.id}', ${qi})">Edit</button>
          <button class="btn danger small" onclick="delQ('${t.id}', ${qi})">Del</button>
        </div>
      </div>
    `).join('');
    wrap.innerHTML = `
      <div class="row">
        <div>
          <div style="font-weight:800">${t.title}</div>
          <div class="hint">[${t.start} → ${t.end}] | ${t.durationSec}s | default=${t.perQuestionDefault}</div>
          <div class="hint">Linklar: 
            <a class="link" href="test.html?id=${t.id}" target="_blank">test.html?id=${t.id}</a> · 
            <a class="link" href="test-firebase.html?id=${t.id}" target="_blank">test-firebase.html?id=${t.id}</a>
          </div>
        </div>
        <div class="sp"></div>
        <button class="btn small" onclick="addQ('${t.id}')">Savol qo'shish</button>
        <button class="btn ghost small" onclick="editT('${t.id}')">Testni tahrirlash</button>
        <button class="btn danger small" onclick="delT('${t.id}')">Testni o'chirish</button>
      </div>
      <div class="mt">${qrows || '<div class="hint">Savollar yo\\'q</div>'}</div>
    `;
    box.appendChild(wrap);
  });
}
function addTest(){
  const title = prompt('Sarlavha:'); if(!title) return;
  const description = prompt('Tavsif:','')||'';
  const start = prompt('Start (YYYY-MM-DDTHH:MM:SS+05:00):',''); if(!start) return;
  const end = prompt('End (YYYY-MM-DDTHH:MM:SS+05:00):',''); if(!end) return;
  const durationSec = Number(prompt('Davomiylik (sekund):','900')||'900');
  const perQuestionDefault = Number(prompt('Standart ball:','5')||'5');
  state.tests.tests.push({ id: uid('t'), title, description, start, end, durationSec, perQuestionDefault, questions:[] });
  renderTests();
}
function editT(tid){
  const t = state.tests.tests.find(x=>x.id===tid); if(!t) return;
  const title = prompt('Sarlavha:', t.title); if(title===null) return;
  const description = prompt('Tavsif:', t.description||''); if(description===null) return;
  const start = prompt('Start:', t.start); if(start===null) return;
  const end = prompt('End:', t.end); if(end===null) return;
  const durationSec = Number(prompt('Davomiylik (sek):', String(t.durationSec))||t.durationSec);
  const perQuestionDefault = Number(prompt('Standart ball:', String(t.perQuestionDefault))||t.perQuestionDefault);
  Object.assign(t, {title,description,start,end,durationSec,perQuestionDefault});
  renderTests();
}
function delT(tid){
  const i = state.tests.tests.findIndex(x=>x.id===tid);
  if(i>=0 && confirm('Testni o\\'chirasizmi?')){ state.tests.tests.splice(i,1); renderTests(); }
}
window.addQ = (tid)=>{
  const t = state.tests.tests.find(x=>x.id===tid); if(!t) return;
  const text = prompt('Savol (LaTeX $...$ mumkin):'); if(!text) return;
  const options = prompt('Variantlar (vergul bilan):','A,B,C,D'); if(!options) return;
  const arr = options.split(',').map(s=>s.trim()).filter(Boolean);
  const answerIndex = Number(prompt('To\\'g\\'ri javob indeksi (1..n):','1')) - 1;
  const points = Number(prompt('Ball:', String(t.perQuestionDefault))) || t.perQuestionDefault;
  if(answerIndex<0 || answerIndex>=arr.length){ alert('Indeks 1..n orasida bo\\'lsin.'); return; }
  (t.questions ||= []).push({ id: uid('q'), text, options: arr, answerIndex, points });
  renderTests();
};
window.editQ = (tid, qi)=>{
  const t = state.tests.tests.find(x=>x.id===tid); if(!t) return; const q=t.questions[qi];
  const text = prompt('Savol:', q.text); if(text===null) return;
  const options = prompt('Variantlar (vergul):', q.options.join(',')); if(options===null) return;
  const answerIndex = Number(prompt('To\\'g\\'ri javob (1..n):', String(q.answerIndex+1))) - 1;
  const points = Number(prompt('Ball:', String(q.points))) || q.points;
  const arr = options.split(',').map(s=>s.trim()).filter(Boolean);
  if(answerIndex<0 || answerIndex>=arr.length){ alert('Indeks xato.'); return; }
  Object.assign(q, {text, options:arr, answerIndex, points});
  renderTests();
};
window.delQ = (tid, qi)=>{
  const t = state.tests.tests.find(x=>x.id===tid); if(!t) return;
  if(confirm('Savolni o\\'chirasizmi?')){ t.questions.splice(qi,1); renderTests(); }
};
$('#addTestBtn').onclick = addTest;

// ---------- CARDS/BANNERS ----------
function renderCards(){
  const box = $('#cardsList'); box.innerHTML='';
  (state.lite.cards||[]).forEach((c,i)=>{
    const div=document.createElement('div'); div.className='qcard mb';
    div.innerHTML = `
      <div class="row">
        <div>
          <div style="font-weight:800">${c.title||'(nomlanmagan karta)'}</div>
          <div class="hint">link: ${c.link||'#'} · tags: ${(c.tags||[]).join(', ')} · active: ${c.active?'ha':'yo\\'q'}</div>
          <div class="hint small">Testga bog'lash uchun link: <span class="kbd">test.html?id=&lt;testId&gt;</span> yoki <span class="kbd">test-firebase.html?id=&lt;testId&gt;</span></div>
        </div>
        <div class="sp"></div>
        <button class="btn ghost small" onclick="editCard(${i})">Edit</button>
        <button class="btn danger small" onclick="delCard(${i})">Del</button>
      </div>
    `;
    box.appendChild(div);
  });
}
function renderBanners(){
  const box = $('#bannersList'); box.innerHTML='';
  (state.lite.banners||[]).forEach((b,i)=>{
    const div=document.createElement('div'); div.className='qcard mb';
    div.innerHTML = `
      <div class="row">
        <div>
          <div style="font-weight:800">${b.title||'(banner)'}</div>
          <div class="hint">${b.subtitle||''}</div>
          <div class="hint">active: ${b.active?'ha':'yo\\'q'} · link: ${b.link||'#'}</div>
        </div>
        <div class="sp"></div>
        <button class="btn ghost small" onclick="editBanner(${i})">Edit</button>
        <button class="btn danger small" onclick="delBanner(${i})">Del</button>
      </div>
    `;
    box.appendChild(div);
  });
}
$('#addCardBtn').onclick = ()=>{
  const title = prompt('Karta sarlavhasi:','Test'); if(title===null) return;
  const link = prompt('Link (masalan test.html?id=t1):','test.html?id=t1')||'#';
  const image = prompt('Rasm URL (unsplash ham bo\\'ladi):',''); 
  const tags = prompt('Teglar (vergul):','test,algebra')||'';
  const active = confirm('Faol qilaymi?');
  (state.lite.cards ||= []).push({ id: uid('c'), kind:'test', title, image, link, tags: tags.split(',').map(x=>x.trim()).filter(Boolean), active, main:'Testlar' });
  renderCards();
};
window.editCard = (i)=>{
  const c = state.lite.cards[i];
  const title = prompt('Sarlavha:', c.title||''); if(title===null) return;
  const link = prompt('Link:', c.link||'#'); if(link===null) return;
  const image = prompt('Rasm URL:', c.image||''); if(image===null) return;
  const tags = prompt('Teglar (vergul):', (c.tags||[]).join(',')); if(tags===null) return;
  const active = confirm('Faolmi? (OK=Ha, Cancel=Yo\\'q)');
  Object.assign(c, {title,link,image,tags:tags.split(',').map(s=>s.trim()).filter(Boolean),active});
  renderCards();
};
window.delCard = (i)=>{ if(confirm('Karta o\\'chiriladi?')){ state.lite.cards.splice(i,1); renderCards(); } };

$('#addBannerBtn').onclick = ()=>{
  const title = prompt('Banner sarlavhasi:','Matematika marafoni'); if(title===null) return;
  const subtitle = prompt('Kichik matn:','Yangi testlar ochildi')||'';
  const image = prompt('Rasm URL:','');
  const link = prompt('Link:','#')||'#';
  const active = confirm('Faol qilaymi?');
  (state.lite.banners ||= []).push({ id: uid('b'), title, subtitle, image, link, active });
  renderBanners();
};
window.editBanner = (i)=>{
  const b = state.lite.banners[i];
  const title = prompt('Sarlavha:', b.title||''); if(title===null) return;
  const subtitle = prompt('Kichik matn:', b.subtitle||''); if(subtitle===null) return;
  const image = prompt('Rasm URL:', b.image||''); if(image===null) return;
  const link = prompt('Link:', b.link||'#'); if(link===null) return;
  const active = confirm('Faolmi? (OK=Ha)');
  Object.assign(b, {title,subtitle,image,link,active});
  renderBanners();
};
window.delBanner = (i)=>{ if(confirm('Banner o\\'chiriladi?')){ state.lite.banners.splice(i,1); renderBanners(); } };

// ---------- Import/Export ----------
$('#expLite').onclick = ()=> downloadJSON('liteadmin.json', state.lite);
$('#expTest').onclick = ()=> downloadJSON('test.json', state.tests);

$('#impLite').addEventListener('change', async (e)=>{
  const f=e.target.files[0]; if(!f) return;
  try{
    const data = JSON.parse(await f.text());
    if(!data || typeof data!=='object') throw new Error('JSON format xato');
    // normalize
    data.users ||= []; data.cards ||= []; data.banners ||= [];
    state.lite = data;
    renderUsers(); renderCards(); renderBanners();
  }catch(err){ alert('Import xatosi (liteadmin.json): '+err.message); }
  e.target.value='';
});
$('#impTest').addEventListener('change', async (e)=>{
  const f=e.target.files[0]; if(!f) return;
  try{
    const data = JSON.parse(await f.text());
    if(!data || !Array.isArray(data.tests)) throw new Error('tests massiv topilmadi');
    state.tests = data;
    renderTests();
  }catch(err){ alert('Import xatosi (test.json): '+err.message); }
  e.target.value='';
});

// ---------- Init sample (bo'sh bo'lsa) ----------
if(!(state.lite.cards||[]).length){
  state.lite.cards=[{id:uid('c'),kind:'test',title:"Algebra — Boshlang'ich",image:"https://images.unsplash.com/photo-1519681393784-d120267933ba?q=80&w=1200",link:"test.html?id=t1",tags:["test","algebra","easy"],active:true,main:"Testlar"}];
}
if(!(state.lite.banners||[]).length){
  state.lite.banners=[{id:uid('b'),title:"Matematika marafoni",subtitle:"Yangi testlar ochildi",image:"https://images.unsplash.com/photo-1515879218367-8466d910aaa4?q=80&w=1200",link:"#",active:true}];
}
if(!(state.tests.tests||[]).length){
  state.tests.tests=[{
    id:"t1",title:"Algebra — LaTeX misollar",description:"$\\dfrac{a}{b}+\\dfrac{c}{d}=\\dfrac{ad+bc}{bd}$",
    start:"2025-10-19T09:00:00+05:00",end:"2025-10-31T23:59:59+05:00",durationSec:900,perQuestionDefault:5,
    questions:[
      {id:uid('q'),text:"$2^3+2^2=\\;?$",options:["$6$","$8$","$12$","$10$"],answerIndex:3,points:5},
      {id:uid('q'),text:"$\\sqrt{49}=\\;?$",options:["$5$","$7$","$9$","$6$"],answerIndex:1,points:5}
    ]
  }];
}
renderUsers(); renderTests(); renderCards(); renderBanners();
</script>
</body>
</html>
