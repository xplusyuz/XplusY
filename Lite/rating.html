<!doctype html>
<html lang="uz"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MathCenter — Reyting (ball.json)</title><meta name="color-scheme" content="dark"/>
<link rel="stylesheet" href="assets/styles.css"/>
</head><body>
<header class="nav">
  <div class="container stack">
    <div class="brand"><div class="pi">π</div><div>Reyting</div></div>
    <div class="spacer"></div>
    <button class="btn ghost" onclick="location.href='liteindex.html'">Bosh sahifa</button>
  </div>
</header>

<main class="container" style="display:grid;gap:16px;margin-top:16px">
  <section class="card" style="padding:16px">
    <div style="display:flex;align-items:center;gap:8px"><h3 style="margin:0">Umumiy reyting</h3><span class="badge">ball.json</span></div>
    <table class="table" id="rt">
      <thead><tr><th>O‘rin</th><th>Ism Familiya</th><th>Sinf</th><th>Login</th><th>Umumiy ball</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>
</main>

<script>
async function loadJSON(p){ const r = await fetch(p+'?_=' + Date.now()); if(!r.ok) throw new Error(p+' yuklanmadi'); return r.json(); }
(async function(){
  try{
    const [db, bal] = await Promise.all([loadJSON('liteadmin.json'), loadJSON('ball.json')]);
    const users = db.users||[]; const sums = new Map();
    (bal.results||[]).forEach(r=>{ sums.set(r.login, (sums.get(r.login)||0) + (Number(r.score)||0) ); });
    const rows = users.map(u=>({login:u.login, name:u.name, surname:u.surname, class:u.class, total: sums.get(u.login)||0})).sort((a,b)=>b.total-a.total);
    const tb = document.querySelector('#rt tbody'); tb.innerHTML='';
    rows.forEach((r,i)=>{ const tr=document.createElement('tr'); tr.innerHTML = `<td>${i+1}</td><td>${r.name} ${r.surname}</td><td>${r.class}</td><td>${r.login}</td><td>${r.total}</td>`; tb.appendChild(tr); });
  }catch(e){ alert('Ma\'lumotlarni yuklashda xatolik: '+e.message); }
})();
</script>
</body></html>
