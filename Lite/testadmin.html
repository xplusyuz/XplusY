<!doctype html>
<html lang="uz">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>MathCenter — Test Admin</title>
  <meta name="color-scheme" content="light"/>
  <style>
:root{--green:#2E8B57;--green-700:#1F6B45;--bg:#f7faf8;--text:#1a1f1c;--muted:#6b7280;--card:#fff;--shadow:0 8px 24px rgba(0,0,0,.08);--radius:18px}
*{box-sizing:border-box} html,body{margin:0;height:100%;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text)}
.container{max-width:1100px;margin:0 auto;padding:16px}
.card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow)}
.btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;background:var(--green);color:#fff;border:0;cursor:pointer;font-weight:600}
.btn.ghost{background:#e9f5ef;color:var(--green)}
header.nav{position:sticky;top:0;z-index:10;background:#fff;border-bottom:1px solid #eee}
.brand{display:flex;align-items:center;gap:10px;font-weight:800;color:var(--green)}
.brand .pi{width:28px;height:28px;border-radius:8px;background:linear-gradient(135deg,var(--green),var(--green-700));display:grid;place-items:center;color:#fff;box-shadow:var(--shadow)}
.stack{display:flex;align-items:center;gap:10px}.spacer{flex:1}
label{font-size:13px;color:var(--muted)}
input,select,textarea{width:100%;padding:12px 14px;border:1px solid #e5e7eb;border-radius:12px;background:#fff;outline:0}
.hint{font-size:12px;color:var(--muted)}
.avatar{width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,#d1fae5,#a7f3d0);display:grid;place-items:center;font-weight:700;color:var(--green-700);overflow:hidden}
.table{width:100%;border-collapse:separate;border-spacing:0 10px}
.table th,.table td{text-align:left;padding:10px 12px;vertical-align:middle;background:#fff}
.table tr td:first-child,.table tr th:first-child{border-top-left-radius:12px;border-bottom-left-radius:12px}
.table tr td:last-child,.table tr th:last-child{border-top-right-radius:12px;border-bottom-right-radius:12px}

  .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
  .col-6{grid-column:span 6} .col-4{grid-column:span 4} .col-8{grid-column:span 8} .col-12{grid-column:span 12}
  @media (max-width:900px){ .grid{grid-template-columns:repeat(6,1fr)} .col-6,.col-8,.col-4{grid-column:span 6} }
  .qcard{background:#fff;border-radius:18px;box-shadow:var(--shadow);padding:12px;margin-bottom:10px}
  </style>
</head>
<body>
<header class="nav">
  <div class="container stack">
    <div class="brand"><div class="pi">π</div><div>Test Admin</div></div>
    <div class="spacer"></div>
    <button class="btn ghost" onclick="location.href='liteindex.html'">Bosh sahifa</button>
    <button class="btn" id="btnExport">test.json ni yuklab olish</button>
  </div>
</header>

<main class="container" style="display:grid;gap:16px;margin-top:16px">
  <section class="card" style="padding:16px">
    <h3>Yangi test</h3>
    <div class="grid">
      <div class="col-6"><label>Sarlavha</label><input id="t_title" placeholder="Algebra — 10-sinf"></div>
      <div class="col-6"><label>Tavsif</label><input id="t_desc" placeholder="Qisqa tavsif"></div>
      <div class="col-6"><label>Start (YYYY-MM-DDTHH:MM:SS+05:00)</label><input id="t_start" placeholder="2025-10-19T09:00:00+05:00"></div>
      <div class="col-6"><label>End (YYYY-MM-DDTHH:MM:SS+05:00)</label><input id="t_end" placeholder="2025-10-31T23:59:59+05:00"></div>
      <div class="col-6"><label>Davomiylik (sekund)</label><input id="t_duration" type="number" value="600"></div>
      <div class="col-6"><label>Standart ball (har savol uchun)</label><input id="t_default" type="number" value="1"></div>
    </div>
    <div style="margin-top:10px;display:flex;gap:8px">
      <button class="btn" id="addTest">Test qo'shish</button>
      <button class="btn ghost" id="resetTest">Tozalash</button>
    </div>
  </section>

  <section class="card" style="padding:16px">
    <h3>Testlar ro'yxati</h3>
    <div id="testsList"></div>
  </section>
</main>

<script>
const state = { tests: {meta: {version:'1.0.0'}, tests: []} };
const $ = s=>document.querySelector(s);
function uid(p){ return p + Math.random().toString(36).slice(2,8); }

document.getElementById('addTest').onclick = ()=>{
  const t = {
    id: uid('t'),
    title: document.getElementById('t_title').value.trim(),
    description: document.getElementById('t_desc').value.trim(),
    start: document.getElementById('t_start').value.trim(),
    end: document.getElementById('t_end').value.trim(),
    durationSec: Number(document.getElementById('t_duration').value||0),
    perQuestionDefault: Number(document.getElementById('t_default').value||1),
    questions: []
  };
  if(!t.title || !t.start || !t.end || !t.durationSec) return alert('Majburiy maydonlar: sarlavha, start, end, davomiylik.');
  state.tests.tests.push(t); render();
};
document.getElementById('resetTest').onclick = ()=>{ ['t_title','t_desc','t_start','t_end','t_duration','t_default'].forEach(id=>document.getElementById(id).value=''); document.getElementById('t_duration').value=600; document.getElementById('t_default').value=1; };

function render(){
  const box = document.getElementById('testsList'); box.innerHTML='';
  state.tests.tests.forEach((t,ti)=>{
    const wrap = document.createElement('div'); wrap.className='qcard';
    const qrows = t.questions.map((q,qi)=>`<div class="qcard" style="background:#f8faf9">
        <div><b>Q${qi+1}.</b> ${q.text}</div>
        <div class="hint">Variantlar: ${q.options.join(' | ')} — To'g'ri javob: #${q.answerIndex+1} — Ball: ${q.points}</div>
        <div style="display:flex;gap:6px;margin-top:6px">
          <button class="btn ghost" onclick="editQ('${t.id}', ${qi})">Edit</button>
          <button class="btn" onclick="delQ('${t.id}', ${qi})">Del</button>
        </div>
      </div>`).join('');
    wrap.innerHTML = `
      <div style="display:flex;gap:8px;align-items:center">
        <h4 style="margin:0">${t.title}</h4><span class="hint">[${t.start} → ${t.end}]  ||  Davomiylik: ${t.durationSec}s</span>
        <div class="spacer"></div>
        <a class="btn ghost" href="test.html?id=${t.id}" target="_blank">Linkni ochish</a>
        <button class="btn" onclick="addQ('${t.id}')">Savol qo'shish</button>
        <button class="btn" onclick="delT('${t.id}')">Testni o'chirish</button>
      </div>
      <div style="margin-top:8px">${qrows || '<div class=hint>Hozircha savol yo\'q</div>'}</div>
    `;
    box.appendChild(wrap);
  });
}

window.addQ = id => {
  const t = state.tests.tests.find(x=>x.id===id); if(!t) return;
  const text = prompt('Savol matni:');
  if(!text) return;
  const opts = prompt('Variantlarni vergul bilan kiriting (A,B,C,D):','A,B,C,D');
  if(!opts) return;
  const arr = opts.split(',').map(s=>s.trim()).filter(Boolean);
  const ans = Number(prompt('To\'g\'ri javob indeksi (1..n):','1')) - 1;
  const pts = Number(prompt('Ball (bo\'sh qoldirsangiz standart qo\'llanadi):', t.perQuestionDefault)) || t.perQuestionDefault;
  t.questions.push({ id: uid('q'), text, options: arr, answerIndex: ans, points: pts }); render();
};
window.editQ = (tid, qi) => {
  const t = state.tests.tests.find(x=>x.id===tid); if(!t) return; const q=t.questions[qi];
  const text = prompt('Savol matni:', q.text) ?? q.text;
  const opts = prompt('Variantlar (vergul):', q.options.join(',')) ?? q.options.join(',');
  const ans = Number(prompt('To\'g\'ri javob indeksi (1..n):', String(q.answerIndex+1))) - 1;
  const pts = Number(prompt('Ball:', String(q.points))) || q.points;
  Object.assign(q, {text, options: opts.split(',').map(s=>s.trim()).filter(Boolean), answerIndex: ans, points: pts}); render();
};
window.delQ = (tid, qi) => { const t = state.tests.tests.find(x=>x.id===tid); if(!t) return; if(confirm('O\'chirish?')){ t.questions.splice(qi,1); render(); } };
window.delT = id => { const i = state.tests.tests.findIndex(x=>x.id===id); if(i>=0 && confirm('O\'chirish?')){ state.tests.tests.splice(i,1); render(); } };

document.getElementById('btnExport').onclick = ()=>{ const blob = new Blob([JSON.stringify(state.tests,null,2)],{type:'application/json'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='test.json'; a.click(); URL.revokeObjectURL(a.href); };

render();
</script>
</body>
</html>
