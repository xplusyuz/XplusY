<!doctype html>
<html lang="uz">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>MathCenter ‚Äî Reyting</title>
<link rel="icon" type="image/svg+xml" href="assets/pi-logo.svg">
<link rel="stylesheet" href="assets/styles.css">

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
import config from "./config.js";
const app = initializeApp(config);
const db = getFirestore(app);

window.addEventListener("DOMContentLoaded", loadRating);

async function loadRating(){
  const tbl=document.getElementById("ratingBody");
  tbl.innerHTML="<tr><td colspan='4'>Yuklanmoqda...</td></tr>";
  try{
    const q=query(collection(db,"public_results"),orderBy("score","desc"));
    const snap=await getDocs(q);
    const arr=[];
    snap.forEach(doc=>{
      const d=doc.data();
      arr.push({
        name:d.name||"Foydalanuvchi",
        score:d.score||0,
        title:d.title||"",
        date:d.createdAt?.toDate?.()?.toLocaleString()||""
      });
    });
    arr.sort((a,b)=>b.score-a.score);
    tbl.innerHTML=arr.map((r,i)=>`
      <tr>
        <td>${i+1}</td>
        <td>${r.name}</td>
        <td>${r.title}</td>
        <td>${r.score}</td>
      </tr>`).join("")||"<tr><td colspan='4'>Natijalar topilmadi</td></tr>";
  }catch(e){
    console.error(e);
    tbl.innerHTML="<tr><td colspan='4'>Xatolik: "+e.message+"</td></tr>";
  }
}
</script>
</head>

<body>
<header class="header-glass">
  <div class="container row">
    <div class="brand">
      <img src="assets/pi-logo.svg" class="pi"><h2>Reyting</h2>
    </div>
    <div class="sp"></div>
    <a href="index.html" class="btn ghost">üè† Bosh sahifa</a>
  </div>
</header>

<main class="container">
  <div class="card p">
    <h3>Foydalanuvchilar reytingi</h3>
    <table class="table mt">
      <thead><tr><th>#</th><th>Foydalanuvchi</th><th>Test nomi</th><th>Ball</th></tr></thead>
      <tbody id="ratingBody"></tbody>
    </table>
  </div>
</main>
</body>
</html>
