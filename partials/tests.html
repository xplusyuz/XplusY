<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Testlar</title>
  <link rel="stylesheet" href="./css/base.css"/>
  <script>window.MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']]},svg:{fontCache:'global'}};</script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
</head>
<body>
  <div data-include="./partials/header.html"></div>

  <main class="container">
    <div class="hero">
      <h1>ğŸ“ Testlar</h1>
      <div class="sub">CSV â†’ grid + test runner â€¢ MathJax</div>
    </div>

    <section class="card" id="filtersBar">
      <div class="form-grid">
        <div class="field"><label>Reja</label><select id="fPlan"></select></div>
        <div class="field"><label>Boâ€˜lim</label><select id="fSec"></select></div>
        <div class="field"><label>Filter 1</label><select id="f1"></select></div>
        <div class="field"><label>Filter 2</label><select id="f2"></select></div>
      </div>
    </section>

    <section id="testsSections" data-csv="./csv/tests.csv"></section>
    <section id="testWrap" class="card hidden" style="margin-top:14px"></section>
  </main>

  <div data-include="./partials/footer.html"></div>

  <script type="module">
    import loadPartials from "./js/partials.js";
    (async () => {
      await loadPartials();
      const btn = document.getElementById('btnTheme');
      const cur = localStorage.getItem('mc_theme') || 'light';
      document.body.classList.toggle('theme-light', cur === 'light');
      if (btn) btn.addEventListener('click', () => {
        const isLight = document.body.classList.toggle('theme-light');
        localStorage.setItem('mc_theme', isLight ? 'light' : 'dark');
        try { MathJax.typesetPromise && MathJax.typesetPromise(); } catch(e) {}
      });
      const u0 = JSON.parse(localStorage.getItem('mc_user')||'{}');
      if(!u0.id){ u0.id=1000002; u0.balance= u0.balance ?? 50000; u0.gem = u0.gem ?? 0; localStorage.setItem('mc_user', JSON.stringify(u0)); }
      function syncHeader(){
        const u = JSON.parse(localStorage.getItem('mc_user')||'{}');
        const fmt = n => new Intl.NumberFormat('uz-UZ').format(n||0);
        const id=document.getElementById('hdrId');  if(id) id.textContent='ID: '+(u.id||'â€”');
        const b =document.getElementById('hdrBal'); if(b)  b.textContent='ğŸ’µ '+fmt(u.balance||0);
        const g =document.getElementById('hdrGem'); if(g)  g.textContent='ğŸ’ '+fmt(u.gem||0);
      }
      syncHeader(); window.__syncHeader = syncHeader;
      await import("./js/tests-csv.js");
      await import("./js/test.js");
    })();
  </script>
</body>
</html>
