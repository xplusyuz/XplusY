<section class="max-w-7xl mx-auto px-4 py-8">
<div class="flex items-center justify-between">
<h2 class="text-2xl font-bold">Testlar</h2>
<button id="reloadTests" class="px-3 py-2 rounded-xl border border-gray-200 bg-white shadow hover:scale-[1.02]">ðŸ”„ Yangilash</button>
</div>
<div id="testsGrid" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4 mt-5"></div>
</section>
<script type="module">
import { getFirestore, collection, getDocs, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js';
const db = getFirestore();
const gridT = document.getElementById('testsGrid');
document.getElementById('reloadTests').addEventListener('click', loadTests);
async function loadTests(){
gridT.innerHTML = cardSkeletons(6);
const snap = await getDocs(query(collection(db,'tests'), orderBy('createdAt','desc')));
const out = [];
snap.forEach(d=>{ const x = {id:d.id, ...d.data()}; out.push(card(x)); });
gridT.innerHTML = out.join('');
}
function card(x){
const img = x.imageUrl||'https://images.unsplash.com/photo-1496307042754-b4aa456c4a2d';
const diff = typeof x.rating==='number'? x.rating.toFixed(1): '4.5';
const link = x.link||'#';
return `
<article class="rounded-2xl border border-gray-100 bg-white shadow overflow-hidden">
<img src="${img}" class="w-full h-40 object-cover" alt="test"/>
<div class="p-4">
<div class="font-semibold line-clamp-1">${escapeHtml(x.title||'Test')}</div>
<p class="text-sm text-gray-600 line-clamp-2 mt-1">${escapeHtml(x.subtitle||'Qisqa tavsif')}</p>
<div class="mt-3 flex items-center justify-between">
<span class="text-xs px-2 py-0.5 rounded-full bg-emerald-100 text-emerald-700">ðŸŽ¯ Murakkablik: ${diff}</span>
<a href="${link}" target="_blank" class="text-emerald-700 underline">Boshlash</a>
</div>
</div>
</article>`;
}
function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c])); }
function cardSkeletons(n){ return Array.from({length:n}).map(()=>`<div class='animate-pulse h-60 rounded-2xl bg-gray-100'></div>`).join(''); }
loadTests();
</script>