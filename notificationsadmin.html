<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Notifications Admin</title>
  <style>
    body{font-family:Inter,system-ui;margin:20px;background:#f9fafb;}
    h1{color:#19b36b;}
    form{background:#fff;padding:16px;border-radius:12px;box-shadow:0 4px 16px rgba(0,0,0,.06);margin-bottom:20px}
    input,textarea{width:100%;padding:8px;border:1px solid #ddd;border-radius:8px;margin-bottom:12px;}
    button{padding:10px 16px;background:#19b36b;color:#fff;border:none;border-radius:8px;cursor:pointer;}
  </style>
</head>
<body>
  <h1>ðŸ“¢ Bildirishnomalar Admin</h1>
  <form id="notifForm">
    <input type="text" id="uid" placeholder="Foydalanuvchi UID (yoki ALL)" required/>
    <input type="text" id="title" placeholder="Sarlavha" required/>
    <textarea id="body" placeholder="Matn"></textarea>
    <button type="submit">Yuborish</button>
  </form>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, serverTimestamp, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const app = initializeApp({
  apiKey:"AIzaSyDYwHJou_9GqHZcf8XxtTByC51Z8un8rrM",
  authDomain:"xplusy-760fa.firebaseapp.com",
  projectId:"xplusy-760fa",
});
const db = getFirestore(app);

document.getElementById("notifForm").addEventListener("submit",async e=>{
  e.preventDefault();
  const uid=document.getElementById("uid").value.trim();
  const title=document.getElementById("title").value.trim();
  const body=document.getElementById("body").value.trim();
  if(!uid) return;

  if(uid==="ALL"){
    // broadcast: barcha users kolleksiyasidan oâ€˜qib, hammasiga qoâ€˜shamiz
    const users=await getDocs(collection(db,"users"));
    users.forEach(async u=>{
      await addDoc(collection(db,"notifications",u.id,"items"),{title,body,read:false,createdAt:serverTimestamp()});
    });
    alert("Hamma foydalanuvchilarga yuborildi!");
  }else{
    await addDoc(collection(db,"notifications",uid,"items"),{title,body,read:false,createdAt:serverTimestamp()});
    alert("Yuborildi: "+uid);
  }
  e.target.reset();
});
</script>
</body>
</html>
