<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>LeaderMath â€” Admin Panel</title>

  <link rel="icon" href="logo.png">
  <meta name="theme-color" content="#007AFF">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    body{
      margin:0;
      font-family:Inter,system-ui;
      background:#f2f2f7;
      color:#1d1d1f;
    }
    header{
      background:linear-gradient(135deg,#007AFF,#5856D6);
      color:#fff;
      padding:16px 24px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .logo{
      font-weight:800;
      font-size:20px;
    }
    .logout{
      background:rgba(255,255,255,.2);
      border:none;
      color:#fff;
      padding:10px 16px;
      border-radius:999px;
      cursor:pointer;
    }
    main{
      padding:24px;
      max-width:1200px;
      margin:auto;
    }
    h2{margin-top:0}
    table{
      width:100%;
      border-collapse:collapse;
      background:#fff;
      border-radius:12px;
      overflow:hidden;
    }
    th,td{
      padding:12px;
      border-bottom:1px solid #e5e5ea;
      text-align:left;
      font-size:14px;
    }
    th{
      background:#f2f2f7;
      font-weight:600;
    }
    tr:hover{background:#fafafa}
    .badge{
      padding:4px 10px;
      border-radius:999px;
      font-size:12px;
      font-weight:600;
    }
    .admin{background:#007AFF20;color:#007AFF}
    .user{background:#34C75920;color:#34C759}
  </style>
</head>
<body>

<header>
  <div class="logo">LeaderMath Admin</div>
  <div>
    <span id="adminName"></span>
    <button class="logout" id="logoutBtn">
      <i class="fa fa-sign-out-alt"></i> Chiqish
    </button>
  </div>
</header>

<main>
  <h2>Foydalanuvchilar</h2>
  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>Ism</th>
        <th>Email</th>
        <th>Ball</th>
        <th>Rol</th>
      </tr>
    </thead>
    <tbody id="usersBody">
      <tr><td colspan="5">Yuklanmoqda...</td></tr>
    </tbody>
  </table>
</main>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore-compat.js"></script>

<script>
/* ================= FIREBASE CONFIG ================= */
firebase.initializeApp({
  apiKey: "AIzaSyDYwHJou_9GqHZcf8XxtTByC51Z8un8rrM",
  authDomain: "xplusy-760fa.firebaseapp.com",
  projectId: "xplusy-760fa"
});

const auth = firebase.auth();
const db   = firebase.firestore();
const ADMIN_EMAIL = "sohibjonmath@gmail.com";

/* ================= GOOGLE AUTO LOGIN ================= */
const provider = new firebase.auth.GoogleAuthProvider();
provider.setCustomParameters({ prompt: "select_account" });

auth.onAuthStateChanged(async (user)=>{
  if(!user){
    await auth.signInWithPopup(provider);
    return;
  }

  if(user.email !== ADMIN_EMAIL){
    alert("Siz admin emassiz!");
    await auth.signOut();
    location.reload();
    return;
  }

  document.getElementById("adminName").textContent = user.displayName;
  loadUsers();
});

/* ================= LOAD USERS ================= */
async function loadUsers(){
  const snap = await db.collection("foydalanuvchilar").get();
  const body = document.getElementById("usersBody");
  body.innerHTML = "";

  let i=1;
  snap.forEach(doc=>{
    const u = doc.data();
    body.innerHTML += `
      <tr>
        <td>${i++}</td>
        <td>${u.firstName||"-"}</td>
        <td>${u.email||"-"}</td>
        <td>${u.points||0}</td>
        <td>
          <span class="badge ${u.role==="admin"?"admin":"user"}">
            ${u.role||"user"}
          </span>
        </td>
      </tr>`;
  });
}

/* ================= LOGOUT ================= */
document.getElementById("logoutBtn").onclick = async ()=>{
  if(confirm("Chiqishni xohlaysizmi?")){
    await auth.signOut();
    location.reload();
  }
};
</script>

</body>
</html>
