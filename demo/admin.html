<!doctype html>
<html lang="uz" data-theme="dark">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>LeaderMath — Admin (Site + Home)</title>
  <style>
    :root{
      --brand:#2E8B57;
      --bg:#050908;
      --card:#0f1a15;
      --card-soft:#111f18;
      --line:#23382d;
      --text:#F4FBF7;
      --muted:#8EADA0;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      margin:0;
      font:14px/1.6 system-ui,-apple-system,BlinkMacSystemFont,"SF Pro Text",Segoe UI,sans-serif;
      background:radial-gradient(1000px 700px at 0 0,rgba(46,139,87,.35),transparent 60%),#050908;
      color:var(--text);
    }
    header{
      position:sticky;top:0;
      backdrop-filter:blur(16px);
      background:rgba(5,9,8,.96);
      border-bottom:1px solid rgba(255,255,255,.06);
      z-index:10;
    }
    .row{
      max-width:1120px;
      margin:0 auto;
      padding:10px 16px;
      display:flex;
      align-items:center;
      gap:12px;
    }
    .brand{font-weight:800;color:#bbf7d0}
    main{
      max-width:1120px;
      margin:0 auto;
      padding:16px;
      display:grid;
      gap:16px;
    }
    .card{
      border-radius:16px;
      border:1px solid rgba(255,255,255,.06);
      background:linear-gradient(145deg,var(--card),var(--card-soft));
      box-shadow:0 18px 60px rgba(0,0,0,.7);
      padding:16px;
    }
    h2{margin:0 0 8px;font-size:18px}
    h3{margin:12px 0 6px;font-size:15px}
    label{display:block;font-size:12px;text-transform:uppercase;letter-spacing:.08em;color:var(--muted);margin-bottom:4px;}
    input,textarea{
      width:100%;border-radius:10px;border:1px solid rgba(148,163,184,.4);
      background:#020617;color:#e5e7eb;
      padding:8px 10px;
      font:inherit;
    }
    textarea{min-height:160px;resize:vertical}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .mini{font-size:12px;color:var(--muted)}
    button{
      border-radius:10px;border:1px solid rgba(148,163,184,.4);
      background:linear-gradient(135deg,#22c55e,#16a34a);
      color:#052e16;
      padding:8px 12px;
      cursor:pointer;
      font-weight:700;
      font-size:13px;
    }
    button.secondary{
      background:linear-gradient(135deg,#020617,#020617);
      color:#e5e7eb;
    }
    .chips-area textarea{min-height:80px;font-family:monospace;}
    .flex{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .pill{
      padding:4px 8px;border-radius:999px;border:1px solid rgba(148,239,191,.5);
      font-size:11px;color:#bbf7d0;background:rgba(22,163,74,.14);
    }
    #status{font-size:12px;color:#bbf7d0;margin-left:8px;}
  </style>
</head>
<body>
<header>
  <div class="row">
    <div class="brand">LeaderMath Admin</div>
    <div id="admin-user" class="mini"></div>
    <div style="margin-left:auto" class="flex">
      <button id="btnLoginGoogle">Google bilan kirish</button>
      <button id="btnLogout" class="secondary">Chiqish</button>
    </div>
  </div>
</header>

<main>
  <div class="card">
    <h2>Sayt sozlamalari (configs/site)</h2>
    <p class="mini">Header, favicon, chip menyu, footer — hammasi shu hujjatdan o‘qiladi.</p>
    <div class="grid2">
      <div>
        <label for="siteTitle">Sayt nomi</label>
        <input id="siteTitle" placeholder="LeaderMath.UZ">
      </div>
      <div>
        <label for="siteSubtitle">Tagline</label>
        <input id="siteSubtitle" placeholder="Matematika platformasi">
      </div>
    </div>
    <div class="grid2" style="margin-top:10px;">
      <div>
        <label for="logoUrl">Logo URL</label>
        <input id="logoUrl" placeholder="/logo.png">
      </div>
      <div>
        <label for="faviconUrl">Favicon URL</label>
        <input id="faviconUrl" placeholder="/logo.png">
      </div>
    </div>
    <div style="margin-top:10px;">
      <label for="primaryColor">Asosiy rang (#rrggbb)</label>
      <input id="primaryColor" placeholder="#2E8B57">
    </div>

    <div class="chips-area" style="margin-top:12px;">
      <label for="chipsJson">Chip menyu (JSON massiv)</label>
      <textarea id="chipsJson" placeholder='[{"id":"home","label":"Asosiy"},{"id":"tests","label":"Testlar"}]'></textarea>
      <p class="mini">Har bir chip: {"id":"home","label":"Asosiy"}</p>
    </div>

    <div style="margin-top:12px;">
      <label for="footerHtml">Footer HTML</label>
      <textarea id="footerHtml" placeholder="<p>© 2025 LeaderMath.UZ</p>"></textarea>
    </div>

    <div class="flex" style="margin-top:12px;">
      <button id="btnLoadSite" class="secondary">Sayt configni yuklash</button>
      <button id="btnSaveSite">Saqlash</button>
      <span id="status"></span>
    </div>
  </div>

  <div class="card">
    <h2>Home JSON (configs/home)</h2>
    <p class="mini">Index sahifadagi bo‘limlar, kartochkalar va hokazo. Hozircha to‘liq JSON sifatida tahrirlaymiz.</p>
    <label for="homeJson">home JSON</label>
    <textarea id="homeJson" placeholder='{"sections":[...]}'></textarea>
    <div class="flex" style="margin-top:10px;">
      <button id="btnLoadHome" class="secondary">Firestoredan yuklash</button>
      <button id="btnSaveHome">Publish</button>
      <span id="statusHome"></span>
    </div>
  </div>
</main>

<script type="module">
  import {
    auth,
    onAuthStateChanged,
    GoogleAuthProvider,
    signInWithPopup,
    signOut,
    getSiteConfig,
    saveSiteConfig,
    getHomeConfig,
    saveHomeConfig,
  } from "./firebase.js";

  const $ = (s,r=document)=>r.querySelector(s);
  const ADMIN_EMAILS = [
    "sohibjonmath@gmail.com",
  ];

  const em = $("#siteTitle");
  const sub = $("#siteSubtitle");
  const logo = $("#logoUrl");
  const fav = $("#faviconUrl");
  const color = $("#primaryColor");
  const chips = $("#chipsJson");
  const footer = $("#footerHtml");
  const statusEl = $("#status");

  const homeJson = $("#homeJson");
  const statusHome = $("#statusHome");

  async function loadSite() {
    try{
      const cfg = await getSiteConfig();
      em.value = cfg.title || "";
      sub.value = cfg.subtitle || "";
      logo.value = cfg.logoUrl || "";
      fav.value = cfg.faviconUrl || "";
      color.value = cfg.primaryColor || "";
      chips.value = JSON.stringify(cfg.chips || [], null, 2);
      footer.value = cfg.footerHtml || "";
      statusEl.textContent = "Yuklandi ✔";
    }catch(e){
      statusEl.textContent = "Xato: " + (e.message || e);
    }
  }

  async function saveSite() {
    try{
      let chipsVal = [];
      if(chips.value.trim()){
        chipsVal = JSON.parse(chips.value);
      }
      const data = {
        title: em.value.trim(),
        subtitle: sub.value.trim(),
        logoUrl: logo.value.trim(),
        faviconUrl: fav.value.trim(),
        primaryColor: color.value.trim() || "#2E8B57",
        chips: chipsVal,
        footerHtml: footer.value,
      };
      await saveSiteConfig(data);
      statusEl.textContent = "Saqlendi ✅";
    }catch(e){
      statusEl.textContent = "Xato: " + (e.message || e);
    }
  }

  async function loadHome() {
    try{
      const cfg = await getHomeConfig();
      homeJson.value = JSON.stringify(cfg, null, 2);
      statusHome.textContent = "Yuklandi ✔";
    }catch(e){
      statusHome.textContent = "Xato: " + (e.message || e);
    }
  }
  async function saveHome() {
    try{
      const json = JSON.parse(homeJson.value);
      await saveHomeConfig(json);
      statusHome.textContent = "Publish qilindi ✅";
    }catch(e){
      statusHome.textContent = "Xato: " + (e.message || e);
    }
  }

  $("#btnLoadSite").onclick = loadSite;
  $("#btnSaveSite").onclick = saveSite;
  $("#btnLoadHome").onclick = loadHome;
  $("#btnSaveHome").onclick = saveHome;

  $("#btnLoginGoogle").onclick = async()=>{
    try{
      await signInWithPopup(auth,new GoogleAuthProvider());
    }catch(e){
      alert("Login xatosi: " + (e.message||e));
    }
  };
  $("#btnLogout").onclick = ()=>signOut(auth);

  onAuthStateChanged(auth, (u)=>{
    const info = $("#admin-user");
    if(!u){
      info.textContent = "Kirmagan";
      return;
    }
    info.textContent = u.email || u.uid;
    if(!ADMIN_EMAILS.includes(u.email)){
      alert("Sizda admin huquqi yo'q. (email ruxsat etilgan ro'yxatda emas)");
    }else{
      loadSite();
      loadHome();
    }
  });
</script>
</body>
</html>
