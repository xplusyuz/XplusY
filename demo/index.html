<!doctype html>
<html lang="uz" data-theme="light">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>LeaderMath.UZ â€” Yangiliklar va Reklama Carouseli</title>

  <meta name="theme-color" content="#2E8B57" id="meta-theme-color"/>
  <link rel="icon" href="./logo.png" sizes="any">
  <link rel="apple-touch-icon" href="./logo.png">

  <style>
    :root{
      --brand:#2E8B57; --brand-dark:#1F6B45; --accent:#6B8E23;
      --bg:#F4FAF6; --bg-2:#E9F4EE;
      --card:#FFFFFF; --card-soft:#F9FCFA;
      --text:#0f1b15; --muted:#607469;
      --line:#DFEAE3;
      --radius:18px; --radius-lg:22px; --pill:999px;
      --shadow:0 18px 45px rgba(9,30,17,.16);
      --shadow-sm:0 8px 24px rgba(9,30,17,.10);
    }
    *{box-sizing:border-box}
    html,body{
      margin:0; padding:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:radial-gradient(circle at top,#eef8f2 0,#f4faf6 40%,#edf6f1 100%);
      color:var(--text);
    }
    body{
      min-height:100vh;
      display:flex;
      flex-direction:column;
    }
    .app-shell{
      max-width:1080px;
      margin:0 auto;
      padding:12px 16px 32px;
      display:flex; flex-direction:column;
      gap:16px;
    }
    /* HEADER */
    header{
      position:sticky;
      top:0;
      z-index:10;
      backdrop-filter:blur(18px);
      background:linear-gradient(120deg,rgba(244,250,246,.92),rgba(233,244,238,.94));
      border-bottom:1px solid rgba(223,234,227,.8);
    }
    .header-inner{
      max-width:1080px;
      margin:0 auto;
      padding:10px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .brand-row{
      display:flex; align-items:center; gap:10px;
    }
    .brand-logo{
      width:34px;height:34px;border-radius:14px;
      background:radial-gradient(circle at 30% 20%,#fff 0,#c2e6d2 48%,#2e8b57 100%);
      display:flex;align-items:center;justify-content:center;
      box-shadow:0 0 0 1px rgba(255,255,255,.8),0 10px 25px rgba(11,52,28,.35);
      overflow:hidden;
    }
    .brand-logo img{width:70%;height:70%;object-fit:contain}
    .brand-title{
      display:flex;flex-direction:column;gap:2px;
    }
    .brand-title-main{
      font-weight:800;font-size:17px;letter-spacing:.03em;
      text-transform:uppercase;color:var(--brand-dark);
    }
    .brand-title-sub{
      font-size:12px;color:var(--muted);
    }
    .user-pill{
      padding:4px 10px;
      border-radius:var(--pill);
      background:rgba(255,255,255,.9);
      border:1px solid rgba(223,234,227,.9);
      display:flex;align-items:center;gap:8px;
      box-shadow:var(--shadow-sm);
      cursor:pointer;
      transition:transform .25s,box-shadow .25s,background .25s;
    }
    .user-pill:hover{
      transform:translateY(-1px);
      box-shadow:0 14px 30px rgba(14,52,29,.22);
      background:#ffffff;
    }
    .user-avatar{
      width:26px;height:26px;border-radius:50%;
      background:linear-gradient(135deg,#2e8b57,#6b8e23);
      color:#fff;font-size:13px;font-weight:700;
      display:flex;align-items:center;justify-content:center;
    }
    .user-meta{display:flex;flex-direction:column;gap:1px;}
    .user-name-row{display:flex;align-items:center;gap:4px;}
    .user-name{font-size:12px;font-weight:600;color:var(--text);}
    .user-points{font-size:11px;color:var(--muted);}
    .pro-badge{
      font-size:9px;
      padding:2px 6px;
      border-radius:999px;
      background:linear-gradient(135deg,#ecc94b,#d69e2e);
      color:#1a202c;
      text-transform:uppercase;
      letter-spacing:.05em;
      box-shadow:0 0 0 1px rgba(255,255,255,.7);
    }

    main{flex:1;display:flex}
    .hero{
      margin-top:8px;
      padding:16px 16px 18px;
      border-radius:var(--radius-lg);
      background:radial-gradient(circle at 10% 0,#ffffff 0,#d7efe2 40%,#b1ddc7 100%);
      box-shadow:var(--shadow);
      display:grid;grid-template-columns:minmax(0,3fr) minmax(0,2fr);
      gap:16px;align-items:center;
    }
    @media(max-width:720px){
      .hero{grid-template-columns:1fr}
    }
    .hero-main-title{
      font-size:24px;line-height:1.2;font-weight:800;
      color:#0b2515;margin-bottom:8px;
    }
    .hero-sub{font-size:14px;color:var(--muted);max-width:460px;margin-bottom:12px;}
    .hero-cta-row{display:flex;flex-wrap:wrap;gap:8px;align-items:center;}
    .btn{
      border:none;outline:none;cursor:pointer;
      border-radius:var(--pill);
      padding:8px 16px;
      font-size:13px;font-weight:600;
      display:inline-flex;align-items:center;gap:6px;
      transition:transform .25s,box-shadow .25s,background .25s,color .25s;
    }
    .btn-primary{
      background:linear-gradient(135deg,#2e8b57,#1f6b45);
      color:#fff;
      box-shadow:0 14px 30px rgba(17,68,39,.35);
    }
    .btn-success{
      background:linear-gradient(135deg,#38a169,#2f855a);
      color:#fff;
      box-shadow:0 14px 30px rgba(22,92,53,.35);
    }
    .btn-warning{
      background:linear-gradient(135deg,#dd6b20,#c05621);
      color:#fff;
      box-shadow:0 14px 30px rgba(133,54,15,.4);
    }
    .btn-info{
      background:linear-gradient(135deg,#3182ce,#2b6cb0);
      color:#fff;
      box-shadow:0 14px 30px rgba(30,64,108,.4);
    }
    .btn-primary:hover,
    .btn-success:hover,
    .btn-warning:hover,
    .btn-info:hover{
      transform:translateY(-1px);
      box-shadow:0 18px 40px rgba(14,52,31,.45);
    }
    .btn-ghost{
      background:rgba(255,255,255,.4);
      color:var(--brand-dark);
      border:1px solid rgba(187,214,199,.9);
    }
    .btn-ghost:hover{
      background:#ffffff;
      box-shadow:var(--shadow-sm);
    }
    .hero-meta-tag{
      display:inline-flex;align-items:center;gap:6px;
      padding:3px 10px;
      border-radius:var(--pill);
      background:rgba(255,255,255,.75);
      border:1px solid rgba(210,231,220,.9);
      font-size:11px;color:var(--muted);
    }
    .hero-meta-tag.badge-type-success{
      background:rgba(198,246,213,.9);
      border-color:#9ae6b4;
      color:#22543d;
    }
    .hero-meta-tag.badge-type-warning{
      background:rgba(254,243,199,.95);
      border-color:#f6e05e;
      color:#744210;
    }
    .hero-meta-tag.badge-type-info{
      background:rgba(190,227,248,.92);
      border-color:#90cdf4;
      color:#2a4365;
    }
    .hero-visual{position:relative;min-height:140px;}
    .hero-badge{
      position:absolute;right:8px;top:0;
      padding:6px 12px;border-radius:var(--pill);
      background:rgba(255,255,255,.9);
      border:1px solid rgba(200,224,210,.9);
      font-size:11px;color:var(--brand-dark);
      box-shadow:var(--shadow-sm);
    }
    .hero-orb{
      position:absolute;inset:20px 4px 4px 4px;
      border-radius:18px;
      background:radial-gradient(circle at 20% 0,#ffffff 0,#cde8d7 40%,#2e8b57 110%);
      box-shadow:0 18px 40px rgba(9,38,20,.45);
      overflow:hidden;
    }
    .hero-orb-inner{
      position:absolute;inset:0;
      background:
        radial-gradient(circle at 10% 0,rgba(255,255,255,.7) 0,transparent 55%),
        radial-gradient(circle at 80% 0,rgba(255,255,255,.55) 0,transparent 56%),
        radial-gradient(circle at 40% 100%,rgba(255,255,255,.26) 0,transparent 60%);
      opacity:.75;
    }
    .hero-orb-text{
      position:absolute;bottom:10px;left:12px;right:12px;
      font-size:11px;color:#f0fff6;
    }

    /* CAROUSEL */
    section{margin-top:16px;}
    section h2{
      font-size:16px;margin:0 2px 10px;
      display:flex;align-items:center;justify-content:space-between;
      color:#143423;
    }
    .carousel{
      position:relative;
      border-radius:var(--radius-lg);
      background:linear-gradient(135deg,#0f2517,#173824);
      padding:10px 44px;
      overflow:hidden;
      box-shadow:var(--shadow);
      color:#ecfff6;
      min-height:150px;
    }
    .carousel-track{
      display:flex;
      transition:transform .45s ease;
    }
    .slide{
      min-width:100%;
      display:grid;
      grid-template-columns:minmax(0,3fr) minmax(0,2fr);
      gap:14px;
      padding:4px 0;
    }
    @media(max-width:720px){
      .carousel{padding:10px 40px 12px;}
      .slide{grid-template-columns:1fr}
    }
    .slide-text h3{margin:0 0 6px;font-size:17px;}
    .slide-text p{margin:0 0 8px;font-size:13px;color:#b6d9c5;}
    .slide-badge{
      display:inline-flex;align-items:center;gap:6px;
      font-size:11px;padding:3px 10px;border-radius:var(--pill);
      border:1px solid rgba(196,242,211,.35);
      background:rgba(255,255,255,.12);
    }
    .slide-badge.badge-type-success{
      background:rgba(72,187,120,.22);
      border-color:rgba(154,230,180,.9);
      color:#e6fffa;
    }
    .slide-badge.badge-type-warning{
      background:rgba(237,137,54,.25);
      border-color:rgba(251,211,141,.9);
      color:#fffaf0;
    }
    .slide-badge.badge-type-info{
      background:rgba(66,153,225,.25);
      border-color:rgba(190,227,248,.9);
      color:#e9f5ff;
    }
    .slide-link{
      font-size:12px;margin-top:6px;
      display:inline-flex;align-items:center;gap:4px;
      color:#e3fff2;text-decoration:none;
    }
    .slide-link span{text-decoration:underline;}
    .slide-image-wrap{
      border-radius:16px;
      overflow:hidden;
      background:rgba(0,0,0,.4);
      border:1px solid rgba(196,242,211,.4);
    }
    .slide-image-wrap img{
      width:100%;height:100%;object-fit:cover;display:block;
    }
    .carousel-nav{
      position:absolute;inset:0;
      display:flex;align-items:center;justify-content:space-between;
      pointer-events:none;
    }
    .nav-btn{
      width:28px;height:28px;border-radius:999px;
      border:1px solid rgba(207,235,219,.9);
      background:rgba(8,31,17,.8);
      display:flex;align-items:center;justify-content:center;
      font-size:15px;color:#e8fff3;
      box-shadow:0 10px 25px rgba(0,0,0,.5);
      cursor:pointer;
      pointer-events:auto;
      transition:transform .2s,box-shadow .2s,background .2s;
    }
    .nav-btn:hover{
      transform:translateY(-1px);
      box-shadow:0 14px 30px rgba(0,0,0,.7);
      background:#0b2214;
    }
    .dots{
      position:absolute;left:50%;bottom:8px;
      transform:translateX(-50%);
      display:flex;gap:6px;
    }
    .dot{
      width:7px;height:7px;border-radius:99px;
      background:rgba(255,255,255,.25);
      cursor:pointer;
      border:1px solid rgba(190,236,203,.6);
      transition:width .18s,background .18s;
    }
    .dot.active{
      width:16px;
      background:#c6f6d5;
    }

    /* GRID CARDS */
    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(210px,1fr));
      gap:12px;
    }
    .card{
      border-radius:var(--radius);
      background:var(--card);
      box-shadow:var(--shadow-sm);
      padding:12px 12px 14px;
      display:flex;flex-direction:column;gap:6px;
      border:1px solid rgba(225,235,229,.95);
      position:relative;
      overflow:hidden;
      cursor:pointer;
      transition:transform .25s,box-shadow .25s,border-color .25s,background .25s;
    }
    .card::before{
      content:"";
      position:absolute;inset:-40%;
      background:conic-gradient(from 200deg,#2e8b57,#6b8e23,#2e8b57);
      opacity:0;pointer-events:none;
      transition:opacity .4s;
    }
    .card-inner{
      position:relative;z-index:1;
    }
    .card:hover{
      transform:translateY(-2px);
      box-shadow:0 18px 40px rgba(7,34,19,.24);
      border-color:rgba(144,199,168,1);
      background:linear-gradient(135deg,rgba(255,255,255,.96),rgba(234,247,239,.98));
    }
    .card:hover::before{opacity:.08;}
    .card-icon{
      width:26px;height:26px;border-radius:12px;
      background:rgba(46,139,87,.08);
      display:flex;align-items:center;justify-content:center;
      font-size:15px;
    }
    .card-title{font-size:14px;font-weight:700;margin-top:2px;margin-bottom:0;}
    .card-text{font-size:12px;color:var(--muted);margin:0;}
    .card-status{
      font-size:11px;margin-top:4px;
      display:inline-flex;align-items:center;gap:6px;
      padding:3px 9px;border-radius:var(--pill);
      background:rgba(46,139,87,.06);
      color:var(--brand-dark);
      border:1px solid rgba(182,219,198,.9);
    }
    .card-status.soon{
      background:rgba(250,215,120,.08);
      color:#b7791f;
      border-color:rgba(250,224,143,.85);
    }
    .card a{
      text-decoration:none;color:inherit;
    }

    footer{
      padding:14px 16px 22px;
      font-size:11px;
      color:var(--muted);
      text-align:center;
    }
  </style>
</head>
<body>
  <header>
    <div class="header-inner">
      <div class="brand-row">
        <div class="brand-logo">
          <img src="./logo.png" alt="LM"/>
        </div>
        <div class="brand-title">
          <div class="brand-title-main">LeaderMath.UZ</div>
          <div class="brand-title-sub">Yangiliklar & reklama platformasi</div>
        </div>
      </div>
      <button class="user-pill" id="userBtn" type="button">
        <div class="user-avatar" id="userAvatar">LM</div>
        <div class="user-meta">
          <div class="user-name-row">
            <div class="user-name" id="userName">Mehmon</div>
            <div class="pro-badge" id="proBadge" style="display:none;">PRO</div>
          </div>
          <div class="user-points" id="userInfo">Kirish kerak</div>
        </div>
      </button>
    </div>
  </header>

  <div class="app-shell">
    <section id="heroSection" class="hero" style="display:none;">
      <div>
        <div class="hero-main-title" id="heroTitle"></div>
        <div class="hero-sub" id="heroSubtitle"></div>
        <div class="hero-cta-row">
          <a id="heroCtaLink" class="btn btn-primary" href="#" target="_blank" rel="noopener">
            <span id="heroCtaLabel">Batafsil</span> <span>â†’</span>
          </a>
          <button class="btn btn-ghost" type="button" id="refreshBtn">Yangilash</button>
        </div>
        <div style="margin-top:10px;">
          <span class="hero-meta-tag badge-type-info" id="heroMetaTag">
            ðŸ”„ Kontent Firebase configs/home dan yuklanmoqda
          </span>
        </div>
      </div>
      <div class="hero-visual">
        <div class="hero-badge" id="heroBadgeRight">ðŸ“¢ Dinamik reklama va yangiliklar</div>
        <div class="hero-orb">
          <div class="hero-orb-inner"></div>
          <div class="hero-orb-text" id="heroOrbText">
            Barcha banner va kartalar admin panel orqali drag &amp; drop yordamida boshqariladi.
            Har bir element uchun rolga qarab koâ€˜rinish sozlanadi.
          </div>
        </div>
      </div>
    </section>

    <section id="carouselsRoot"></section>
    <section id="gridsRoot"></section>
  </div>

  <footer>
    Â© <span id="year"></span> LeaderMath.UZ â€” Firebase asosidagi dinamik kontent tizimi.
  </footer>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import {
      getAuth, GoogleAuthProvider, signInWithPopup,
      onAuthStateChanged, signOut
    } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
    import {
      getFirestore, doc, getDoc
    } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDYwHJou_9GqHZcf8XxtTByC51Z8un8rrM",
      authDomain: "xplusy-760fa.firebaseapp.com",
      projectId: "xplusy-760fa",
      storageBucket: "xplusy-760fa.appspot.com",
      messagingSenderId: "457882083595",
      appId: "1:457882083595:web:4b76c5f5a6bcd1d987b9c8"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    const heroSection = document.getElementById('heroSection');
    const heroTitle = document.getElementById('heroTitle');
    const heroSubtitle = document.getElementById('heroSubtitle');
    const heroCtaLink = document.getElementById('heroCtaLink');
    const heroCtaLabel = document.getElementById('heroCtaLabel');
    const heroMetaTag = document.getElementById('heroMetaTag');
    const heroBadgeRight = document.getElementById('heroBadgeRight');
    const heroOrbText = document.getElementById('heroOrbText');

    const carouselsRoot = document.getElementById('carouselsRoot');
    const gridsRoot = document.getElementById('gridsRoot');
    const refreshBtn = document.getElementById('refreshBtn');

    const userBtn = document.getElementById('userBtn');
    const userNameEl = document.getElementById('userName');
    const userInfoEl = document.getElementById('userInfo');
    const userAvatar = document.getElementById('userAvatar');
    const proBadge = document.getElementById('proBadge');

    document.getElementById('year').textContent = new Date().getFullYear();

    let currentRole = 'guest'; // "guest" | "user" | "pro"

    userBtn.addEventListener('click', async () => {
      if (!auth.currentUser) {
        try{
          await signInWithPopup(auth, provider);
        }catch(e){ console.error(e); alert("Kirishda xatolik: " + e.message); }
      } else {
        if (confirm("Chiqishni xohlaysizmi?")) await signOut(auth);
      }
    });

    async function determineRole(user){
      if(!user){
        currentRole = 'guest';
        proBadge.style.display = 'none';
        userInfoEl.textContent = "Kirish kerak";
        return;
      }
      try{
        const snap = await getDoc(doc(db,'users',user.uid));
        let role = 'user';
        if(snap.exists()){
          const data = snap.data();
          if(typeof data.role === 'string'){
            role = data.role;
          }
        }
        currentRole = role;
        if(currentRole === 'pro'){
          proBadge.style.display = 'inline-flex';
          userInfoEl.textContent = "Pro foydalanuvchi";
        }else if(currentRole === 'user'){
          proBadge.style.display = 'none';
          userInfoEl.textContent = "Oddiy foydalanuvchi";
        }else{
          proBadge.style.display = 'none';
          userInfoEl.textContent = "Kirish kerak";
        }
      }catch(e){
        console.error('Role oâ€˜qishda xatolik:', e);
        currentRole = 'user';
        proBadge.style.display = 'none';
        userInfoEl.textContent = "Oddiy foydalanuvchi";
      }
    }

    onAuthStateChanged(auth, async (user) => {
      if (user) {
        const name = user.displayName || user.email || "Foydalanuvchi";
        userNameEl.textContent = name;
        userAvatar.textContent = (name[0] || 'U').toUpperCase();
      } else {
        userNameEl.textContent = "Mehmon";
        userAvatar.textContent = "LM";
      }
      await determineRole(user);
      loadConfig(false);
    });

    function heroCtaClass(type){
      switch(type){
        case 'success': return 'btn btn-success';
        case 'warning': return 'btn btn-warning';
        case 'info': return 'btn btn-info';
        default: return 'btn btn-primary';
      }
    }

    function isVisibleForRole(obj){
      const roles = obj && obj.visibleRoles;
      if(!Array.isArray(roles) || roles.length === 0) return true;
      return roles.includes(currentRole);
    }

    async function loadConfig(showLog=true){
      try{
        const snap = await getDoc(doc(db,'configs','home'));
        if(!snap.exists()){
          console.warn('configs/home topilmadi');
          alert('configs/home topilmadi. Avval admin.html orqali yarating.');
          return;
        }
        const cfg = snap.data();
        renderHero(cfg.hero || {});
        renderCarousels(cfg.carousels || []);
        renderGrids(cfg.grids || []);
        if(showLog) console.log('Konfiguratsiya yuklandi, rol:', currentRole);
      }catch(e){
        console.error(e);
        alert("Maâ€™lumotlarni yuklashda xatolik: " + e.message);
      }
    }

    function renderHero(hero){
      if(!hero){ heroSection.style.display='none'; return; }
      heroTitle.textContent = hero.title || '';
      heroSubtitle.textContent = hero.subtitle || '';

      const baseLabel = hero.ctaLabel || 'Batafsil';
      const proLabel = hero.proCtaLabel || baseLabel;
      const finalLabel = currentRole === 'pro' ? proLabel : baseLabel;
      heroCtaLabel.textContent = finalLabel;

      heroCtaLink.href = hero.ctaHref || '#';
      heroCtaLink.className = heroCtaClass(hero.ctaType || 'primary');

      const badgeText = hero.badgeText || 'ðŸ”„ Kontent Firebase configs/home dan yuklanmoqda';
      const badgeType = hero.badgeType || 'info';
      heroMetaTag.textContent = badgeText;
      heroMetaTag.className = 'hero-meta-tag badge-type-' + badgeType;

      if(currentRole === 'pro'){
        heroBadgeRight.textContent = 'â­ Pro foydalanuvchilar uchun maxsus takliflar';
        heroOrbText.textContent = 'Siz Pro foydalanuvchisiz. Banner va cardlar orasida faqat Pro uchun moâ€˜ljallangan maxsus takliflar ham bor.';
      }else{
        heroBadgeRight.textContent = hero.badgeText || 'ðŸ“¢ Dinamik reklama va yangiliklar';
        heroOrbText.textContent = 'Barcha banner va kartalar admin panel orqali drag & drop yordamida boshqariladi. Har bir element uchun rolga qarab koâ€˜rinish sozlanadi.';
      }

      heroSection.style.display='grid';
    }

    function renderCarousels(list){
      carouselsRoot.innerHTML = '';
      if(!Array.isArray(list) || !list.length) return;
      list.forEach((carCfg) => {
        const items = Array.isArray(carCfg.items) ? carCfg.items.filter(it=>isVisibleForRole(it)) : [];
        if(!items.length) return;

        const sec = document.createElement('section');
        const title = document.createElement('h2');
        title.textContent = carCfg.title || 'Carusel';
        sec.appendChild(title);

        const wrapper = document.createElement('div');
        wrapper.className = 'carousel';
        const track = document.createElement('div');
        track.className = 'carousel-track';

        items.forEach((item)=>{
          const slide = document.createElement('div');
          slide.className = 'slide';
          const text = document.createElement('div');
          text.className = 'slide-text';
          text.innerHTML = `
            <h3>${item.title || ''}</h3>
            <p>${item.text || ''}</p>
          `;
          if(item.badge){
            const b = document.createElement('div');
            b.className = 'slide-badge badge-type-' + (item.badgeType || 'info');
            b.innerHTML = `ðŸ“Œ <span>${item.badge}</span>`;
            text.appendChild(b);
          }
          if(item.href){
            const link = document.createElement('a');
            link.className = 'slide-link';
            link.href = item.href;
            link.target = '_blank';
            link.rel = 'noopener';
            link.innerHTML = `<span>Havola</span> â†—`;
            text.appendChild(link);
          }

          const imgWrap = document.createElement('div');
          imgWrap.className = 'slide-image-wrap';
          if(item.imageUrl){
            const img = document.createElement('img');
            img.src = item.imageUrl;
            img.alt = item.title || '';
            imgWrap.appendChild(img);
          }

          slide.appendChild(text);
          slide.appendChild(imgWrap);
          track.appendChild(slide);
        });

        const nav = document.createElement('div');
        nav.className = 'carousel-nav';
        const prev = document.createElement('button');
        prev.className = 'nav-btn';
        prev.innerHTML = 'â€¹';
        const next = document.createElement('button');
        next.className = 'nav-btn';
        next.innerHTML = 'â€º';
        nav.appendChild(prev);
        nav.appendChild(next);

        const dots = document.createElement('div');
        dots.className = 'dots';
        items.forEach((_,i)=>{
          const d = document.createElement('div');
          d.className = 'dot' + (i===0?' active':'');
          dots.appendChild(d);
        });

        wrapper.appendChild(track);
        wrapper.appendChild(nav);
        wrapper.appendChild(dots);
        sec.appendChild(wrapper);
        carouselsRoot.appendChild(sec);

        initCarousel(wrapper, track, items.length);
      });
    }

    function initCarousel(wrapper, track, count){
      if(count === 0) return;
      let current = 0;
      const dots = Array.from(wrapper.querySelectorAll('.dot'));
      const btns = wrapper.querySelectorAll('.nav-btn');
      const prev = btns[0];
      const next = btns[1];

      function update(){
        track.style.transform = `translateX(-${current*100}%)`;
        dots.forEach((d,i)=>d.classList.toggle('active',i===current));
      }
      prev.addEventListener('click',()=>{
        current = (current - 1 + count) % count;
        update();
      });
      next.addEventListener('click',()=>{
        current = (current + 1) % count;
        update();
      });
      dots.forEach((d,i)=>d.addEventListener('click',()=>{ current=i; update(); }));
    }

    function renderGrids(list){
      gridsRoot.innerHTML = '';
      if(!Array.isArray(list) || !list.length) return;
      list.forEach(gridCfg=>{
        const items = Array.isArray(gridCfg.items) ? gridCfg.items.filter(it=>isVisibleForRole(it)) : [];
        if(!items.length) return;

        const sec = document.createElement('section');
        const title = document.createElement('h2');
        title.textContent = gridCfg.title || 'Boâ€˜lim';
        sec.appendChild(title);

        const grid = document.createElement('div');
        grid.className = 'grid';

        items.forEach(item=>{
          const a = document.createElement(item.href ? 'a' : 'div');
          if(item.href){
            a.href = item.href;
            a.target = '_blank';
            a.rel = 'noopener';
          }
          const card = document.createElement('div');
          card.className = 'card';
          const inner = document.createElement('div');
          inner.className = 'card-inner';
          inner.innerHTML = `
            <div class="card-icon">${item.icon || 'ðŸ“¦'}</div>
            <div class="card-title">${item.title || ''}</div>
            <p class="card-text">${item.text || ''}</p>
          `;
          const status = document.createElement('div');
          status.className = 'card-status' + (item.status==='soon'?' soon':'');
          status.innerHTML = (item.status==='soon'?'â³ Tez orada':'âœ… Aktiv modul');
          inner.appendChild(status);

          card.appendChild(inner);
          a.appendChild(card);
          grid.appendChild(a);
        });

        sec.appendChild(grid);
        gridsRoot.appendChild(sec);
      });
    }

    refreshBtn.addEventListener('click',()=>loadConfig(true));

    // Guest holati uchun ham bir marta yuklash
    if(!auth.currentUser){
      loadConfig(false);
    }
  </script>
</body>
</html>
