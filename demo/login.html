<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover">
  <title>Namangan shahar 1-IMI — Kirish</title>

  <link rel="icon" href="logo.png" sizes="192x192">
  <meta name="theme-color" content="#e0f2fe">

  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

  <style>
    :root{
      --brand:#0ea5e9;
      --bg:#e0f2fe;
      --text:#0f172a;
      --muted:#6b7280;
      --shell-radius:22px;
      --shadow:0 14px 30px rgba(15,23,42,.25);
    }
    *{margin:0;padding:0;box-sizing:border-box;}
    body{
      min-height:100vh;
      font-family:system-ui,-apple-system,'Segoe UI',Roboto,Arial;
      background:radial-gradient(circle at top,#e0f2fe,#f9fafb);
      color:var(--text);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:16px;
    }
    .shell{
      width:100%;
      max-width:800px;
      background:#f9fafb;
      border-radius:var(--shell-radius);
      box-shadow:var(--shadow);
      border:1px solid #dbeafe;
      padding:16px 16px 14px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .shell-header{
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    .shell-header-left{
      display:flex;
      gap:10px;
      align-items:center;
    }
    .logo{
      width:52px;
      height:52px;
      border-radius:50%;
      object-fit:cover;
      box-shadow:0 6px 16px rgba(15,23,42,.3);
    }
    .title-block{
      display:flex;
      flex-direction:column;
      gap:3px;
    }
    .title{
      font-size:17px;
      font-weight:700;
    }
    .subtitle{
      font-size:12px;
      color:var(--muted);
    }
    .badge{
      font-size:11px;
      padding:4px 8px;
      border-radius:999px;
      background:#eff6ff;
      border:1px dashed #bfdbfe;
      color:#1d4ed8;
      white-space:nowrap;
    }
    .columns{
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    @media(min-width:720px){
      .columns{
        flex-direction:row;
      }
    }
    .col{
      flex:1;
      background:white;
      border-radius:18px;
      border:1px solid #e5e7eb;
      padding:10px;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .col-title{
      font-size:13px;
      font-weight:600;
    }
    .col-text{
      font-size:11px;
      color:var(--muted);
    }
    .form{
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .label{
      display:flex;
      flex-direction:column;
      gap:2px;
      font-size:11px;
      color:#4b5563;
    }
    .label span{
      font-weight:500;
    }
    .label input{
      padding:7px 8px;
      border-radius:10px;
      border:1px solid #d4d4d8;
      font-size:12px;
      outline:none;
    }
    .label input:focus{
      border-color:var(--brand);
      box-shadow:0 0 0 1px var(--brand);
    }
    .btn-primary,
    .btn-secondary{
      border:none;
      border-radius:999px;
      padding:8px 10px;
      font-size:12px;
      font-weight:600;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:6px;
      margin-top:6px;
    }
    .btn-primary{
      background:linear-gradient(135deg,#0ea5e9,#38bdf8);
      color:white;
      box-shadow:0 8px 18px rgba(56,189,248,.55);
    }
    .btn-secondary{
      background:#ffffff;
      color:#374151;
      border:1px solid #d1d5db;
    }
    .creds-box{
      margin-top:6px;
      padding:8px;
      border-radius:12px;
      background:#eff6ff;
      border:1px solid #bfdbfe;
      font-size:11px;
      color:#1f2937;
      display:none;
    }
    .creds-title{
      font-weight:600;
      margin-bottom:3px;
    }
    .creds-row{
      display:flex;
      gap:4px;
      align-items:center;
      margin-bottom:2px;
    }
    .creds-row code{
      background:white;
      padding:1px 5px;
      border-radius:999px;
      border:1px solid #dbeafe;
      font-family:monospace;
    }
    .creds-note{
      font-size:10px;
      color:#4b5563;
      margin-top:4px;
    }
    .footer-text{
      font-size:10px;
      color:#9ca3af;
      text-align:right;
    }
  </style>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore-compat.js"></script>

  <!-- Sizning config'ingiz -->
  <script src="firebase-config.js"></script>

  <!-- Umumiy auth tizim -->
  <script src="auth-lite.js"></script>
</head>
<body>

<div class="shell">
  <div class="shell-header">
    <div class="shell-header-left">
      <img src="logo.png" alt="1-IMI" class="logo">
      <div class="title-block">
        <div class="title">Namangan shahar 1-IMI</div>
        <div class="subtitle">Portalga kirish — ID + Parol tizimi</div>
      </div>
    </div>
    <div class="badge">
      <i class="fa-solid fa-lock"></i>
      Himoyalangan kirish
    </div>
  </div>

  <div class="columns">
    <!-- Login -->
    <div class="col">
      <div class="col-title">ID + Parol orqali kirish</div>
      <div class="col-text">
        Sizga berilgan 6 xonali ID va 8 belgili parolni kiriting.
      </div>
      <form id="login-form" class="form">
        <label class="label">
          <span>ID (6 xonali)</span>
          <input id="login-id" type="text" maxlength="6" inputmode="numeric" required>
        </label>
        <label class="label">
          <span>Parol</span>
          <input id="login-password" type="password" minlength="6" required>
        </label>
        <button type="submit" class="btn-primary">
          <i class="fa-solid fa-right-to-bracket"></i>
          Kirish
        </button>
      </form>
      <button id="btn-logout" type="button" class="btn-secondary" style="display:none;">
        <i class="fa-solid fa-arrow-right-from-bracket"></i>
        Chiqish
      </button>
    </div>

    <!-- Ro'yxatdan o'tish -->
    <div class="col">
      <div class="col-title">Yangi foydalanuvchi (bir bosishda)</div>
      <div class="col-text">
        Tizim sizga avtomatik 6 xonali ID va 8 belgili parol beradi. Ularni yozib oling!
      </div>
      <button id="btn-auto-register" type="button" class="btn-primary">
        <i class="fa-solid fa-user-plus"></i>
        Yangi ID + Parol berish
      </button>
      <div id="creds-box" class="creds-box">
        <div class="creds-title">Sizning ID va parolingiz:</div>
        <div class="creds-row">
          <span>ID:</span>
          <code id="creds-id"></code>
        </div>
        <div class="creds-row">
          <span>Parol:</span>
          <code id="creds-pass"></code>
        </div>
        <div class="creds-note">
          Iltimos, ID va parolni yozib oling yoki skrinshot qilib saqlang. Ular orqali keyin portalga kirasiz.
        </div>
      </div>
    </div>
  </div>

  <div class="footer-text">
    Agar ID yoki parolni yo'qotib qo'ysangiz, dekanat yoki IT bo'limga murojaat qiling.
  </div>
</div>

<script>
  function getRedirectUrl(){
    const params = new URLSearchParams(location.search);
    const r = params.get('redirect');
    return r ? decodeURIComponent(r) : 'index.html';
  }

  const loginForm   = document.getElementById('login-form');
  const loginIdEl   = document.getElementById('login-id');
  const loginPassEl = document.getElementById('login-password');
  const btnReg      = document.getElementById('btn-auto-register');
  const credsBox    = document.getElementById('creds-box');
  const credsId     = document.getElementById('creds-id');
  const credsPass   = document.getElementById('creds-pass');
  const btnLogout   = document.getElementById('btn-logout');

  authLite.onUserChange(user=>{
    if (user){
      // allaqachon kirgan bo'lsa logout tugmasini ko'rsatamiz
      if (btnLogout) btnLogout.style.display = 'flex';
    }else{
      if (btnLogout) btnLogout.style.display = 'none';
    }
  });

  if (loginForm){
    loginForm.addEventListener('submit', async (e)=>{
      e.preventDefault();
      try{
        await authLite.loginWithIdPassword(loginIdEl.value, loginPassEl.value);
        // muvaffaqiyatli kirganda redirect
        location.href = getRedirectUrl();
      }catch(err){
        alert(err.message || 'Kirishda xatolik');
        console.error(err);
      }
    });
  }

  if (btnReg){
    btnReg.addEventListener('click', async ()=>{
      try{
        const { loginId, password } = await authLite.registerAuto();
        if (credsBox){
          credsBox.style.display = 'block';
          credsId.textContent   = loginId;
          credsPass.textContent = password;
        }
        // auto login bo'ldi, darhol redirect qilamiz
        setTimeout(()=>{
          location.href = getRedirectUrl();
        }, 800);
      }catch(err){
        alert('Ro‘yxatdan o‘tishda xatolik: ' + (err.message || err));
        console.error(err);
      }
    });
  }

  if (btnLogout){
    btnLogout.addEventListener('click', async ()=>{
      await authLite.logout();
      alert('Hisobdan chiqdingiz.');
    });
  }
</script>

</body>
</html>
