<!doctype html>
<html lang="uz">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MathCenter.uz — Xush kelibsiz</title>
  <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
  <style>
    :root{
      --green:#0faf64; --edge:#e0f3eb; --bg:#f6fffb;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:var(--bg);color:#0c2b1b}
    header{position:sticky;top:0;z-index:10;padding:10px 16px;background:#ffffffd9;border-bottom:1px solid #eaf7f1;backdrop-filter:saturate(150%) blur(6px);}
    .header-inner{max-width:1200px;margin:0 auto;display:grid;gap:12px;align-items:center;}
    @media(min-width:900px){ .header-inner{ grid-template-columns: 1fr auto; } }
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:48px;height:48px;border-radius:14px;background:radial-gradient(60% 60% at 50% 35%, #b9ffd9, #2de38d 55%, #0ea55a 100%);display:grid;place-items:center;box-shadow:0 0 36px rgba(14,175,100,.35), inset 0 0 20px rgba(255,255,255,.7)}
    .logo svg{width:28px;height:28px;fill:#fff}
    .brand-title{padding:8px 12px;border-radius:14px;background:linear-gradient(145deg,#f7fffb,#eafff5);box-shadow:0 10px 18px #b0f5d633,inset 0 -3px 8px rgba(255,255,255,.8)}
    .brand-title h1{margin:0;font-size:20px;background:linear-gradient(180deg,#0dbb6f,#0a8f52);-webkit-background-clip:text;color:transparent;font-weight:900;letter-spacing:.3px}
    .stats{display:grid; grid-auto-flow:column; gap:10px;}
    .card{background:linear-gradient(180deg, rgba(255,255,255,.68), rgba(255,255,255,.54));backdrop-filter:saturate(160%) blur(6px);-webkit-backdrop-filter:saturate(160%) blur(6px);border:1px solid var(--edge);border-radius:14px;padding:10px 12px;box-shadow:0 16px 32px rgba(10,143,82,.14), 0 2px 6px rgba(0,0,0,.05);display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;min-height:52px;min-width:90px}
    .card .label{font-size:12px;opacity:.7}
    .card .value{font-size:14px;font-weight:800}
    @media(max-width:899px){ .header-inner{ grid-template-columns:1fr; } }
    .stats-compact{display:none}
    @media(max-width:540px){ .stats{display:none} .stats-compact{display:block} }
    main{max-width:1200px;margin:16px auto 96px;padding:0 16px}
    .content{background:#fff;border:1px solid var(--edge);border-radius:16px;padding:16px;box-shadow:0 4px 12px rgba(0,0,0,.06)}
    /* FAB + chips */
    .fab{position:fixed;right:16px;bottom:16px;z-index:50}
    .fab-btn{width:56px;height:56px;border-radius:20px;background:var(--green);color:#fff;border:none;font-size:24px;font-weight:900;box-shadow:0 10px 24px rgba(0,0,0,.2)}
    .fab-menu{display:none;position:absolute;right:0;bottom:70px;flex-direction:column;gap:8px}
    .fab.open .fab-menu{display:flex}
    .chip{background:#fff;border:1px solid var(--edge);padding:10px 14px;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,.08);font-weight:800;transition:transform .18s ease, box-shadow .18s ease, background-color .18s ease, color .18s ease}
    .chip:hover{transform:scale(1.05); box-shadow:0 6px 16px rgba(0,0,0,.14)}
    .chip.active{background:var(--green);color:#fff;border-color:var(--green);box-shadow:0 8px 22px rgba(15,175,100,.35)}
  
    /* FAB spring animation */
    @keyframes chipPop {
      0% { transform: scale(0.86) translateY(8px); opacity: 0; }
      60%{ transform: scale(1.06) translateY(0);   opacity: 1; }
      100%{transform: scale(1); }
    }
    .fab.open .fab-menu .chip { animation: chipPop .22s cubic-bezier(.2,.7,.3,1) both; }
    .fab.open .fab-menu .chip:nth-child(1){ animation-delay: .00s; }
    .fab.open .fab-menu .chip:nth-child(2){ animation-delay: .02s; }
    .fab.open .fab-menu .chip:nth-child(3){ animation-delay: .04s; }
    .fab.open .fab-menu .chip:nth-child(4){ animation-delay: .06s; }
    .fab.open .fab-menu .chip:nth-child(5){ animation-delay: .08s; }

  
    /* Reverse FAB closing animation */
    @keyframes chipPopOut {
      0% { transform: scale(1); opacity: 1; }
      100%{ transform: scale(0.86) translateY(8px); opacity: 0; }
    }
    .fab.closing .fab-menu .chip { animation: chipPopOut .18s cubic-bezier(.2,.7,.3,1) both; }

  </style>
</head>
<body>
  <header>
    <div class="header-inner">
      <div class="brand">
        <div class="logo" aria-hidden="true">
          <svg viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg"><path d="M76 92h104c9 0 16-7 16-16s-7-16-16-16H60c-9 0-16 7-16 16s7 16 16 16h4c8 41 4 77-8 97-5 8 5 17 13 12 24-14 35-53 29-109zm57 0c7 39 3 74-8 94-5 9 6 18 14 12 24-16 35-56 28-106h-34z"/></svg>
        </div>
        <div class="brand-title"><h1>MathCenter.uz</h1></div>
      </div>
      <div class="stats" id="headerStats">
        <div class="card"><div class="label">Salom</div><div class="value" id="helloName">—</div><div class="label" id="helloAge">Yosh: —</div></div>
        <div class="card"><div class="label">ID</div><div class="value" id="headerID">—</div></div>
        <div class="card"><div class="label">Balans</div><div class="value" id="headerBalans">0</div></div>
        <div class="card"><div class="label">Ball</div><div class="value" id="headerBall">0</div></div>
      </div>
      <div class="stats-compact" id="headerCompact"></div>
    </div>
  </header>

  <main>
    <div id="app"><div class="content"><h2>Testlar</h2><p>Namuna test roʻyxati bu yerda boʻladi.</p></div></div>
  </main>

  <div class="fab" id="fab">
    <button class="fab-btn" id="fabBtn">≡</button>
    <div class="fab-menu" id="fabMenu">
      <button class="chip" data-route="home">Bosh sahifa</button>
      <button class="chip" data-route="tests">Testlar</button>
      <button class="chip" data-route="live">Live</button>
      <button class="chip" data-route="profile">Profil</button>
      <button class="chip" data-route="settings">Sozlamalar</button>
    </div>
  </div>

<script>
const routes=["home","tests","live","profile","settings"];

// FAB close helper
function closeFab(){
  if (fab.classList.contains('open')){
    fab.classList.add('closing');
    setTimeout(()=>{ fab.classList.remove('open'); fab.classList.remove('closing'); }, 180);
  }
}
const fab=document.getElementById('fab');
const fabBtn=document.getElementById('fabBtn');
const fabMenu=document.getElementById('fabMenu');
fabBtn.onclick=(e)=>{
  e.stopPropagation();
  if (fab.classList.contains('open')) {
    // play reverse and close after animation
    fab.classList.add('closing');
    setTimeout(()=>{ fab.classList.remove('open'); fab.classList.remove('closing'); }, 200);
  } else {
    fab.classList.add('open');
  }
};
fabMenu.addEventListener('click',(e)=>{
  const btn=e.target.closest('.chip'); if(!btn) return;
  const r=btn.getAttribute('data-route'); if(!r) return;
  loadRoute(r); closeFab();
});

function animateCount(el, target, duration=600){
  if(!el) return;
  target = Number(target)||0;
  const start = Number(el.textContent.replace(/\D/g,'')) || 0;
  const startTime = performance.now();
  const fmt = (v)=> v.toLocaleString('uz-UZ');
  function step(t){
    const p = Math.min(1, (t - startTime)/duration);
    const val = Math.round(start + (target - start) * p);
    el.textContent = fmt(val);
    if (p < 1) requestAnimationFrame(step);
  }
  requestAnimationFrame(step);
}

function setActive(route){
  document.querySelectorAll('.fab-menu .chip').forEach(b=>{
    b.classList.toggle('active', b.getAttribute('data-route')===route);
  });
}
async function loadRoute(route){
  const app=document.getElementById('app');
  try{
    const res=await fetch('partials/'+route+'.html?v='+Date.now());
    if(!res.ok) throw 0;
    app.innerHTML=await res.text();
  }catch(_){
    app.innerHTML='<div class="content"><h2>'+route+'</h2><p>Namuna sahifa.</p></div>';
  }
  setActive(route);
  history.replaceState({},'', '#'+route);
  window.scrollTo({top:0,behavior:'smooth'});
}
window.addEventListener('hashchange',()=>{
  const r=location.hash.replace('#','');
  if(routes.includes(r)) loadRoute(r);
});

// Close on outside click / ESC
document.addEventListener('click', (e)=>{
  if (fab.classList.contains('open') && !fab.contains(e.target)) closeFab();
});
document.addEventListener('keydown', (e)=>{
  if (e.key === 'Escape') closeFab();
});

document.addEventListener('DOMContentLoaded',()=>{
  const start=location.hash.replace('#','')||'tests';
  setActive(start); loadRoute(start);
  updateHeader({});
});
function updateHeader(userDoc){
  const name=userDoc?.ism||'Sohibjon';
  const age=userDoc?.yosh||'26';
  const id=userDoc?.numericId||'1002';
  const balans=userDoc?.balans??0;
  const ball=userDoc?.ball??0;
  document.getElementById('helloName').textContent=name;
  document.getElementById('helloAge').textContent='Yosh: '+age;
  animateCount(document.getElementById('headerID'), id);
  animateCount(document.getElementById('headerBalans'), balans);
  animateCount(document.getElementById('headerBall'), ball);
  const c=document.getElementById('headerCompact');
  c.innerHTML = '<div class="card"><div style="width:100%>'+
  '<div style="display:flex;justify-content:space-between;align-items:center;gap:8px;margin-bottom:6px;">'+
    '<div style="font-weight:800">Salom <span style="font-weight:900">'+name+'</span></div>'+
    '<div class="label">Yosh: '+age+'</div>'+
  '</div>'+
  '<div style="display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:8px;text-align:center;">'+
    '<div>'+
      '<div class="label" style="display:flex;gap:6px;justify-content:center;align-items:center">'+
        '<svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3" y="5" width="18" height="14" rx="2" stroke="#0a8f52" stroke-width="2"/><rect x="6" y="8" width="6" height="2" fill="#0a8f52"/><rect x="6" y="11" width="4" height="2" fill="#0a8f52"/></svg> ID</div>'+
      '<div class="value">'+id+'</div>'+
    '</div>'+
    '<div>'+
      '<div class="label" style="display:flex;gap:6px;justify-content:center;align-items:center">'+
        '<svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 7a2 2 0 0 1 2-2h14a1 1 0 0 1 1 1v4H3V7Z" fill="#0a8f52"/><rect x="3" y="8" width="18" height="11" rx="2" stroke="#0a8f52" stroke-width="2"/></svg> Balans</div>'+
      '<div class="value">'+balans+'</div>'+
    '</div>'+
    '<div>'+
      '<div class="label" style="display:flex;gap:6px;justify-content:center;align-items:center">'+
        '<svg width="12" height="12" viewBox="0 0 24 24" fill="#0a8f52" xmlns="http://www.w3.org/2000/svg"><path d="m12 2 2.9 6.2 6.8.6-5.1 4.5 1.6 6.6L12 16.9 5.8 20l1.6-6.6L2.3 8.8l6.8-.6L12 2Z"/></svg> Ball</div>'+
      '<div class="value">'+ball+'</div>'+
    '</div>'+
  '</div></div></div>'; animateCount(document.getElementById('cid'), id); animateCount(document.getElementById('cbal'), balans); animateCount(document.getElementById('cball'), ball);
}
</script>
</body>
</html>
