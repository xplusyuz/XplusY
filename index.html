<!doctype html>
<html lang="uz">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LeaderMath — Mobil</title>
<meta name="theme-color" content="#2E8B57"/>
<link rel="manifest" href="./manifest.webmanifest"/>
<link rel="icon" href="./favicon.ico"/>
<style>
:root{
 --brand:#2E8B57;--brand2:#1F6B45;
 --bg:#f4f8f6;--card:#fff;--text:#0d1b14;--muted:#324e41;
 --frame:#d8e7dd;--chip:#e9f5ef;--chip-b:#b9dfc9;
}
:root.dark{
 --bg:#0e1512;--card:#142018;--text:#EAF7EE;--muted:#A5C7B4;
 --frame:#204030;--chip:#183323;--chip-b:#25573b;
}
body{margin:0;font-family:Inter,system-ui;background:var(--bg);color:var(--text)}
.appbar{background:linear-gradient(135deg,var(--brand),var(--brand2));color:#fff;padding:10px 14px;display:flex;align-items:center;gap:10px}
.logo{width:40px;height:40px;border-radius:12px;background:#fff2;display:grid;place-items:center;font-weight:800}
.title{font-size:18px;font-weight:800}
.iconbtn{margin-left:auto;border:none;background:#ffffff33;color:#fff;border-radius:10px;padding:6px 10px;cursor:pointer}
.card{background:var(--card);border:1px solid var(--frame);border-radius:14px;padding:14px;margin:10px;box-shadow:0 4px 10px rgba(0,0,0,.05)}
.banner{margin:12px;border-radius:16px;overflow:hidden;background:linear-gradient(135deg,#f6fff9,#eaf5ee);box-shadow:0 6px 14px rgba(0,0,0,.08)}
.dark .banner{background:linear-gradient(135deg,#16261c,#0e1a15)}
.rank{display:grid;grid-template-columns:40px 1fr auto;gap:8px;align-items:center;padding:10px;border-radius:12px;border:1px solid var(--frame);margin:6px;background:var(--card);box-shadow:0 2px 6px rgba(0,0,0,.04)}
.rank:hover{transform:scale(1.02);box-shadow:0 6px 16px rgba(46,139,87,.25)}
.btn{display:inline-block;padding:10px 16px;border-radius:10px;font-weight:700;text-decoration:none;text-align:center}
.btn.main{background:linear-gradient(135deg,var(--brand),var(--brand2));color:#fff}
.btn.ghost{border:1px solid var(--frame);background:var(--chip);color:var(--text)}
</style>
</head>
<body>
<header class="appbar"><div class="logo">L</div><div class="title">LeaderMath</div>
<button id="themeBtn" class="iconbtn">🌙</button></header>
<div id="bannerWrap"></div>
<div id="cardWrap"></div>
<section class="card"><h3>Top 50 — Ball bo‘yicha</h3><div id="boardList"></div></section>
<script type="module">
import {auth,db,onAuthStateChanged} from './lib/firebase.client.js';
import {collection,query,orderBy,limit,onSnapshot} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
// theme
const root=document.documentElement,btn=document.getElementById('themeBtn');const key='lm-theme';
function setTheme(m){root.classList.toggle('dark',m==='dark');localStorage.setItem(key,m);btn.textContent=m==='dark'?'☀️':'🌙';}
setTheme(localStorage.getItem(key)||(matchMedia('(prefers-color-scheme: dark)').matches?'dark':'light'));
btn.onclick=()=>setTheme(root.classList.contains('dark')?'light':'dark');
// load banners/cards
fetch('./index.json').then(r=>r.json()).then(data=>{
 const banners=data.banners||[],sections=data.sections||[];
 document.getElementById('bannerWrap').innerHTML=banners.map(b=>`<div class='banner'>${b.html}</div>`).join('');
 document.getElementById('cardWrap').innerHTML=sections.flatMap(s=>s.items).map(it=>`
   <div class='card'>
     <h3>${it.name}</h3>
     <p>${it.description||''}</p>
     <a class='btn main' href='${it.link}'>Boshlash</a>
   </div>`).join('');
});
// leaderboard
onSnapshot(query(collection(db,'users'),orderBy('points','desc'),limit(50)),snap=>{
 const arr=snap.docs.map(d=>d.data());
 document.getElementById('boardList').innerHTML=arr.map((u,i)=>`
 <div class='rank'><div>${i+1}</div><div><b>${u.name||'Foydalanuvchi'}</b><div class='muted'>${u.school||''}</div></div><div>${u.points||0}</div></div>`).join('');
});
</script>
</body>
</html>