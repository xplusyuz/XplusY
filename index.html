<!doctype html>
<html lang="uz">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>XplusY — Bosh sahifa</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <script src="assets/include.js"></script>
  <style>
    :root {
      --primary:#19b36b;
      --text:#0b1f17;
      --granite:#f3faf6;
    }
    body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color:var(--text); background: var(--granite); }
    .container { max-width: 1100px; margin: 0 auto; padding: 16px; }
    /* Hero */
    .hero { border-radius: 24px; padding: 48px 24px; position: relative; overflow: hidden; box-shadow: 0 24px 48px rgba(0,0,0,.06); }
    .hero h1 { font-size: clamp(28px, 5vw, 48px); margin: 0 0 8px; letter-spacing:-.5px; }
    .hero p { font-size: 18px; opacity:.85; margin:0 0 18px; }
    .btn { display:inline-block; padding: 12px 18px; border-radius: 14px; text-decoration:none; background:#fff; border:1px solid rgba(0,0,0,.08); }
    .btn.primary { background: var(--primary); color:#fff; border:none; }
    .chips { display:flex; gap:10px; flex-wrap:wrap; margin-top:8px; }
    .chip { padding:6px 10px; border-radius:999px; background:#fff; border:1px solid rgba(0,0,0,.06); font-size:14px; }
    /* Carousel */
    .carousel { margin-top: 24px; position:relative; }
    .slides { display:grid; grid-auto-flow: column; grid-auto-columns: 100%; overflow:hidden; border-radius: 18px; }
    .slide { position:relative; min-height: 280px; display:grid; align-items:end; color:#fff; }
    .slide img { position:absolute; inset:0; width:100%; height:100%; object-fit:cover; filter: saturate(1.1) contrast(1.05); }
    .slide::after { content:""; position:absolute; inset:0; background: linear-gradient(180deg, rgba(0,0,0,0) 20%, rgba(0,0,0,.55) 100%); }
    .slide .caption { position:relative; padding:18px; z-index:2; }
    .badge { position:absolute; top:14px; left:14px; padding:6px 10px; border-radius:999px; backdrop-filter: blur(6px); background: rgba(255,255,255,.2); border:1px solid rgba(255,255,255,.4); font-weight:700; }
    .dots { display:flex; gap:6px; justify-content:center; margin-top:10px; }
    .dot { width:10px; height:10px; border-radius:999px; background:#cfeede; opacity:.7; }
    .dot.active { opacity:1; background: var(--primary); }
    /* Promo grid */
    .grid { display:grid; grid-template-columns: repeat(4,1fr); gap:14px; margin-top:28px; }
    .card { background:#fff; border:1px solid rgba(0,0,0,.06); border-radius:16px; padding:16px; box-shadow: 0 12px 28px rgba(0,0,0,.06); }
    .card h4{ margin:6px 0 6px; }
    @media (max-width: 980px) { .grid{ grid-template-columns: repeat(2,1fr);} }
    @media (max-width: 640px) { .grid{ grid-template-columns: 1fr;} }
    /* Feature blocks */
    .features { display:grid; grid-template-columns: repeat(3,1fr); gap:14px; margin-top:28px; }
    .feature { background:linear-gradient(180deg,#ffffff,#f7fffb); border:1px solid rgba(0,0,0,.05); border-radius:16px; padding:18px; }
    @media (max-width: 980px) { .features{ grid-template-columns: 1fr; } }
    /* Testimonials */
    .testi { display:grid; grid-template-columns: repeat(3,1fr); gap:14px; margin-top:28px; }
    .quote { background:#fff; border-radius:16px; padding:16px; border:1px solid rgba(0,0,0,.06); box-shadow: 0 12px 28px rgba(0,0,0,.06); }
    @media (max-width: 980px) { .testi{ grid-template-columns: 1fr; } }
    /* Partners */
    .partners { display:flex; gap:18px; flex-wrap:wrap; align-items:center; justify-content:center; margin:28px 0; }
    .partners img { height:36px; opacity:.85; filter: grayscale(1); }
    /* Video */
    .video-wrap { margin-top:28px; border-radius:16px; overflow:hidden; box-shadow: 0 12px 28px rgba(0,0,0,.06); }
    .video-wrap iframe { width:100%; aspect-ratio:16/9; border:0; }
  </style>
</head>
<body>
  <div data-include="header.html"></div>
  <main class="container">
    <section class="hero" id="hero" style="background: linear-gradient(135deg,#e9fff3,#c9f7e2)">
      <h1 id="heroTitle">Matematika uchun premium platforma</h1>
      <p id="heroSub">Kurslar • Testlar • Simulyatorlar — barchasi bitta joyda</p>
      <div class="chips">
        <a class="btn primary" id="ctaPrimary" href="#">Boshlash</a>
        <a class="btn" id="ctaSecondary" href="#">Kurslarni ko‘rish</a>
      </div>
    </section>

    <section class="carousel" id="carousel">
      <div class="slides" id="slides"></div>
      <div class="dots" id="dots"></div>
    </section>

    <section class="grid" id="promoGrid"></section>
    <section class="features" id="features"></section>
    <section class="testi" id="testi"></section>
    <section class="partners" id="partners"></section>
    <section class="video-wrap" id="videoWrap" style="display:none"></section>
  </main>
  <div data-include="footer.html"></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  const firebaseConfig = {"apiKey": "AIzaSyDYwHJou_9GqHZcf8XxtTByC51Z8un8rrM", "authDomain": "xplusy-760fa.firebaseapp.com", "projectId": "xplusy-760fa", "storageBucket": "xplusy-760fa.firebasestorage.app", "messagingSenderId": "992512966017", "appId": "1:992512966017:web:5e919dbc9b8d8abcb43c80", "measurementId": "G-459PLJ7P7L"};
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  async function loadIndexConfig(){
    // Try Firestore meta/index_page. Fallback to local indexadmin.json
    try {
      const snap = await getDoc(doc(db, "meta", "index_page"));
      if (snap.exists()) return snap.data();
    } catch(e){ console.warn("No Firestore index_page", e); }
    try {
      const r = await fetch("indexadmin.json", {cache:"no-store"});
      if (r.ok) return await r.json();
    } catch(e){}
    return null;
  }

  function el(tag, opts={}){
    const n = document.createElement(tag);
    if (opts.class) n.className = opts.class;
    if (opts.text) n.textContent = opts.text;
    if (opts.html) n.innerHTML = opts.html;
    if (opts.attrs) Object.entries(opts.attrs).forEach(([k,v]) => n.setAttribute(k,v));
    return n;
  }

  function buildCarousel(banners){
    const slides = document.getElementById("slides");
    const dots = document.getElementById("dots");
    slides.innerHTML = ""; dots.innerHTML = "";
    (banners||[]).forEach((b,i)=>{
      const s = el("div", {class:"slide"});
      const img = el("img", {attrs:{src: b.img || "https://picsum.photos/1200/600?blur=2"}});
      s.appendChild(img);
      if (b.tag) s.appendChild(el("div",{class:"badge", text:b.tag}));
      const cap = el("div",{class:"caption"});
      cap.appendChild(el("div",{html:`<strong style="font-size:20px">${b.title||""}</strong>`}));
      cap.appendChild(el("div",{html:`<small style="opacity:.85">${b.subtitle||""}</small>`}));
      if (b.href) {
        const link = el("a",{class:"btn", text:"Ko‘rish", attrs:{href:b.href}});
        link.style.marginTop = "8px";
        cap.appendChild(link);
      }
      s.appendChild(cap);
      slides.appendChild(s);
      const d = el("div",{class:"dot"}); if (i===0) d.classList.add("active"); dots.appendChild(d);
    });
    // Auto-rotate
    let idx = 0;
    setInterval(()=>{
      const count = (banners||[]).length;
      if (!count) return;
      idx = (idx+1)%count;
      slides.scrollTo({left: idx*slides.clientWidth, behavior:"smooth"});
      Array.from(dots.children).forEach((d,i)=> d.classList.toggle("active", i===idx));
    }, 4000);
    // Resize sync
    window.addEventListener("resize", ()=>{
      const left = idx * document.getElementById("slides").clientWidth;
      document.getElementById("slides").scrollTo({left, behavior:"instant"});
    });
  }

  function renderPromo(promo){
    const wrap = document.getElementById("promoGrid");
    wrap.innerHTML = "";
    (promo||[]).forEach(p=>{
      const c = el("div",{class:"card"});
      c.innerHTML = `<div style="font-weight:700">${p.title||""}</div><div style="opacity:.8">${p.desc||""}</div>`;
      wrap.appendChild(c);
    });
  }

  function renderFeatures(list){
    const wrap = document.getElementById("features"); wrap.innerHTML="";
    (list||[]).forEach(f=>{
      const c = el("div",{class:"feature"});
      c.innerHTML = `<h3 style="margin:6px 0">${f.title||""}</h3><p style="opacity:.85">${f.desc||""}</p>`;
      wrap.appendChild(c);
    });
  }

  function renderTesti(list){
    const wrap = document.getElementById("testi"); wrap.innerHTML="";
    (list||[]).forEach(t=>{
      const c = el("div",{class:"quote"});
      c.innerHTML = `<div style="font-size:15px; opacity:.9">${t.text||""}</div><div style="margin-top:8px; font-weight:700">${t.name||""}</div>`;
      wrap.appendChild(c);
    });
  }

  function renderPartners(list){
    const wrap = document.getElementById("partners"); wrap.innerHTML="";
    (list||[]).forEach(p=>{
      const a = el("a",{attrs:{href:p.href||"#"}});
      const img = el("img",{attrs:{src:p.logo || "https://dummyimage.com/120x36/ddd/555.png&text=Logo"}});
      a.appendChild(img); wrap.appendChild(a);
    });
  }

  function renderVideo(v){
    const wrap = document.getElementById("videoWrap");
    if (!v?.youtubeId){ wrap.style.display="none"; wrap.innerHTML=""; return; }
    wrap.style.display = "block";
    wrap.innerHTML = `<iframe src="https://www.youtube.com/embed/${v.youtubeId}" allowfullscreen></iframe>`;
  }

  loadIndexConfig().then(cfg => {
    if (!cfg) return;
    document.documentElement.style.setProperty("--primary", cfg.theme?.primary || "#19b36b");
    document.documentElement.style.setProperty("--granite", cfg.theme?.graniteBg || "#f3faf6");
    document.documentElement.style.setProperty("--text", cfg.theme?.text || "#0b1f17");

    const hero = document.getElementById("hero");
    hero.style.background = cfg.hero?.bg || hero.style.background;
    document.getElementById("heroTitle").textContent = cfg.hero?.title || "";
    document.getElementById("heroSub").textContent = cfg.hero?.subtitle || "";
    const c1 = document.getElementById("ctaPrimary");
    const c2 = document.getElementById("ctaSecondary");
    if (cfg.hero?.ctaPrimary){ c1.textContent = cfg.hero.ctaPrimary.label; c1.href = cfg.hero.ctaPrimary.href || "#"; }
    if (cfg.hero?.ctaSecondary){ c2.textContent = cfg.hero.ctaSecondary.label; c2.href = cfg.hero.ctaSecondary.href || "#"; }

    buildCarousel(cfg.banners||[]);
    renderPromo(cfg.promo||[]);
    renderFeatures(cfg.features||[]);
    renderTesti(cfg.testimonials||[]);
    renderPartners(cfg.partners||[]);
    renderVideo(cfg.video||null);
  });
</script>
</body>
</html>
