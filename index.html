<!doctype html>
<html lang="uz">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MathCenter.uz — Xush kelibsiz</title>
  <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
  <style>
    :root{ --green:#0faf64; --edge:#e0f3eb; --bg:#f6fffb; }
    *{box-sizing:border-box} body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:var(--bg)}
    header{position:sticky;top:0;z-index:10;padding:10px 16px;background:#ffffffd9;border-bottom:1px solid #eaf7f1;backdrop-filter:saturate(150%) blur(6px);}
    .header-inner{max-width:1200px;margin:0 auto;display:grid;gap:12px;align-items:center;}
    @media(min-width:900px){ .header-inner{ grid-template-columns: 1fr auto; } }
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:48px;height:48px;border-radius:14px;background:radial-gradient(60% 60% at 50% 35%, #b9ffd9, #2de38d 55%, #0ea55a 100%);display:grid;place-items:center;box-shadow:0 0 36px rgba(14,175,100,.35), inset 0 0 20px rgba(255,255,255,.7)}
    .logo svg{width:28px;height:28px;fill:#fff}
    .brand-title{padding:8px 12px;border-radius:14px;background:linear-gradient(145deg,#f7fffb,#eafff5);box-shadow:0 10px 18px #b0f5d633,inset 0 -3px 8px rgba(255,255,255,.8)}
    .brand-title h1{margin:0;font-size:20px;background:linear-gradient(180deg,#0dbb6f,#0a8f52);-webkit-background-clip:text;color:transparent;font-weight:900;letter-spacing:.3px}
    .stats{display:grid; grid-auto-flow:column; gap:10px;}
    .card{background:#fff;border:1px solid var(--edge);border-radius:14px;padding:10px 12px;box-shadow:0 12px 28px rgba(10,143,82,.12), 0 2px 6px rgba(0,0,0,.05);display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;min-height:52px;min-width:90px}
    .card .label{font-size:12px;opacity:.7} .card .value{font-size:14px;font-weight:800}
    @media(max-width:899px){ .header-inner{ grid-template-columns:1fr; } }
    .stats-compact{display:none} @media(max-width:540px){ .stats{display:none} .stats-compact{display:block} }
    main{max-width:1200px;margin:16px auto 96px;padding:0 16px}
    .content{background:#fff;border:1px solid var(--edge);border-radius:16px;padding:16px;box-shadow:0 4px 12px rgba(0,0,0,.06)}
    .fab{position:fixed;right:16px;bottom:16px;z-index:50}
    .fab-btn{width:56px;height:56px;border-radius:20px;background:var(--green);color:#fff;border:none;font-size:24px;font-weight:900;box-shadow:0 10px 24px rgba(0,0,0,.2)}
    .fab-menu{display:none;position:absolute;right:0;bottom:70px;flex-direction:column;gap:8px}
    .fab.open .fab-menu{display:flex}
    .chip{background:#fff;border:1px solid var(--edge);padding:10px 14px;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,.08);font-weight:800;transition:transform .18s ease, box-shadow .18s ease, background-color .18s ease, color .18s ease}
    .chip:hover{transform:scale(1.05); box-shadow:0 6px 16px rgba(0,0,0,.14)} .chip.active{background:#0faf64;color:#fff;border-color:#0faf64;box-shadow:0 8px 22px rgba(15,175,100,.35)}
  </style>
</head>
<body>
  <header>
    <div class="header-inner">
      <div class="brand">
  <div class="logo" aria-hidden="true">
    <img src="assets/favicon.svg" alt="Logo" />
  </div>
        <div class="brand-title"><h1>MathCenter.uz</h1></div>
      </div>
      <div class="stats" id="headerStats">
        <div class="card"><div class="label">Salom</div><div class="value" id="helloName">—</div><div class="label" id="helloAge">Yosh: —</div></div>
        <div class="card"><div class="label">ID</div><div class="value" id="headerID">—</div></div>
        <div class="card"><div class="label">Balans</div><div class="value" id="headerBalans">0</div></div>
        <div class="card"><div class="label">Ball</div><div class="value" id="headerBall">0</div></div>
      </div>
      <div class="stats-compact" id="headerCompact"></div>
    </div>
  </header>
  <main><div id="app"><div class="content"><h2>Bosh sahifa</h2><p>Xush kelibsiz!</p></div></div></main>
  <div class="fab" id="fab">
    <button class="fab-btn" id="fabBtn">≡</button>
    <div class="fab-menu" id="fabMenu">
      <button class="chip" data-route="home">Bosh sahifa</button>
      <button class="chip" data-route="courses">Kurslar</button>
      <button class="chip" data-route="tests">Testlar</button>
      <button class="chip" data-route="simulators">Simulyatorlar</button>
      <button class="chip" data-route="results">Natijalar</button>
      <button class="chip" data-route="profile">Profil</button>
    </div>
  </div>
<script>
const routes=["home","courses","tests","simulators","results","profile"];
const fab=document.getElementById('fab'); const fabBtn=document.getElementById('fabBtn'); const fabMenu=document.getElementById('fabMenu');
function closeFab(){ if(fab.classList.contains('open')){ fab.classList.add('closing'); setTimeout(()=>{ fab.classList.remove('open'); fab.classList.remove('closing');},180);}}
fabBtn.onclick=(e)=>{ e.stopPropagation(); if(fab.classList.contains('open')) closeFab(); else fab.classList.add('open'); };
fabMenu.addEventListener('click',(e)=>{ const btn=e.target.closest('.chip'); if(!btn) return; const r=btn.getAttribute('data-route'); if(!r) return; loadRoute(r); closeFab(); });
document.addEventListener('click',(e)=>{ if(fab.classList.contains('open') && !fab.contains(e.target)) closeFab(); });
document.addEventListener('keydown',(e)=>{ if(e.key==='Escape') closeFab(); });
function setActive(route){ document.querySelectorAll('.fab-menu .chip').forEach(b=>b.classList.toggle('active', b.getAttribute('data-route')===route)); }
async function loadRoute(route){
  const app=document.getElementById('app');
  try{ const res=await fetch('partials/'+route+'.html?v='+Date.now()); if(!res.ok) throw 0; app.innerHTML=await res.text(); }
  catch(_){ app.innerHTML='<div class="content"><h2>'+route+'</h2><p>Namuna sahifa.</p></div>'; }
  setActive(route); history.replaceState({},'', '#'+route); window.scrollTo({top:0,behavior:'smooth'});
}
window.addEventListener('hashchange',()=>{ const r=location.hash.replace('#',''); if(routes.includes(r)) loadRoute(r); });
document.addEventListener('DOMContentLoaded',()=>{ const start=location.hash.replace('#','')||'home'; setActive(start); loadRoute(start); updateHeader({}); });
function updateHeader(d){ const name=d?.ism||'Sohibjon', age=d?.yosh||'26', id=d?.numericId||'1002', balans=d?.balans??0, ball=d?.ball??0;
  document.getElementById('helloName').textContent=name; document.getElementById('helloAge').textContent='Yosh: '+age;
  document.getElementById('headerID').textContent=id; document.getElementById('headerBalans').textContent=balans; document.getElementById('headerBall').textContent=ball;
  const c=document.getElementById('headerCompact'); c.innerHTML='<div class="card"><div style="width:100%"><div style="display:flex;justify-content:space-between;align-items:center;gap:8px;margin-bottom:6px;"><div style="font-weight:800">Salom <span style="font-weight:900">'+name+'</span></div><div class="label">Yosh: '+age+'</div></div><div style="display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:8px;text-align:center;"><div><div class="label">ID</div><div class="value">'+id+'</div></div><div><div class="label">Balans</div><div class="value">'+balans+'</div></div><div><div class="label">Ball</div><div class="value">'+ball+'</div></div></div></div></div>';
}
</script>

<style id="iframe-spa-style">
  #app iframe#appframe{width:100%;border:0;display:block;min-height:60vh}
</style>
<script>
/* iframe-SPA: dizayn o'zgartirmasdan linked sahifalarni #app ichida ko'rsatadi */
(function(){
  const app = document.getElementById("app");
  if(!app) return;

  // Create iframe on demand so we don't disturb existing layout
  let frame = null;
  function ensureFrame(){
    if(frame) return frame;
    frame = document.createElement("iframe");
    frame.id = "appframe";
    // start hidden; will show after load
    frame.style.visibility = "hidden";
    app.innerHTML = ""; // #app ichini SPA zona sifatida ishlatamiz
    app.appendChild(frame);
    frame.addEventListener("load", ()=>{
      try{
        const d = frame.contentDocument;
        // autosize
        frame.style.height = (d.documentElement.scrollHeight || d.body.scrollHeight || 800) + "px";
      }catch(e){/* ignore */}
      frame.style.visibility = "visible";
      window.scrollTo({top:0, behavior:"smooth"});
    });
    return frame;
  }

  // Route -> file mapping (partials yoki bog'langan .html)
  const DEFAULTS = {
    "home": "partials/home.html",
    "courses": "partials/courses.html",
    "tests": "partials/tests.html",
    "simulators": "partials/simulators.html",
    "results": "partials/results.html",
    "profile": "partials/profile.html"
  };

  function normalizeTarget(href){
    if(!href || href==="#" ) return null;
    // hash route (#home) -> map to partial
    if(href.startsWith("#")){
      const r = href.slice(1);
      return DEFAULTS[r] || null;
    }
    // direct html link -> use as-is
    if(/\.html(\?.*)?(#.*)?$/i.test(href)) return href;
    return null;
  }

  function navigateTo(target){
    const f = ensureFrame();
    if(!target) return;
    // For file:// relative paths, keep them relative
    f.src = target;
    history.replaceState({target}, "", target.startsWith("#") ? target : ("#"+target.replace(/^partials\//,"").replace(/\.html.*$/,"")));
  }

  // Intercept FAB/data-route buttons if present
  document.addEventListener("click", (e)=>{
    const btn = e.target.closest(".chip[data-route]");
    if(btn){
      e.preventDefault();
      const route = btn.getAttribute("data-route");
      navigateTo(DEFAULTS[route] || null);
      setActive(route);
      return;
    }
    // Intercept internal <a href="*.html">
    const a = e.target.closest("a[href]");
    if(a){
      const t = normalizeTarget(a.getAttribute("href"));
      if(t){
        e.preventDefault();
        navigateTo(t);
      }
    }
  });

  function setActive(route){
    document.querySelectorAll('.fab-menu .chip')
      .forEach(b=> b.classList.toggle('active', b.getAttribute('data-route')===route));
  }

  // On load: try hash or default home
  document.addEventListener("DOMContentLoaded", ()=>{
    let initial = "home";
    if(location.hash){
      const raw = location.hash.slice(1);
      if(DEFAULTS[raw]) initial = raw;
      else if(/\.html/i.test(raw)) initial = raw; // support #partials/home.html
    }
    navigateTo(DEFAULTS[initial]);
    setActive(initial);
  });
})();
</script>
</body></html>