<!doctype html>
<html lang="uz">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>MathCenter.uz — Xush kelibsiz</title>
  <style>
    :root{
      --mc-green-3:#40e19a;
      --mc-green-4:#14ba6e;
      --mc-white:#ffffff;
      --shadow-sm:0 4px 16px rgba(20,186,110,.15);
    }
    body{margin:0;font-family:sans-serif;background:#f7fff9;}

    /* Header */
    header{position:sticky;top:0;background:#fff;border-bottom:1px solid #e9f8f0;box-shadow:var(--shadow-sm);}
    .header-inner{display:flex;flex-wrap:wrap;gap:8px;padding:10px;align-items:center;justify-content:space-between;}

    /* Desktop */
    @media(min-width:900px){
      .header-inner{flex-wrap:nowrap;}
    }

    /* Mobile compact header */
    @media(max-width:899px){
      .header-inner{flex-direction:column;align-items:stretch;}
      .header-card{font-size:13px;padding:8px 10px;}
    }

    /* Header card */
    .header-card{
      background:#fff;border:1px solid #e8fbf1;border-radius:14px;padding:12px 14px;box-shadow:var(--shadow-sm);
      display:flex;flex-direction:column;align-items:center;justify-content:center;flex:1;text-align:center;
    }
    .header-card strong{font-size:15px;}

    /* Mobile: merge all stats into one card */
    @media(max-width:899px){
      .stats{display:flex;flex-direction:column;gap:6px;}
      .stats .header-card{padding:10px;}
    }

    .stats-desktop{display:flex;gap:12px;}

    /* FAB */
    .fab{position:fixed;right:16px;bottom:16px;z-index:60;}
    .fab-btn{width:64px;height:64px;border-radius:22px;border:none;display:grid;place-items:center;background:linear-gradient(180deg,#22e08f,#0faf64);box-shadow:0 14px 28px rgba(14,175,100,.35);color:#fff;font-size:24px;font-weight:900;}
    .fab-menu{position:absolute;right:76px;bottom:0;display:none;gap:8px;flex-wrap:wrap;}
    .fab.open .fab-menu{display:flex;}
    .chip{padding:8px 12px;border-radius:14px;background:#fff;box-shadow:var(--shadow-sm);border:1px solid #e4fbef;font-weight:600;cursor:pointer;}
  /* --- PATCH: mobile header compact, centering, fab fix --- */
    .card{justify-content:center;text-align:center}
    .stats-compact{display:none}
    @media(max-width:899px){
      .stats{display:none}
      .stats-compact{display:block}
      .title3d h1{font-size:16px}
      .card .value{font-size:13px}
      .card .label{font-size:11px}
    }
    .fab-drag{pointer-events:none}
  </style>
</head>
<body>
  <header>
    <div class="header-inner">
      <div class="header-card">
        <div><strong id="helloName">Salom</strong></div>
        <div id="helloAge">Yosh: —</div>
        <div>ID: <span id="headerID">—</span></div>
        <div>Balans: <span id="headerBalans">0</span></div>
        <div>Ball: <span id="headerBall">0</span></div>
      </div>
    </div>
          <div class="stats-compact" id="headerCompact"></div>
    </header>

  <main>
    <div id="app"></div>
  </main>

  <!-- Floating Menu -->
  <div class="fab" id="fab">
    <button class="fab-btn" id="fabBtn">≡</button>
    <div class="fab-menu" id="fabMenu">
      <div class="chip" data-route="home">Bosh sahifa</div>
      <div class="chip" data-route="tests">Testlar</div>
      <div class="chip" data-route="live">Live</div>
      <div class="chip" data-route="profile">Profil</div>
      <div class="chip" data-route="settings">Sozlamalar</div>
      <div class="chip" id="logoutBtn">Chiqish</div>
    </div>
  </div>

  <script>
    const fab=document.getElementById('fab');
    const fabBtn=document.getElementById('fabBtn');
    fabBtn.onclick=()=>fab.classList.toggle('open');
    document.getElementById('fabMenu').onclick=(e)=>{
      const btn=e.target.closest('.chip');if(!btn)return;
      alert("Route: "+btn.dataset.route);
    };
      // --- PATCH: compact header & FAB fix ---
    function updateHeader(userDoc){
      const name = userDoc?.ism || 'Foydalanuvchi';
      const age = userDoc?.yosh || (userDoc?.tugilgan ? calcAge(userDoc.tugilgan) : '—');
      const id = userDoc?.numericId ?? '—';
      const balans = (userDoc?.balans ?? 0).toLocaleString('uz-UZ');
      const ball = (userDoc?.ball ?? 0).toLocaleString('uz-UZ');
      // Desktop kartalar
      const el = (id)=>document.getElementById(id);
      if(el('helloName')) el('helloName').textContent = name;
      if(el('helloAge')) el('helloAge').textContent = `Yosh: ${age}`;
      if(el('headerID')) el('headerID').textContent = id;
      if(el('headerBalans')) el('headerBalans').textContent = balans;
      if(el('headerBall')) el('headerBall').textContent = ball;
      // Mobil ixcham karta
      const compact = el('headerCompact');
      if(compact){
        compact.innerHTML = `
          <div class="card">
            <div style="width:100%">
              <div style="display:flex; justify-content:space-between; align-items:center; gap:8px; margin-bottom:6px;">
                <div style="font-weight:800;">Salom <span style="font-weight:900">${name}</span></div>
                <div class="hint">Yosh: ${age}</div>
              </div>
              <div style="display:grid; grid-template-columns:repeat(3,1fr); gap:8px; text-align:center;">
                <div><div class="label">ID</div><div class="value">${id}</div></div>
                <div><div class="label">Balans</div><div class="value">${balans}</div></div>
                <div><div class="label">Ball</div><div class="value">${ball}</div></div>
              </div>
            </div>
          </div>`;
      }
    }

    // FAB toggle va dragni tuzatish (overlay clickni to'smasin)
    (function(){
      const fab = document.getElementById('fab');
      const fabBtn = document.getElementById('fabBtn');
      const fabMenu = document.getElementById('fabMenu');
      if(!fab || !fabBtn) return;
      fabBtn.onclick = (e)=>{ e.stopPropagation(); fab.classList.toggle('open'); };
      fab.addEventListener('click', (e)=>{
        const btn = e.target.closest('.chip'); if(!btn) return;
        const r = btn.getAttribute('data-route'); if(!r){ if(btn.id==='logoutBtn') doLogout(); return; }
        loadRoute(r); fab.classList.remove('open');
      });
      let sx=0, sy=0, startRight=16, startBottom=16, dragging=false;
      const getRB = ()=>{ const s = getComputedStyle(fab); return {r: parseFloat(s.right), b: parseFloat(s.bottom)}; };
      const pointerDown = (e)=>{ dragging=true; fabBtn.style.cursor='grabbing'; sx=e.clientX; sy=e.clientY; const {r,b}=getRB(); startRight=r; startBottom=b; };
      const pointerMove = (e)=>{ if(!dragging) return; const dx=e.clientX-sx; const dy=e.clientY-sy; fab.style.right = Math.max(8, startRight-dx)+"px"; fab.style.bottom = Math.max(8, startBottom-dy)+"px"; };
      const pointerUp = ()=>{ dragging=false; fabBtn.style.cursor=''; };
      fabBtn.addEventListener('pointerdown', pointerDown);
      window.addEventListener('pointermove', pointerMove);
      window.addEventListener('pointerup', pointerUp);
    })();
  </script>
</body>
</html>
