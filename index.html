<!DOCTYPE html>
<html lang="uz" data-theme="system">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>XplusY â€“ SPA</title>
  <meta name="theme-color" content="#f6fbf8"/>
  <link rel="stylesheet" href="./css/base.css"/>
  <link rel="stylesheet" href="./css/theme.css"/>
</head>
<body>
  <header>
    <div class="bar container">
      <div class="brand">
        <span>ðŸŽ“</span><span>XplusY</span>
      </div>
      <nav class="nav" id="topnav">
        <a href="#/home">Bosh sahifa</a>
        <a href="#/tests">Testlar</a>
        <a href="#/live">Live</a>
        <a href="#/leaderboard">Reyting</a>
        <a href="#/settings">Sozlamalar</a>
      </nav>
      <div class="right">
        <button id="btnTheme" class="btn ghost" title="Tema">ðŸŒ—</button>
        <button id="btnLogin" class="btn">Google bilan kirish</button>
        <div id="userBox" class="hide">
          <img id="avatar" src="" alt="" style="width:28px;height:28px;border-radius:50%"/>
          <span id="displayName" class="status"></span>
          <button id="btnLogout" class="btn ghost">Chiqish</button>
        </div>
      </div>
    </div>
  </header>

  <main class="container">
    <div id="app">
      <div class="card">
        Yuklanmoqda...
      </div>
    </div>
  </main>

  <footer>
    <div class="container status">
      Â© 2025 XplusY â€¢ SPA skeleton â€¢ Tema: <span id="themeLabel">system</span>
    </div>
  </footer>

  <!-- App scripts -->
  <script src="./js/common.js"></script>
  <script src="./js/router.js"></script>

  <!-- Firebase (modular, via CDN) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDYwHJou_9GqHZcf8XxtTByC51Z8un8rrM",
      authDomain: "xplusy-760fa.firebaseapp.com",
      projectId: "xplusy-760fa",
      storageBucket: "xplusy-760fa.appspot.com",
      messagingSenderId: "992512966017",
      appId: "1:992512966017:web:5e919dbc9b8d8abcb43c80",
      measurementId: "G-459PLJ7P7L"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    const btnLogin = document.getElementById("btnLogin");
    const btnLogout = document.getElementById("btnLogout");
    const userBox = document.getElementById("userBox");
    const avatar = document.getElementById("avatar");
    const displayName = document.getElementById("displayName");

    btnLogin?.addEventListener("click", async () => {
      try {
        await signInWithPopup(auth, provider);
      } catch (e) {
        alert("Kirishda xato: " + (e?.message || e));
        console.error(e);
      }
    });

    btnLogout?.addEventListener("click", async () => {
      await signOut(auth);
    });

    onAuthStateChanged(auth, (user) => {
      if (user) {
        btnLogin?.classList.add("hide");
        userBox?.classList.remove("hide");
        avatar.src = user.photoURL || "";
        displayName.textContent = user.displayName || user.email || "Foydalanuvchi";
      } else {
        btnLogin?.classList.remove("hide");
        userBox?.classList.add("hide");
        avatar.src = "";
        displayName.textContent = "";
      }
    });
  </script>
</body>
</html>
