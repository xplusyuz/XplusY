<!doctype html>
<html lang="uz">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MathCenter.uz ‚Äî Bosh sahifa</title>
  <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
  <style>
    :root{ --green:#0faf64; --edge:#e0f3eb; --bg:#f6fffb; }
    *{box-sizing:border-box}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:var(--bg)}

    header{position:sticky;top:0;z-index:10;padding:10px 16px;background:#ffffffd9;border-bottom:1px solid #eaf7f1;backdrop-filter:saturate(150%) blur(6px);}
    .header-inner{max-width:1200px;margin:0 auto;display:grid;gap:12px;align-items:center;}
    @media(min-width:900px){ .header-inner{ grid-template-columns: 1fr auto; } }

    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:48px;height:48px;border-radius:14px;background:radial-gradient(60% 60% at 50% 35%, #b9ffd9, #2de38d 55%, #0ea55a 100%);display:grid;place-items:center;box-shadow:0 0 36px rgba(14,175,100,.35), inset 0 0 20px rgba(255,255,255,.7)}
    .logo svg{width:28px;height:28px;fill:#fff}
    .brand-title{padding:8px 12px;border-radius:14px;background:linear-gradient(145deg,#f7fffb,#eafff5);box-shadow:0 10px 18px #b0f5d633,inset 0 -3px 8px rgba(255,255,255,.8)}
    .brand-title h1{margin:0;font-size:20px;background:linear-gradient(180deg,#0dbb6f,#0a8f52);-webkit-background-clip:text;color:transparent;font-weight:900;letter-spacing:.3px}

    main{max-width:1200px;margin:16px auto 96px;padding:0 16px}
    .content{background:#fff;border:1px solid var(--edge);border-radius:16px;padding:16px;box-shadow:0 4px 12px rgba(0,0,0,.06)}

    /* Hero */
    .hero{position:relative;border-radius:22px;overflow:hidden;border:1px solid #e0f3eb;background:#dff7ee;min-height:260px;display:grid;place-items:center;box-shadow:0 12px 28px rgba(10,143,82,.12)}
    .hero .bg{position:absolute;inset:0;background-size:cover;background-position:center;filter:saturate(1.05) contrast(1.05)}
    .hero .veil{position:absolute;inset:0;background:linear-gradient(180deg,#00000030,#00000020)}
    .hero .inner{position:relative;z-index:2;color:#fff;text-align:center;padding:32px}
    .hero .inner h2{margin:0 0 10px 0;font-size:28px}
    .hero .inner p{margin:0 0 14px 0;font-size:16px;opacity:.95}
    .hero .actions{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
    .pill{appearance:none;display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:999px;border:1px solid #cfeee0;background:#fff;color:#064e3b;text-decoration:none;font-weight:700;transition:.15s}
    .pill:hover{transform:translateY(-1px);box-shadow:0 6px 14px rgba(16,185,129,.15)}
    .mc-badge{display:inline-block;border:1px solid #eaf7f1;border-radius:999px;padding:4px 10px;font-size:12px;background:#fff}

    /* Grids */
    .block-title{display:flex;justify-content:space-between;align-items:center;gap:8px;margin:14px 0 8px 0}
    .cards{display:grid;gap:16px}
    .cards.fixed-3-2-1{grid-template-columns:1fr}
    @media(min-width:640px){ .cards.fixed-3-2-1{grid-template-columns:repeat(2,1fr)} }
    @media(min-width:1024px){ .cards.fixed-3-2-1{grid-template-columns:repeat(3,1fr)} }
    .cards.auto-fill{grid-template-columns:repeat(auto-fill,minmax(250px,1fr))}

    .card3d{background:#fff;border:1px solid var(--edge);border-radius:16px;box-shadow:0 12px 28px rgba(10,143,82,.12), 0 2px 6px rgba(0,0,0,.05);overflow:hidden;display:flex;flex-direction:column;transition:transform .15s ease, box-shadow .15s ease}
    .card3d:hover{transform:translateY(-3px);box-shadow:0 16px 36px rgba(10,143,82,.18)}
    .card3d .media{width:100%;height:180px;object-fit:cover;background:#f1f5f4}
    .card3d .body{padding:14px}
    .ctitle{margin:0 0 6px 0;font-size:18px;display:flex;flex-wrap:wrap;gap:6px;align-items:center}
    .tag{display:inline-block;padding:2px 8px;border-radius:999px;background:#f3fbf7;border:1px solid #cfeee0;color:#087454;font-size:11px}
    .desc{margin:8px 0;color:#5d776f;font-size:14px;line-height:1.5}
    .foot{display:flex;align-items:center;justify-content:space-between;margin-top:10px}
    .price{font-weight:800;color:#0a3a2d}
    .price.free{color:#047857}
  </style>
</head>
<body>
  <header>
    <div class="header-inner">
      <div class="brand">
        <div class="logo"><svg viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M76 92h104c9 0 16-7 16-16s-7-16-16-16H60c-9 0-16 7-16 16s7 16 16 16h4c8 41 4 77-8 97-5 8 5 17 13 12 24-14 35-53 29-109zm57 0c7 39 3 74-8 94-5 9 6 18 14 12 24-16 35-56 28-106h-34z"/></svg></div>
        <div class="brand-title"><h1>MathCenter.uz</h1></div>
      </div>
      <div>
        <a class="pill" href="admin.html">üîê Admin</a>
      </div>
    </div>
  </header>

  <main>
    <!-- HERO (home) -->
    <div class="content" id="heroBlock">
      <div class="hero">
        <div id="hero-bg" class="bg"></div><div class="veil"></div>
        <span id="homeTag" class="mc-badge" style="position:absolute;top:12px;left:12px;display:none"></span>
        <div class="inner">
          <h2 id="homeTitle">Yuklanmoqda‚Ä¶</h2>
          <p id="homeDesc"></p>
          <div class="actions"><a id="homeBtn" class="pill" href="#courses">Boshlash</a></div>
        </div>
      </div>
    </div>

    <!-- COURSES -->
    <div class="content">
      <div class="block-title">
        <h2 style="margin:0">Kurslar</h2>
        <div>
          <button id="mode321" class="pill">3/2/1</button>
          <button id="modeAuto" class="pill">Auto</button>
        </div>
      </div>
      <div id="gridCourses" class="cards fixed-3-2-1"></div>
    </div>

    <!-- SIMULATORLAR -->
    <div class="content">
      <div class="block-title">
        <h2 style="margin:0">Simulyatorlar</h2>
      </div>
      <div id="gridSims" class="cards fixed-3-2-1"></div>
    </div>

    <!-- TESTLAR -->
    <div class="content">
      <div class="block-title">
        <h2 style="margin:0">Testlar</h2>
      </div>
      <div id="gridTests" class="cards fixed-3-2-1"></div>
    </div>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, query, where, orderBy, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {"apiKey": "AIzaSyDYwHJou_9GqHZcf8XxtTByC51Z8un8rrM", "authDomain": "xplusy-760fa.firebaseapp.com", "projectId": "xplusy-760fa", "storageBucket": "xplusy-760fa.appspot.com", "messagingSenderId": "992512966017", "appId": "1:992512966017:web:5e919dbc9b8d8abcb43c80", "measurementId": "G-459PLJ7P7L"};
    const app = initializeApp(firebaseConfig);
    const db  = getFirestore(app);

    const price = v => ((+v||0)<=0 ? '<span class="price free">FREE</span>' : `<span class="price">${(+v).toLocaleString('uz-UZ')} so'm</span>`);
    const el = html => { const t=document.createElement('template'); t.innerHTML=html.trim(); return t.content.firstChild; };

    function card(c){
      return `<article class="card3d">
        ${c.image?`<img class="media" src="${c.image}" alt="cover">`:''}
        <div class="body">
          <h3 class="ctitle">${c.title||'‚Äî'} ${c.tag?`<span class="tag">${String(c.tag).toUpperCase()}</span>`:''} ${c.cat?`<span class="tag">${c.cat}</span>`:''}</h3>
          ${c.desc?`<p class="desc">${c.desc}</p>`:''}
          <div class="foot">${price(c.price)} ${c.link?`<a class="pill" href="${c.link}" target="${c.link?.startsWith('http')?'__blank':'_self'}">${c.button||'Boshlash'}</a>`:''}</div>
        </div>
      </article>`;
    }

    async function getByType(type){
      try{
        const qy = query(collection(db,'catalog'), where('type','==',type), orderBy('updatedAt','desc'));
        const snap = await getDocs(qy);
        const arr=[]; snap.forEach(d=>arr.push(d.data()));
        return arr;
      }catch(err){
        const qy = query(collection(db,'catalog'), where('type','==',type));
        const snap = await getDocs(qy);
        const arr=[]; snap.forEach(d=>arr.push(d.data()));
        return arr;
      }
    }

    async function renderHome(){
      let data = (await getByType('home'))[0];
      if(!data) data = { title:'Matematika marafoni!', desc:'Algebra, geometriya va onlayn testlar ‚Äî barchasi bir joyda.', image:'https://picsum.photos/seed/promo/1200/600', button:'Boshlash', link:'#courses' };
      document.getElementById('hero-bg').style.backgroundImage = `url("${data.image||''}")`;
      document.getElementById('homeTitle').textContent = data.title||'';
      document.getElementById('homeDesc').textContent  = data.desc||'';
      const btn = document.getElementById('homeBtn'); btn.textContent=data.button||'Boshlash'; btn.href=data.link||'#courses';
      const tg  = document.getElementById('homeTag'); if(data.tag||data.promotag){ tg.style.display='inline-block'; tg.textContent=data.tag||data.promotag; }
    }

    async function renderGrid(kind, rootId){
      const map = { courses:'course', simulators:'sim', tests:'test' };
      const data = await getByType(map[kind]);
      const root = document.getElementById(rootId);
      root.innerHTML = '';
      data.forEach(c=> root.appendChild(el(card(c))));
    }

    // Grid mode toggle
    const applyMode = (m)=>{ ['gridCourses','gridSims','gridTests'].forEach(id=>{ const el=document.getElementById(id); if(!el) return; el.classList.toggle('auto-fill', m==='auto'); el.classList.toggle('fixed-3-2-1', m!=='auto'); }); localStorage.setItem('gridmode', m); };
    document.getElementById('mode321').onclick=()=>applyMode('fixed');
    document.getElementById('modeAuto').onclick=()=>applyMode('auto');
    applyMode(localStorage.getItem('gridmode')==='auto'?'auto':'fixed');

    // Initial render
    renderHome();
    renderGrid('courses','gridCourses');
    renderGrid('simulators','gridSims');
    renderGrid('tests','gridTests');
  </script>
</body>
</html>
