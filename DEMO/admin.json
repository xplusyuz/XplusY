{
  "chips": [
    {
      "id": "home",
      "icon": "svg/home.png",
      "html": "<!doctype html>\n<html lang=\"uz\">\n<head>\n  <meta charset=\"utf-8\"/>\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"/>\n  <title>LeaderMath — Banners Only</title>\n  <meta name=\"theme-color\" content=\"#000\"/>\n  <link rel=\"icon\" href=\"./logo.png\"/>\n  <style>\n    /* Ekranni to'liq egallash */\n    html,body{height:100%;margin:0;background:#000;overflow:hidden}\n    .stage{position:fixed;inset:0;background:#000}\n    .layer{position:absolute;inset:0;opacity:0;transition:opacity .35s ease;border:0;width:100%;height:100%}\n    .layer.show{opacity:1}\n    /* Tap/Swipe zonalari (ko'rinmas) */\n    .tap{position:absolute;inset:0;display:grid;grid-template-columns:1fr 1fr;z-index:5}\n    .tap>div{height:100%}\n    .tap .left{cursor:w-resize}\n    .tap .right{cursor:e-resize}\n  </style>\n</head>\n<body>\n  <div class=\"stage\">\n    <!-- Double buffer iframes -->\n    <iframe id=\"A\" class=\"layer show\" loading=\"eager\"\n      sandbox=\"allow-forms allow-pointer-lock allow-popups allow-same-origin allow-scripts\" referrerpolicy=\"no-referrer\"></iframe>\n    <iframe id=\"B\" class=\"layer\"\n      sandbox=\"allow-forms allow-pointer-lock allow-popups allow-same-origin allow-scripts\" referrerpolicy=\"no-referrer\"></iframe>\n\n    <!-- Ko'rinmas boshqaruv zonalari -->\n    <div class=\"tap\">\n      <div id=\"left\"  class=\"left\"  aria-label=\"prev\"></div>\n      <div id=\"right\" class=\"right\" aria-label=\"next\"></div>\n    </div>\n  </div>\n\n  <script>\n  // ===== Sozlamalar =====\n  const DUR_MS = 5000;     // har slaydga 5s\n  const WRAP   = true;     // oxiridan boshiga o'tsin\n\n  // ===== Holat =====\n  let DATA = {sections:[]};\n  let playlist = [];       // {secIdx, idx, html, bg, link, title}\n  let ptr = 0;             // joriy indeks\n  let active = 'A';        // qaysi iframe ko'rinmoqda: 'A' | 'B'\n  let timer = null;\n  let lastTick = 0;\n  let remaining = DUR_MS;\n  let paused = false;\n\n  // ===== Qisqa yordamchilar =====\n  const $ = sel => document.querySelector(sel);\n  const A = $('#A'), B = $('#B');\n  const L = $('#left'), R = $('#right');\n\n  function wrapHtml(bn, sec){\n    const bg = bn.bg || (sec?.darkish ? '#0f1814' : '#ffffff');\n    const css = `\n      <style>\n        *{box-sizing:border-box}\n        html,body{height:100%;margin:0;background:${bg};font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}\n        a{text-decoration:none}\n      </style>`;\n    // Bannerning o'zi: bn.html\n    return css + (bn.html || `<div style=\"display:grid;place-items:center;height:100%;color:#888\">Bo‘sh banner</div>`);\n  }\n\n  function buildPlaylist(){\n    playlist = [];\n    DATA.sections.forEach((sec, sI)=>{\n      (sec.banners||[]).forEach((bn, bI)=>{\n        playlist.push({\n          secIdx: sI, idx: bI,\n          html: wrapHtml(bn, sec),\n          bg: bn.bg, link: bn.link, title: bn.title\n        });\n      });\n    });\n  }\n\n  // Double-buffer render\n  function renderTo(target, html){\n    target.srcdoc = html;\n  }\n  function show(idx, resetDur=false){\n    if(!playlist.length) return;\n    ptr = ((idx%playlist.length)+playlist.length)%playlist.length;\n    const nextLayer = active === 'A' ? B : A;\n    const curLayer  = active === 'A' ? A : B;\n\n    renderTo(nextLayer, playlist[ptr].html);\n    // cross-fade\n    nextLayer.classList.add('show');\n    curLayer.classList.remove('show');\n    active = (active === 'A') ? 'B' : 'A';\n\n    // timer\n    remaining = resetDur ? DUR_MS : remaining;\n    clearTimeout(timer);\n    if(!paused){\n      lastTick = performance.now();\n      timer = setTimeout(()=> next(), remaining);\n    }\n  }\n  function next(){\n    if(!playlist.length) return;\n    const nx = ptr + 1;\n    if(nx >= playlist.length){\n      if(!WRAP) return;\n      show(0, true);\n    }else{\n      show(nx, true);\n    }\n  }\n  function prev(){\n    if(!playlist.length) return;\n    const pv = ptr - 1;\n    if(pv < 0){\n      if(!WRAP) return;\n      show(playlist.length-1, true);\n    }else{\n      show(pv, true);\n    }\n  }\n\n  // Pauza/resume (ushlab turish)\n  function pause(){\n    if(paused) return;\n    paused = true;\n    clearTimeout(timer);\n    const elapsed = performance.now() - lastTick;\n    remaining = Math.max(0, remaining - elapsed);\n  }\n  function resume(){\n    if(!paused) return;\n    paused = false;\n    lastTick = performance.now();\n    timer = setTimeout(()=> next(), remaining);\n  }\n\n  // Controls\n  L.addEventListener('click', prev);\n  R.addEventListener('click', next);\n\n  ['left','right'].forEach(id=>{\n    const el = document.getElementById(id);\n    el.addEventListener('pointerdown', pause);\n    el.addEventListener('pointerup', resume);\n    el.addEventListener('pointerleave', resume);\n  });\n\n  // Swipe (mobil)\n  let sx=0, sy=0;\n  document.addEventListener('touchstart', e=>{\n    if(!e.touches[0]) return;\n    sx = e.touches[0].clientX; sy = e.touches[0].clientY; pause();\n  }, {passive:true});\n  document.addEventListener('touchend', e=>{\n    resume();\n    const t = e.changedTouches[0]; if(!t) return;\n    const dx = t.clientX - sx, dy = t.clientY - sy;\n    if(Math.abs(dx) > 40 && Math.abs(dx) > Math.abs(dy)){ dx < 0 ? next() : prev(); }\n  }, {passive:true});\n\n  // Klaviatura\n  window.addEventListener('keydown', e=>{\n    if(e.key === 'ArrowRight') next();\n    else if(e.key === 'ArrowLeft') prev();\n    else if(e.code === 'Space'){ paused ? resume() : pause(); e.preventDefault(); }\n  });\n\n  async function init(){\n    try{\n      const res = await fetch('./banner.json', {cache:'no-store'});\n      DATA = await res.json();\n      buildPlaylist();\n      if(!playlist.length){\n        // JSON bo'sh bo'lsa ham \"faqat banner\" falsafasini buzmaslik uchun banner ichida xabar\n        const msg = `<div style=\"display:grid;place-items:center;height:100%;background:#111;color:#fff;font-family:system-ui\">\n          <div style=\"text-align:center;opacity:.9\">banner.json bo'sh</div></div>`;\n        A.srcdoc = msg; A.classList.add('show'); return;\n      }\n      // birinchi bannerlarni har ikkala qatlamga yuklab, keyin ko'rsatish\n      A.srcdoc = playlist[0].html; A.classList.add('show'); active='A';\n      // 2-chi oldindan bufferga (agar bo'lsa)\n      if(playlist[1]) B.srcdoc = playlist[1].html;\n\n      // avtomatik start\n      remaining = DUR_MS; lastTick = performance.now();\n      timer = setTimeout(()=> next(), remaining);\n    }catch(err){\n      const msg = `<div style=\"display:grid;place-items:center;height:100%;background:#111;color:#fff;font-family:system-ui\">\n        <div style=\"text-align:center;opacity:.9\">banner.json yuklanmadi</div></div>`;\n      A.srcdoc = msg; A.classList.add('show');\n    }\n  }\n  init();\n  </script>\n</body>\n</html>\n"
    }
  ]
}