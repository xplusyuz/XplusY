<!doctype html>
<html lang="uz">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>LeaderMath â€” Full Banner Carousel</title>
  <meta name="theme-color" content="#2E8B57"/>
  <link rel="icon" href="./logo.png"/>

  <style>
    :root{
      --brand:#2E8B57;
      --bg:#f4f8f6;
      --vh:1vh;
    }
    html,body{height:100%;margin:0;padding:0;overflow:hidden;background:var(--bg);}
    *{box-sizing:border-box;}

    /* dynamic full height */
    .carousel-viewport{
      position:fixed;
      inset:0;
      width:100%;
      height:calc(var(--vh) * 100);
      overflow:hidden;
      background:#000;
    }

    .slides{
      display:grid;
      grid-auto-flow:column;
      grid-auto-columns:100%;
      width:100%;
      height:100%;
      transition:transform .8s ease-in-out;
    }

    iframe{
      width:100%;
      height:100%;
      border:0;
      display:block;
      background:#000;
    }

    /* simple fade overlay (optional aesthetic) */
    .gradient-overlay{
      position:absolute;
      inset:0;
      background:linear-gradient(180deg,rgba(0,0,0,.25),rgba(0,0,0,.1));
      pointer-events:none;
    }

    /* responsive ratio adjust */
    @media (max-aspect-ratio: 9/16){
      iframe{object-fit:cover;}
    }
  </style>
</head>
<body>

  <div class="carousel-viewport" id="viewport">
    <div class="slides" id="slides"></div>
    <div class="gradient-overlay"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDYwHJou_9GqHZcf8XxtTByC51Z8un8rrM",
      authDomain: "xplusy-760fa.firebaseapp.com",
      projectId: "xplusy-760fa",
      storageBucket: "xplusy-760fa.appspot.com",
      messagingSenderId: "992512966017",
      appId: "1:992512966017:web:5e919dbc9b8d8abcb43c80",
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const q = s => document.querySelector(s);
    function setVH(){ document.documentElement.style.setProperty('--vh', (window.innerHeight * 0.01)+'px'); }
    setVH(); addEventListener('resize', setVH); addEventListener('orientationchange', setVH);

    async function loadBanners(){
      try{
        const snap = await getDoc(doc(db,'configs','home'));
        if(!snap.exists()) throw 0;
        const data = snap.data();
        const sections = data.sections||[];
        const banners = sections[0]?.subsections?.[0]?.banners||[];
        renderCarousel(banners);
      }catch(e){
        console.error(e);
        q('#slides').innerHTML = `<iframe srcdoc="<h1 style='color:white;text-align:center;margin-top:40vh'>Banner topilmadi</h1>"></iframe>`;
      }
    }

    function frameFromBanner(b){
      const f=document.createElement('iframe');
      f.sandbox = b.sandbox || 'allow-scripts allow-forms';
      if(b.mode==='url' && b.src){
        f.src=b.src;
      }else{
        const html = `<!doctype html><html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'><style>html,body{margin:0;height:100%;overflow:hidden;background:#000}</style></head><body>${b.contentHtml||''}</body></html>`;
        f.srcdoc = html;
      }
      return f;
    }

    function renderCarousel(banners){
      const slides = q('#slides');
      slides.innerHTML='';
      banners.forEach(b=>{
        const holder=document.createElement('div');
        holder.style.position='relative';
        holder.appendChild(frameFromBanner(b));
        slides.appendChild(holder);
      });

      let i=0;
      const total=banners.length;
      if(total<=1) return;
      setInterval(()=>{
        i=(i+1)%total;
        slides.style.transform=`translateX(-${i*100}%)`;
      },5000); // 5s each
    }

    loadBanners();
  </script>

</body>
</html>
