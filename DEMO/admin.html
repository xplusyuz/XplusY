<!doctype html>
<html lang="uz">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>LeaderMath ‚Äî Admin Panel</title>
  <meta name="theme-color" content="#2E8B57"/>
  <style>
    body{margin:0;font-family:system-ui;background:#f4f8f6;color:#0d1b14;padding:20px}
    h1{color:#2E8B57}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    td,th{border:1px solid #d8e7dd;padding:8px}
    input,textarea{width:100%;border:1px solid #cfe7db;border-radius:8px;padding:6px}
    .btn{background:#2E8B57;color:#fff;border:none;padding:8px 14px;border-radius:8px;cursor:pointer}
    .btn.red{background:#a33}
  </style>
</head>
<body>
  <h1>LeaderMath ‚Äî Admin Panel</h1>
  <button class="btn" onclick="addChip()">+ Chip qo‚Äòshish</button>
  <button class="btn" onclick="downloadJson()">JSON yuklab olish</button>
  <table id="tbl">
    <thead><tr><th>ID</th><th>Nomi</th><th>Order</th><th>Ko‚Äòrinadi</th><th>Amal</th></tr></thead>
    <tbody></tbody>
  </table>

  <div id="editor" style="display:none;margin-top:20px">
    <h3>Chip tahrirlash</h3>
    <label>Nomi:<br><input id="label"></label><br><br>
    <label>Order:<br><input id="order" type="number"></label><br><br>
    <label>Ko‚Äòrinadigan:<input type="checkbox" id="visible" checked></label><br><br>
    <label>HTML:<br><textarea id="html" rows="12"></textarea></label><br><br>
    <button class="btn" onclick="saveChip()">Saqlash</button>
    <button class="btn red" onclick="cancelEdit()">Bekor</button>
  </div>

<script>
let DATA={chips:[]};
let editId=null;
async function load(){
  try{
    const res=await fetch('admin.json',{cache:'no-store'});
    DATA=await res.json();
  }catch{DATA={chips:[]}}
  render();
}
function render(){
  const tb=document.querySelector('#tbl tbody');
  tb.innerHTML=DATA.chips.map(c=>`
    <tr>
      <td>${c.id}</td>
      <td>${c.label}</td>
      <td>${c.order||0}</td>
      <td>${c.visible!==false?'‚úÖ':'‚ùå'}</td>
      <td>
        <button onclick="editChip('${c.id}')">‚úèÔ∏è</button>
        <button onclick="delChip('${c.id}')">üóëÔ∏è</button>
      </td>
    </tr>`).join('');
}
function addChip(){
  const id='chip_'+Date.now().toString(36);
  editId=id;
  document.querySelector('#editor').style.display='block';
  document.querySelector('#label').value='Yangi chip';
  document.querySelector('#order').value=DATA.chips.length+1;
  document.querySelector('#visible').checked=true;
  document.querySelector('#html').value='<!doctype html><html><body><h2>Yangi chip</h2></body></html>';
}
function editChip(id){
  const c=DATA.chips.find(x=>x.id===id);
  if(!c)return;
  editId=id;
  document.querySelector('#editor').style.display='block';
  document.querySelector('#label').value=c.label;
  document.querySelector('#order').value=c.order;
  document.querySelector('#visible').checked=c.visible!==false;
  document.querySelector('#html').value=c.html;
}
function saveChip(){
  const obj={
    id:editId,
    label:document.querySelector('#label').value.trim(),
    order:Number(document.querySelector('#order').value)||0,
    visible:document.querySelector('#visible').checked,
    html:document.querySelector('#html').value
  };
  const ex=DATA.chips.findIndex(x=>x.id===editId);
  if(ex>=0)DATA.chips[ex]=obj;else DATA.chips.push(obj);
  render();
  document.querySelector('#editor').style.display='none';
}
function cancelEdit(){document.querySelector('#editor').style.display='none';}
function delChip(id){
  if(confirm('O‚Äòchirilsinmi?')){
    DATA.chips=DATA.chips.filter(c=>c.id!==id);
    render();
  }
}
function downloadJson(){
  const a=document.createElement('a');
  a.href=URL.createObjectURL(new Blob([JSON.stringify(DATA,null,2)],{type:'application/json'}));
  a.download='admin.json';a.click();
}
load();
</script>
</body>
</html>
